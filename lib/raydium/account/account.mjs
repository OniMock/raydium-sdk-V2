var _n=Object.defineProperty;var Mn=(t,e,n)=>e in t?_n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var De=(t,e,n)=>(Mn(t,typeof e!="symbol"?e+"":e,n),n);import{PublicKey as st,SystemProgram as Lo}from"@solana/web3.js";import{PublicKey as On}from"@solana/web3.js";import{get as Ft,set as Dn}from"lodash";var at=class{logLevel;name;constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let n=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Ut={},vn={};function H(t){let e=Ft(Ut,t);if(!e){let n=Ft(vn,t);e=new at({name:t,logLevel:n}),Dn(Ut,t,e)}return e}import{MINT_SIZE as Vo,TOKEN_PROGRAM_ID as Wo,getTransferFeeConfig as qo,unpackMint as Go}from"@solana/spl-token";var ct=H("Raydium_accountInfo_util");async function Vt(t,e,n){let{batchRequest:r,commitment:o="confirmed",chunkCount:i=100}={batchRequest:!1,...n},s=ut(e,i),a=new Array(s.length).fill([]);if(r){let u=s.map(l=>{let p=t._buildArgs([l.map(m=>m.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:p}}),c=ut(u,10);a=(await(await Promise.all(c.map(async l=>await t._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&ct.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(p=>{if(p){let{data:m,executable:d,lamports:b,owner:g,rentEpoch:x}=p;return m.length!==2&&m[1]!=="base64"&&ct.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(m[0],"base64"),executable:d,lamports:b,owner:new On(g),rentEpoch:x}}return null})))}else try{a=await Promise.all(s.map(u=>t.getMultipleAccountsInfo(u,o)))}catch(u){u instanceof Error&&ct.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}import re from"bn.js";var me=9e15,ce=1e9,lt="0123456789abcdef",Oe="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Ke="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",ft={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-me,maxE:me,crypto:!1},Ht,te,S=!0,Ue="[DecimalError] ",ae=Ue+"Invalid argument: ",jt=Ue+"Precision limit exceeded",Zt=Ue+"crypto unavailable",zt="[object Decimal]",j=Math.floor,W=Math.pow,Kn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Fn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Un=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Qt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,J=1e7,A=7,Vn=9007199254740991,Wn=Oe.length-1,pt=Ke.length-1,h={toStringTag:zt};h.absoluteValue=h.abs=function(){var t=new this.constructor(this);return t.s<0&&(t.s=1),P(t)};h.ceil=function(){return P(new this.constructor(this),this.e+1,2)};h.clampedTo=h.clamp=function(t,e){var n,r=this,o=r.constructor;if(t=new o(t),e=new o(e),!t.s||!e.s)return new o(NaN);if(t.gt(e))throw Error(ae+e);return n=r.cmp(t),n<0?t:r.cmp(e)>0?e:new o(r)};h.comparedTo=h.cmp=function(t){var e,n,r,o,i=this,s=i.d,a=(t=new i.constructor(t)).d,u=i.s,c=t.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(i.e!==t.e)return i.e>t.e^u<0?1:-1;for(r=s.length,o=a.length,e=0,n=r<o?r:o;e<n;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return r===o?0:r>o^u<0?1:-1};h.cosine=h.cos=function(){var t,e,n=this,r=n.constructor;return n.d?n.d[0]?(t=r.precision,e=r.rounding,r.precision=t+Math.max(n.e,n.sd())+A,r.rounding=1,n=qn(r,en(r,n)),r.precision=t,r.rounding=e,P(te==2||te==3?n.neg():n,t,e,!0)):new r(1):new r(NaN)};h.cubeRoot=h.cbrt=function(){var t,e,n,r,o,i,s,a,u,c,f=this,l=f.constructor;if(!f.isFinite()||f.isZero())return new l(f);for(S=!1,i=f.s*W(f.s*f,1/3),!i||Math.abs(i)==1/0?(n=G(f.d),t=f.e,(i=(t-n.length+1)%3)&&(n+=i==1||i==-2?"0":"00"),i=W(n,1/3),t=j((t+1)/3)-(t%3==(t<0?-1:2)),i==1/0?n="5e"+t:(n=i.toExponential(),n=n.slice(0,n.indexOf("e")+1)+t),r=new l(n),r.s=f.s):r=new l(i.toString()),s=(t=l.precision)+3;;)if(a=r,u=a.times(a).times(a),c=u.plus(f),r=v(c.plus(f).times(a),c.plus(u),s+2,1),G(a.d).slice(0,s)===(n=G(r.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!o&&n=="4999"){if(!o&&(P(a,t+1,0),a.times(a).times(a).eq(f))){r=a;break}s+=4,o=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(P(r,t+1,1),e=!r.times(r).times(r).eq(f));break}return S=!0,P(r,t,l.rounding,e)};h.decimalPlaces=h.dp=function(){var t,e=this.d,n=NaN;if(e){if(t=e.length-1,n=(t-j(this.e/A))*A,t=e[t],t)for(;t%10==0;t/=10)n--;n<0&&(n=0)}return n};h.dividedBy=h.div=function(t){return v(this,new this.constructor(t))};h.dividedToIntegerBy=h.divToInt=function(t){var e=this,n=e.constructor;return P(v(e,new n(t),0,1,1),n.precision,n.rounding)};h.equals=h.eq=function(t){return this.cmp(t)===0};h.floor=function(){return P(new this.constructor(this),this.e+1,3)};h.greaterThan=h.gt=function(t){return this.cmp(t)>0};h.greaterThanOrEqualTo=h.gte=function(t){var e=this.cmp(t);return e==1||e===0};h.hyperbolicCosine=h.cosh=function(){var t,e,n,r,o,i=this,s=i.constructor,a=new s(1);if(!i.isFinite())return new s(i.s?1/0:NaN);if(i.isZero())return a;n=s.precision,r=s.rounding,s.precision=n+Math.max(i.e,i.sd())+4,s.rounding=1,o=i.d.length,o<32?(t=Math.ceil(o/3),e=(1/We(4,t)).toString()):(t=16,e="2.3283064365386962890625e-10"),i=de(s,1,i.times(e),new s(1),!0);for(var u,c=t,f=new s(8);c--;)u=i.times(i),i=a.minus(u.times(f.minus(u.times(f))));return P(i,s.precision=n,s.rounding=r,!0)};h.hyperbolicSine=h.sinh=function(){var t,e,n,r,o=this,i=o.constructor;if(!o.isFinite()||o.isZero())return new i(o);if(e=i.precision,n=i.rounding,i.precision=e+Math.max(o.e,o.sd())+4,i.rounding=1,r=o.d.length,r<3)o=de(i,2,o,o,!0);else{t=1.4*Math.sqrt(r),t=t>16?16:t|0,o=o.times(1/We(5,t)),o=de(i,2,o,o,!0);for(var s,a=new i(5),u=new i(16),c=new i(20);t--;)s=o.times(o),o=o.times(a.plus(s.times(u.times(s).plus(c))))}return i.precision=e,i.rounding=n,P(o,e,n,!0)};h.hyperbolicTangent=h.tanh=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+7,r.rounding=1,v(n.sinh(),n.cosh(),r.precision=t,r.rounding=e)):new r(n.s)};h.inverseCosine=h.acos=function(){var t,e=this,n=e.constructor,r=e.abs().cmp(1),o=n.precision,i=n.rounding;return r!==-1?r===0?e.isNeg()?Q(n,o,i):new n(0):new n(NaN):e.isZero()?Q(n,o+4,i).times(.5):(n.precision=o+6,n.rounding=1,e=e.asin(),t=Q(n,o+4,i).times(.5),n.precision=o,n.rounding=i,t.minus(e))};h.inverseHyperbolicCosine=h.acosh=function(){var t,e,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(t=r.precision,e=r.rounding,r.precision=t+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,S=!1,n=n.times(n).minus(1).sqrt().plus(n),S=!0,r.precision=t,r.rounding=e,n.ln()):new r(n)};h.inverseHyperbolicSine=h.asinh=function(){var t,e,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,S=!1,n=n.times(n).plus(1).sqrt().plus(n),S=!0,r.precision=t,r.rounding=e,n.ln())};h.inverseHyperbolicTangent=h.atanh=function(){var t,e,n,r,o=this,i=o.constructor;return o.isFinite()?o.e>=0?new i(o.abs().eq(1)?o.s/0:o.isZero()?o:NaN):(t=i.precision,e=i.rounding,r=o.sd(),Math.max(r,t)<2*-o.e-1?P(new i(o),t,e,!0):(i.precision=n=r-o.e,o=v(o.plus(1),new i(1).minus(o),n+t,1),i.precision=t+4,i.rounding=1,o=o.ln(),i.precision=t,i.rounding=e,o.times(.5))):new i(NaN)};h.inverseSine=h.asin=function(){var t,e,n,r,o=this,i=o.constructor;return o.isZero()?new i(o):(e=o.abs().cmp(1),n=i.precision,r=i.rounding,e!==-1?e===0?(t=Q(i,n+4,r).times(.5),t.s=o.s,t):new i(NaN):(i.precision=n+6,i.rounding=1,o=o.div(new i(1).minus(o.times(o)).sqrt().plus(1)).atan(),i.precision=n,i.rounding=r,o.times(2)))};h.inverseTangent=h.atan=function(){var t,e,n,r,o,i,s,a,u,c=this,f=c.constructor,l=f.precision,p=f.rounding;if(c.isFinite()){if(c.isZero())return new f(c);if(c.abs().eq(1)&&l+4<=pt)return s=Q(f,l+4,p).times(.25),s.s=c.s,s}else{if(!c.s)return new f(NaN);if(l+4<=pt)return s=Q(f,l+4,p).times(.5),s.s=c.s,s}for(f.precision=a=l+10,f.rounding=1,n=Math.min(28,a/A+2|0),t=n;t;--t)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(S=!1,e=Math.ceil(a/A),r=1,u=c.times(c),s=new f(c),o=c;t!==-1;)if(o=o.times(u),i=s.minus(o.div(r+=2)),o=o.times(u),s=i.plus(o.div(r+=2)),s.d[e]!==void 0)for(t=e;s.d[t]===i.d[t]&&t--;);return n&&(s=s.times(2<<n-1)),S=!0,P(s,f.precision=l,f.rounding=p,!0)};h.isFinite=function(){return!!this.d};h.isInteger=h.isInt=function(){return!!this.d&&j(this.e/A)>this.d.length-2};h.isNaN=function(){return!this.s};h.isNegative=h.isNeg=function(){return this.s<0};h.isPositive=h.isPos=function(){return this.s>0};h.isZero=function(){return!!this.d&&this.d[0]===0};h.lessThan=h.lt=function(t){return this.cmp(t)<0};h.lessThanOrEqualTo=h.lte=function(t){return this.cmp(t)<1};h.logarithm=h.log=function(t){var e,n,r,o,i,s,a,u,c=this,f=c.constructor,l=f.precision,p=f.rounding,m=5;if(t==null)t=new f(10),e=!0;else{if(t=new f(t),n=t.d,t.s<0||!n||!n[0]||t.eq(1))return new f(NaN);e=t.eq(10)}if(n=c.d,c.s<0||!n||!n[0]||c.eq(1))return new f(n&&!n[0]?-1/0:c.s!=1?NaN:n?0:1/0);if(e)if(n.length>1)i=!0;else{for(o=n[0];o%10===0;)o/=10;i=o!==1}if(S=!1,a=l+m,s=se(c,a),r=e?Fe(f,a+10):se(t,a),u=v(s,r,a,1),Te(u.d,o=l,p))do if(a+=10,s=se(c,a),r=e?Fe(f,a+10):se(t,a),u=v(s,r,a,1),!i){+G(u.d).slice(o+1,o+15)+1==1e14&&(u=P(u,l+1,0));break}while(Te(u.d,o+=10,p));return S=!0,P(u,l,p)};h.minus=h.sub=function(t){var e,n,r,o,i,s,a,u,c,f,l,p,m=this,d=m.constructor;if(t=new d(t),!m.d||!t.d)return!m.s||!t.s?t=new d(NaN):m.d?t.s=-t.s:t=new d(t.d||m.s!==t.s?m:NaN),t;if(m.s!=t.s)return t.s=-t.s,m.plus(t);if(c=m.d,p=t.d,a=d.precision,u=d.rounding,!c[0]||!p[0]){if(p[0])t.s=-t.s;else if(c[0])t=new d(m);else return new d(u===3?-0:0);return S?P(t,a,u):t}if(n=j(t.e/A),f=j(m.e/A),c=c.slice(),i=f-n,i){for(l=i<0,l?(e=c,i=-i,s=p.length):(e=p,n=f,s=c.length),r=Math.max(Math.ceil(a/A),s)+2,i>r&&(i=r,e.length=1),e.reverse(),r=i;r--;)e.push(0);e.reverse()}else{for(r=c.length,s=p.length,l=r<s,l&&(s=r),r=0;r<s;r++)if(c[r]!=p[r]){l=c[r]<p[r];break}i=0}for(l&&(e=c,c=p,p=e,t.s=-t.s),s=c.length,r=p.length-s;r>0;--r)c[s++]=0;for(r=p.length;r>i;){if(c[--r]<p[r]){for(o=r;o&&c[--o]===0;)c[o]=J-1;--c[o],c[r]+=J}c[r]-=p[r]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--n;return c[0]?(t.d=c,t.e=Ve(c,n),S?P(t,a,u):t):new d(u===3?-0:0)};h.modulo=h.mod=function(t){var e,n=this,r=n.constructor;return t=new r(t),!n.d||!t.s||t.d&&!t.d[0]?new r(NaN):!t.d||n.d&&!n.d[0]?P(new r(n),r.precision,r.rounding):(S=!1,r.modulo==9?(e=v(n,t.abs(),0,3,1),e.s*=t.s):e=v(n,t,0,r.modulo,1),e=e.times(t),S=!0,n.minus(e))};h.naturalExponential=h.exp=function(){return mt(this)};h.naturalLogarithm=h.ln=function(){return se(this)};h.negated=h.neg=function(){var t=new this.constructor(this);return t.s=-t.s,P(t)};h.plus=h.add=function(t){var e,n,r,o,i,s,a,u,c,f,l=this,p=l.constructor;if(t=new p(t),!l.d||!t.d)return!l.s||!t.s?t=new p(NaN):l.d||(t=new p(t.d||l.s===t.s?l:NaN)),t;if(l.s!=t.s)return t.s=-t.s,l.minus(t);if(c=l.d,f=t.d,a=p.precision,u=p.rounding,!c[0]||!f[0])return f[0]||(t=new p(l)),S?P(t,a,u):t;if(i=j(l.e/A),r=j(t.e/A),c=c.slice(),o=i-r,o){for(o<0?(n=c,o=-o,s=f.length):(n=f,r=i,s=c.length),i=Math.ceil(a/A),s=i>s?i+1:s+1,o>s&&(o=s,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for(s=c.length,o=f.length,s-o<0&&(o=s,n=f,f=c,c=n),e=0;o;)e=(c[--o]=c[o]+f[o]+e)/J|0,c[o]%=J;for(e&&(c.unshift(e),++r),s=c.length;c[--s]==0;)c.pop();return t.d=c,t.e=Ve(c,r),S?P(t,a,u):t};h.precision=h.sd=function(t){var e,n=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(ae+t);return n.d?(e=Jt(n.d),t&&n.e+1>e&&(e=n.e+1)):e=NaN,e};h.round=function(){var t=this,e=t.constructor;return P(new e(t),t.e+1,e.rounding)};h.sine=h.sin=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+Math.max(n.e,n.sd())+A,r.rounding=1,n=Hn(r,en(r,n)),r.precision=t,r.rounding=e,P(te>2?n.neg():n,t,e,!0)):new r(NaN)};h.squareRoot=h.sqrt=function(){var t,e,n,r,o,i,s=this,a=s.d,u=s.e,c=s.s,f=s.constructor;if(c!==1||!a||!a[0])return new f(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(S=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=G(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=j((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),r=new f(e)):r=new f(c.toString()),n=(u=f.precision)+3;;)if(i=r,r=i.plus(v(s,i,n+2,1)).times(.5),G(i.d).slice(0,n)===(e=G(r.d)).slice(0,n))if(e=e.slice(n-3,n+1),e=="9999"||!o&&e=="4999"){if(!o&&(P(i,u+1,0),i.times(i).eq(s))){r=i;break}n+=4,o=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(P(r,u+1,1),t=!r.times(r).eq(s));break}return S=!0,P(r,u,f.rounding,t)};h.tangent=h.tan=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+10,r.rounding=1,n=n.sin(),n.s=1,n=v(n,new r(1).minus(n.times(n)).sqrt(),t+10,0),r.precision=t,r.rounding=e,P(te==2||te==4?n.neg():n,t,e,!0)):new r(NaN)};h.times=h.mul=function(t){var e,n,r,o,i,s,a,u,c,f=this,l=f.constructor,p=f.d,m=(t=new l(t)).d;if(t.s*=f.s,!p||!p[0]||!m||!m[0])return new l(!t.s||p&&!p[0]&&!m||m&&!m[0]&&!p?NaN:!p||!m?t.s/0:t.s*0);for(n=j(f.e/A)+j(t.e/A),u=p.length,c=m.length,u<c&&(i=p,p=m,m=i,s=u,u=c,c=s),i=[],s=u+c,r=s;r--;)i.push(0);for(r=c;--r>=0;){for(e=0,o=u+r;o>r;)a=i[o]+m[r]*p[o-r-1]+e,i[o--]=a%J|0,e=a/J|0;i[o]=(i[o]+e)%J|0}for(;!i[--s];)i.pop();return e?++n:i.shift(),t.d=i,t.e=Ve(i,n),S?P(t,l.precision,l.rounding):t};h.toBinary=function(t,e){return ht(this,2,t,e)};h.toDecimalPlaces=h.toDP=function(t,e){var n=this,r=n.constructor;return n=new r(n),t===void 0?n:(Z(t,0,ce),e===void 0?e=r.rounding:Z(e,0,8),P(n,t+n.e+1,e))};h.toExponential=function(t,e){var n,r=this,o=r.constructor;return t===void 0?n=$(r,!0):(Z(t,0,ce),e===void 0?e=o.rounding:Z(e,0,8),r=P(new o(r),t+1,e),n=$(r,!0,t+1)),r.isNeg()&&!r.isZero()?"-"+n:n};h.toFixed=function(t,e){var n,r,o=this,i=o.constructor;return t===void 0?n=$(o):(Z(t,0,ce),e===void 0?e=i.rounding:Z(e,0,8),r=P(new i(o),t+o.e+1,e),n=$(r,!1,t+r.e+1)),o.isNeg()&&!o.isZero()?"-"+n:n};h.toFraction=function(t){var e,n,r,o,i,s,a,u,c,f,l,p,m=this,d=m.d,b=m.constructor;if(!d)return new b(m);if(c=n=new b(1),r=u=new b(0),e=new b(r),i=e.e=Jt(d)-m.e-1,s=i%A,e.d[0]=W(10,s<0?A+s:s),t==null)t=i>0?e:c;else{if(a=new b(t),!a.isInt()||a.lt(c))throw Error(ae+a);t=a.gt(e)?i>0?e:c:a}for(S=!1,a=new b(G(d)),f=b.precision,b.precision=i=d.length*A*2;l=v(a,e,0,1,1),o=n.plus(l.times(r)),o.cmp(t)!=1;)n=r,r=o,o=c,c=u.plus(l.times(o)),u=o,o=e,e=a.minus(l.times(o)),a=o;return o=v(t.minus(n),r,0,1,1),u=u.plus(o.times(c)),n=n.plus(o.times(r)),u.s=c.s=m.s,p=v(c,r,i,1).minus(m).abs().cmp(v(u,n,i,1).minus(m).abs())<1?[c,r]:[u,n],b.precision=f,S=!0,p};h.toHexadecimal=h.toHex=function(t,e){return ht(this,16,t,e)};h.toNearest=function(t,e){var n=this,r=n.constructor;if(n=new r(n),t==null){if(!n.d)return n;t=new r(1),e=r.rounding}else{if(t=new r(t),e===void 0?e=r.rounding:Z(e,0,8),!n.d)return t.s?n:t;if(!t.d)return t.s&&(t.s=n.s),t}return t.d[0]?(S=!1,n=v(n,t,0,e,1).times(t),S=!0,P(n)):(t.s=n.s,n=t),n};h.toNumber=function(){return+this};h.toOctal=function(t,e){return ht(this,8,t,e)};h.toPower=h.pow=function(t){var e,n,r,o,i,s,a=this,u=a.constructor,c=+(t=new u(t));if(!a.d||!t.d||!a.d[0]||!t.d[0])return new u(W(+a,c));if(a=new u(a),a.eq(1))return a;if(r=u.precision,i=u.rounding,t.eq(1))return P(a,r,i);if(e=j(t.e/A),e>=t.d.length-1&&(n=c<0?-c:c)<=Vn)return o=Xt(u,a,n,r),t.s<0?new u(1).div(o):P(o,r,i);if(s=a.s,s<0){if(e<t.d.length-1)return new u(NaN);if((t.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return n=W(+a,c),e=n==0||!isFinite(n)?j(c*(Math.log("0."+G(a.d))/Math.LN10+a.e+1)):new u(n+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(S=!1,u.rounding=a.s=1,n=Math.min(12,(e+"").length),o=mt(t.times(se(a,r+n)),r),o.d&&(o=P(o,r+5,1),Te(o.d,r,i)&&(e=r+10,o=P(mt(t.times(se(a,e+n)),e),e+5,1),+G(o.d).slice(r+1,r+15)+1==1e14&&(o=P(o,r+1,0)))),o.s=s,S=!0,u.rounding=i,P(o,r,i))};h.toPrecision=function(t,e){var n,r=this,o=r.constructor;return t===void 0?n=$(r,r.e<=o.toExpNeg||r.e>=o.toExpPos):(Z(t,1,ce),e===void 0?e=o.rounding:Z(e,0,8),r=P(new o(r),t,e),n=$(r,t<=r.e||r.e<=o.toExpNeg,t)),r.isNeg()&&!r.isZero()?"-"+n:n};h.toSignificantDigits=h.toSD=function(t,e){var n=this,r=n.constructor;return t===void 0?(t=r.precision,e=r.rounding):(Z(t,1,ce),e===void 0?e=r.rounding:Z(e,0,8)),P(new r(n),t,e)};h.toString=function(){var t=this,e=t.constructor,n=$(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()&&!t.isZero()?"-"+n:n};h.truncated=h.trunc=function(){return P(new this.constructor(this),this.e+1,1)};h.valueOf=h.toJSON=function(){var t=this,e=t.constructor,n=$(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()?"-"+n:n};function G(t){var e,n,r,o=t.length-1,i="",s=t[0];if(o>0){for(i+=s,e=1;e<o;e++)r=t[e]+"",n=A-r.length,n&&(i+=ie(n)),i+=r;s=t[e],r=s+"",n=A-r.length,n&&(i+=ie(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return i+s}function Z(t,e,n){if(t!==~~t||t<e||t>n)throw Error(ae+t)}function Te(t,e,n,r){var o,i,s,a;for(i=t[0];i>=10;i/=10)--e;return--e<0?(e+=A,o=0):(o=Math.ceil((e+1)/A),e%=A),i=W(10,A-e),a=t[o]%i|0,r==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=n<4&&a==99999||n>3&&a==49999||a==5e4||a==0):s=(n<4&&a+1==i||n>3&&a+1==i/2)&&(t[o+1]/i/100|0)==W(10,e-2)-1||(a==i/2||a==0)&&(t[o+1]/i/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(r||n<4)&&a==9999||!r&&n>3&&a==4999):s=((r||n<4)&&a+1==i||!r&&n>3&&a+1==i/2)&&(t[o+1]/i/1e3|0)==W(10,e-3)-1,s}function ve(t,e,n){for(var r,o=[0],i,s=0,a=t.length;s<a;){for(i=o.length;i--;)o[i]*=e;for(o[0]+=lt.indexOf(t.charAt(s++)),r=0;r<o.length;r++)o[r]>n-1&&(o[r+1]===void 0&&(o[r+1]=0),o[r+1]+=o[r]/n|0,o[r]%=n)}return o.reverse()}function qn(t,e){var n,r,o;if(e.isZero())return e;r=e.d.length,r<32?(n=Math.ceil(r/3),o=(1/We(4,n)).toString()):(n=16,o="2.3283064365386962890625e-10"),t.precision+=n,e=de(t,1,e.times(o),new t(1));for(var i=n;i--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return t.precision-=n,e}var v=function(){function t(r,o,i){var s,a=0,u=r.length;for(r=r.slice();u--;)s=r[u]*o+a,r[u]=s%i|0,a=s/i|0;return a&&r.unshift(a),r}function e(r,o,i,s){var a,u;if(i!=s)u=i>s?1:-1;else for(a=u=0;a<i;a++)if(r[a]!=o[a]){u=r[a]>o[a]?1:-1;break}return u}function n(r,o,i,s){for(var a=0;i--;)r[i]-=a,a=r[i]<o[i]?1:0,r[i]=a*s+r[i]-o[i];for(;!r[0]&&r.length>1;)r.shift()}return function(r,o,i,s,a,u){var c,f,l,p,m,d,b,g,x,w,y,T,k,I,B,_,R,M,E,U,q=r.constructor,z=r.s==o.s?1:-1,F=r.d,D=o.d;if(!F||!F[0]||!D||!D[0])return new q(!r.s||!o.s||(F?D&&F[0]==D[0]:!D)?NaN:F&&F[0]==0||!D?z*0:z/0);for(u?(m=1,f=r.e-o.e):(u=J,m=A,f=j(r.e/m)-j(o.e/m)),E=D.length,R=F.length,x=new q(z),w=x.d=[],l=0;D[l]==(F[l]||0);l++);if(D[l]>(F[l]||0)&&f--,i==null?(I=i=q.precision,s=q.rounding):a?I=i+(r.e-o.e)+1:I=i,I<0)w.push(1),d=!0;else{if(I=I/m+2|0,l=0,E==1){for(p=0,D=D[0],I++;(l<R||p)&&I--;l++)B=p*u+(F[l]||0),w[l]=B/D|0,p=B%D|0;d=p||l<R}else{for(p=u/(D[0]+1)|0,p>1&&(D=t(D,p,u),F=t(F,p,u),E=D.length,R=F.length),_=E,y=F.slice(0,E),T=y.length;T<E;)y[T++]=0;U=D.slice(),U.unshift(0),M=D[0],D[1]>=u/2&&++M;do p=0,c=e(D,y,E,T),c<0?(k=y[0],E!=T&&(k=k*u+(y[1]||0)),p=k/M|0,p>1?(p>=u&&(p=u-1),b=t(D,p,u),g=b.length,T=y.length,c=e(b,y,g,T),c==1&&(p--,n(b,E<g?U:D,g,u))):(p==0&&(c=p=1),b=D.slice()),g=b.length,g<T&&b.unshift(0),n(y,b,T,u),c==-1&&(T=y.length,c=e(D,y,E,T),c<1&&(p++,n(y,E<T?U:D,T,u))),T=y.length):c===0&&(p++,y=[0]),w[l++]=p,c&&y[0]?y[T++]=F[_]||0:(y=[F[_]],T=1);while((_++<R||y[0]!==void 0)&&I--);d=y[0]!==void 0}w[0]||w.shift()}if(m==1)x.e=f,Ht=d;else{for(l=1,p=w[0];p>=10;p/=10)l++;x.e=l+f*m-1,P(x,a?i+x.e+1:i,s,d)}return x}}();function P(t,e,n,r){var o,i,s,a,u,c,f,l,p,m=t.constructor;e:if(e!=null){if(l=t.d,!l)return t;for(o=1,a=l[0];a>=10;a/=10)o++;if(i=e-o,i<0)i+=A,s=e,f=l[p=0],u=f/W(10,o-s-1)%10|0;else if(p=Math.ceil((i+1)/A),a=l.length,p>=a)if(r){for(;a++<=p;)l.push(0);f=u=0,o=1,i%=A,s=i-A+1}else break e;else{for(f=a=l[p],o=1;a>=10;a/=10)o++;i%=A,s=i-A+o,u=s<0?0:f/W(10,o-s-1)%10|0}if(r=r||e<0||l[p+1]!==void 0||(s<0?f:f%W(10,o-s-1)),c=n<4?(u||r)&&(n==0||n==(t.s<0?3:2)):u>5||u==5&&(n==4||r||n==6&&(i>0?s>0?f/W(10,o-s):0:l[p-1])%10&1||n==(t.s<0?8:7)),e<1||!l[0])return l.length=0,c?(e-=t.e+1,l[0]=W(10,(A-e%A)%A),t.e=-e||0):l[0]=t.e=0,t;if(i==0?(l.length=p,a=1,p--):(l.length=p+1,a=W(10,A-i),l[p]=s>0?(f/W(10,o-s)%W(10,s)|0)*a:0),c)for(;;)if(p==0){for(i=1,s=l[0];s>=10;s/=10)i++;for(s=l[0]+=a,a=1;s>=10;s/=10)a++;i!=a&&(t.e++,l[0]==J&&(l[0]=1));break}else{if(l[p]+=a,l[p]!=J)break;l[p--]=0,a=1}for(i=l.length;l[--i]===0;)l.pop()}return S&&(t.e>m.maxE?(t.d=null,t.e=NaN):t.e<m.minE&&(t.e=0,t.d=[0])),t}function $(t,e,n){if(!t.isFinite())return $t(t);var r,o=t.e,i=G(t.d),s=i.length;return e?(n&&(r=n-s)>0?i=i.charAt(0)+"."+i.slice(1)+ie(r):s>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(t.e<0?"e":"e+")+t.e):o<0?(i="0."+ie(-o-1)+i,n&&(r=n-s)>0&&(i+=ie(r))):o>=s?(i+=ie(o+1-s),n&&(r=n-o-1)>0&&(i=i+"."+ie(r))):((r=o+1)<s&&(i=i.slice(0,r)+"."+i.slice(r)),n&&(r=n-s)>0&&(o+1===s&&(i+="."),i+=ie(r))),i}function Ve(t,e){var n=t[0];for(e*=A;n>=10;n/=10)e++;return e}function Fe(t,e,n){if(e>Wn)throw S=!0,n&&(t.precision=n),Error(jt);return P(new t(Oe),e,1,!0)}function Q(t,e,n){if(e>pt)throw Error(jt);return P(new t(Ke),e,n,!0)}function Jt(t){var e=t.length-1,n=e*A+1;if(e=t[e],e){for(;e%10==0;e/=10)n--;for(e=t[0];e>=10;e/=10)n++}return n}function ie(t){for(var e="";t--;)e+="0";return e}function Xt(t,e,n,r){var o,i=new t(1),s=Math.ceil(r/A+4);for(S=!1;;){if(n%2&&(i=i.times(e),qt(i.d,s)&&(o=!0)),n=j(n/2),n===0){n=i.d.length-1,o&&i.d[n]===0&&++i.d[n];break}e=e.times(e),qt(e.d,s)}return S=!0,i}function Wt(t){return t.d[t.d.length-1]&1}function Yt(t,e,n){for(var r,o=new t(e[0]),i=0;++i<e.length;)if(r=new t(e[i]),r.s)o[n](r)&&(o=r);else{o=r;break}return o}function mt(t,e){var n,r,o,i,s,a,u,c=0,f=0,l=0,p=t.constructor,m=p.rounding,d=p.precision;if(!t.d||!t.d[0]||t.e>17)return new p(t.d?t.d[0]?t.s<0?0:1/0:1:t.s?t.s<0?0:t:0/0);for(e==null?(S=!1,u=d):u=e,a=new p(.03125);t.e>-2;)t=t.times(a),l+=5;for(r=Math.log(W(2,l))/Math.LN10*2+5|0,u+=r,n=i=s=new p(1),p.precision=u;;){if(i=P(i.times(t),u,1),n=n.times(++f),a=s.plus(v(i,n,u,1)),G(a.d).slice(0,u)===G(s.d).slice(0,u)){for(o=l;o--;)s=P(s.times(s),u,1);if(e==null)if(c<3&&Te(s.d,u-r,m,c))p.precision=u+=10,n=i=a=new p(1),f=0,c++;else return P(s,p.precision=d,m,S=!0);else return p.precision=d,s}s=a}}function se(t,e){var n,r,o,i,s,a,u,c,f,l,p,m=1,d=10,b=t,g=b.d,x=b.constructor,w=x.rounding,y=x.precision;if(b.s<0||!g||!g[0]||!b.e&&g[0]==1&&g.length==1)return new x(g&&!g[0]?-1/0:b.s!=1?NaN:g?0:b);if(e==null?(S=!1,f=y):f=e,x.precision=f+=d,n=G(g),r=n.charAt(0),Math.abs(i=b.e)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)b=b.times(t),n=G(b.d),r=n.charAt(0),m++;i=b.e,r>1?(b=new x("0."+n),i++):b=new x(r+"."+n.slice(1))}else return c=Fe(x,f+2,y).times(i+""),b=se(new x(r+"."+n.slice(1)),f-d).plus(c),x.precision=y,e==null?P(b,y,w,S=!0):b;for(l=b,u=s=b=v(b.minus(1),b.plus(1),f,1),p=P(b.times(b),f,1),o=3;;){if(s=P(s.times(p),f,1),c=u.plus(v(s,new x(o),f,1)),G(c.d).slice(0,f)===G(u.d).slice(0,f))if(u=u.times(2),i!==0&&(u=u.plus(Fe(x,f+2,y).times(i+""))),u=v(u,new x(m),f,1),e==null)if(Te(u.d,f-d,w,a))x.precision=f+=d,c=s=b=v(l.minus(1),l.plus(1),f,1),p=P(b.times(b),f,1),o=a=1;else return P(u,x.precision=y,w,S=!0);else return x.precision=y,u;u=c,o+=2}}function $t(t){return String(t.s*t.s/0)}function dt(t,e){var n,r,o;for((n=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(n<0&&(n=r),n+=+e.slice(r+1),e=e.substring(0,r)):n<0&&(n=e.length),r=0;e.charCodeAt(r)===48;r++);for(o=e.length;e.charCodeAt(o-1)===48;--o);if(e=e.slice(r,o),e){if(o-=r,t.e=n=n-r-1,t.d=[],r=(n+1)%A,n<0&&(r+=A),r<o){for(r&&t.d.push(+e.slice(0,r)),o-=A;r<o;)t.d.push(+e.slice(r,r+=A));e=e.slice(r),r=A-e.length}else r-=o;for(;r--;)e+="0";t.d.push(+e),S&&(t.e>t.constructor.maxE?(t.d=null,t.e=NaN):t.e<t.constructor.minE&&(t.e=0,t.d=[0]))}else t.e=0,t.d=[0];return t}function Gn(t,e){var n,r,o,i,s,a,u,c,f;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Qt.test(e))return dt(t,e)}else if(e==="Infinity"||e==="NaN")return+e||(t.s=NaN),t.e=NaN,t.d=null,t;if(Fn.test(e))n=16,e=e.toLowerCase();else if(Kn.test(e))n=2;else if(Un.test(e))n=8;else throw Error(ae+e);for(i=e.search(/p/i),i>0?(u=+e.slice(i+1),e=e.substring(2,i)):e=e.slice(2),i=e.indexOf("."),s=i>=0,r=t.constructor,s&&(e=e.replace(".",""),a=e.length,i=a-i,o=Xt(r,new r(n),i,i*2)),c=ve(e,n,J),f=c.length-1,i=f;c[i]===0;--i)c.pop();return i<0?new r(t.s*0):(t.e=Ve(c,f),t.d=c,S=!1,s&&(t=v(t,o,a*4)),u&&(t=t.times(Math.abs(u)<54?W(2,u):qe.pow(2,u))),S=!0,t)}function Hn(t,e){var n,r=e.d.length;if(r<3)return e.isZero()?e:de(t,2,e,e);n=1.4*Math.sqrt(r),n=n>16?16:n|0,e=e.times(1/We(5,n)),e=de(t,2,e,e);for(var o,i=new t(5),s=new t(16),a=new t(20);n--;)o=e.times(e),e=e.times(i.plus(o.times(s.times(o).minus(a))));return e}function de(t,e,n,r,o){var i,s,a,u,c=1,f=t.precision,l=Math.ceil(f/A);for(S=!1,u=n.times(n),a=new t(r);;){if(s=v(a.times(u),new t(e++*e++),f,1),a=o?r.plus(s):r.minus(s),r=v(s.times(u),new t(e++*e++),f,1),s=a.plus(r),s.d[l]!==void 0){for(i=l;s.d[i]===a.d[i]&&i--;);if(i==-1)break}i=a,a=r,r=s,s=i,c++}return S=!0,s.d.length=l+1,s}function We(t,e){for(var n=t;--e;)n*=t;return n}function en(t,e){var n,r=e.s<0,o=Q(t,t.precision,1),i=o.times(.5);if(e=e.abs(),e.lte(i))return te=r?4:1,e;if(n=e.divToInt(o),n.isZero())te=r?3:2;else{if(e=e.minus(n.times(o)),e.lte(i))return te=Wt(n)?r?2:3:r?4:1,e;te=Wt(n)?r?1:4:r?3:2}return e.minus(o).abs()}function ht(t,e,n,r){var o,i,s,a,u,c,f,l,p,m=t.constructor,d=n!==void 0;if(d?(Z(n,1,ce),r===void 0?r=m.rounding:Z(r,0,8)):(n=m.precision,r=m.rounding),!t.isFinite())f=$t(t);else{for(f=$(t),s=f.indexOf("."),d?(o=2,e==16?n=n*4-3:e==8&&(n=n*3-2)):o=e,s>=0&&(f=f.replace(".",""),p=new m(1),p.e=f.length-s,p.d=ve($(p),10,o),p.e=p.d.length),l=ve(f,10,o),i=u=l.length;l[--u]==0;)l.pop();if(!l[0])f=d?"0p+0":"0";else{if(s<0?i--:(t=new m(t),t.d=l,t.e=i,t=v(t,p,n,r,0,o),l=t.d,i=t.e,c=Ht),s=l[n],a=o/2,c=c||l[n+1]!==void 0,c=r<4?(s!==void 0||c)&&(r===0||r===(t.s<0?3:2)):s>a||s===a&&(r===4||c||r===6&&l[n-1]&1||r===(t.s<0?8:7)),l.length=n,c)for(;++l[--n]>o-1;)l[n]=0,n||(++i,l.unshift(1));for(u=l.length;!l[u-1];--u);for(s=0,f="";s<u;s++)f+=lt.charAt(l[s]);if(d){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)f+="0";for(l=ve(f,o,e),u=l.length;!l[u-1];--u);for(s=1,f="1.";s<u;s++)f+=lt.charAt(l[s])}else f=f.charAt(0)+"."+f.slice(1);f=f+(i<0?"p":"p+")+i}else if(i<0){for(;++i;)f="0"+f;f="0."+f}else if(++i>u)for(i-=u;i--;)f+="0";else i<u&&(f=f.slice(0,i)+"."+f.slice(i))}f=(e==16?"0x":e==2?"0b":e==8?"0o":"")+f}return t.s<0?"-"+f:f}function qt(t,e){if(t.length>e)return t.length=e,!0}function jn(t){return new this(t).abs()}function Zn(t){return new this(t).acos()}function zn(t){return new this(t).acosh()}function Qn(t,e){return new this(t).plus(e)}function Jn(t){return new this(t).asin()}function Xn(t){return new this(t).asinh()}function Yn(t){return new this(t).atan()}function $n(t){return new this(t).atanh()}function er(t,e){t=new this(t),e=new this(e);var n,r=this.precision,o=this.rounding,i=r+4;return!t.s||!e.s?n=new this(NaN):!t.d&&!e.d?(n=Q(this,i,1).times(e.s>0?.25:.75),n.s=t.s):!e.d||t.isZero()?(n=e.s<0?Q(this,r,o):new this(0),n.s=t.s):!t.d||e.isZero()?(n=Q(this,i,1).times(.5),n.s=t.s):e.s<0?(this.precision=i,this.rounding=1,n=this.atan(v(t,e,i,1)),e=Q(this,i,1),this.precision=r,this.rounding=o,n=t.s<0?n.minus(e):n.plus(e)):n=this.atan(v(t,e,i,1)),n}function tr(t){return new this(t).cbrt()}function nr(t){return P(t=new this(t),t.e+1,2)}function rr(t,e,n){return new this(t).clamp(e,n)}function or(t){if(!t||typeof t!="object")throw Error(Ue+"Object expected");var e,n,r,o=t.defaults===!0,i=["precision",1,ce,"rounding",0,8,"toExpNeg",-me,0,"toExpPos",0,me,"maxE",0,me,"minE",-me,0,"modulo",0,9];for(e=0;e<i.length;e+=3)if(n=i[e],o&&(this[n]=ft[n]),(r=t[n])!==void 0)if(j(r)===r&&r>=i[e+1]&&r<=i[e+2])this[n]=r;else throw Error(ae+n+": "+r);if(n="crypto",o&&(this[n]=ft[n]),(r=t[n])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(Zt);else this[n]=!1;else throw Error(ae+n+": "+r);return this}function ir(t){return new this(t).cos()}function sr(t){return new this(t).cosh()}function tn(t){var e,n,r;function o(i){var s,a,u,c=this;if(!(c instanceof o))return new o(i);if(c.constructor=o,Gt(i)){c.s=i.s,S?!i.d||i.e>o.maxE?(c.e=NaN,c.d=null):i.e<o.minE?(c.e=0,c.d=[0]):(c.e=i.e,c.d=i.d.slice()):(c.e=i.e,c.d=i.d?i.d.slice():i.d);return}if(u=typeof i,u==="number"){if(i===0){c.s=1/i<0?-1:1,c.e=0,c.d=[0];return}if(i<0?(i=-i,c.s=-1):c.s=1,i===~~i&&i<1e7){for(s=0,a=i;a>=10;a/=10)s++;S?s>o.maxE?(c.e=NaN,c.d=null):s<o.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[i]):(c.e=s,c.d=[i]);return}else if(i*0!==0){i||(c.s=NaN),c.e=NaN,c.d=null;return}return dt(c,i.toString())}else if(u!=="string")throw Error(ae+i);return(a=i.charCodeAt(0))===45?(i=i.slice(1),c.s=-1):(a===43&&(i=i.slice(1)),c.s=1),Qt.test(i)?dt(c,i):Gn(c,i)}if(o.prototype=h,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.EUCLID=9,o.config=o.set=or,o.clone=tn,o.isDecimal=Gt,o.abs=jn,o.acos=Zn,o.acosh=zn,o.add=Qn,o.asin=Jn,o.asinh=Xn,o.atan=Yn,o.atanh=$n,o.atan2=er,o.cbrt=tr,o.ceil=nr,o.clamp=rr,o.cos=ir,o.cosh=sr,o.div=ar,o.exp=cr,o.floor=ur,o.hypot=lr,o.ln=fr,o.log=pr,o.log10=dr,o.log2=mr,o.max=hr,o.min=gr,o.mod=br,o.mul=yr,o.pow=wr,o.random=Tr,o.round=xr,o.sign=Pr,o.sin=Ar,o.sinh=kr,o.sqrt=Sr,o.sub=Cr,o.sum=Ir,o.tan=Br,o.tanh=Lr,o.trunc=Nr,t===void 0&&(t={}),t&&t.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<r.length;)t.hasOwnProperty(n=r[e++])||(t[n]=this[n]);return o.config(t),o}function ar(t,e){return new this(t).div(e)}function cr(t){return new this(t).exp()}function ur(t){return P(t=new this(t),t.e+1,3)}function lr(){var t,e,n=new this(0);for(S=!1,t=0;t<arguments.length;)if(e=new this(arguments[t++]),e.d)n.d&&(n=n.plus(e.times(e)));else{if(e.s)return S=!0,new this(1/0);n=e}return S=!0,n.sqrt()}function Gt(t){return t instanceof qe||t&&t.toStringTag===zt||!1}function fr(t){return new this(t).ln()}function pr(t,e){return new this(t).log(e)}function mr(t){return new this(t).log(2)}function dr(t){return new this(t).log(10)}function hr(){return Yt(this,arguments,"lt")}function gr(){return Yt(this,arguments,"gt")}function br(t,e){return new this(t).mod(e)}function yr(t,e){return new this(t).mul(e)}function wr(t,e){return new this(t).pow(e)}function Tr(t){var e,n,r,o,i=0,s=new this(1),a=[];if(t===void 0?t=this.precision:Z(t,1,ce),r=Math.ceil(t/A),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(r));i<r;)o=e[i],o>=429e7?e[i]=crypto.getRandomValues(new Uint32Array(1))[0]:a[i++]=o%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(r*=4);i<r;)o=e[i]+(e[i+1]<<8)+(e[i+2]<<16)+((e[i+3]&127)<<24),o>=214e7?crypto.randomBytes(4).copy(e,i):(a.push(o%1e7),i+=4);i=r/4}else throw Error(Zt);else for(;i<r;)a[i++]=Math.random()*1e7|0;for(r=a[--i],t%=A,r&&t&&(o=W(10,A-t),a[i]=(r/o|0)*o);a[i]===0;i--)a.pop();if(i<0)n=0,a=[0];else{for(n=-1;a[0]===0;n-=A)a.shift();for(r=1,o=a[0];o>=10;o/=10)r++;r<A&&(n-=A-r)}return s.e=n,s.d=a,s}function xr(t){return P(t=new this(t),t.e+1,this.rounding)}function Pr(t){return t=new this(t),t.d?t.d[0]?t.s:0*t.s:t.s||NaN}function Ar(t){return new this(t).sin()}function kr(t){return new this(t).sinh()}function Sr(t){return new this(t).sqrt()}function Cr(t,e){return new this(t).sub(e)}function Ir(){var t=0,e=arguments,n=new this(e[t]);for(S=!1;n.s&&++t<e.length;)n=n.plus(e[t]);return S=!0,P(n,this.precision,this.rounding)}function Br(t){return new this(t).tan()}function Lr(t){return new this(t).tanh()}function Nr(t){return P(t=new this(t),t.e+1,1)}h[Symbol.for("nodejs.util.inspect.custom")]=h.toString;h[Symbol.toStringTag]="Decimal";var qe=h.constructor=tn(ft);Oe=new qe(Oe);Ke=new qe(Ke);import Kr from"big.js";import ui from"bn.js";import Er from"toformat";var Rr=Er,xe=Rr;import He from"big.js";import Mr from"bn.js";import Dr from"decimal.js-light";import Pe from"bn.js";var nn=9007199254740991;function X(t){let e=H("Raydium_parseBigNumberish");if(t instanceof Pe)return t;if(typeof t=="string"){if(t.match(/^-?[0-9]+$/))return new Pe(t);e.logWithError(`invalid BigNumberish string: ${t}`)}return typeof t=="number"?(t%1&&e.logWithError(`BigNumberish number underflow: ${t}`),(t>=nn||t<=-nn)&&e.logWithError(`BigNumberish number overflow: ${t}`),new Pe(String(t))):typeof t=="bigint"?new Pe(t.toString()):(e.error(`invalid BigNumberish value: ${t}`),new Pe(0))}var Ge=H("module/fraction"),gt=xe(He),Ae=xe(Dr),vr={[0]:Ae.ROUND_DOWN,[1]:Ae.ROUND_HALF_UP,[2]:Ae.ROUND_UP},Or={[0]:He.roundDown,[1]:He.roundHalfUp,[2]:He.roundUp},O=class{numerator;denominator;constructor(e,n=new Mr(1)){this.numerator=X(e),this.denominator=X(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new O(this.denominator,this.numerator)}add(e){let n=e instanceof O?e:new O(X(e));return this.denominator.eq(n.denominator)?new O(this.numerator.add(n.numerator),this.denominator):new O(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(e){let n=e instanceof O?e:new O(X(e));return this.denominator.eq(n.denominator)?new O(this.numerator.sub(n.numerator),this.denominator):new O(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(e){let n=e instanceof O?e:new O(X(e));return new O(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(e){let n=e instanceof O?e:new O(X(e));return new O(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(e,n={groupSeparator:""},r=1){Number.isInteger(e)||Ge.logWithError(`${e} is not an integer.`),e<=0&&Ge.logWithError(`${e} is not positive.`),Ae.set({precision:e+1,rounding:vr[r]});let o=new Ae(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),n)}toFixed(e,n={groupSeparator:""},r=1){return Number.isInteger(e)||Ge.logWithError(`${e} is not an integer.`),e<0&&Ge.logWithError(`${e} is negative.`),gt.DP=e,gt.RM=Or[r]||1,new gt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,n)}isZero(){return this.numerator.isZero()}};var yi=H("Raydium_amount"),wi=xe(Kr);import{PublicKey as Ur}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as rn}from"@solana/spl-token";var on={chainId:101,address:Ur.default.toBase58(),programId:rn.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ne={chainId:101,address:"So11111111111111111111111111111111111111112",programId:rn.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as yt}from"@solana/web3.js";import{PublicKey as K,SystemProgram as sn,SYSVAR_RENT_PUBKEY as Vr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Wr}from"@solana/spl-token";function bt({pubkey:t,isSigner:e=!1,isWritable:n=!0}){return{pubkey:t,isWritable:n,isSigner:e}}var Ii=[bt({pubkey:Wr,isWritable:!1}),bt({pubkey:sn.programId,isWritable:!1}),bt({pubkey:Vr,isWritable:!1})];function an({publicKey:t,transformSol:e}){let n=cn(t.toString());if(n instanceof K)return e&&n.equals(ke)?oe:n;if(e&&n.toString()===ke.toBase58())return oe;if(typeof n=="string"){if(n===K.default.toBase58())return K.default;try{return new K(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function cn(t){try{return new K(t)}catch{return t}}var Bi=new K("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Li=new K("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ni=new K("SysvarRent111111111111111111111111111111111"),Ei=new K("SysvarC1ock11111111111111111111111111111111"),Ri=new K("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),_i=new K("Sysvar1nstructions1111111111111111111111111"),Mi=sn.programId,Di=new K("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),vi=new K("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Oi=new K("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ki=new K("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Fi=new K("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ui=new K("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Vi=new K("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Wi=new K("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),qi=new K("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Gi=new K("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Hi=new K("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),oe=new K("So11111111111111111111111111111111111111112"),ke=K.default;var wt=class{symbol;name;decimals;isToken2022;mint;constructor({mint:e,decimals:n,symbol:r,name:o,skipMint:i=!1,isToken2022:s=!1}){if(e===ke.toBase58()||e instanceof yt&&ke.equals(e)){this.decimals=ne.decimals,this.symbol=ne.symbol,this.name=ne.name,this.mint=new yt(ne.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=i?yt.default:an({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},he=wt;De(he,"WSOL",new wt({...ne,mint:ne.address}));var Tt=class{symbol;name;decimals;constructor({decimals:e,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=n,this.name=r}equals(e){return this===e}},je=Tt;De(je,"SOL",new Tt(on));import qr from"bn.js";var rs=new O(new qr(100));var us=H("Raydium_price");import{PublicKey as Cs}from"@solana/web3.js";import Bs from"bn.js";var Gr=new re(0),Zs=new re(1),zs=new re(2),Qs=new re(3),Js=new re(5),Fr=new re(10),Xs=new re(100),Ys=new re(1e3),$s=new re(1e4);function ut(t,e=1,n=[]){let r=[...t];if(e<=0)return n;for(;r.length;)n.push(r.splice(0,e));return n}import{PublicKey as Xr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Yr}from"@solana/spl-token";import{ComputeBudgetProgram as pn,Keypair as dn,PublicKey as Hr,Transaction as hn,TransactionMessage as jr,VersionedTransaction as gn}from"@solana/web3.js";var V={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip",NonceAccount:"NonceAccount"};import{TOKEN_PROGRAM_ID as Zr}from"@solana/spl-token";var mn=H("Raydium_txUtil"),bn=1644;function Ze(t){let e=[],n=[];return t.microLamports&&(e.push(pn.setComputeUnitPrice({microLamports:t.microLamports})),n.push(V.SetComputeUnitPrice)),t.units&&(e.push(pn.setComputeUnitLimit({units:t.units})),n.push(V.SetComputeUnitLimit)),{instructions:e,instructionTypes:n}}async function ge(t,e){let n=e??"confirmed";return(await t.getLatestBlockhash?.({commitment:n}))?.blockhash}async function ze(t,e){return t.getSignatureStatuses([e]),new Promise((n,r)=>{let o=setTimeout(r,6e4);t.onSignature(e,i=>{if(clearTimeout(o),!i.err){n("");return}r(Object.assign(i.err,{txId:e}))},"confirmed")})}function zr(t,e){t.length<1&&mn.logWithError(`no instructions provided: ${t.toString()}`),e.length<1&&mn.logWithError(`no signers provided:, ${e.toString()}`);let n=new hn;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=e[0],n.add(...t);try{return Buffer.from(n.serialize({verifySignatures:!1})).toString("base64").length<bn}catch{return!1}}function yn(t,e){let[n,r]=Hr.findProgramAddressSync(t,e);return{publicKey:n,nonce:r}}function Se({instructions:t,payer:e,signers:n}){return zr(t,[e,...n])}function Ce({instructions:t,payer:e,lookupTableAddressAccount:n,recentBlockhash:r=dn.generate().publicKey.toString()}){let i=new jr({payerKey:e,recentBlockhash:r,instructions:t}).compileToV0Message(Object.values(n??{}));try{return Buffer.from(new gn(i).serialize()).toString("base64").length<bn}catch{return!1}}var Qr=t=>Buffer.isBuffer(t)?t:t instanceof Uint8Array?Buffer.from(t.buffer,t.byteOffset,t.byteLength):Buffer.from(t),Jr=t=>{let e=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof gn&&(e=Qr(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function pe(t){let e=[];return t.forEach(n=>{n instanceof hn&&(n.recentBlockhash||(n.recentBlockhash=Zr.toBase58()),n.feePayer||(n.feePayer=dn.generate().publicKey)),e.push(Jr(n))}),console.log("simulate tx string:",e),e}function Qe(t,e,n){return yn([t.toBuffer(),(n??Yr).toBuffer(),e.toBuffer()],new Xr("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as C}from"@solana/web3.js";var Ta=new C("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),xa=new C("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Pa=new C("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Aa=new C("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ka=new C("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Sa=new C("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Ca=new C("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Ia=new C("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Ba=new C("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),La=new C("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Na=new C("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Ea=new C("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ra=new C("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),_a=new C("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Ma=new C("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Da=new C("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),va=new C("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Oa=new C("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ka=new C("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Fa=new C("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Ua=new C("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Va=new C("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),$r=new C("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),eo=new C("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),to=new C("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Wa=new C("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),no=new C("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),qa=new C("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),ro=new C("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),Ga=new C("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Ha=new C("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),oo=new C("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),io=new C("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var ja={SERUM_MARKET:C.default,OPENBOOK_MARKET:new C("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:C.default,FarmV3:new C("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new C("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new C("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new C("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new C("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new C("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new C("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new C("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new C("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:$r,CREATE_CPMM_POOL_AUTH:eo,CREATE_CPMM_POOL_FEE_ACC:to,FEE_DESTINATION_ID:new C("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:no,LCOK_CPMM_AUTH:ro,LAUNCHPAD_PROGRAM:oo,LAUNCHPAD_AUTH:io};import Qa from"bn.js";import{PublicKey as wn,AddressLookupTableAccount as Je}from"@solana/web3.js";async function xt({connection:t,address:e}){let n=await Vt(t,[...new Set(e.map(o=>o.toString()))].map(o=>new wn(o))),r={};for(let o=0;o<e.length;o++){let i=n[o],s=e[o];if(!i)continue;let a=new Je({key:s,state:Je.deserialize(i.data)});r[s.toString()]=a,Xe[s.toString()]=a}return r}var Xe={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Je({key:new wn("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Je.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as be,sendAndConfirmTransaction as Pt,SystemProgram as so,Transaction as Ie,TransactionMessage as Be,VersionedTransaction as Le}from"@solana/web3.js";import ao from"axios";var Ye=2e3,$e=class{connection;owner;instructions=[];endInstructions=[];lookupTableAddress=[];signers=[];instructionTypes=[];endInstructionTypes=[];feePayer;cluster;signAllTransactions;blockhashCommitment;loopMultiTxStatus;constructor(e){this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){let e=(await ao.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:n}=e?.[15]??{};if(!!n)return{units:6e5,microLamports:Math.min(Math.ceil(n*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:n,instructionTypes:r}=Ze(e);return this.instructions.unshift(...n),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){return e?(this.endInstructions.push(so.transfer({fromPubkey:e.feePayer??this.feePayer,toPubkey:new be(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(V.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:n}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;n&&this.instructions.unshift(...n)}catch{n&&this.instructions.unshift(...n)}}addInstruction({instructions:e=[],endInstructions:n=[],signers:r=[],instructionTypes:o=[],endInstructionTypes:i=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...n),this.signers.push(...r),this.instructionTypes.push(...o),this.endInstructionTypes.push(...i),this.lookupTableAddress.push(...s.filter(a=>a!==be.default.toString())),this}async versionBuild({txVersion:e,extInfo:n},r){return e===0?await this.buildV0({...n||{}},r):this.build(n,r)}build(e,n){let r=new Ie;return this.allInstructions.length&&r.add(...this.allInstructions),r.feePayer=this.feePayer,this.owner?.signer&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:r,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{let{recentBlockHash:i,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:u}=o||{},c=i??n??await ge(this.connection,this.blockhashCommitment);if(r.recentBlockhash=c,this.signers.length&&r.sign(...this.signers),pe([r]),this.owner?.isKeyPair)return{txId:a?await Pt(this.connection,r,this.signers.find(l=>l.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(r.serialize(),{skipPreflight:s}),signedTx:r};if(this.signAllTransactions){let f=await this.signAllTransactions([r]);if(this.signers.length)for(let l of f)try{l.sign(...this.signers)}catch{}return{txId:u?"":await this.connection.sendRawTransaction(f[0].serialize(),{skipPreflight:s}),signedTx:f[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:n=[],extInfo:r}=e,{transaction:o}=this.build(r),i=n.filter(c=>c.transaction.instructions.length>0),s=[o,...i.map(c=>c.transaction)],a=[this.signers,...i.map(c=>c.signers)],u=[...this.instructionTypes,...i.map(c=>c.instructionTypes).flat()];return this.owner?.signer&&a.forEach(c=>{c.some(f=>f.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async c=>{let{sequentially:f,onTxUpdate:l,skipTxCount:p=0,recentBlockHash:m,skipPreflight:d=!0}=c||{},b=m??await ge(this.connection,this.blockhashCommitment);if(this.owner?.isKeyPair){if(f){let g=[],x=0;for(let w of s){if(++x,x<=p)continue;let y=await Pt(this.connection,w,this.signers.find(T=>T.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:d});g.push(y)}return{txIds:g,signedTxs:s}}return{txIds:await await Promise.all(s.map(async g=>(g.recentBlockhash=b,await this.connection.sendRawTransaction(g.serialize(),{skipPreflight:d})))),signedTxs:s}}if(this.signAllTransactions){let g=s.map((w,y)=>(w.recentBlockhash=b,a[y].length&&w.sign(...a[y]),w));pe(g);let x=await this.signAllTransactions(g);if(f){let w=0,y=[],T=async()=>{if(!x[w])return;let k=await this.connection.sendRawTransaction(x[w].serialize(),{skipPreflight:d});y.push({txId:k,status:"sent",signedTx:x[w]}),l?.([...y]),w++;let I=!1,B=null,_=null,R=M=>{B!==null&&clearInterval(B),_!==null&&this.connection.removeSignatureListener(_);let E=y.findIndex(U=>U.txId===k);if(E>-1){if(y[E].status==="error"||y[E].status==="success")return;y[E].status=M.err?"error":"success"}l?.([...y]),M.err||T()};this.loopMultiTxStatus&&(B=setInterval(async()=>{if(I){clearInterval(B);return}try{let M=await this.connection.getTransaction(k,{commitment:"confirmed",maxSupportedTransactionVersion:0});M&&(I=!0,clearInterval(B),R({err:M.meta?.err||null}),console.log("tx status from getTransaction:",k))}catch(M){I=!0,clearInterval(B),console.error("getTransaction timeout:",M,k)}},Ye)),_=this.connection.onSignature(k,M=>{if(I){this.connection.removeSignatureListener(_);return}I=!0,R(M)},"confirmed"),this.connection.getSignatureStatus(k)};return await T(),{txIds:y.map(k=>k.txId),signedTxs:x}}else{let w=[];for(let y=0;y<x.length;y+=1){let T=await this.connection.sendRawTransaction(x[y].serialize(),{skipPreflight:d});w.push(T)}return{txIds:w,signedTxs:x}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:n,extInfo:r}){return n===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e,n){let{lookupTableCache:r={},lookupTableAddress:o=[],forerunCreate:i,recentBlockhash:s,...a}=e||{},u={...this.cluster==="devnet"?{}:Xe,...r},c=Array.from(new Set([...o,...this.lookupTableAddress])),f=[];for(let d of c)u[d]===void 0&&f.push(new be(d));if(f.length>0){let d=await xt({connection:this.connection,address:f});for(let[b,g]of Object.entries(d))u[b]=g}let l=n??(i?be.default.toBase58():s??await ge(this.connection,this.blockhashCommitment)),p=new Be({payerKey:this.feePayer,recentBlockhash:l,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(u));this.owner?.signer&&!this.signers.some(d=>d.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let m=new Le(p);return m.sign(this.signers),{builder:this,transaction:m,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async d=>{let{skipPreflight:b=!0,sendAndConfirm:g,notSendToRpc:x}=d||{};if(pe([m]),this.owner?.isKeyPair){let w=await this.connection.sendTransaction(m,{skipPreflight:b});return g&&await ze(this.connection,w),{txId:w,signedTx:m}}if(this.signAllTransactions){let w=await this.signAllTransactions([m]);if(this.signers.length)for(let y of w)try{y.sign(this.signers)}catch{}return{txId:x?"":await this.connection.sendTransaction(w[0],{skipPreflight:b}),signedTx:w[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(e){let{extraPreBuildData:n=[],buildProps:r}=e,{transaction:o}=await this.buildV0(r),i=n.filter(c=>c.builder.instructions.length>0),s=[o,...i.map(c=>c.transaction)],a=[this.signers,...i.map(c=>c.signers)],u=[...this.instructionTypes,...i.map(c=>c.instructionTypes).flat()];return this.owner?.signer&&a.forEach(c=>{c.some(f=>f.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(c,f)=>{c.sign(a[f])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:r,execute:async c=>{let{sequentially:f,onTxUpdate:l,recentBlockHash:p,skipPreflight:m=!0}=c||{};if(p&&s.forEach(d=>d.message.recentBlockhash=p),pe(s),this.owner?.isKeyPair){if(f){let d=[];for(let b of s){let g=await this.connection.sendTransaction(b,{skipPreflight:m});await ze(this.connection,g),d.push(g)}return{txIds:d,signedTxs:s}}return{txIds:await Promise.all(s.map(async d=>await this.connection.sendTransaction(d,{skipPreflight:m}))),signedTxs:s}}if(this.signAllTransactions){let d=await this.signAllTransactions(s);if(f){let b=0,g=[],x=async()=>{if(!d[b])return;let w=await this.connection.sendTransaction(d[b],{skipPreflight:m});g.push({txId:w,status:"sent",signedTx:d[b]}),l?.([...g]),b++;let y=!1,T=null,k=null,I=B=>{T!==null&&clearInterval(T),k!==null&&this.connection.removeSignatureListener(k);let _=g.findIndex(R=>R.txId===w);if(_>-1){if(g[_].status==="error"||g[_].status==="success")return;g[_].status=B.err?"error":"success"}l?.([...g]),B.err||x()};this.loopMultiTxStatus&&(T=setInterval(async()=>{if(y){clearInterval(T);return}try{let B=await this.connection.getTransaction(w,{commitment:"confirmed",maxSupportedTransactionVersion:0});B&&(y=!0,clearInterval(T),I({err:B.meta?.err||null}),console.log("tx status from getTransaction:",w))}catch(B){y=!0,clearInterval(T),console.error("getTransaction timeout:",B,w)}},Ye)),k=this.connection.onSignature(w,B=>{if(y){this.connection.removeSignatureListener(k);return}y=!0,I(B)},"confirmed"),this.connection.getSignatureStatus(w)};return x(),{txIds:[],signedTxs:d}}else{let b=[];for(let g=0;g<d.length;g+=1){let x=await this.connection.sendTransaction(d[g],{skipPreflight:m});b.push(x)}return{txIds:b,signedTxs:d}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){let{splitIns:n=[],computeBudgetConfig:r,...o}=e||{},i=r?Ze(r):{instructions:[],instructionTypes:[]},s=this.signers.reduce((l,p)=>({...l,[p.publicKey.toBase58()]:p}),{}),a=[],u=[],c=[],f=0;if(this.allInstructions.forEach(l=>{let p=[...c,l],m=r?[...i.instructions,...p]:p,b=[...new Set(p.map(g=>g.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(g=>new be(g));if(l!==n[f]&&c.length<12&&(Se({instructions:m,payer:this.feePayer,signers:b})||Se({instructions:p,payer:this.feePayer,signers:b})))c.push(l);else{if(c.length===0)throw Error("item ins too big");f+=l===n[f]?1:0,Se({instructions:r?[...i.instructions,...c]:[...c],payer:this.feePayer,signers:b})?a.push(new Ie().add(...i.instructions,...c)):a.push(new Ie().add(...c)),u.push(Array.from(new Set(c.map(g=>g.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat())).map(g=>s[g]).filter(g=>g!==void 0)),c=[l]}}),c.length>0){let p=[...new Set(c.map(m=>m.keys.filter(d=>d.isSigner).map(d=>d.pubkey.toString())).flat()).values()].map(m=>s[m]).filter(m=>m!==void 0);Se({instructions:r?[...i.instructions,...c]:[...c],payer:this.feePayer,signers:p.map(m=>m.publicKey)})?a.push(new Ie().add(...i.instructions,...c)):a.push(new Ie().add(...c)),u.push(p)}return a.forEach(l=>l.feePayer=this.feePayer),this.owner?.signer&&u.forEach(l=>{l.some(p=>p.publicKey.equals(this.owner.publicKey))||l.push(this.owner.signer)}),{builder:this,transactions:a,signers:u,instructionTypes:this.instructionTypes,execute:async l=>{let{sequentially:p,onTxUpdate:m,skipTxCount:d=0,recentBlockHash:b,skipPreflight:g=!0}=l||{},x=b??await ge(this.connection,this.blockhashCommitment);if(a.forEach(async(w,y)=>{w.recentBlockhash=x,u[y].length&&w.sign(...u[y])}),pe(a),this.owner?.isKeyPair){if(p){let w=0,y=[];for(let T of a){if(++w,w<=d){y.push("tx skipped");continue}let k=await Pt(this.connection,T,this.signers.find(I=>I.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});y.push(k)}return{txIds:y,signedTxs:a}}return{txIds:await Promise.all(a.map(async w=>await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:g}))),signedTxs:a}}if(this.signAllTransactions){let w=await this.signAllTransactions(a.slice(d,a.length)),y=[...a.slice(0,d),...w];if(p){let T=0,k=[],I=async()=>{if(!y[T])return;T<d&&(k.push({txId:"",status:"success",signedTx:y[T]}),m?.([...k]),T++,I());let B=await this.connection.sendRawTransaction(y[T].serialize(),{skipPreflight:g});k.push({txId:B,status:"sent",signedTx:y[T]}),m?.([...k]),T++;let _=!1,R=null,M=null,E=U=>{R!==null&&clearInterval(R),M!==null&&this.connection.removeSignatureListener(M);let q=k.findIndex(z=>z.txId===B);if(q>-1){if(k[q].status==="error"||k[q].status==="success")return;k[q].status=U.err?"error":"success"}m?.([...k]),U.err||I()};this.loopMultiTxStatus&&(R=setInterval(async()=>{if(_){clearInterval(R);return}try{let U=await this.connection.getTransaction(B,{commitment:"confirmed",maxSupportedTransactionVersion:0});U&&(_=!0,clearInterval(R),E({err:U.meta?.err||null}),console.log("tx status from getTransaction:",B))}catch(U){_=!0,clearInterval(R),console.error("getTransaction timeout:",U,B)}},Ye)),M=this.connection.onSignature(B,U=>{if(_){this.connection.removeSignatureListener(M);return}_=!0,E(U)},"confirmed"),this.connection.getSignatureStatus(B)};return await I(),{txIds:k.map(B=>B.txId),signedTxs:y}}else{let T=[];for(let k=0;k<y.length;k+=1){let I=await this.connection.sendRawTransaction(y[k].serialize(),{skipPreflight:g});T.push(I)}return{txIds:T,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(e){let{computeBudgetConfig:n,splitIns:r=[],lookupTableCache:o={},lookupTableAddress:i=[],...s}=e||{},a={...this.cluster==="devnet"?{}:Xe,...o},u=Array.from(new Set([...this.lookupTableAddress,...i])),c=[];for(let w of u)a[w]===void 0&&c.push(new be(w));let f=await xt({connection:this.connection,address:c});for(let[w,y]of Object.entries(f))a[w]=y;let l=n?Ze(n):{instructions:[],instructionTypes:[]},p=await ge(this.connection,this.blockhashCommitment),m=this.signers.reduce((w,y)=>({...w,[y.publicKey.toBase58()]:y}),{}),d=[],b=[],g=[],x=0;if(this.allInstructions.forEach(w=>{let y=[...g,w],T=n?[...l.instructions,...y]:y;if(w!==r[x]&&g.length<12&&(Ce({instructions:T,payer:this.feePayer,lookupTableAddressAccount:a})||Ce({instructions:y,payer:this.feePayer,lookupTableAddressAccount:a})))g.push(w);else{if(g.length===0)throw Error("item ins too big");x+=w===r[x]?1:0;let k={};for(let I of[...new Set(u)])a[I]!==void 0&&(k[I]=a[I]);if(n&&Ce({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:p})){let I=new Be({payerKey:this.feePayer,recentBlockhash:p,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(a));d.push(new Le(I))}else{let I=new Be({payerKey:this.feePayer,recentBlockhash:p,instructions:[...g]}).compileToV0Message(Object.values(a));d.push(new Le(I))}b.push(Array.from(new Set(g.map(I=>I.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(I=>m[I]).filter(I=>I!==void 0)),g=[w]}}),g.length>0){let y=[...new Set(g.map(T=>T.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(T=>m[T]).filter(T=>T!==void 0);if(n&&Ce({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:p})){let T=new Be({payerKey:this.feePayer,recentBlockhash:p,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(a));d.push(new Le(T))}else{let T=new Be({payerKey:this.feePayer,recentBlockhash:p,instructions:[...g]}).compileToV0Message(Object.values(a));d.push(new Le(T))}b.push(y)}return this.owner?.signer&&b.forEach(w=>{w.some(y=>y.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),d.forEach((w,y)=>{w.sign(b[y])}),{builder:this,transactions:d,buildProps:e,signers:b,instructionTypes:this.instructionTypes,execute:async w=>{let{sequentially:y,onTxUpdate:T,skipTxCount:k=0,recentBlockHash:I,skipPreflight:B=!0}=w||{};if(d.map(async(_,R)=>{b[R].length&&_.sign(b[R]),I&&(_.message.recentBlockhash=I)}),pe(d),this.owner?.isKeyPair){if(y){let _=0,R=[];for(let M of d){if(++_,_<=k){console.log("skip tx: ",_),R.push("tx skipped");continue}let E=await this.connection.sendTransaction(M,{skipPreflight:B});await ze(this.connection,E),R.push(E)}return{txIds:R,signedTxs:d}}return{txIds:await Promise.all(d.map(async _=>await this.connection.sendTransaction(_,{skipPreflight:B}))),signedTxs:d}}if(this.signAllTransactions){let _=await this.signAllTransactions(d.slice(k,d.length)),R=[...d.slice(0,k),..._];if(y){let M=0,E=[],U=async()=>{if(!R[M])return;if(M<k){E.push({txId:"",status:"success",signedTx:R[M]}),T?.([...E]),M++,U();return}let q=await this.connection.sendTransaction(R[M],{skipPreflight:B});E.push({txId:q,status:"sent",signedTx:R[M]}),T?.([...E]),M++;let z=!1,F=null,D=null,Kt=ee=>{F!==null&&clearInterval(F),D!==null&&this.connection.removeSignatureListener(D);let Me=E.findIndex(Rn=>Rn.txId===q);if(Me>-1){if(E[Me].status==="error"||E[Me].status==="success")return;E[Me].status=ee.err?"error":"success"}T?.([...E]),ee.err||U()};this.loopMultiTxStatus&&(F=setInterval(async()=>{if(z){clearInterval(F);return}try{let ee=await this.connection.getTransaction(q,{commitment:"confirmed",maxSupportedTransactionVersion:0});ee&&(z=!0,clearInterval(F),Kt({err:ee.meta?.err||null}),console.log("tx status from getTransaction:",q))}catch(ee){z=!0,clearInterval(F),console.error("getTransaction timeout:",ee,q)}},Ye)),D=this.connection.onSignature(q,ee=>{if(z){this.connection.removeSignatureListener(D);return}z=!0,Kt(ee)},"confirmed"),this.connection.getSignatureStatus(q)};return U(),{txIds:[],signedTxs:R}}else{let M=[];for(let E=0;E<R.length;E+=1){let U=await this.connection.sendTransaction(R[E],{skipPreflight:B});M.push(U)}return{txIds:M,signedTxs:R}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};import co from"bn.js";var hc=new co(1e6);import{AccountLayout as we,createAssociatedTokenAccountInstruction as vt,TOKEN_PROGRAM_ID as fe,TOKEN_2022_PROGRAM_ID as No}from"@solana/spl-token";var At=(...t)=>t.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ne=class{scope;disabled=!1;logger;constructor({scope:e,moduleName:n}){this.scope=e,this.logger=H(n)}createTxBuilder(e){return this.scope.checkOwner(),new $e({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(At(e))}logInfo(...e){this.logger.info(At(e))}logAndCreateError(...e){let n=At(e);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Ao,SystemProgram as ko}from"@solana/web3.js";import So from"bn.js";import{createCloseAccountInstruction as Co,createInitializeAccountInstruction as Io,createTransferInstruction as Bo,TOKEN_PROGRAM_ID as ye}from"@solana/spl-token";import{Keypair as wo,PublicKey as Ln}from"@solana/web3.js";import To from"bn.js";import{TOKEN_PROGRAM_ID as xo}from"@solana/spl-token";function uo(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function kt(t,...e){if(!uo(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function St(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Tn(t,e){kt(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var tt=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Y=(t,e)=>t<<32-e|t>>>e;var Wc=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function lo(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Ct(t){return typeof t=="string"&&(t=lo(t)),kt(t),t}var et=class{clone(){return this._cloneInto()}},qc={}.toString;function xn(t){let e=r=>t().update(Ct(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function fo(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),a=Number(n&i),u=r?4:0,c=r?0:4;t.setUint32(e+u,s,r),t.setUint32(e+c,a,r)}var Pn=(t,e,n)=>t&e^~t&n,An=(t,e,n)=>t&e^t&n^e&n,nt=class extends et{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=tt(this.buffer)}update(e){St(this);let{view:n,buffer:r,blockLen:o}=this;e=Ct(e);let i=e.length;for(let s=0;s<i;){let a=Math.min(o-this.pos,i-s);if(a===o){let u=tt(e);for(;o<=i-s;s+=o)this.process(u,s);continue}r.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){St(this),Tn(e,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:i}=this,{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(r,0),s=0);for(let l=s;l<o;l++)n[l]=0;fo(r,o-8,BigInt(this.length*8),i),this.process(r,0);let a=tt(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,f=this.get();if(c>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<c;l++)a.setUint32(4*l,f[l],i)}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:i,destroyed:s,pos:a}=this;return e.length=o,e.pos=a,e.finished=i,e.destroyed=s,o%n&&e.buffer.set(r),e}};var po=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ue=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),le=new Uint32Array(64),It=class extends nt{constructor(){super(64,32,8,!1),this.A=ue[0]|0,this.B=ue[1]|0,this.C=ue[2]|0,this.D=ue[3]|0,this.E=ue[4]|0,this.F=ue[5]|0,this.G=ue[6]|0,this.H=ue[7]|0}get(){let{A:e,B:n,C:r,D:o,E:i,F:s,G:a,H:u}=this;return[e,n,r,o,i,s,a,u]}set(e,n,r,o,i,s,a,u){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,n){for(let l=0;l<16;l++,n+=4)le[l]=e.getUint32(n,!1);for(let l=16;l<64;l++){let p=le[l-15],m=le[l-2],d=Y(p,7)^Y(p,18)^p>>>3,b=Y(m,17)^Y(m,19)^m>>>10;le[l]=b+le[l-7]+d+le[l-16]|0}let{A:r,B:o,C:i,D:s,E:a,F:u,G:c,H:f}=this;for(let l=0;l<64;l++){let p=Y(a,6)^Y(a,11)^Y(a,25),m=f+p+Pn(a,u,c)+po[l]+le[l]|0,b=(Y(r,2)^Y(r,13)^Y(r,22))+An(r,o,i)|0;f=c,c=u,u=a,a=s+m|0,s=i,i=o,o=r,r=m+b|0}r=r+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,f=f+this.H|0,this.set(r,o,i,s,a,u,c,f)}roundClean(){le.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var kn=xn(()=>new It);import{PublicKey as yo}from"@solana/web3.js";import Cn,{isBN as Xu}from"bn.js";import{bits as Yc,BitStructure as $c,blob as mo,Blob as eu,cstr as tu,f32 as nu,f32be as ru,f64 as ou,f64be as iu,greedy as su,Layout as ho,ns64 as au,ns64be as cu,nu64 as uu,nu64be as lu,offset as fu,s16 as pu,s16be as mu,s24 as du,s24be as hu,s32 as gu,s32be as bu,s40 as yu,s40be as wu,s48 as Tu,s48be as xu,s8 as Pu,seq as Au,struct as ku,Structure as go,u16 as Su,u16be as Cu,u24 as Iu,u24be as Bu,u32 as Lu,u32be as Nu,u40 as Eu,u40be as Ru,u48 as _u,u48be as Mu,u8 as Du,UInt as bo,union as vu,Union as Ou,unionLayoutDiscriminator as Ku,utf8 as Fu}from"@solana/buffer-layout";var Bt=ho,Sn=go;var Lt=bo;var Nt=mo;var Et=class extends Bt{blob;signed;constructor(e,n,r){super(e,r),this.blob=Nt(e),this.signed=n}decode(e,n=0){let r=new Cn(this.blob.decode(e,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(e,n,r=0){return typeof e=="number"&&(e=new Cn(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),n,r)}};function In(t){return new Lt(1,t)}function rt(t){return new Lt(4,t)}function ot(t){return new Et(8,!1,t)}var Rt=class extends Bt{layout;decoder;encoder;constructor(e,n,r,o){super(e.span,o),this.layout=e,this.decoder=n,this.encoder=r}decode(e,n){return this.decoder(this.layout.decode(e,n))}encode(e,n,r){return this.layout.encode(this.encoder(e),n,r)}getSpan(e,n){return this.layout.getSpan(e,n)}};function Ee(t){return new Rt(Nt(32),e=>new yo(e),e=>e.toBuffer(),t)}var _t=class extends Sn{decode(e,n){return super.decode(e,n)}};function Bn(t,e,n){return new _t(t,e,n)}var Re=Bn([Ee("mint"),Ee("owner"),ot("amount"),rt("delegateOption"),Ee("delegate"),In("state"),rt("isNativeOption"),ot("isNative"),ot("delegatedAmount"),rt("closeAuthorityOption"),Ee("closeAuthority")]);var pl=H("Raydium_Util");function Nn({owner:t,solAccountResp:e,tokenAccountResp:n}){let r=[],o=[];for(let{pubkey:i,account:s}of n.value){let a=Re.decode(s.data),{mint:u,amount:c}=a;r.push({publicKey:i,mint:u,amount:c,isAssociated:Qe(t,u,s.owner).publicKey.equals(i),isNative:!1,programId:s.owner}),o.push({pubkey:i,accountInfo:a,programId:s.owner})}return e&&r.push({mint:Ln.default,amount:new To(String(e.lamports)),isNative:!0,programId:e.owner}),{tokenAccounts:r,tokenAccountRawInfos:o}}function it({fromPublicKey:t,programId:e=xo,assignSeed:n}){let r=n?btoa(n).slice(0,32):wo.generate().publicKey.toBase58().slice(0,32);return{publicKey:Po(t,r,e),seed:r}}function Po(t,e,n){let r=Buffer.concat([t.toBuffer(),Buffer.from(e),n.toBuffer()]),o=kn(r);return new Ln(o)}function Mt(t){let{mint:e,tokenAccount:n,owner:r,programId:o=ye}=t;return Io(n,e,r,o)}function _e(t){let{tokenAccount:e,payer:n,multiSigners:r=[],owner:o,programId:i=ye}=t;return Co(e,n,o,r,i)}async function Dt(t){let{connection:e,amount:n,commitment:r,payer:o,owner:i,skipCloseAccount:s}=t,a=await e.getMinimumBalanceForRentExemption(Re.span,r),u=X(n).add(new So(a)),c=it({fromPublicKey:o,programId:ye});return{addresses:{newAccount:c.publicKey},signers:[],instructions:[ko.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:c.seed,newAccountPubkey:c.publicKey,lamports:u.toNumber(),space:Re.span,programId:ye}),Mt({mint:new Ao(ne.address),tokenAccount:c.publicKey,owner:i,programId:ye})],instructionTypes:[V.CreateAccount,V.InitAccount],endInstructionTypes:s?[]:[V.CloseAccount],endInstructions:s?[]:[_e({tokenAccount:c.publicKey,payer:o,owner:i})]}}function En({source:t,destination:e,owner:n,amount:r,multiSigners:o=[],tokenProgram:i=ye}){return Bo(t,e,n,BigInt(String(r)),o,i)}var Ot=class extends Ne{_tokenAccounts=[];_tokenAccountRawInfos=[];_accountChangeListenerId;_accountListener=[];_clientOwnedToken=!1;_notSubscribeAccountChange=!1;_accountFetchTime=0;constructor(e){super(e);let{tokenAccounts:n,tokenAccountRawInfos:r,notSubscribeAccountChange:o}=e;this._tokenAccounts=n||[],this._tokenAccountRawInfos=r||[],this._notSubscribeAccountChange=o??!0,this._clientOwnedToken=!!(n||r)}get tokenAccounts(){return this._tokenAccounts}get tokenAccountRawInfos(){return this._tokenAccountRawInfos}set notSubscribeAccountChange(e){this._notSubscribeAccountChange=e}updateTokenAccount({tokenAccounts:e,tokenAccountRawInfos:n}){return e&&(this._tokenAccounts=e),n&&(this._tokenAccountRawInfos=n),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=void 0,this._clientOwnedToken=!0,this}addAccountChangeListener(e){return this._accountListener.push(e),this}removeAccountChangeListener(e){return this._accountListener=this._accountListener.filter(n=>n!==e),this}getAssociatedTokenAccount(e,n){return Qe(this.scope.ownerPubKey,e,n).publicKey}resetTokenAccounts(){this._clientOwnedToken||(this._tokenAccounts=[],this._tokenAccountRawInfos=[])}async fetchWalletTokenAccounts(e){if(this._clientOwnedToken||!e?.forceUpdate&&this._tokenAccounts.length&&Date.now()-this._accountFetchTime<(this._notSubscribeAccountChange?1e3*5:1e3*60*3))return{tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos};this.scope.checkOwner();let r={...{},...e},[o,i,s]=await Promise.all([this.scope.connection.getAccountInfo(this.scope.ownerPubKey,r.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:fe},r.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:No},r.commitment)]),{tokenAccounts:a,tokenAccountRawInfos:u}=Nn({owner:this.scope.ownerPubKey,solAccountResp:o,tokenAccountResp:{context:i.context,value:[...i.value,...s.value]}});return this._tokenAccounts=a,this._tokenAccountRawInfos=u,this._accountFetchTime=Date.now(),this._notSubscribeAccountChange||(this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=this.scope.connection.onAccountChange(this.scope.ownerPubKey,()=>{this.fetchWalletTokenAccounts({forceUpdate:!0}),this._accountListener.forEach(c=>c({tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos}))},{commitment:e?.commitment})),{tokenAccounts:a,tokenAccountRawInfos:u}}clearAccountChangeCkb(){this._accountChangeListenerId!==void 0&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId)}async getCreatedTokenAccount({mint:e,programId:n=fe,associatedOnly:r=!0}){await this.fetchWalletTokenAccounts();let o=this._tokenAccounts.filter(({mint:s})=>s?.equals(e)).sort((s,a)=>s.amount.lt(a.amount)?1:-1),i=this.getAssociatedTokenAccount(e,n);for(let s of o){let{publicKey:a}=s;if(a&&(!r||r&&i.equals(a)))return a}}async getOrCreateTokenAccount(e){await this.fetchWalletTokenAccounts();let{mint:n,createInfo:r,associatedOnly:o,owner:i,notUseTokenAccount:s=!1,skipCloseAccount:a=!1,checkCreateATAOwner:u=!1,assignSeed:c}=e,f=new st(e.tokenProgram||fe),l=this.getAssociatedTokenAccount(n,new st(f)),p=(s?[]:this.tokenAccountRawInfos).filter(d=>d.accountInfo.mint.equals(n)&&(!o||d.pubkey.equals(l))).sort((d,b)=>d.accountInfo.amount.lt(b.accountInfo.amount)?1:-1);r===void 0||p.length>0;let m={instructions:[],endInstructions:[],signers:[],instructionTypes:[],endInstructionTypes:[]};if(o){let d=vt(i,l,i,n,f),b=this.tokenAccountRawInfos.find(g=>g.pubkey.equals(l));if(u){let g=await this.scope.connection.getAccountInfo(l);if(g===null)m.instructions?.push(d),m.instructionTypes.push(V.CreateATA);else if(!(g.owner.equals(f)&&we.decode(g.data).mint.equals(n)&&we.decode(g.data).owner.equals(i)))throw Error(`create ata check error -> mint: ${n.toString()}, ata: ${l.toString()}`)}else b===void 0&&(m.instructions.push(d),m.instructionTypes.push(V.CreateATA));if(n.equals(oe)&&r?.amount){let g=await Dt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:r.payer||this.scope.ownerPubKey,amount:r.amount??0,skipCloseAccount:a});m.instructions.push(...g.instructions||[]),m.endInstructions.push(...g.endInstructions||[]),m.instructionTypes.push(...g.instructionTypes||[]),m.endInstructionTypes.push(...g.endInstructionTypes||[]),r.amount&&(m.instructions.push(En({source:g.addresses.newAccount,destination:l,owner:this.scope.ownerPubKey,amount:r.amount,tokenProgram:fe})),m.instructionTypes.push(V.TransferAmount))}return!a&&b===void 0&&(m.endInstructions.push(_e({owner:i,payer:r?.payer||i,tokenAccount:l,programId:f})),m.endInstructionTypes.push(V.CloseAccount)),{account:l,instructionParams:m}}else{let d=it({fromPublicKey:i,programId:f,assignSeed:c}),b=await this.scope.connection.getMinimumBalanceForRentExemption(we.span),g=Lo.createAccountWithSeed({fromPubkey:i,basePubkey:i,seed:d.seed,newAccountPubkey:d.publicKey,lamports:b+Number(r?.amount?.toString()??0),space:we.span,programId:f});return m.instructions.push(g,Mt({mint:n,tokenAccount:d.publicKey,owner:this.scope.ownerPubKey,programId:f})),m.instructionTypes.push(V.CreateAccount),m.instructionTypes.push(V.InitAccount),a||(m.endInstructions.push(_e({owner:i,payer:r?.payer||i,tokenAccount:d.publicKey,programId:f})),m.endInstructionTypes.push(V.CloseAccount)),{account:d.publicKey,instructionParams:m}}}async checkOrCreateAta({mint:e,programId:n=fe,autoUnwrapWSOLToSOL:r}){await this.fetchWalletTokenAccounts();let o=this.scope.account.tokenAccounts.find(({mint:a})=>a?.toBase58()===e.toBase58())?.publicKey,i=this.scope.ownerPubKey,s={};if(!o){let a=this.getAssociatedTokenAccount(e,n),u=await vt(i,a,i,e,n);s.instructions=[u],s.instructionTypes=[V.CreateATA],o=a}return r&&oe.toBase58()===e.toBase58()&&(s.endInstructions=[_e({owner:i,payer:i,tokenAccount:o,programId:n})],s.endInstructionTypes=[V.CloseAccount]),{pubKey:o,newInstructions:s}}async handleTokenAccount(e){let{side:n,amount:r,mint:o,programId:i=fe,tokenAccount:s,payer:a=this.scope.ownerPubKey,bypassAssociatedCheck:u,skipCloseAccount:c,checkCreateATAOwner:f}=e,l=this.getAssociatedTokenAccount(o,i);if(new st(oe).equals(o)){let p=await Dt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:a,amount:r,skipCloseAccount:c});return{tokenAccount:p.addresses.newAccount,...p}}else if(!s||n==="out"&&!l.equals(s)&&!u){let p=[],m=vt(this.scope.ownerPubKey,l,this.scope.ownerPubKey,o,i);if(f){let d=await this.scope.connection.getAccountInfo(l);if(d===null)p.push(m);else if(!(d.owner.equals(fe)&&we.decode(d.data).mint.equals(o)&&we.decode(d.data).owner.equals(this.scope.ownerPubKey)))throw Error(`create ata check error -> mint: ${o.toString()}, ata: ${l.toString()}`)}else p.push(m);return{tokenAccount:l,instructions:p,instructionTypes:[V.CreateATA]}}return{tokenAccount:s}}async processTokenAccount(e){let{mint:n,programId:r=fe,amount:o,useSOLBalance:i,handleTokenAccount:s,feePayer:a}=e,u,c=this.createTxBuilder(a);if(n.equals(new st(oe))&&i){let{tokenAccount:f,...l}=await this.handleTokenAccount({side:"in",amount:o||0,mint:n,bypassAssociatedCheck:!0,programId:r});u=f,c.addInstruction(l)}else if(u=await this.getCreatedTokenAccount({mint:n,associatedOnly:!1,programId:r}),!u&&s){let{tokenAccount:f,...l}=await this.scope.account.handleTokenAccount({side:"in",amount:0,mint:n,bypassAssociatedCheck:!0,programId:r});u=f,c.addInstruction(l)}return{tokenAccount:u,...c.AllTxData}}};export{Ot as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=account.mjs.map