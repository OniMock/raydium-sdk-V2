var Si=Object.defineProperty;var Ii=(i,e,t)=>e in i?Si(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var Nt=(i,e,t)=>(Ii(i,typeof e!="symbol"?e+"":e,t),t);import{Keypair as Ht,PublicKey as k,SystemProgram as He,TransactionInstruction as we}from"@solana/web3.js";import In from"bn.js";import{PublicKey as Ki}from"@solana/web3.js";import{get as Nn,set as Ni}from"lodash";var jt=class{logLevel;name;constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Cn={},Ci={};function Te(i){let e=Nn(Cn,i);if(!e){let t=Nn(Ci,i);e=new jt({name:i,logLevel:t}),Ni(Cn,i,e)}return e}import{MINT_SIZE as Fo,TOKEN_PROGRAM_ID as vo,getTransferFeeConfig as Wo,unpackMint as Oo}from"@solana/spl-token";var Zt=Te("Raydium_accountInfo_util");async function ze(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}={batchRequest:!1,...t},s=Qt(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(m=>{let d=i._buildArgs([m.map(f=>f.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=Qt(u,10);a=(await(await Promise.all(c.map(async m=>await i._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&Zt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:f,executable:p,lamports:b,owner:y,rentEpoch:g}=d;return f.length!==2&&f[1]!=="base64"&&Zt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:p,lamports:b,owner:new Ki(y),rentEpoch:g}}return null})))}else try{a=await Promise.all(s.map(u=>i.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&Zt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function Yt(i,e,t){let n=await ze(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>({...r,accountInfo:n[o]}))}import Ge from"bn.js";var ct=9e15,Ye=1e9,$t="0123456789abcdef",Lt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Mt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",en={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-ct,maxE:ct,crypto:!1},Rn,qe,L=!0,Et="[DecimalError] ",Qe=Et+"Invalid argument: ",En=Et+"Precision limit exceeded",Fn=Et+"crypto unavailable",vn="[object Decimal]",ke=Math.floor,me=Math.pow,Li=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Mi=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Ri=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Wn=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Fe=1e7,K=7,Ei=9007199254740991,Fi=Lt.length-1,tn=Mt.length-1,h={toStringTag:vn};h.absoluteValue=h.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),I(i)};h.ceil=function(){return I(new this.constructor(this),this.e+1,2)};h.clampedTo=h.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(Qe+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};h.comparedTo=h.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};h.cosine=h.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+K,n.rounding=1,t=vi(n,Vn(n,t)),n.precision=i,n.rounding=e,I(qe==2||qe==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};h.cubeRoot=h.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(L=!1,o=l.s*me(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=ye(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=me(t,1/3),i=ke((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=Q(c.plus(l).times(a),c.plus(u),s+2,1),ye(a.d).slice(0,s)===(t=ye(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(I(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(I(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return L=!0,I(n,i,m.rounding,e)};h.decimalPlaces=h.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-ke(this.e/K))*K,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};h.dividedBy=h.div=function(i){return Q(this,new this.constructor(i))};h.dividedToIntegerBy=h.divToInt=function(i){var e=this,t=e.constructor;return I(Q(e,new t(i),0,1,1),t.precision,t.rounding)};h.equals=h.eq=function(i){return this.cmp(i)===0};h.floor=function(){return I(new this.constructor(this),this.e+1,3)};h.greaterThan=h.gt=function(i){return this.cmp(i)>0};h.greaterThanOrEqualTo=h.gte=function(i){var e=this.cmp(i);return e==1||e===0};h.hyperbolicCosine=h.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/vt(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=lt(s,1,o.times(e),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return I(o,s.precision=t,s.rounding=n,!0)};h.hyperbolicSine=h.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=lt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/vt(5,i)),r=lt(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,I(r,e,t,!0)};h.hyperbolicTangent=h.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,Q(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};h.inverseCosine=h.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Ee(t,r,o):new t(0):new t(NaN):e.isZero()?Ee(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Ee(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};h.inverseHyperbolicCosine=h.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,L=!1,t=t.times(t).minus(1).sqrt().plus(t),L=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};h.inverseHyperbolicSine=h.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,L=!1,t=t.times(t).plus(1).sqrt().plus(t),L=!0,n.precision=i,n.rounding=e,t.ln())};h.inverseHyperbolicTangent=h.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?I(new o(r),i,e,!0):(o.precision=t=n-r.e,r=Q(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};h.inverseSine=h.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Ee(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};h.inverseTangent=h.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=tn)return s=Ee(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=tn)return s=Ee(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/K+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(L=!1,e=Math.ceil(a/K),n=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),L=!0,I(s,l.precision=m,l.rounding=d,!0)};h.isFinite=function(){return!!this.d};h.isInteger=h.isInt=function(){return!!this.d&&ke(this.e/K)>this.d.length-2};h.isNaN=function(){return!this.s};h.isNegative=h.isNeg=function(){return this.s<0};h.isPositive=h.isPos=function(){return this.s>0};h.isZero=function(){return!!this.d&&this.d[0]===0};h.lessThan=h.lt=function(i){return this.cmp(i)<0};h.lessThanOrEqualTo=h.lte=function(i){return this.cmp(i)<1};h.logarithm=h.log=function(i){var e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,f=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(L=!1,a=m+f,s=Ze(c,a),n=e?Rt(l,a+10):Ze(i,a),u=Q(s,n,a,1),ft(u.d,r=m,d))do if(a+=10,s=Ze(c,a),n=e?Rt(l,a+10):Ze(i,a),u=Q(s,n,a,1),!o){+ye(u.d).slice(r+1,r+15)+1==1e14&&(u=I(u,m+1,0));break}while(ft(u.d,r+=10,d));return L=!0,I(u,m,d)};h.minus=h.sub=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,f=this,p=f.constructor;if(i=new p(i),!f.d||!i.d)return!f.s||!i.s?i=new p(NaN):f.d?i.s=-i.s:i=new p(i.d||f.s!==i.s?f:NaN),i;if(f.s!=i.s)return i.s=-i.s,f.plus(i);if(c=f.d,d=i.d,a=p.precision,u=p.rounding,!c[0]||!d[0]){if(d[0])i.s=-i.s;else if(c[0])i=new p(f);else return new p(u===3?-0:0);return L?I(i,a,u):i}if(t=ke(i.e/K),l=ke(f.e/K),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/K),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,i.s=-i.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(r=n;r&&c[--r]===0;)c[r]=Fe-1;--c[r],c[n]+=Fe}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=Ft(c,t),L?I(i,a,u):i):new p(u===3?-0:0)};h.modulo=h.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?I(new n(t),n.precision,n.rounding):(L=!1,n.modulo==9?(e=Q(t,i.abs(),0,3,1),e.s*=i.s):e=Q(t,i,0,n.modulo,1),e=e.times(i),L=!0,t.minus(e))};h.naturalExponential=h.exp=function(){return nn(this)};h.naturalLogarithm=h.ln=function(){return Ze(this)};h.negated=h.neg=function(){var i=new this.constructor(this);return i.s=-i.s,I(i)};h.plus=h.add=function(i){var e,t,n,r,o,s,a,u,c,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(i=new d(m)),L?I(i,a,u):i;if(o=ke(m.e/K),n=ke(i.e/K),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/K),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/Fe|0,c[r]%=Fe;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=Ft(c,n),L?I(i,a,u):i};h.precision=h.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(Qe+i);return t.d?(e=On(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};h.round=function(){var i=this,e=i.constructor;return I(new e(i),i.e+1,e.rounding)};h.sine=h.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+K,n.rounding=1,t=Oi(n,Vn(n,t)),n.precision=i,n.rounding=e,I(qe>2?t.neg():t,i,e,!0)):new n(NaN)};h.squareRoot=h.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(L=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=ye(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=ke((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(Q(s,o,t+2,1)).times(.5),ye(o.d).slice(0,t)===(e=ye(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(I(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(I(n,u+1,1),i=!n.times(n).eq(s));break}return L=!0,I(n,u,l.rounding,i)};h.tangent=h.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=Q(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,I(qe==2||qe==4?t.neg():t,i,e,!0)):new n(NaN)};h.times=h.mul=function(i){var e,t,n,r,o,s,a,u,c,l=this,m=l.constructor,d=l.d,f=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!f||!f[0])return new m(!i.s||d&&!d[0]&&!f||f&&!f[0]&&!d?NaN:!d||!f?i.s/0:i.s*0);for(t=ke(l.e/K)+ke(i.e/K),u=d.length,c=f.length,u<c&&(o=d,d=f,f=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+f[n]*d[r-n-1]+e,o[r--]=a%Fe|0,e=a/Fe|0;o[r]=(o[r]+e)%Fe|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Ft(o,t),L?I(i,m.precision,m.rounding):i};h.toBinary=function(i,e){return on(this,2,i,e)};h.toDecimalPlaces=h.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Ie(i,0,Ye),e===void 0?e=n.rounding:Ie(e,0,8),I(t,i+t.e+1,e))};h.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Oe(n,!0):(Ie(i,0,Ye),e===void 0?e=r.rounding:Ie(e,0,8),n=I(new r(n),i+1,e),t=Oe(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};h.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Oe(r):(Ie(i,0,Ye),e===void 0?e=o.rounding:Ie(e,0,8),n=I(new o(r),i+r.e+1,e),t=Oe(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};h.toFraction=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,f=this,p=f.d,b=f.constructor;if(!p)return new b(f);if(c=t=new b(1),n=u=new b(0),e=new b(n),o=e.e=On(p)-f.e-1,s=o%K,e.d[0]=me(10,s<0?K+s:s),i==null)i=o>0?e:c;else{if(a=new b(i),!a.isInt()||a.lt(c))throw Error(Qe+a);i=a.gt(e)?o>0?e:c:a}for(L=!1,a=new b(ye(p)),l=b.precision,b.precision=o=p.length*K*2;m=Q(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=a.minus(m.times(r)),a=r;return r=Q(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=f.s,d=Q(c,n,o,1).minus(f).abs().cmp(Q(u,t,o,1).minus(f).abs())<1?[c,n]:[u,t],b.precision=l,L=!0,d};h.toHexadecimal=h.toHex=function(i,e){return on(this,16,i,e)};h.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Ie(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(L=!1,t=Q(t,i,0,e,1).times(i),L=!0,I(t)):(i.s=t.s,t=i),t};h.toNumber=function(){return+this};h.toOctal=function(i,e){return on(this,8,i,e)};h.toPower=h.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(me(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return I(a,n,o);if(e=ke(i.e/K),e>=i.d.length-1&&(t=c<0?-c:c)<=Ei)return r=Dn(u,a,t,n),i.s<0?new u(1).div(r):I(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=me(+a,c),e=t==0||!isFinite(t)?ke(c*(Math.log("0."+ye(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(L=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=nn(i.times(Ze(a,n+t)),n),r.d&&(r=I(r,n+5,1),ft(r.d,n,o)&&(e=n+10,r=I(nn(i.times(Ze(a,e+t)),e),e+5,1),+ye(r.d).slice(n+1,n+15)+1==1e14&&(r=I(r,n+1,0)))),r.s=s,L=!0,u.rounding=o,I(r,n,o))};h.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Oe(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Ie(i,1,Ye),e===void 0?e=r.rounding:Ie(e,0,8),n=I(new r(n),i,e),t=Oe(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};h.toSignificantDigits=h.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Ie(i,1,Ye),e===void 0?e=n.rounding:Ie(e,0,8)),I(new n(t),i,e)};h.toString=function(){var i=this,e=i.constructor,t=Oe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};h.truncated=h.trunc=function(){return I(new this.constructor(this),this.e+1,1)};h.valueOf=h.toJSON=function(){var i=this,e=i.constructor,t=Oe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function ye(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=K-n.length,t&&(o+=je(t)),o+=n;s=i[e],n=s+"",t=K-n.length,t&&(o+=je(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ie(i,e,t){if(i!==~~i||i<e||i>t)throw Error(Qe+i)}function ft(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=K,r=0):(r=Math.ceil((e+1)/K),e%=K),o=me(10,K-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==me(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==me(10,e-3)-1,s}function Kt(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=$t.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function vi(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/vt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=lt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var Q=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,l,m,d,f,p,b,y,g,A,P,T,C,w,S,R,E,U,_,le,Y=n.constructor,fe=n.s==r.s?1:-1,re=n.d,J=r.d;if(!re||!re[0]||!J||!J[0])return new Y(!n.s||!r.s||(re?J&&re[0]==J[0]:!J)?NaN:re&&re[0]==0||!J?fe*0:fe/0);for(u?(f=1,l=n.e-r.e):(u=Fe,f=K,l=ke(n.e/f)-ke(r.e/f)),_=J.length,E=re.length,g=new Y(fe),A=g.d=[],m=0;J[m]==(re[m]||0);m++);if(J[m]>(re[m]||0)&&l--,o==null?(w=o=Y.precision,s=Y.rounding):a?w=o+(n.e-r.e)+1:w=o,w<0)A.push(1),p=!0;else{if(w=w/f+2|0,m=0,_==1){for(d=0,J=J[0],w++;(m<E||d)&&w--;m++)S=d*u+(re[m]||0),A[m]=S/J|0,d=S%J|0;p=d||m<E}else{for(d=u/(J[0]+1)|0,d>1&&(J=i(J,d,u),re=i(re,d,u),_=J.length,E=re.length),R=_,P=re.slice(0,_),T=P.length;T<_;)P[T++]=0;le=J.slice(),le.unshift(0),U=J[0],J[1]>=u/2&&++U;do d=0,c=e(J,P,_,T),c<0?(C=P[0],_!=T&&(C=C*u+(P[1]||0)),d=C/U|0,d>1?(d>=u&&(d=u-1),b=i(J,d,u),y=b.length,T=P.length,c=e(b,P,y,T),c==1&&(d--,t(b,_<y?le:J,y,u))):(d==0&&(c=d=1),b=J.slice()),y=b.length,y<T&&b.unshift(0),t(P,b,T,u),c==-1&&(T=P.length,c=e(J,P,_,T),c<1&&(d++,t(P,_<T?le:J,T,u))),T=P.length):c===0&&(d++,P=[0]),A[m++]=d,c&&P[0]?P[T++]=re[R]||0:(P=[re[R]],T=1);while((R++<E||P[0]!==void 0)&&w--);p=P[0]!==void 0}A[0]||A.shift()}if(f==1)g.e=l,Rn=p;else{for(m=1,d=A[0];d>=10;d/=10)m++;g.e=m+l*f-1,I(g,a?o+g.e+1:o,s,p)}return g}}();function I(i,e,t,n){var r,o,s,a,u,c,l,m,d,f=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=K,s=e,l=m[d=0],u=l/me(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/K),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,r=1,o%=K,s=o-K+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=K,s=o-K+r,u=s<0?0:l/me(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%me(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/me(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=me(10,(K-e%K)%K),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=me(10,K-o),m[d]=s>0?(l/me(10,r-s)%me(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==Fe&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Fe)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return L&&(i.e>f.maxE?(i.d=null,i.e=NaN):i.e<f.minE&&(i.e=0,i.d=[0])),i}function Oe(i,e,t){if(!i.isFinite())return qn(i);var n,r=i.e,o=ye(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+je(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+je(-r-1)+o,t&&(n=t-s)>0&&(o+=je(n))):r>=s?(o+=je(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+je(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=je(n))),o}function Ft(i,e){var t=i[0];for(e*=K;t>=10;t/=10)e++;return e}function Rt(i,e,t){if(e>Fi)throw L=!0,t&&(i.precision=t),Error(En);return I(new i(Lt),e,1,!0)}function Ee(i,e,t){if(e>tn)throw Error(En);return I(new i(Mt),e,t,!0)}function On(i){var e=i.length-1,t=e*K+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function je(i){for(var e="";i--;)e+="0";return e}function Dn(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/K+4);for(L=!1;;){if(t%2&&(o=o.times(e),Ln(o.d,s)&&(r=!0)),t=ke(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Ln(e.d,s)}return L=!0,o}function Kn(i){return i.d[i.d.length-1]&1}function _n(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function nn(i,e){var t,n,r,o,s,a,u,c=0,l=0,m=0,d=i.constructor,f=d.rounding,p=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(L=!1,u=p):u=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(me(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=I(o.times(i),u,1),t=t.times(++l),a=s.plus(Q(o,t,u,1)),ye(a.d).slice(0,u)===ye(s.d).slice(0,u)){for(r=m;r--;)s=I(s.times(s),u,1);if(e==null)if(c<3&&ft(s.d,u-n,f,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return I(s,d.precision=p,f,L=!0);else return d.precision=p,s}s=a}}function Ze(i,e){var t,n,r,o,s,a,u,c,l,m,d,f=1,p=10,b=i,y=b.d,g=b.constructor,A=g.rounding,P=g.precision;if(b.s<0||!y||!y[0]||!b.e&&y[0]==1&&y.length==1)return new g(y&&!y[0]?-1/0:b.s!=1?NaN:y?0:b);if(e==null?(L=!1,l=P):l=e,g.precision=l+=p,t=ye(y),n=t.charAt(0),Math.abs(o=b.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)b=b.times(i),t=ye(b.d),n=t.charAt(0),f++;o=b.e,n>1?(b=new g("0."+t),o++):b=new g(n+"."+t.slice(1))}else return c=Rt(g,l+2,P).times(o+""),b=Ze(new g(n+"."+t.slice(1)),l-p).plus(c),g.precision=P,e==null?I(b,P,A,L=!0):b;for(m=b,u=s=b=Q(b.minus(1),b.plus(1),l,1),d=I(b.times(b),l,1),r=3;;){if(s=I(s.times(d),l,1),c=u.plus(Q(s,new g(r),l,1)),ye(c.d).slice(0,l)===ye(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Rt(g,l+2,P).times(o+""))),u=Q(u,new g(f),l,1),e==null)if(ft(u.d,l-p,A,a))g.precision=l+=p,c=s=b=Q(m.minus(1),m.plus(1),l,1),d=I(b.times(b),l,1),r=a=1;else return I(u,g.precision=P,A,L=!0);else return g.precision=P,u;u=c,r+=2}}function qn(i){return String(i.s*i.s/0)}function rn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%K,t<0&&(n+=K),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=K;n<r;)i.d.push(+e.slice(n,n+=K));e=e.slice(n),n=K-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),L&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Wi(i,e){var t,n,r,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Wn.test(e))return rn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(Mi.test(e))t=16,e=e.toLowerCase();else if(Li.test(e))t=2;else if(Ri.test(e))t=8;else throw Error(Qe+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=Dn(n,new n(t),o,o*2)),c=Kt(e,t,Fe),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=Ft(c,l),i.d=c,L=!1,s&&(i=Q(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?me(2,u):pt.pow(2,u))),L=!0,i)}function Oi(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:lt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/vt(5,t)),e=lt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function lt(i,e,t,n,r){var o,s,a,u,c=1,l=i.precision,m=Math.ceil(l/K);for(L=!1,u=t.times(t),a=new i(n);;){if(s=Q(a.times(u),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=Q(s.times(u),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return L=!0,s.d.length=m+1,s}function vt(i,e){for(var t=i;--e;)t*=i;return t}function Vn(i,e){var t,n=e.s<0,r=Ee(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return qe=n?4:1,e;if(t=e.divToInt(r),t.isZero())qe=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return qe=Kn(t)?n?2:3:n?4:1,e;qe=Kn(t)?n?1:4:n?3:2}return e.minus(r).abs()}function on(i,e,t,n){var r,o,s,a,u,c,l,m,d,f=i.constructor,p=t!==void 0;if(p?(Ie(t,1,Ye),n===void 0?n=f.rounding:Ie(n,0,8)):(t=f.precision,n=f.rounding),!i.isFinite())l=qn(i);else{for(l=Oe(i),s=l.indexOf("."),p?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new f(1),d.e=l.length-s,d.d=Kt(Oe(d),10,r),d.e=d.d.length),m=Kt(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=p?"0p+0":"0";else{if(s<0?o--:(i=new f(i),i.d=m,i.e=o,i=Q(i,d,t,n,0,r),m=i.d,o=i.e,c=Rn),s=m[t],a=r/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=$t.charAt(m[s]);if(p){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Kt(l,r,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=$t.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function Ln(i,e){if(i.length>e)return i.length=e,!0}function Di(i){return new this(i).abs()}function _i(i){return new this(i).acos()}function qi(i){return new this(i).acosh()}function Vi(i,e){return new this(i).plus(e)}function Gi(i){return new this(i).asin()}function Ui(i){return new this(i).asinh()}function Xi(i){return new this(i).atan()}function Hi(i){return new this(i).atanh()}function zi(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Ee(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Ee(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Ee(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(Q(i,e,o,1)),e=Ee(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(Q(i,e,o,1)),t}function ji(i){return new this(i).cbrt()}function Zi(i){return I(i=new this(i),i.e+1,2)}function Qi(i,e,t){return new this(i).clamp(e,t)}function Yi(i){if(!i||typeof i!="object")throw Error(Et+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,Ye,"rounding",0,8,"toExpNeg",-ct,0,"toExpPos",0,ct,"maxE",0,ct,"minE",-ct,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=en[t]),(n=i[t])!==void 0)if(ke(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(Qe+t+": "+n);if(t="crypto",r&&(this[t]=en[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Fn);else this[t]=!1;else throw Error(Qe+t+": "+n);return this}function Ji(i){return new this(i).cos()}function $i(i){return new this(i).cosh()}function Gn(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,Mn(o)){c.s=o.s,L?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;L?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return rn(c,o.toString())}else if(u!=="string")throw Error(Qe+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),Wn.test(o)?rn(c,o):Wi(c,o)}if(r.prototype=h,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Yi,r.clone=Gn,r.isDecimal=Mn,r.abs=Di,r.acos=_i,r.acosh=qi,r.add=Vi,r.asin=Gi,r.asinh=Ui,r.atan=Xi,r.atanh=Hi,r.atan2=zi,r.cbrt=ji,r.ceil=Zi,r.clamp=Qi,r.cos=Ji,r.cosh=$i,r.div=er,r.exp=tr,r.floor=nr,r.hypot=ir,r.ln=rr,r.log=or,r.log10=ar,r.log2=sr,r.max=ur,r.min=cr,r.mod=lr,r.mul=mr,r.pow=dr,r.random=fr,r.round=pr,r.sign=br,r.sin=gr,r.sinh=yr,r.sqrt=hr,r.sub=wr,r.sum=kr,r.tan=Pr,r.tanh=Ar,r.trunc=Tr,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function er(i,e){return new this(i).div(e)}function tr(i){return new this(i).exp()}function nr(i){return I(i=new this(i),i.e+1,3)}function ir(){var i,e,t=new this(0);for(L=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return L=!0,new this(1/0);t=e}return L=!0,t.sqrt()}function Mn(i){return i instanceof pt||i&&i.toStringTag===vn||!1}function rr(i){return new this(i).ln()}function or(i,e){return new this(i).log(e)}function sr(i){return new this(i).log(2)}function ar(i){return new this(i).log(10)}function ur(){return _n(this,arguments,"lt")}function cr(){return _n(this,arguments,"gt")}function lr(i,e){return new this(i).mod(e)}function mr(i,e){return new this(i).mul(e)}function dr(i,e){return new this(i).pow(e)}function fr(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Ie(i,1,Ye),n=Math.ceil(i/K),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(Fn);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=K,n&&i&&(r=me(10,K-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=K)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<K&&(t-=K-n)}return s.e=t,s.d=a,s}function pr(i){return I(i=new this(i),i.e+1,this.rounding)}function br(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function gr(i){return new this(i).sin()}function yr(i){return new this(i).sinh()}function hr(i){return new this(i).sqrt()}function wr(i,e){return new this(i).sub(e)}function kr(){var i=0,e=arguments,t=new this(e[i]);for(L=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return L=!0,I(t,this.precision,this.rounding)}function Pr(i){return new this(i).tan()}function Ar(i){return new this(i).tanh()}function Tr(i){return I(i=new this(i),i.e+1,1)}h[Symbol.for("nodejs.util.inspect.custom")]=h.toString;h[Symbol.toStringTag]="Decimal";var pt=h.constructor=Gn(en);Lt=new pt(Lt);Mt=new pt(Mt);var B=pt;import Lr from"big.js";import Dt from"bn.js";import xr from"toformat";var Br=xr,bt=Br;import Ot from"big.js";import Ir from"bn.js";import Nr from"decimal.js-light";import gt from"bn.js";var Un=9007199254740991;function pe(i){let e=Te("Raydium_parseBigNumberish");if(i instanceof gt)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new gt(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=Un||i<=-Un)&&e.logWithError(`BigNumberish number overflow: ${i}`),new gt(String(i))):typeof i=="bigint"?new gt(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new gt(0))}var Wt=Te("module/fraction"),sn=bt(Ot),yt=bt(Nr),Cr={[0]:yt.ROUND_DOWN,[1]:yt.ROUND_HALF_UP,[2]:yt.ROUND_UP},Kr={[0]:Ot.roundDown,[1]:Ot.roundHalfUp,[2]:Ot.roundUp},X=class{numerator;denominator;constructor(e,t=new Ir(1)){this.numerator=pe(e),this.denominator=pe(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new X(this.denominator,this.numerator)}add(e){let t=e instanceof X?e:new X(pe(e));return this.denominator.eq(t.denominator)?new X(this.numerator.add(t.numerator),this.denominator):new X(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof X?e:new X(pe(e));return this.denominator.eq(t.denominator)?new X(this.numerator.sub(t.numerator),this.denominator):new X(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof X?e:new X(pe(e));return new X(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof X?e:new X(pe(e));return new X(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Wt.logWithError(`${e} is not an integer.`),e<=0&&Wt.logWithError(`${e} is not positive.`),yt.set({precision:e+1,rounding:Cr[n]});let r=new yt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Wt.logWithError(`${e} is not an integer.`),e<0&&Wt.logWithError(`${e} is negative.`),sn.DP=e,sn.RM=Kr[n]||1,new sn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Mr=Te("Raydium_amount"),Xn=bt(Lr);function Rr(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):Mr.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var Pe=class extends X{token;logger;constructor(e,t,n=!0,r){let o=new Dt(0),s=an.pow(new Dt(e.decimals));if(n)o=pe(t);else{let a=new Dt(0),u=new Dt(0);if(typeof t=="string"||typeof t=="number"||typeof t=="bigint"){let[c,l]=Rr(t.toString(),e.decimals);a=pe(c),u=pe(l)}a=a.mul(s),o=a.add(u)}super(o,s),this.logger=Te(r||"TokenAmount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new Pe(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new Pe(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,t,n=0){return super.toSignificant(e,t,n)}toFixed(e=this.token.decimals,t,n=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,t,n)}toExact(e={groupSeparator:""}){return Xn.DP=this.token.decimals,new Xn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};import{PublicKey as Er}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Hn}from"@solana/spl-token";var zn={chainId:101,address:Er.default.toBase58(),programId:Hn.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},nt={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Hn.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as mn}from"@solana/web3.js";import{PublicKey as te,SystemProgram as jn,SYSVAR_RENT_PUBKEY as Fr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as vr}from"@solana/spl-token";function un({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var ys=[un({pubkey:vr,isWritable:!1}),un({pubkey:jn.programId,isWritable:!1}),un({pubkey:Fr,isWritable:!1})];function cn({publicKey:i,transformSol:e}){let t=Zn(i.toString());if(t instanceof te)return e&&t.equals(ht)?Jt:t;if(e&&t.toString()===ht.toBase58())return Jt;if(typeof t=="string"){if(t===te.default.toBase58())return te.default;try{return new te(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Zn(i){try{return new te(i)}catch{return i}}var _t=new te("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ln=new te("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Je=new te("SysvarRent111111111111111111111111111111111"),hs=new te("SysvarC1ock11111111111111111111111111111111"),it=new te("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ws=new te("Sysvar1nstructions1111111111111111111111111"),ks=jn.programId,Ps=new te("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),As=new te("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ts=new te("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),xs=new te("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Bs=new te("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ss=new te("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Is=new te("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ns=new te("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Cs=new te("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ks=new te("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ls=new te("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Jt=new te("So11111111111111111111111111111111111111112"),ht=te.default;function Ct(i){return cn({publicKey:i,transformSol:!0})}var dn=class{symbol;name;decimals;isToken2022;mint;constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===ht.toBase58()||e instanceof mn&&ht.equals(e)){this.decimals=nt.decimals,this.symbol=nt.symbol,this.name=nt.name,this.mint=new mn(nt.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?mn.default:cn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ve=dn;Nt(Ve,"WSOL",new dn({...nt,mint:nt.address}));var fn=class{symbol;name;decimals;constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},qt=fn;Nt(qt,"SOL",new fn(zn));import Wr from"bn.js";var Qn=new X(new Wr(100)),$e=class extends X{toSignificant(e=5,t,n){return this.mul(Qn).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Qn).toFixed(e,t,n)}};var Or=Te("Raydium_price"),ve=class extends X{baseToken;quoteToken;scalar;constructor(e){let{baseToken:t,quoteToken:n,numerator:r,denominator:o}=e;super(r,o),this.baseToken=t,this.quoteToken=n,this.scalar=new X(pn(t.decimals),pn(n.decimals))}get raw(){return new X(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new ve({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&Or.logWithError("mul token not equals");let t=super.mul(e);return new ve({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:t.denominator,numerator:t.numerator})}toSignificant(e=this.quoteToken.decimals,t,n){return this.adjusted.toSignificant(e,t,n)}toFixed(e=this.quoteToken.decimals,t,n){return this.adjusted.toFixed(e,t,n)}};import{PublicKey as ca}from"@solana/web3.js";import ma from"bn.js";var Dr=new Ge(0),Ca=new Ge(1),Ka=new Ge(2),La=new Ge(3),Ma=new Ge(5),an=new Ge(10),Ra=new Ge(100),Ea=new Ge(1e3),Fa=new Ge(1e4);function pn(i){return an.pow(pe(i))}function Qt(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as qr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Vr}from"@solana/spl-token";import{ComputeBudgetProgram as Ga,Keypair as Ha,PublicKey as _r,Transaction as ja,TransactionMessage as Qa,VersionedTransaction as Ya}from"@solana/web3.js";var be={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip",NonceAccount:"NonceAccount"};import{TOKEN_PROGRAM_ID as tu}from"@solana/spl-token";var nu=Te("Raydium_txUtil");function xe(i,e){let[t,n]=_r.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function ue(i,e,t){return xe([i.toBuffer(),(t??Vr).toBuffer(),e.toBuffer()],new qr("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as M}from"@solana/web3.js";var cu=new M("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),lu=new M("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),mu=new M("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),du=new M("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),fu=new M("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),pu=new M("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),bu=new M("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),gu=new M("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),yu=new M("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),hu=new M("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),wu=new M("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),ku=new M("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Pu=new M("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Au=new M("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Tu=new M("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),xu=new M("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Bu=new M("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Su=new M("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Iu=new M("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Nu=new M("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Cu=new M("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Ku=new M("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Gr=new M("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Ur=new M("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Xr=new M("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Lu=new M("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Hr=new M("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Mu=new M("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),zr=new M("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),Ru=new M("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Eu=new M("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),jr=new M("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),Zr=new M("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var Fu={SERUM_MARKET:M.default,OPENBOOK_MARKET:new M("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:M.default,FarmV3:new M("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new M("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new M("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new M("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new M("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new M("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new M("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new M("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new M("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Gr,CREATE_CPMM_POOL_AUTH:Ur,CREATE_CPMM_POOL_FEE_ACC:Xr,FEE_DESTINATION_ID:new M("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:Hr,LCOK_CPMM_AUTH:zr,LAUNCHPAD_PROGRAM:jr,LAUNCHPAD_AUTH:Zr};import We from"bn.js";var wt=1e4;function ae(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r={...e,olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}},o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new We(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===wt){let u=new We(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=bn(i.mul(new We(wt)),new We(wt-o.transferFeeBasisPoints)),c=new We(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=bn(l.mul(new We(o.transferFeeBasisPoints)),new We(wt)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=bn(i.mul(new We(o.transferFeeBasisPoints)),new We(wt)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function et(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function bn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new We(0))?t.add(new We(1)):t}import{PublicKey as Qr,AddressLookupTableAccount as Yn}from"@solana/web3.js";var Yr={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Yn({key:new Qr("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Yn.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as ec,sendAndConfirmTransaction as tc,SystemProgram as rc,Transaction as oc,TransactionMessage as ac,VersionedTransaction as uc}from"@solana/web3.js";import lc from"axios";import Jr from"bn.js";var yc=new Jr(1e6);import{ASSOCIATED_TOKEN_PROGRAM_ID as It,TOKEN_2022_PROGRAM_ID as se,TOKEN_PROGRAM_ID as j}from"@solana/spl-token";import{PublicKey as ao}from"@solana/web3.js";import ti,{isBN as ni}from"bn.js";import{bits as Dc,BitStructure as _c,blob as $r,Blob as qc,cstr as Vc,f32 as Gc,f32be as Uc,f64 as Xc,f64be as Hc,greedy as zc,Layout as eo,ns64 as jc,ns64be as Zc,nu64 as Qc,nu64be as Yc,offset as Jc,s16 as $c,s16be as el,s24 as tl,s24be as nl,s32 as to,s32be as il,s40 as rl,s40be as ol,s48 as sl,s48be as al,s8 as ul,seq as no,struct as cl,Structure as io,u16 as ro,u16be as ll,u24 as ml,u24be as dl,u32 as fl,u32be as pl,u40 as bl,u40be as gl,u48 as yl,u48be as hl,u8 as oo,UInt as so,union as wl,Union as kl,unionLayoutDiscriminator as Pl,utf8 as Al}from"@solana/buffer-layout";var gn=eo,Jn=io;var yn=so;var $n=oo,kt=ro;var $=to;var ei=no;var Ne=$r;var mt=class extends gn{blob;signed;constructor(e,t,n){super(e,n),this.blob=Ne(e),this.signed=t}decode(e,t=0){let n=new ti(this.blob.decode(e,t),10,"le");return this.signed?n.fromTwos(this.span*8).clone():n}encode(e,t,n=0){return typeof e=="number"&&(e=new ti(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),t,n)}};function oe(i){return new yn(1,i)}function dt(i){return new yn(4,i)}function N(i){return new mt(8,!1,i)}function q(i){return new mt(16,!1,i)}function ii(i){return new mt(8,!0,i)}function ri(i){return new mt(16,!0,i)}var Vt=class extends gn{layout;decoder;encoder;constructor(e,t,n,r){super(e.span,r),this.layout=e,this.decoder=t,this.encoder=n}decode(e,t){return this.decoder(this.layout.decode(e,t))}encode(e,t,n){return this.layout.encode(this.encoder(e),t,n)}getSpan(e,t){return this.layout.getSpan(e,t)}};function Z(i){return new Vt(Ne(32),e=>new ao(e),e=>e.toBuffer(),i)}function Be(i){return new Vt($n(),uo,co,i)}function uo(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function co(i){return i?1:0}var hn=class extends Jn{decode(e,t){return super.decode(e,t)}};function H(i,e,t){return new hn(i,e,t)}function ne(i,e,t){let n,r=typeof e=="number"?e:ni(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=ni(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return ei(i,r,t)}import ko from"bn.js";import Re from"bn.js";var ie=new Re(0),De=new Re(1),Ue=new Re(-1),Ce=new Re(1).shln(64),Gt=new Re(1).shln(128),wn=Ce.sub(De),Pt=64,oi=Gt.subn(1),Ae=-443636,Se=-Ae,rt=new Re("4295048016"),ot=new Re("79226673521066979257578248091"),vl=new Re("4295048017"),Wl=new Re("79226673521066979257578248090"),si=16,ai="59543866431248",ui="184467440737095516",ci="15793534762490258745",Ut=new Re(10).pow(new Re(6));var Ol=new Re("18446744073700000000");import W from"bn.js";function Xt(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function kn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Pn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function At(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function li(i,e){return At(i,e)?null:kn(i,e)}function mi(i,e){return At(i,e)?null:Pn(i,e)}var Ul=Buffer.from("amm_config","utf8"),lo=Buffer.from("pool","utf8"),mo=Buffer.from("pool_vault","utf8"),fo=Buffer.from("pool_reward_vault","utf8"),di=Buffer.from("position","utf8"),po=Buffer.from("tick_array","utf8"),bo=Buffer.from("operation","utf8"),go=Buffer.from("pool_tick_array_bitmap_extension","utf8"),yo=Buffer.from("observation","utf8");function fi(i,e,t,n){return xe([lo,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function An(i,e,t){return xe([mo,e.toBuffer(),t.toBuffer()],i)}function pi(i,e,t){return xe([fo,e.toBuffer(),t.toBuffer()],i)}function z(i,e,t){return xe([po,e.toBuffer(),Xt(t)],i)}function tt(i,e,t,n){return xe([di,e.toBuffer(),Xt(t),Xt(n)],i)}function Ke(i,e){return xe([di,e.toBuffer()],i)}function Tt(i){return xe([Buffer.from("metadata","utf8"),it.toBuffer(),i.toBuffer()],it)}function Tn(i){return xe([bo],i)}function he(i,e){return xe([go,e.toBuffer()],i)}function bi(i,e){return xe([yo,e.toBuffer()],i)}var gi=Buffer.from("locked_position","utf8");function xn(i,e){return xe([gi,e.toBuffer()],i)}function yi(i,e){return xe([gi,e.toBuffer()],i)}var Xl=Buffer.from("support_mint","utf8");import{PublicKey as Le}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as hi}from"@solana/spl-token";import ee from"bn.js";import _e from"bn.js";var xt=class{static getfeeGrowthInside(e,t,n){let r=new _e(0),o=new _e(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new _e(0),a=new _e(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=v.wrappingSubU128(v.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=v.wrappingSubU128(v.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=v.mulDivFloor(v.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ce),u=t.tokenFeesOwedA.add(a),c=v.mulDivFloor(v.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ce),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=v.mulDivFloor(v.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ce),u=t.tokenFeesOwedA.add(a),c=v.mulDivFloor(v.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ce),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=v.wrappingSubU128(u,c.growthInsideLastX64),m=v.mulDivFloor(l,t.liquidity,Ce),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=v.wrappingSubU128(u,c.growthInsideLastX64),m=v.mulDivFloor(l,t.liquidity,Ce),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new _e(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new _e(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(v.wrappingSubU128(v.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new _e(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new _e(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(v.wrappingSubU128(v.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){let a=F.priceToSqrtPriceX64(new B(e.price),e.mintA.decimals,e.mintB.decimals),u=F.getSqrtPriceX64FromTick(t.tickLower),c=F.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=G.getAmountsFromLiquidity(a,u,c,n,o),[d,f]=[ae(m.amountA,e.mintA.extensions?.feeConfig,s,!0),ae(m.amountB,e.mintB.extensions?.feeConfig,s,!0)],[p,b]=[ae(new _e(new B(m.amountA.toString()).mul(l).toFixed(0)),e.mintA.extensions?.feeConfig,s,!0),ae(new _e(new B(m.amountB.toString()).mul(l).toFixed(0)),e.mintB.extensions?.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:f,amountSlippageA:p,amountSlippageB:b,expirationTime:et(d.expirationTime,f.expirationTime)}}};var ho=15,V=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=x.getTickArrayStartIndexByTick(r,o),l=x.getInitializedTickArrayInRange(s,a,o,c,Math.floor(ho/2));for(let f=0;f<l.length;f++){let{publicKey:p}=z(t,n,l[f]);u.push(p)}let m=(await ze(e,u)).map(f=>f!==null?Bt.decode(f.data):null),d={};for(let f=0;f<u.length;f++){let p=m[f];p!==null&&(d[p.startTickIndex]={...p,address:u[f]})}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=x.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:f}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,f]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/V.tickCount(t)),a=n?x.searchLowBitFromStart(r,o,s-1,1,t):x.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=de-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<de;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=z(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=x.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<de;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=z(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(x.checkIsOutOfBoundary(e)){if(e>Se)return!1;let n=x.getTickArrayStartIndexByTick(Ae,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return de*e}};var Bn=14,Xe=class{static maxTickInTickarrayBitmap(e){return e*de*st}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!V.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-V.tickCount(n):t+V.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*de,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=li(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=mi(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-V.tickCount(n)}}}},St=class{static getBitmapOffset(e,t){if(!V.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=Xe.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=Xe.maxTickInTickarrayBitmap(e),n=-t;if(Se<=t)throw Error(`extensionTickBoundary check error: ${Se}, ${t}`);if(n<=Ae)throw Error(`extensionTickBoundary check error: ${n}, ${Ae}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:x.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=V.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=Xe.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=x.mergeTickArrayBitmap(e).shln(st-1-a),c=At(512,u)?null:kn(512,u);if(c!==null){let l=t-c*V.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=x.mergeTickArrayBitmap(e).shrn(a),c=At(512,u)?null:Pn(512,u);if(c!==null){let l=t+c*V.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-V.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%Xe.maxTickInTickarrayBitmap(t),r=Math.floor(n/V.tickCount(t));return e<0&&n!=0&&(r=st-r),r}};var ce=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!c||l===void 0||!m)throw new Error("Invalid tick array");u.push(m);let{allTrade:d,amountCalculated:f,accounts:p,sqrtPriceX64:b,feeAmount:y}=at.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return u.push(...p),{allTrade:d,expectedAmountOut:f.mul(Ue),remainingAccounts:u,executionPrice:b,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let b=this.preInitializedTickArrayStartIndex(e,s);if(b.isExist){let{publicKey:y}=z(e.programId,e.id,b.nextStartIndex);a.push(y)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:f,feeAmount:p}=at.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(Ue),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:f,feeAmount:p}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=ce.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?St.checkTickArrayIsInit(V.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):x.checkTickArrayIsInitialized(x.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=z(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,V.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=z(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/V.tickCount(e.tickSpacing)),r=t?x.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):x.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=V.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=Xe.nextInitializedTickArrayStartIndex(x.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=St.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Ae||t>Se)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){let s=[];for(let a=0;a<o.length;a++){let u=o[a],c=t.rewardDefaultInfos[a]?.mint.programId??(await e.getAccountInfo(u.tokenMint))?.owner;if(c===void 0)throw Error("get new reward mint info error");let l={...u,perSecond:v.x64ToDecimal(u.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Le(c)};if(l.tokenMint.equals(Le.default))continue;if(n<=l.openTime.toNumber()||r.eq(ie)){s.push(l);continue}let m=new ee(Math.min(l.endTime.toNumber(),n)),d=m.sub(l.lastUpdateTime),f=v.mulDivFloor(d,l.emissionsPerSecondX64,r),p=l.rewardGrowthGlobalX64.add(f),b=v.mulDivFloor(d,l.emissionsPerSecondX64,Ce),y=l.rewardTotalEmissioned.add(b);s.push({...l,rewardGrowthGlobalX64:p,rewardTotalEmissioned:y,lastUpdateTime:m})}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=x.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=Xe.maxTickInTickarrayBitmap(e),n=-t;return t>Se&&(t=V.getArrayStartIndex(Se,e)+V.tickCount(e)),n<Ae&&(n=V.getArrayStartIndex(Ae,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!V.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/V.tickCount(t)*st}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await Yt(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=Pi.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=x.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=x.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=z(u.programId,u.id,m);o.push({pubkey:d}),r[d.toString()]=u.id}}let s=await Yt(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=Bt.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]={...l,address:u.pubkey}}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){let s=[];for(let a=0;a<e.length;a++){let u=e[a];u!==null&&(s.find(c=>c.equals(u.state.programId))||s.push(u.state.programId))}if(n){let a=n.tokenAccounts.map(m=>m.accountInfo.mint),u=[];for(let m of a)for(let d of s)u.push(Ke(d,m).publicKey);let c=await ze(t,u,{batchRequest:r}),l={};for(let m of c){if(m===null)continue;let d=ki.decode(m.data),f=d.poolId.toString(),p=e.find(S=>S.state.id.toBase58()===f);if(p===void 0)continue;let b=p.state,y=x._getTickPriceLegacy({poolInfo:b,tick:d.tickLower,baseIn:!0}),g=x._getTickPriceLegacy({poolInfo:b,tick:d.tickUpper,baseIn:!0}),{amountA:A,amountB:P}=G.getAmountsFromLiquidity(b.sqrtPriceX64,y.tickSqrtPriceX64,g.tickSqrtPriceX64,d.liquidity,!1),T=1/(1-Math.sqrt(Math.sqrt(y.price.div(g.price).toNumber())));p.positionAccount=[...p.positionAccount??[],{poolId:d.poolId,nftMint:d.nftMint,priceLower:y.price,priceUpper:g.price,amountA:A,amountB:P,tickLower:d.tickLower,tickUpper:d.tickUpper,liquidity:d.liquidity,feeGrowthInsideLastX64A:d.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:d.feeGrowthInsideLastX64B,tokenFeesOwedA:d.tokenFeesOwedA,tokenFeesOwedB:d.tokenFeesOwedB,rewardInfos:d.rewardInfos.map(S=>({...S,pendingReward:new ee(0)})),leverage:T,tokenFeeAmountA:new ee(0),tokenFeeAmountB:new ee(0)}];let C=await x.getTickArrayAddressByTick(p.state.programId,d.poolId,d.tickLower,p.state.tickSpacing),w=await x.getTickArrayAddressByTick(p.state.programId,d.poolId,d.tickUpper,p.state.tickSpacing);l[`${p.state.programId.toString()}-${d.poolId.toString()}-${d.tickLower}`]=C,l[`${p.state.programId.toString()}-${d.poolId.toString()}-${d.tickUpper}`]=w}if(o){let m=Object.values(l),d=await ze(t,m,{batchRequest:r}),f={};for(let p=0;p<m.length;p++){let b=d[p];if(b===null)continue;let y=m[p].toString();f[y]=Bt.decode(b.data)}for(let{state:p,positionAccount:b}of e)if(!!b)for(let y of b){let g=`${p.programId.toString()}-${p.id.toString()}-${y.tickLower}`,A=`${p.programId.toString()}-${p.id.toString()}-${y.tickUpper}`,P=f[l[g].toString()],T=f[l[A].toString()],C=P.ticks[x.getTickOffsetInArray(y.tickLower,p.tickSpacing)],w=T.ticks[x.getTickOffsetInArray(y.tickUpper,p.tickSpacing)],{tokenFeeAmountA:S,tokenFeeAmountB:R}=await xt.GetPositionFees(p,y,C,w),E=await xt.GetPositionRewards(p,y,C,w);y.tokenFeeAmountA=S.gte(new ee(0))?S:new ee(0),y.tokenFeeAmountB=R.gte(new ee(0))?R:new ee(0);for(let U=0;U<E.length;U++)y.rewardInfos[U].pendingReward=E[U].gte(new ee(0))?E[U]:new ee(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new B(0),catchLiquidityInsufficient:u=!1}){let c,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new B(0))?c=l?rt.add(new ee(1)):ot.sub(new ee(1)):c=F.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let f=ae(o,m,r,!1),{allTrade:p,expectedAmountOut:b,remainingAccounts:y,executionPrice:g,feeAmount:A}=ce.getOutputAmountAndRemainAccounts(e,t,n,f.amount.sub(f.fee??ie),c,u),P=ae(b,d,r,!1),T=F.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),C=l?T:new B(1).div(T),w=b.mul(new ee(Math.floor((1-s)*1e10))).div(new ee(1e10)),S=ae(w,d,r,!1),R=l?e.currentPrice:new B(1).div(e.currentPrice),E=new B(C).sub(R).abs(),U=R,_=new $e(new B(E).mul(10**15).toFixed(0),new B(U).mul(10**15).toFixed(0));return{allTrade:p,realAmountIn:f,amountOut:P,minAmountOut:S,expirationTime:et(f.expirationTime,P.expirationTime),currentPrice:e.currentPrice,executionPrice:C,priceImpact:_,fee:A,remainingAccounts:y,executionPriceX64:g}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=r.address===e.mintB.address,[c,l]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new Ve({...c,mint:c.address,isToken2022:c.programId===hi.toBase58()}),new Ve({...l,mint:l.address,isToken2022:l.programId===hi.toBase58()})],{allTrade:f,realAmountIn:p,amountOut:b,minAmountOut:y,expirationTime:g,currentPrice:A,executionPrice:P,priceImpact:T,fee:C,remainingAccounts:w,executionPriceX64:S}=ce.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Le(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),R={...p,amount:new Pe(m,p.amount),fee:p.fee===void 0?void 0:new Pe(m,p.fee)},E={...b,amount:new Pe(d,b.amount),fee:b.fee===void 0?void 0:new Pe(d,b.fee)},U={...y,amount:new Pe(d,y.amount),fee:y.fee===void 0?void 0:new Pe(d,y.fee)},_=new ve({baseToken:m,denominator:new ee(10).pow(new ee(20+m.decimals)),quoteToken:d,numerator:A.mul(new B(10**(20+d.decimals))).toFixed(0)}),le=new ve({baseToken:m,denominator:new ee(10).pow(new ee(20+m.decimals)),quoteToken:d,numerator:P.mul(new B(10**(20+d.decimals))).toFixed(0)}),Y=new Pe(m,C);return{allTrade:f,realAmountIn:R,amountOut:E,minAmountOut:U,expirationTime:g,currentPrice:_,executionPrice:le,priceImpact:T,fee:Y,remainingAccounts:w,executionPriceX64:S}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new B(0)}){let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new B(0))?l=u?ot.sub(new ee(1)):rt.add(new ee(1)):l=F.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=ae(o,c[n.toString()],r,!0),{expectedAmountIn:d,remainingAccounts:f,executionPrice:p,feeAmount:b}=ce.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub(m.fee??ie),l),y=u?e.mintB.address:e.mintA.address,g=ae(d,c[y],r,!1),A=F.sqrtPriceX64ToPrice(p,e.mintA.decimals,e.mintB.decimals),P=u?A:new B(1).div(A),T=d.mul(new ee(Math.floor((1+s)*1e10))).div(new ee(1e10)),C=ae(T,c[y],r,!0),w=u?e.currentPrice:new B(1).div(e.currentPrice),S=new B(P).sub(w).abs(),R=w,E=new $e(new B(S).mul(10**15).toFixed(0),new B(R).mul(10**15).toFixed(0));return{amountIn:g,maxAmountIn:C,realAmountOut:m,expirationTime:et(g.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:P,priceImpact:E,fee:b,remainingAccounts:f}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){let o=e[t],s=x.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=x.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,f;return l<=0?f=0:m===l?f=d/l:d===l?f=l/m:f=l/d*(l/m),{feeApr:o.feeApr*f,rewardsApr:[(o.rewardApr[0]??0)*f,(o.rewardApr[1]??0)*f,(o.rewardApr[2]??0)*f],apr:o.apr*f}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[Ct(e.mintA.address).toString()],d=r[Ct(e.mintB.address).toString()],f=e.mintA.decimals,p=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let b=F.priceToSqrtPriceX64(new B(e.price),e.mintA.decimals,e.mintB.decimals),y=F.getSqrtPriceX64FromTick(s),g=F.getSqrtPriceX64FromTick(a),{amountSlippageA:A,amountSlippageB:P}=G.getAmountsFromLiquidityWithSlippage(b,y,g,t,!1,!1,0),{amountSlippageA:T,amountSlippageB:C}=G.getAmountsFromLiquidityWithSlippage(b,y,g,o,!1,!1,0),w=new B(A.toString()).div(new B(10).pow(f)).mul(m.value).add(new B(P.toString()).div(new B(10).pow(p)).mul(d.value)),S=new B(T.toString()).div(new B(10).pow(f)).mul(m.value).add(new B(C.toString()).div(new B(10).pow(p)).mul(d.value)),R=new B(1).div(w.add(S)),U=new B(l.volumeFee).mul(365).div(c).mul(R).mul(100).toNumber(),_=3600*24*365,le=e.rewardDefaultInfos.map(Y=>{let fe=Y.mint.decimals,re=r[Y.mint.address];return u<(Y.startTime??0)||u>(Y.endTime??0)||!Y.perSecond||!re||fe===void 0?0:new B(re.value).mul(new B(Y.perSecond).mul(_)).div(new B(10).pow(fe)).mul(R).mul(100).toNumber()});return{feeApr:U,rewardsApr:le,apr:U+le.reduce((Y,fe)=>Y+fe,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){let l=F.priceToSqrtPriceX64(new B(e.price),e.mintA.decimals,e.mintB.decimals),m=F.getSqrtPriceX64FromTick(n),d=F.getSqrtPriceX64FromTick(r),f=ae(o,e[t?"mintA":"mintB"].extensions?.feeConfig,u,!c),p=new ee(new B(f.amount.sub(f.fee??ie).toString()).toFixed(0)),b;if(l.lte(m))b=t?G.getLiquidityFromTokenAmountA(m,d,p,!a):new ee(0);else if(l.lte(d)){let g=G.getLiquidityFromTokenAmountA(l,d,p,!a),A=G.getLiquidityFromTokenAmountB(m,l,p);b=t?g:A}else b=t?new ee(0):G.getLiquidityFromTokenAmountB(m,d,p);let y=await ce.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:b,slippage:s,add:a});return{liquidity:b,amountA:t?f:y.amountA,amountB:t?y.amountB:f,amountSlippageA:t?f:y.amountSlippageA,amountSlippageB:t?y.amountSlippageB:f,expirationTime:y.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){let u=F.getSqrtPriceX64FromTick(n),c=F.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=G.getAmountsFromLiquidity(F.priceToSqrtPriceX64(new B(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,f]=[ae(m.amountA,t.mintA.extensions?.feeConfig,e,!0),ae(m.amountB,t.mintB.extensions?.feeConfig,e,!0)],[p,b]=[ae(m.amountA.muln(l),t.mintA.extensions?.feeConfig,e,!0),ae(m.amountB.muln(l),t.mintB.extensions?.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:f,amountSlippageA:p,amountSlippageB:b,expirationTime:et(d.expirationTime,f.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new Le(u.id));(await ze(e,r)).forEach((u,c)=>{!u||(n[r[c].toBase58()]=wi.decode(u.data))});let s=t.map(u=>he(new Le(u.programId),new Le(u.id)).publicKey),a=await ce.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>({...u,[c.id]:{...n[c.id],id:new Le(c.id),version:6,programId:new Le(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:{...c.config,id:new Le(c.config.id),fundOwner:""},currentPrice:new B(c.price),exBitmapAccount:he(new Le(c.programId),new Le(c.id)).publicKey,exBitmapInfo:a[he(new Le(c.programId),new Le(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber(),rewardInfos:n[c.id].rewardInfos}}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var v=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(ie)||(o=o.add(De)),o}static mulDivFloor(e,t,n){if(n.eq(ie))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ie))throw new Error("division by 0");return e.mul(t).add(n.sub(De)).div(n)}static x64ToDecimal(e,t){return new B(e.toString()).div(B.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new W(e.mul(B.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Gt).sub(t).mod(Gt)}};function ge(i,e){return Sn(i.mul(e),64,256)}function wo(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Sn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var F=class{static sqrtPriceX64ToPrice(e,t,n){return v.x64ToDecimal(e).pow(2).mul(B.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return v.decimalToX64(e.mul(B.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ie))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ie))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ie))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ie))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ie))return e;let o=t.shln(Pt);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?v.mulDivCeil(s,e,a):v.mulDivRoundingUp(s,De,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return v.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Pt);if(r)return e.add(o.div(t));{let s=v.mulDivRoundingUp(o,De,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ae||e>Se)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new W("18445821805675395072"):new W("18446744073709551616");return(t&2)!=0&&(n=ge(n,new W("18444899583751176192"))),(t&4)!=0&&(n=ge(n,new W("18443055278223355904"))),(t&8)!=0&&(n=ge(n,new W("18439367220385607680"))),(t&16)!=0&&(n=ge(n,new W("18431993317065453568"))),(t&32)!=0&&(n=ge(n,new W("18417254355718170624"))),(t&64)!=0&&(n=ge(n,new W("18387811781193609216"))),(t&128)!=0&&(n=ge(n,new W("18329067761203558400"))),(t&256)!=0&&(n=ge(n,new W("18212142134806163456"))),(t&512)!=0&&(n=ge(n,new W("17980523815641700352"))),(t&1024)!=0&&(n=ge(n,new W("17526086738831433728"))),(t&2048)!=0&&(n=ge(n,new W("16651378430235570176"))),(t&4096)!=0&&(n=ge(n,new W("15030750278694412288"))),(t&8192)!=0&&(n=ge(n,new W("12247334978884435968"))),(t&16384)!=0&&(n=ge(n,new W("8131365268886854656"))),(t&32768)!=0&&(n=ge(n,new W("3584323654725218816"))),(t&65536)!=0&&(n=ge(n,new W("696457651848324352"))),(t&131072)!=0&&(n=ge(n,new W("26294789957507116"))),(t&262144)!=0&&(n=ge(n,new W("37481735321082"))),e>0&&(n=oi.div(n)),n}static getTickFromPrice(e,t,n){return F.getTickFromSqrtPriceX64(F.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(ot)||e.lt(rt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new W(t-64),r=wo(n,32,128),o=new W("8000000000000000","hex"),s=0,a=new W(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new W(0))&&s<si;){u=u.mul(u);let p=u.shrn(127);u=u.shrn(63+p.toNumber()),a=a.add(o.mul(p)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=r.add(c).mul(new W(ai)),d=Sn(m.sub(new W(ui)),64,128).toNumber(),f=Sn(m.add(new W(ci)),64,128).toNumber();return d==f?d:F.getSqrtPriceX64FromTick(f).lte(e)?f:d}},ut=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=F.getTickFromSqrtPriceX64(F.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=ut.getTickWithPriceAndTickspacing(e,t,n,r),s=F.getSqrtPriceX64FromTick(o);return F.sqrtPriceX64ToPrice(s,n,r)}},G=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ie))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Pt),s=t.sub(e);return r?v.mulDivRoundingUp(v.mulDivCeil(o,s,t),De,e):v.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ie))throw new Error("sqrtPriceX64A must greater than 0");return r?v.mulDivCeil(n,t.sub(e),Ce):v.mulDivFloor(n,t.sub(e),Ce)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?v.mulDivRoundingUp(a,De,wn):a.shrn(Pt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),v.mulDivFloor(n,wn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return G.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=G.getLiquidityFromTokenAmountA(e,n,r,!1),a=G.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return G.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:G.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new W(0)};if(e.lt(n)){let s=G.getTokenAmountAFromLiquidity(e,n,r,o),a=G.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new W(0),amountB:G.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=G.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new W(new B(u.toString()).mul(l).toFixed(0)),d=new W(new B(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){let c=F.priceToSqrtPriceX64(new B(e.price),e.mintA.decimals,e.mintB.decimals),l=F.getSqrtPriceX64FromTick(t),m=F.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,f=G.getAmountsFromLiquidity(c,l,m,r,s),[p,b]=[ae(f.amountA,e.mintA.extensions?.feeConfig,a,u),ae(f.amountB,e.mintB.extensions?.feeConfig,a,u)],[y,g]=[ae(new W(new B(f.amountA.toString()).mul(d).toFixed(0)),e.mintA.extensions?.feeConfig,a,u),ae(new W(new B(f.amountB.toString()).mul(d).toFixed(0)),e.mintB.extensions?.feeConfig,a,u)];return{liquidity:r,amountA:p,amountB:b,amountSlippageA:y,amountSlippageB:g,expirationTime:et(p.expirationTime,b.expirationTime)}}},at=class{static swapCompute(e,t,n,r,o,s,a,u,c,l,m,d,f,p,b=!1){if(d.eq(ie))throw new Error("amountSpecified must not be 0");if(p||(p=s?rt.add(De):ot.sub(De)),s){if(p.lt(rt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(p.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(p.gt(ot))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(p.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let y=d.gt(ie),g={amountSpecifiedRemaining:d,amountCalculated:ie,sqrtPriceX64:m,tick:c>f?Math.min(f+V.tickCount(l)-1,c):f,accounts:[],liquidity:u,feeAmount:new W(0)},A=f,P=n[f],T=0,C=!s&&P.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(ie)&&!g.sqrtPriceX64.eq(p);){T>10;let w={};w.sqrtPriceStartX64=g.sqrtPriceX64;let S=x.nextInitTick(P,g.tick,l,s,C),R=S||null,E=null;if(!R?.liquidityGross.gtn(0)){let _=ce.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},A,s);if(!_.isExist){if(b)return{allTrade:!1,amountSpecifiedRemaining:g.amountSpecifiedRemaining,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts};throw Error("swapCompute LiquidityInsufficient")}A=_.nextStartIndex;let{publicKey:le}=z(e,t,A);E=le,P=n[A];try{R=x.firstInitializedTick(P,s)}catch{throw Error("not found next tick info")}}w.tickNext=R.tick,w.initialized=R.liquidityGross.gtn(0),f!==A&&E&&(g.accounts.push(E),f=A),w.tickNext<Ae?w.tickNext=Ae:w.tickNext>Se&&(w.tickNext=Se),w.sqrtPriceNextX64=F.getSqrtPriceX64FromTick(w.tickNext);let U;if(s&&w.sqrtPriceNextX64.lt(p)||!s&&w.sqrtPriceNextX64.gt(p)?U=p:U=w.sqrtPriceNextX64,[g.sqrtPriceX64,w.amountIn,w.amountOut,w.feeAmount]=at.swapStepCompute(g.sqrtPriceX64,U,g.liquidity,g.amountSpecifiedRemaining,a,s),g.feeAmount=g.feeAmount.add(w.feeAmount),y?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(w.amountIn.add(w.feeAmount)),g.amountCalculated=g.amountCalculated.sub(w.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(w.amountOut),g.amountCalculated=g.amountCalculated.add(w.amountIn.add(w.feeAmount))),g.sqrtPriceX64.eq(w.sqrtPriceNextX64)){if(w.initialized){let _=R.liquidityNet;s&&(_=_.mul(Ue)),g.liquidity=G.addDelta(g.liquidity,_)}C=w.tickNext!=g.tick&&!s&&P.startTickIndex===w.tickNext,g.tick=s?w.tickNext-1:w.tickNext}else if(g.sqrtPriceX64!=w.sqrtPriceStartX64){let _=F.getTickFromSqrtPriceX64(g.sqrtPriceX64);C=_!=g.tick&&!s&&P.startTickIndex===_,g.tick=_}++T}try{let{nextStartIndex:w,isExist:S}=V.nextInitializedTickArray(g.tick,l,s,r,o);S&&f!==w&&(g.accounts.push(z(e,t,w).publicKey),f=w)}catch{}return{allTrade:!0,amountSpecifiedRemaining:ie,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,r,o,s){let a={sqrtPriceX64Next:new W(0),amountIn:new W(0),amountOut:new W(0),feeAmount:new W(0)},u=r.gte(ie);if(u){let l=v.mulDivFloor(r,Ut.sub(new W(o.toString())),Ut);a.amountIn=s?G.getTokenAmountAFromLiquidity(t,e,n,!0):G.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(a.amountIn)?a.sqrtPriceX64Next=t:a.sqrtPriceX64Next=F.getNextSqrtPriceX64FromInput(e,n,l,s)}else a.amountOut=s?G.getTokenAmountBFromLiquidity(t,e,n,!1):G.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(Ue).gte(a.amountOut)?a.sqrtPriceX64Next=t:a.sqrtPriceX64Next=F.getNextSqrtPriceX64FromOutput(e,n,r.mul(Ue),s);let c=t.eq(a.sqrtPriceX64Next);return s?(c&&u||(a.amountIn=G.getTokenAmountAFromLiquidity(a.sqrtPriceX64Next,e,n,!0)),c&&!u||(a.amountOut=G.getTokenAmountBFromLiquidity(a.sqrtPriceX64Next,e,n,!1))):(a.amountIn=c&&u?a.amountIn:G.getTokenAmountBFromLiquidity(e,a.sqrtPriceX64Next,n,!0),a.amountOut=c&&!u?a.amountOut:G.getTokenAmountAFromLiquidity(e,a.sqrtPriceX64Next,n,!1)),!u&&a.amountOut.gt(r.mul(Ue))&&(a.amountOut=r.mul(Ue)),u&&!a.sqrtPriceX64Next.eq(t)?a.feeAmount=r.sub(a.amountIn):a.feeAmount=v.mulDivCeil(a.amountIn,new W(o),Ut.sub(new W(o))),[a.sqrtPriceX64Next,a.amountIn,a.amountOut,a.feeAmount]}};var de=60,st=512,x=class{static getTickArrayAddressByTick(e,t,n,r){let o=x.getTickArrayStartIndexByTick(n,r),{publicKey:s}=z(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=x.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=de)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=V.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*V.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*de,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*de,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*de:e+t*de}static mergeTickArrayBitmap(e){let t=new ko(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*de));return[...x.searchLowBitFromStart(e,t,s-1,o,n),...x.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return x.searchHightBitFromStart(e,t,-7680,st,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=x.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=z(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>x.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===r)break}let u=V.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>x.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===r)break}let u=V.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Ae||e>Se}static nextInitTick(e,t,n,r,o){if(V.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<de;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=de-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<de;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=F.getSqrtPriceX64FromTick(t),o=F.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new B(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new B(1).div(t),o=ut.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=F.getSqrtPriceX64FromTick(o),a=F.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new B(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=F.getSqrtPriceX64FromTick(t),o=F.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new B(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new B(1).div(t),o=ut.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=F.getSqrtPriceX64FromTick(o),a=F.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new B(1).div(a)}}};var $m=H([Ne(8),oe("bump"),kt("index"),Z(""),dt("protocolFeeRate"),dt("tradeFeeRate"),kt("tickSpacing"),ne(N(),8,"")]),Po=H([dt("blockTimestamp"),ii("tickCumulative"),ne(N(),4)]),Ai=H([Ne(8),Be("initialized"),N("recentEpoch"),kt("observationIndex"),Z("poolId"),ne(Po,100,"observations"),ne(N(),4)]),Ao=H([oe("rewardState"),N("openTime"),N("endTime"),N("lastUpdateTime"),q("emissionsPerSecondX64"),N("rewardTotalEmissioned"),N("rewardClaimed"),Z("tokenMint"),Z("tokenVault"),Z("creator"),q("rewardGrowthGlobalX64")]),wi=H([Ne(8),oe("bump"),Z("ammConfig"),Z("creator"),Z("mintA"),Z("mintB"),Z("vaultA"),Z("vaultB"),Z("observationId"),oe("mintDecimalsA"),oe("mintDecimalsB"),kt("tickSpacing"),q("liquidity"),q("sqrtPriceX64"),$("tickCurrent"),dt(),q("feeGrowthGlobalX64A"),q("feeGrowthGlobalX64B"),N("protocolFeesTokenA"),N("protocolFeesTokenB"),q("swapInAmountTokenA"),q("swapOutAmountTokenB"),q("swapInAmountTokenB"),q("swapOutAmountTokenA"),oe("status"),ne(oe(),7,""),ne(Ao,3,"rewardInfos"),ne(N(),16,"tickArrayBitmap"),N("totalFeesTokenA"),N("totalFeesClaimedTokenA"),N("totalFeesTokenB"),N("totalFeesClaimedTokenB"),N("fundFeesTokenA"),N("fundFeesTokenB"),N("startTime"),ne(N(),15*4-3,"padding")]),To=H([q("growthInsideLastX64"),N("rewardAmountOwed")]),ki=H([Ne(8),oe("bump"),Z("nftMint"),Z("poolId"),$("tickLower"),$("tickUpper"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),N("tokenFeesOwedA"),N("tokenFeesOwedB"),ne(To,3,"rewardInfos"),ne(N(),8,"")]),ed=H([Ne(8),oe("bump"),Z("poolId"),$("tickLowerIndex"),$("tickUpperIndex"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),N("tokenFeesOwedA"),N("tokenFeesOwedB"),ne(q(),3,"rewardGrowthInside"),ne(N(),8,"")]),xo=H([$("tick"),ri("liquidityNet"),q("liquidityGross"),q("feeGrowthOutsideX64A"),q("feeGrowthOutsideX64B"),ne(q(),3,"rewardGrowthsOutsideX64"),ne(dt(),13,"")]),Bt=H([Ne(8),Z("poolId"),$("startTickIndex"),ne(xo,de,"ticks"),oe("initializedTickCount"),ne(oe(),115,"")]),td=H([Ne(329),ne(Z(),100,"whitelistMints")]),Pi=H([Ne(8),Z("poolId"),ne(ne(N(),8),Bn,"positiveTickArrayBitmap"),ne(ne(N(),8),Bn,"negativeTickArrayBitmap")]),nd=H([N(),oe("bump"),Z("owner"),Z("poolId"),Z("positionId"),Z("nftAccount"),ne(N(),8)]),id=H([Ne(8),oe("bump"),Z("lockOwner"),Z("poolId"),Z("positionId"),Z("nftAccount"),Z("lockNftMint"),N("recentEpoch"),ne(N(),8)]);Ai.span;var Ti=Te("Raydium_Clmm"),Me={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},xi=[188,37,179,131,82,150,84,73],Bi=[16,72,250,198,14,162,212,19],zt=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p){let b=H([q("sqrtPriceX64"),N("zero")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:He.programId,isSigner:!1,isWritable:!1},{pubkey:Je,isSigner:!1,isWritable:!1},...p?.map(P=>({pubkey:P,isSigner:!1,isWritable:!1}))||[]],g=Buffer.alloc(b.span);b.encode({sqrtPriceX64:f,zero:ie},g);let A=Buffer.from([...Me.createPool,...g]);return new we({keys:y,programId:e,data:A})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,extendMintAccount:u}=e,[c,l]=[new k(r.address),new k(o.address)],{publicKey:m}=fi(t,s,c,l),{publicKey:d}=bi(t,m),{publicKey:f}=An(t,m,c),{publicKey:p}=An(t,m,l),b=he(t,m).publicKey,y=[this.createPoolInstruction(t,m,n,s,d,c,f,new k(r.programId||j),l,p,new k(o.programId||j),b,a,u)];return{signers:[],instructions:y,instructionTypes:[be.CreateAccount,be.ClmmCreatePool],address:{poolId:m,observationId:d,exBitmapAccount:b,mintAVault:f,mintBVault:p},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,b,y,g,A,P,T,C,w,S,R,E,U){let _=H([$("tickLowerIndex"),$("tickUpperIndex"),$("tickArrayLowerStartIndex"),$("tickArrayUpperStartIndex"),q("liquidity"),N("amountMaxA"),N("amountMaxB"),Be("withMetadata"),oe("optionBaseFlag"),Be("baseFlag")]),le=[...U?[{pubkey:U,isSigner:!1,isWritable:!0}]:[]],Y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:Je,isSigner:!1,isWritable:!1},{pubkey:He.programId,isSigner:!1,isWritable:!1},{pubkey:j,isSigner:!1,isWritable:!1},{pubkey:It,isSigner:!1,isWritable:!1},{pubkey:it,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...le],fe=Buffer.alloc(_.span);_.encode({tickLowerIndex:A,tickUpperIndex:P,tickArrayLowerStartIndex:T,tickArrayUpperStartIndex:C,liquidity:w,amountMaxA:S,amountMaxB:R,withMetadata:E==="create",baseFlag:!1,optionBaseFlag:0},fe);let re=Buffer.from([...Me.openPosition,...fe]);return new we({keys:Y,programId:e,data:re})}static openPositionFromLiquidityInstruction22(e,t,n,r,o,s,a,u,c,l,m,d,f,p,b,y,g,A,P,T,C,w,S,R,E){let U=H([$("tickLowerIndex"),$("tickUpperIndex"),$("tickArrayLowerStartIndex"),$("tickArrayUpperStartIndex"),q("liquidity"),N("amountMaxA"),N("amountMaxB"),Be("withMetadata"),oe("optionBaseFlag"),Be("baseFlag")]),_=[...E?[{pubkey:E,isSigner:!1,isWritable:!0}]:[]],le=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Je,isSigner:!1,isWritable:!1},{pubkey:He.programId,isSigner:!1,isWritable:!1},{pubkey:j,isSigner:!1,isWritable:!1},{pubkey:It,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},..._],Y=Buffer.alloc(U.span);U.encode({tickLowerIndex:g,tickUpperIndex:A,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:T,liquidity:C,amountMaxA:w,amountMaxB:S,withMetadata:R==="create",baseFlag:!1,optionBaseFlag:0},Y);let fe=Buffer.from([...Me.openPositionWithTokenEx,...Y]);return new we({keys:le,programId:e,data:fe})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l,nft2022:m}){let d=[],[f,p]=[new k(e.programId),new k(e.id)],b;if(l)b=new k((await l(1))[0]);else{let E=Ht.generate();d.push(E),b=E.publicKey}let y=x.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=x.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=z(f,p,y),{publicKey:P}=z(f,p,g),{publicKey:T}=m?ue(n.wallet,b,se):ue(n.wallet,b,j),{publicKey:C}=Tt(b),{publicKey:w}=Ke(f,b),{publicKey:S}=tt(f,p,r,o),R=m?this.openPositionFromLiquidityInstruction22(f,n.feePayer,p,n.wallet,b,T,S,A,P,w,n.tokenAccountA,n.tokenAccountB,new k(t.vault.A),new k(t.vault.B),new k(e.mintA.address),new k(e.mintB.address),r,o,y,g,s,a,u,c,ce.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?he(f,p).publicKey:void 0):this.openPositionFromLiquidityInstruction(f,n.feePayer,p,n.wallet,b,T,C,S,A,P,w,n.tokenAccountA,n.tokenAccountB,new k(t.vault.A),new k(t.vault.B),new k(e.mintA.address),new k(e.mintB.address),r,o,y,g,s,a,u,c,ce.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?he(f,p).publicKey:void 0);return{signers:d,instructions:[R],instructionTypes:[be.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:b,tickArrayLower:A,tickArrayUpper:P,positionNftAccount:T,metadataAccount:C,personalPosition:w,protocolPosition:S}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l,nft2022:m}){let d=[],[f,p]=[new k(e.programId),new k(e.id)],b;if(l)b=new k((await l(1))[0]);else{let E=Ht.generate();d.push(E),b=E.publicKey}let y=x.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=x.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=z(f,p,y),{publicKey:P}=z(f,p,g),{publicKey:T}=m?ue(n.wallet,b,se):ue(n.wallet,b,j),{publicKey:C}=Tt(b),{publicKey:w}=Ke(f,b),{publicKey:S}=tt(f,p,r,o),R=m?this.openPositionFromBaseInstruction22(f,n.feePayer,p,n.wallet,b,T,S,A,P,w,n.tokenAccountA,n.tokenAccountB,new k(t.vault.A),new k(t.vault.B),new k(e.mintA.address),new k(e.mintB.address),r,o,y,g,c,s,a,u,ce.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?he(f,p).publicKey:void 0):this.openPositionFromBaseInstruction(f,n.feePayer,p,n.wallet,b,T,C,S,A,P,w,n.tokenAccountA,n.tokenAccountB,new k(t.vault.A),new k(t.vault.B),new k(e.mintA.address),new k(e.mintB.address),r,o,y,g,c,s,a,u,ce.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?he(f,p).publicKey:void 0);return{address:{nftMint:b,tickArrayLower:A,tickArrayUpper:P,positionNftAccount:T,metadataAccount:C,personalPosition:w,protocolPosition:S},instructions:[R],signers:d,instructionTypes:[be.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,b,y,g,A,P,T,C,w,S,R,E,U){let _=H([$("tickLowerIndex"),$("tickUpperIndex"),$("tickArrayLowerStartIndex"),$("tickArrayUpperStartIndex"),q("liquidity"),N("amountMaxA"),N("amountMaxB"),Be("withMetadata"),oe("optionBaseFlag"),Be("baseFlag")]),le=[...U?[{pubkey:U,isSigner:!1,isWritable:!0}]:[]],Y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:Je,isSigner:!1,isWritable:!1},{pubkey:He.programId,isSigner:!1,isWritable:!1},{pubkey:j,isSigner:!1,isWritable:!1},{pubkey:It,isSigner:!1,isWritable:!1},{pubkey:it,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...le],fe=Buffer.alloc(_.span);_.encode({tickLowerIndex:A,tickUpperIndex:P,tickArrayLowerStartIndex:T,tickArrayUpperStartIndex:C,liquidity:new In(0),amountMaxA:S==="MintA"?R:E,amountMaxB:S==="MintA"?E:R,withMetadata:w==="create",baseFlag:S==="MintA",optionBaseFlag:1},fe);let re=Buffer.from([...Me.openPosition,...fe]);return new we({keys:Y,programId:e,data:re})}static openPositionFromBaseInstruction22(e,t,n,r,o,s,a,u,c,l,m,d,f,p,b,y,g,A,P,T,C,w,S,R,E){let U=H([$("tickLowerIndex"),$("tickUpperIndex"),$("tickArrayLowerStartIndex"),$("tickArrayUpperStartIndex"),q("liquidity"),N("amountMaxA"),N("amountMaxB"),Be("withMetadata"),oe("optionBaseFlag"),Be("baseFlag")]),_=[...E?[{pubkey:E,isSigner:!1,isWritable:!0}]:[]],le=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Je,isSigner:!1,isWritable:!1},{pubkey:He.programId,isSigner:!1,isWritable:!1},{pubkey:j,isSigner:!1,isWritable:!1},{pubkey:It,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},..._],Y=Buffer.alloc(U.span);U.encode({tickLowerIndex:g,tickUpperIndex:A,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:T,liquidity:new In(0),amountMaxA:w==="MintA"?S:R,amountMaxB:w==="MintA"?R:S,withMetadata:C==="create",baseFlag:w==="MintA",optionBaseFlag:1},Y);let fe=Buffer.from([...Me.openPositionWithTokenEx,...Y]);return new we({keys:le,programId:e,data:fe})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l,nft2022:m}){let d,f=[];if(l)d=new k((await l(1))[0]);else{let E=Ht.generate();f.push(E),d=E.publicKey}let[p,b]=[new k(e.programId),new k(e.id)],y=x.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=x.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=z(p,b,y),{publicKey:P}=z(p,b,g),{publicKey:T}=m?ue(n.wallet,d,se):ue(n.wallet,d,j),{publicKey:C}=Tt(d),{publicKey:w}=Ke(p,d),{publicKey:S}=tt(p,b,r,o),R=m?this.openPositionFromLiquidityInstruction22(p,n.wallet,b,n.wallet,d,T,S,A,P,w,n.tokenAccountA,n.tokenAccountB,new k(t.vault.A),new k(t.vault.B),new k(t.mintA.address),new k(t.mintB.address),r,o,y,g,s,a,u,c,ce.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?he(p,b).publicKey:void 0):this.openPositionFromLiquidityInstruction(p,n.wallet,b,n.wallet,d,T,C,S,A,P,w,n.tokenAccountA,n.tokenAccountB,new k(t.vault.A),new k(t.vault.B),new k(t.mintA.address),new k(t.mintB.address),r,o,y,g,s,a,u,c,ce.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?he(p,b).publicKey:void 0);return{address:{nftMint:d,tickArrayLower:A,tickArrayUpper:P,positionNftAccount:T,metadataAccount:C,personalPosition:w,protocolPosition:S},instructions:[R],signers:f,instructionTypes:[be.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o,s){let a=H([]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:He.programId,isSigner:!1,isWritable:!1},{pubkey:s?se:j,isSigner:!1,isWritable:!1}],c=Buffer.alloc(a.span);a.encode({},c);let l=Buffer.from([...Me.closePosition,...c]);return new we({keys:u,programId:e,data:l})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r,nft2022:o}){let s=new k(e.programId),a=o?ue(n.wallet,r.nftMint,se).publicKey:ue(n.wallet,r.nftMint,j).publicKey,{publicKey:u}=Ke(s,r.nftMint),c=[];return c.push(this.closePositionInstruction(s,n.wallet,r.nftMint,a,u,o)),{address:{positionNftAccount:a,personalPosition:u},signers:[],instructions:c,instructionTypes:[be.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,b,y,g,A){let P=H([q("liquidity"),N("amountMaxA"),N("amountMaxB"),oe("optionBaseFlag"),Be("baseFlag")]),T=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],C=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:j,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...T],w=Buffer.alloc(P.span);P.encode({liquidity:b,amountMaxA:y,amountMaxB:g,optionBaseFlag:0,baseFlag:!1},w);let S=Buffer.from([...Me.increaseLiquidity,...w]);return new we({keys:C,programId:e,data:S})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a,nft2022:u}){let[c,l]=[new k(e.programId),new k(e.id)],m=x.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=x.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=z(c,l,m),{publicKey:p}=z(c,l,d),{publicKey:b}=u?ue(r.wallet,n.nftMint,se):ue(r.wallet,n.nftMint,j),{publicKey:y}=Ke(c,n.nftMint),{publicKey:g}=tt(c,l,n.tickLower,n.tickUpper),A=this.increasePositionFromLiquidityInstruction(c,r.wallet,b,y,l,g,f,p,r.tokenAccountA,r.tokenAccountB,new k(t.vault.A),new k(t.vault.B),new k(e.mintA.address),new k(e.mintB.address),o,s,a,ce.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?he(c,l).publicKey:void 0);return{address:{tickArrayLower:f,tickArrayUpper:p,positionNftAccount:b,personalPosition:y,protocolPosition:g},signers:[],instructions:[A],instructionTypes:[be.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a,nft2022:u}){let[c,l]=[new k(e.programId),new k(e.id)],m=x.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=x.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=z(c,l,m),{publicKey:p}=z(c,l,d),{publicKey:b}=u?ue(r.wallet,n.nftMint,se):ue(r.wallet,n.nftMint,j),{publicKey:y}=Ke(c,n.nftMint),{publicKey:g}=tt(c,l,n.tickLower,n.tickUpper);return{address:{tickArrayLower:f,tickArrayUpper:p,positionNftAccount:b,personalPosition:y,protocolPosition:g},instructions:[this.increasePositionFromBaseInstruction(c,r.wallet,b,y,l,g,f,p,r.tokenAccountA,r.tokenAccountB,new k(t.vault.A),new k(t.vault.B),new k(e.mintA.address),new k(e.mintB.address),o,s,a,ce.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?he(c,l).publicKey:void 0)],signers:[],instructionTypes:[be.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,b,y,g,A){let P=H([q("liquidity"),N("amountMaxA"),N("amountMaxB"),oe("optionBaseFlag"),Be("baseFlag")]),T=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],C=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:j,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...T],w=Buffer.alloc(P.span);P.encode({liquidity:new In(0),amountMaxA:b==="MintA"?y:g,amountMaxB:b==="MintA"?g:y,baseFlag:b==="MintA",optionBaseFlag:1},w);let S=Buffer.from([...Me.increaseLiquidity,...w]);return new we({keys:C,programId:e,data:S})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,b,y,g,A,P){let T=H([q("liquidity"),N("amountMinA"),N("amountMinB")]),C=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[],...b.map(E=>[{pubkey:E.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:E.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:E.rewardMint,isSigner:!1,isWritable:!1}]).flat()],w=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:j,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:_t,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...C],S=Buffer.alloc(T.span);T.encode({liquidity:y,amountMinA:g,amountMinB:A},S);let R=Buffer.from([...Me.decreaseLiquidity,...S]);return new we({keys:w,programId:e,data:R})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u,nft2022:c}){let[l,m]=[new k(e.programId),new k(e.id)],d=x.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),f=x.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=z(l,m,d),{publicKey:b}=z(l,m,f),{publicKey:y}=c?ue(r.wallet,n.nftMint,se):ue(r.wallet,n.nftMint,u),{publicKey:g}=Ke(l,n.nftMint),{publicKey:A}=tt(l,m,n.tickLower,n.tickUpper),P=[];for(let w=0;w<e.rewardDefaultInfos.length;w++)P.push({poolRewardVault:new k(t.rewardInfos[w].vault),ownerRewardVault:r.rewardAccounts[w],rewardMint:new k(e.rewardDefaultInfos[w].mint.address)});let T=[],C=this.decreaseLiquidityInstruction(l,r.wallet,y,g,m,A,p,b,r.tokenAccountA,r.tokenAccountB,new k(t.vault.A),new k(t.vault.B),new k(e.mintA.address),new k(e.mintB.address),P,o,s,a,ce.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[d,f])?he(l,m).publicKey:void 0);return T.push(C),{address:{tickArrayLower:p,tickArrayUpper:b,positionNftAccount:y,personalPosition:g,protocolPosition:A},signers:[],instructions:T,instructionTypes:[be.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,b,y,g){let A=H([N("amount"),N("otherAmountThreshold"),q("sqrtPriceLimitX64"),Be("isBaseInput")]),P=[...g?[{pubkey:g,isSigner:!1,isWritable:!0}]:[],...m.map(S=>({pubkey:S,isSigner:!1,isWritable:!0}))],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:j,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:_t,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...P],C=Buffer.alloc(A.span);A.encode({amount:f,otherAmountThreshold:p,sqrtPriceLimitX64:b,isBaseInput:y},C);let w=Buffer.from([...Me.swap,...C]);return new we({keys:T,programId:e,data:w})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new k(e.programId),new k(e.id)],[d,f]=[new k(t.vault.A),new k(t.vault.B)],[p,b]=[new k(e.mintA.address),new k(e.mintB.address)],y=e.mintA.address===o.toString(),g=[this.swapInstruction(l,r.wallet,m,new k(e.config.id),y?r.tokenAccountA:r.tokenAccountB,y?r.tokenAccountB:r.tokenAccountA,y?d:f,y?f:d,y?p:b,y?b:p,c,n,s,a,u,!0,he(l,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[be.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new k(e.programId),new k(e.id)],[d,f]=[new k(t.vault.A),new k(t.vault.B)],[p,b]=[new k(e.mintA.address),new k(e.mintB.address)],y=e.mintA.address===o.toBase58(),g=[this.swapInstruction(l,r.wallet,m,new k(e.config.id),y?r.tokenAccountB:r.tokenAccountA,y?r.tokenAccountA:r.tokenAccountB,y?f:d,y?d:f,y?b:p,y?p:b,c,n,s,a,u,!1,he(l,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[be.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let f=H([N("openTime"),N("endTime"),q("emissionsPerSecondX64")]),p=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:He.programId,isSigner:!1,isWritable:!1},{pubkey:Je,isSigner:!1,isWritable:!1}],b=Buffer.alloc(f.span);f.encode({openTime:pe(l),endTime:pe(m),emissionsPerSecondX64:d},b);let y=Buffer.from([...Me.initReward,...b]);return new we({keys:p,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new k(e.programId),new k(e.id)],a=pi(o,s,r.mint).publicKey,u=Tn(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new k(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[be.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let f=H([oe("rewardIndex"),q("emissionsPerSecondX64"),N("openTime"),N("endTime")]),p=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:j,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],b=Buffer.alloc(f.span);f.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:pe(l),endTime:pe(m)},b);let y=Buffer.from([...Me.setRewardEmissions,...b]);return new we({keys:p,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new k(e.programId),new k(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,u=new k(t.rewardInfos[d].vault),c=new k(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&Ti.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Tn(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new k(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[be.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=H([oe("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:j,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:_t,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...Me.collectReward,...l]);return new we({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new k(e.programId),new k(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,u=new k(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&Ti.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[be.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:r,wallet:o,nftMint:s,nft2022:a,getEphemeralSigners:u}){let c=[],l;if(u)l=new k((await u(1))[0]);else{let g=Ht.generate();c.push(g),l=g.publicKey}let m=a?ue(o,s,se).publicKey:ue(o,s,j).publicKey,{publicKey:d}=Ke(n,s),f=yi(e,l).publicKey,p=ue(o,l,j).publicKey,b=Tt(l).publicKey,y=zt.lockPositionInstructionV2({programId:e,auth:t,payer:r,positionOwner:o,lockOwner:o,positionNftAccount:m,positionId:d,lockPositionId:f,lockNftMint:l,lockNftAccount:p,metadataAccount:b,withMetadata:!0,nft2022:a,positionNftMint:s,authPositionNftAccount:ue(t,s,a?se:j).publicKey,positionNftProgram:a?se:j});return{address:{positionId:d,lockPositionId:f,lockNftAccount:p,lockNftMint:l,positionNftAccount:m,metadataAccount:b},instructions:[y],signers:c,instructionTypes:[be.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:r,lockOwner:o,positionNftAccount:s,positionId:a,positionNftMint:u,authPositionNftAccount:c,positionNftProgram:l,lockPositionId:m,lockNftMint:d,lockNftAccount:f,metadataAccount:p,withMetadata:b}){let y=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!0,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:it,isSigner:!1,isWritable:!1},{pubkey:It,isSigner:!1,isWritable:!1},{pubkey:Je,isSigner:!1,isWritable:!1},{pubkey:j,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:He.programId,isSigner:!1,isWritable:!1}],g=H([Be("withMetadata")]),A=Buffer.alloc(g.span);g.encode({withMetadata:b},A);let P=Buffer.from([...xi,...A]);return new we({keys:y,programId:e,data:P})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:s}=ue(r,o,j),{publicKey:a}=Ke(n,o),u=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:xn(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:j,isSigner:!1,isWritable:!1},{pubkey:He.programId,isSigner:!1,isWritable:!1}];return new we({keys:u,programId:e,data:Buffer.from(xi)})}static harvestLockPositionInstruction(e){let[t,n]=[new k(e.poolKeys.programId),new k(e.poolKeys.id)],r=x.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=x.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=z(t,n,r),{publicKey:a}=z(t,n,o),{publicKey:u}=ue(e.owner,e.ownerPosition.nftMint,j),{publicKey:c}=Ke(t,e.ownerPosition.nftMint),{publicKey:l}=tt(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let p=0;p<e.poolKeys.rewardInfos.length;p++)m.push({poolRewardVault:new k(e.poolKeys.rewardInfos[p].vault),ownerRewardVault:e.ownerRewardAccounts[p],rewardMint:new k(e.poolKeys.rewardInfos[p].mint.address)});let d=[...m.map(p=>[{pubkey:p.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:p.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:p.rewardMint,isSigner:!1,isWritable:!1}]).flat()],f=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:xn(e.programId,c).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new k(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new k(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:j,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:ln,isSigner:!1,isWritable:!1},{pubkey:new k(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new k(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new we({keys:f,programId:e.programId,data:Buffer.from(Bi)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:r,lockOwner:o,lockNftMint:s,lockNftAccount:a,positionNftAccount:u,positionId:c,poolId:l,protocolPosition:m,vaultA:d,vaultB:f,tickArrayLower:p,tickArrayUpper:b,userVaultA:y,userVaultB:g,mintA:A,mintB:P,rewardAccounts:T,exTickArrayBitmap:C}){let w=[...C?[{pubkey:C,isSigner:!1,isWritable:!0}]:[],...T.map(R=>[{pubkey:R.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.rewardMint,isSigner:!1,isWritable:!1}]).flat()],S=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:j,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:ln,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},...w];return new we({keys:S,programId:e,data:Buffer.from(Bi)})}};export{zt as ClmmInstrument};
//# sourceMappingURL=instrument.mjs.map