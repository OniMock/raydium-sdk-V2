var Zn=Object.defineProperty;var Qn=(r,e,t)=>e in r?Zn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var dt=(r,e,t)=>(Qn(r,typeof e!="symbol"?e+"":e,t),t);import C from"bn.js";var je=9e15,Oe=1e9,Ct="0123456789abcdef",pt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",gt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Lt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-je,maxE:je,crypto:!1},an,Se,k=!0,bt="[DecimalError] ",ve=bt+"Invalid argument: ",un=bt+"Precision limit exceeded",cn=bt+"crypto unavailable",mn="[object Decimal]",oe=Math.floor,ee=Math.pow,Yn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Jn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,$n=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ln=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,xe=1e7,A=7,er=9007199254740991,tr=pt.length-1,Et=gt.length-1,g={toStringTag:mn};g.absoluteValue=g.abs=function(){var r=new this.constructor(this);return r.s<0&&(r.s=1),x(r)};g.ceil=function(){return x(new this.constructor(this),this.e+1,2)};g.clampedTo=g.clamp=function(r,e){var t,n=this,i=n.constructor;if(r=new i(r),e=new i(e),!r.s||!e.s)return new i(NaN);if(r.gt(e))throw Error(ve+e);return t=n.cmp(r),t<0?r:n.cmp(e)>0?e:new i(n)};g.comparedTo=g.cmp=function(r){var e,t,n,i,o=this,s=o.d,a=(r=new o.constructor(r)).d,u=o.s,c=r.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==r.e)return o.e>r.e^u<0?1:-1;for(n=s.length,i=a.length,e=0,t=n<i?n:i;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===i?0:n>i^u<0?1:-1};g.cosine=g.cos=function(){var r,e,t=this,n=t.constructor;return t.d?t.d[0]?(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+A,n.rounding=1,t=nr(n,hn(n,t)),n.precision=r,n.rounding=e,x(Se==2||Se==3?t.neg():t,r,e,!0)):new n(1):new n(NaN)};g.cubeRoot=g.cbrt=function(){var r,e,t,n,i,o,s,a,u,c,m=this,l=m.constructor;if(!m.isFinite()||m.isZero())return new l(m);for(k=!1,o=m.s*ee(m.s*m,1/3),!o||Math.abs(o)==1/0?(t=re(m.d),r=m.e,(o=(r-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ee(t,1/3),r=oe((r+1)/3)-(r%3==(r<0?-1:2)),o==1/0?t="5e"+r:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+r),n=new l(t),n.s=m.s):n=new l(o.toString()),s=(r=l.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(m),n=q(c.plus(m).times(a),c.plus(u),s+2,1),re(a.d).slice(0,s)===(t=re(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!i&&t=="4999"){if(!i&&(x(a,r+1,0),a.times(a).times(a).eq(m))){n=a;break}s+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(x(n,r+1,1),e=!n.times(n).times(n).eq(m));break}return k=!0,x(n,r,l.rounding,e)};g.decimalPlaces=g.dp=function(){var r,e=this.d,t=NaN;if(e){if(r=e.length-1,t=(r-oe(this.e/A))*A,r=e[r],r)for(;r%10==0;r/=10)t--;t<0&&(t=0)}return t};g.dividedBy=g.div=function(r){return q(this,new this.constructor(r))};g.dividedToIntegerBy=g.divToInt=function(r){var e=this,t=e.constructor;return x(q(e,new t(r),0,1,1),t.precision,t.rounding)};g.equals=g.eq=function(r){return this.cmp(r)===0};g.floor=function(){return x(new this.constructor(this),this.e+1,3)};g.greaterThan=g.gt=function(r){return this.cmp(r)>0};g.greaterThanOrEqualTo=g.gte=function(r){var e=this.cmp(r);return e==1||e===0};g.hyperbolicCosine=g.cosh=function(){var r,e,t,n,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(r=Math.ceil(i/3),e=(1/yt(4,r)).toString()):(r=16,e="2.3283064365386962890625e-10"),o=Ze(s,1,o.times(e),new s(1),!0);for(var u,c=r,m=new s(8);c--;)u=o.times(o),o=a.minus(u.times(m.minus(u.times(m))));return x(o,s.precision=t,s.rounding=n,!0)};g.hyperbolicSine=g.sinh=function(){var r,e,t,n,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,n=i.d.length,n<3)i=Ze(o,2,i,i,!0);else{r=1.4*Math.sqrt(n),r=r>16?16:r|0,i=i.times(1/yt(5,r)),i=Ze(o,2,i,i,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);r--;)s=i.times(i),i=i.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,x(i,e,t,!0)};g.hyperbolicTangent=g.tanh=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+7,n.rounding=1,q(t.sinh(),t.cosh(),n.precision=r,n.rounding=e)):new n(t.s)};g.inverseCosine=g.acos=function(){var r,e=this,t=e.constructor,n=e.abs().cmp(1),i=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Te(t,i,o):new t(0):new t(NaN):e.isZero()?Te(t,i+4,o).times(.5):(t.precision=i+6,t.rounding=1,e=e.asin(),r=Te(t,i+4,o).times(.5),t.precision=i,t.rounding=o,r.minus(e))};g.inverseHyperbolicCosine=g.acosh=function(){var r,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(r=n.precision,e=n.rounding,n.precision=r+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,k=!1,t=t.times(t).minus(1).sqrt().plus(t),k=!0,n.precision=r,n.rounding=e,t.ln()):new n(t)};g.inverseHyperbolicSine=g.asinh=function(){var r,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,k=!1,t=t.times(t).plus(1).sqrt().plus(t),k=!0,n.precision=r,n.rounding=e,t.ln())};g.inverseHyperbolicTangent=g.atanh=function(){var r,e,t,n,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(r=o.precision,e=o.rounding,n=i.sd(),Math.max(n,r)<2*-i.e-1?x(new o(i),r,e,!0):(o.precision=t=n-i.e,i=q(i.plus(1),new o(1).minus(i),t+r,1),o.precision=r+4,o.rounding=1,i=i.ln(),o.precision=r,o.rounding=e,i.times(.5))):new o(NaN)};g.inverseSine=g.asin=function(){var r,e,t,n,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(r=Te(o,t+4,n).times(.5),r.s=i.s,r):new o(NaN):(o.precision=t+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,i.times(2)))};g.inverseTangent=g.atan=function(){var r,e,t,n,i,o,s,a,u,c=this,m=c.constructor,l=m.precision,d=m.rounding;if(c.isFinite()){if(c.isZero())return new m(c);if(c.abs().eq(1)&&l+4<=Et)return s=Te(m,l+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new m(NaN);if(l+4<=Et)return s=Te(m,l+4,d).times(.5),s.s=c.s,s}for(m.precision=a=l+10,m.rounding=1,t=Math.min(28,a/A+2|0),r=t;r;--r)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(k=!1,e=Math.ceil(a/A),n=1,u=c.times(c),s=new m(c),i=c;r!==-1;)if(i=i.times(u),o=s.minus(i.div(n+=2)),i=i.times(u),s=o.plus(i.div(n+=2)),s.d[e]!==void 0)for(r=e;s.d[r]===o.d[r]&&r--;);return t&&(s=s.times(2<<t-1)),k=!0,x(s,m.precision=l,m.rounding=d,!0)};g.isFinite=function(){return!!this.d};g.isInteger=g.isInt=function(){return!!this.d&&oe(this.e/A)>this.d.length-2};g.isNaN=function(){return!this.s};g.isNegative=g.isNeg=function(){return this.s<0};g.isPositive=g.isPos=function(){return this.s>0};g.isZero=function(){return!!this.d&&this.d[0]===0};g.lessThan=g.lt=function(r){return this.cmp(r)<0};g.lessThanOrEqualTo=g.lte=function(r){return this.cmp(r)<1};g.logarithm=g.log=function(r){var e,t,n,i,o,s,a,u,c=this,m=c.constructor,l=m.precision,d=m.rounding,f=5;if(r==null)r=new m(10),e=!0;else{if(r=new m(r),t=r.d,r.s<0||!t||!t[0]||r.eq(1))return new m(NaN);e=r.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new m(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(i=t[0];i%10===0;)i/=10;o=i!==1}if(k=!1,a=l+f,s=_e(c,a),n=e?ht(m,a+10):_e(r,a),u=q(s,n,a,1),Je(u.d,i=l,d))do if(a+=10,s=_e(c,a),n=e?ht(m,a+10):_e(r,a),u=q(s,n,a,1),!o){+re(u.d).slice(i+1,i+15)+1==1e14&&(u=x(u,l+1,0));break}while(Je(u.d,i+=10,d));return k=!0,x(u,l,d)};g.minus=g.sub=function(r){var e,t,n,i,o,s,a,u,c,m,l,d,f=this,p=f.constructor;if(r=new p(r),!f.d||!r.d)return!f.s||!r.s?r=new p(NaN):f.d?r.s=-r.s:r=new p(r.d||f.s!==r.s?f:NaN),r;if(f.s!=r.s)return r.s=-r.s,f.plus(r);if(c=f.d,d=r.d,a=p.precision,u=p.rounding,!c[0]||!d[0]){if(d[0])r.s=-r.s;else if(c[0])r=new p(f);else return new p(u===3?-0:0);return k?x(r,a,u):r}if(t=oe(r.e/A),m=oe(f.e/A),c=c.slice(),o=m-t,o){for(l=o<0,l?(e=c,o=-o,s=d.length):(e=d,t=m,s=c.length),n=Math.max(Math.ceil(a/A),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,l=n<s,l&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){l=c[n]<d[n];break}o=0}for(l&&(e=c,c=d,d=e,r.s=-r.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(i=n;i&&c[--i]===0;)c[i]=xe-1;--c[i],c[n]+=xe}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(r.d=c,r.e=wt(c,t),k?x(r,a,u):r):new p(u===3?-0:0)};g.modulo=g.mod=function(r){var e,t=this,n=t.constructor;return r=new n(r),!t.d||!r.s||r.d&&!r.d[0]?new n(NaN):!r.d||t.d&&!t.d[0]?x(new n(t),n.precision,n.rounding):(k=!1,n.modulo==9?(e=q(t,r.abs(),0,3,1),e.s*=r.s):e=q(t,r,0,n.modulo,1),e=e.times(r),k=!0,t.minus(e))};g.naturalExponential=g.exp=function(){return Rt(this)};g.naturalLogarithm=g.ln=function(){return _e(this)};g.negated=g.neg=function(){var r=new this.constructor(this);return r.s=-r.s,x(r)};g.plus=g.add=function(r){var e,t,n,i,o,s,a,u,c,m,l=this,d=l.constructor;if(r=new d(r),!l.d||!r.d)return!l.s||!r.s?r=new d(NaN):l.d||(r=new d(r.d||l.s===r.s?l:NaN)),r;if(l.s!=r.s)return r.s=-r.s,l.minus(r);if(c=l.d,m=r.d,a=d.precision,u=d.rounding,!c[0]||!m[0])return m[0]||(r=new d(l)),k?x(r,a,u):r;if(o=oe(l.e/A),n=oe(r.e/A),c=c.slice(),i=o-n,i){for(i<0?(t=c,i=-i,s=m.length):(t=m,n=o,s=c.length),o=Math.ceil(a/A),s=o>s?o+1:s+1,i>s&&(i=s,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(s=c.length,i=m.length,s-i<0&&(i=s,t=m,m=c,c=t),e=0;i;)e=(c[--i]=c[i]+m[i]+e)/xe|0,c[i]%=xe;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return r.d=c,r.e=wt(c,n),k?x(r,a,u):r};g.precision=g.sd=function(r){var e,t=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(ve+r);return t.d?(e=dn(t.d),r&&t.e+1>e&&(e=t.e+1)):e=NaN,e};g.round=function(){var r=this,e=r.constructor;return x(new e(r),r.e+1,e.rounding)};g.sine=g.sin=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+A,n.rounding=1,t=ir(n,hn(n,t)),n.precision=r,n.rounding=e,x(Se>2?t.neg():t,r,e,!0)):new n(NaN)};g.squareRoot=g.sqrt=function(){var r,e,t,n,i,o,s=this,a=s.d,u=s.e,c=s.s,m=s.constructor;if(c!==1||!a||!a[0])return new m(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(k=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=re(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=oe((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new m(e)):n=new m(c.toString()),t=(u=m.precision)+3;;)if(o=n,n=o.plus(q(s,o,t+2,1)).times(.5),re(o.d).slice(0,t)===(e=re(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!i&&e=="4999"){if(!i&&(x(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(x(n,u+1,1),r=!n.times(n).eq(s));break}return k=!0,x(n,u,m.rounding,r)};g.tangent=g.tan=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+10,n.rounding=1,t=t.sin(),t.s=1,t=q(t,new n(1).minus(t.times(t)).sqrt(),r+10,0),n.precision=r,n.rounding=e,x(Se==2||Se==4?t.neg():t,r,e,!0)):new n(NaN)};g.times=g.mul=function(r){var e,t,n,i,o,s,a,u,c,m=this,l=m.constructor,d=m.d,f=(r=new l(r)).d;if(r.s*=m.s,!d||!d[0]||!f||!f[0])return new l(!r.s||d&&!d[0]&&!f||f&&!f[0]&&!d?NaN:!d||!f?r.s/0:r.s*0);for(t=oe(m.e/A)+oe(r.e/A),u=d.length,c=f.length,u<c&&(o=d,d=f,f=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,i=u+n;i>n;)a=o[i]+f[n]*d[i-n-1]+e,o[i--]=a%xe|0,e=a/xe|0;o[i]=(o[i]+e)%xe|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),r.d=o,r.e=wt(o,t),k?x(r,l.precision,l.rounding):r};g.toBinary=function(r,e){return Ft(this,2,r,e)};g.toDecimalPlaces=g.toDP=function(r,e){var t=this,n=t.constructor;return t=new n(t),r===void 0?t:(le(r,0,Oe),e===void 0?e=n.rounding:le(e,0,8),x(t,r+t.e+1,e))};g.toExponential=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=Be(n,!0):(le(r,0,Oe),e===void 0?e=i.rounding:le(e,0,8),n=x(new i(n),r+1,e),t=Be(n,!0,r+1)),n.isNeg()&&!n.isZero()?"-"+t:t};g.toFixed=function(r,e){var t,n,i=this,o=i.constructor;return r===void 0?t=Be(i):(le(r,0,Oe),e===void 0?e=o.rounding:le(e,0,8),n=x(new o(i),r+i.e+1,e),t=Be(n,!1,r+n.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};g.toFraction=function(r){var e,t,n,i,o,s,a,u,c,m,l,d,f=this,p=f.d,h=f.constructor;if(!p)return new h(f);if(c=t=new h(1),n=u=new h(0),e=new h(n),o=e.e=dn(p)-f.e-1,s=o%A,e.d[0]=ee(10,s<0?A+s:s),r==null)r=o>0?e:c;else{if(a=new h(r),!a.isInt()||a.lt(c))throw Error(ve+a);r=a.gt(e)?o>0?e:c:a}for(k=!1,a=new h(re(p)),m=h.precision,h.precision=o=p.length*A*2;l=q(a,e,0,1,1),i=t.plus(l.times(n)),i.cmp(r)!=1;)t=n,n=i,i=c,c=u.plus(l.times(i)),u=i,i=e,e=a.minus(l.times(i)),a=i;return i=q(r.minus(t),n,0,1,1),u=u.plus(i.times(c)),t=t.plus(i.times(n)),u.s=c.s=f.s,d=q(c,n,o,1).minus(f).abs().cmp(q(u,t,o,1).minus(f).abs())<1?[c,n]:[u,t],h.precision=m,k=!0,d};g.toHexadecimal=g.toHex=function(r,e){return Ft(this,16,r,e)};g.toNearest=function(r,e){var t=this,n=t.constructor;if(t=new n(t),r==null){if(!t.d)return t;r=new n(1),e=n.rounding}else{if(r=new n(r),e===void 0?e=n.rounding:le(e,0,8),!t.d)return r.s?t:r;if(!r.d)return r.s&&(r.s=t.s),r}return r.d[0]?(k=!1,t=q(t,r,0,e,1).times(r),k=!0,x(t)):(r.s=t.s,t=r),t};g.toNumber=function(){return+this};g.toOctal=function(r,e){return Ft(this,8,r,e)};g.toPower=g.pow=function(r){var e,t,n,i,o,s,a=this,u=a.constructor,c=+(r=new u(r));if(!a.d||!r.d||!a.d[0]||!r.d[0])return new u(ee(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,r.eq(1))return x(a,n,o);if(e=oe(r.e/A),e>=r.d.length-1&&(t=c<0?-c:c)<=er)return i=fn(u,a,t,n),r.s<0?new u(1).div(i):x(i,n,o);if(s=a.s,s<0){if(e<r.d.length-1)return new u(NaN);if((r.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ee(+a,c),e=t==0||!isFinite(t)?oe(c*(Math.log("0."+re(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(k=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),i=Rt(r.times(_e(a,n+t)),n),i.d&&(i=x(i,n+5,1),Je(i.d,n,o)&&(e=n+10,i=x(Rt(r.times(_e(a,e+t)),e),e+5,1),+re(i.d).slice(n+1,n+15)+1==1e14&&(i=x(i,n+1,0)))),i.s=s,k=!0,u.rounding=o,x(i,n,o))};g.toPrecision=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=Be(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(le(r,1,Oe),e===void 0?e=i.rounding:le(e,0,8),n=x(new i(n),r,e),t=Be(n,r<=n.e||n.e<=i.toExpNeg,r)),n.isNeg()&&!n.isZero()?"-"+t:t};g.toSignificantDigits=g.toSD=function(r,e){var t=this,n=t.constructor;return r===void 0?(r=n.precision,e=n.rounding):(le(r,1,Oe),e===void 0?e=n.rounding:le(e,0,8)),x(new n(t),r,e)};g.toString=function(){var r=this,e=r.constructor,t=Be(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()&&!r.isZero()?"-"+t:t};g.truncated=g.trunc=function(){return x(new this.constructor(this),this.e+1,1)};g.valueOf=g.toJSON=function(){var r=this,e=r.constructor,t=Be(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()?"-"+t:t};function re(r){var e,t,n,i=r.length-1,o="",s=r[0];if(i>0){for(o+=s,e=1;e<i;e++)n=r[e]+"",t=A-n.length,t&&(o+=Fe(t)),o+=n;s=r[e],n=s+"",t=A-n.length,t&&(o+=Fe(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function le(r,e,t){if(r!==~~r||r<e||r>t)throw Error(ve+r)}function Je(r,e,t,n){var i,o,s,a;for(o=r[0];o>=10;o/=10)--e;return--e<0?(e+=A,i=0):(i=Math.ceil((e+1)/A),e%=A),o=ee(10,A-e),a=r[i]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(r[i+1]/o/100|0)==ee(10,e-2)-1||(a==o/2||a==0)&&(r[i+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(r[i+1]/o/1e3|0)==ee(10,e-3)-1,s}function ft(r,e,t){for(var n,i=[0],o,s=0,a=r.length;s<a;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=Ct.indexOf(r.charAt(s++)),n=0;n<i.length;n++)i[n]>t-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/t|0,i[n]%=t)}return i.reverse()}function nr(r,e){var t,n,i;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),i=(1/yt(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),r.precision+=t,e=Ze(r,1,e.times(i),new r(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return r.precision-=t,e}var q=function(){function r(n,i,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*i+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,i,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=i[a]){u=n[a]>i[a]?1:-1;break}return u}function t(n,i,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<i[o]?1:0,n[o]=a*s+n[o]-i[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,o,s,a,u){var c,m,l,d,f,p,h,w,b,F,P,v,j,y,X,H,Y,J,D,ye,ie=n.constructor,Me=n.s==i.s?1:-1,$=n.d,G=i.d;if(!$||!$[0]||!G||!G[0])return new ie(!n.s||!i.s||($?G&&$[0]==G[0]:!G)?NaN:$&&$[0]==0||!G?Me*0:Me/0);for(u?(f=1,m=n.e-i.e):(u=xe,f=A,m=oe(n.e/f)-oe(i.e/f)),D=G.length,Y=$.length,b=new ie(Me),F=b.d=[],l=0;G[l]==($[l]||0);l++);if(G[l]>($[l]||0)&&m--,o==null?(y=o=ie.precision,s=ie.rounding):a?y=o+(n.e-i.e)+1:y=o,y<0)F.push(1),p=!0;else{if(y=y/f+2|0,l=0,D==1){for(d=0,G=G[0],y++;(l<Y||d)&&y--;l++)X=d*u+($[l]||0),F[l]=X/G|0,d=X%G|0;p=d||l<Y}else{for(d=u/(G[0]+1)|0,d>1&&(G=r(G,d,u),$=r($,d,u),D=G.length,Y=$.length),H=D,P=$.slice(0,D),v=P.length;v<D;)P[v++]=0;ye=G.slice(),ye.unshift(0),J=G[0],G[1]>=u/2&&++J;do d=0,c=e(G,P,D,v),c<0?(j=P[0],D!=v&&(j=j*u+(P[1]||0)),d=j/J|0,d>1?(d>=u&&(d=u-1),h=r(G,d,u),w=h.length,v=P.length,c=e(h,P,w,v),c==1&&(d--,t(h,D<w?ye:G,w,u))):(d==0&&(c=d=1),h=G.slice()),w=h.length,w<v&&h.unshift(0),t(P,h,v,u),c==-1&&(v=P.length,c=e(G,P,D,v),c<1&&(d++,t(P,D<v?ye:G,v,u))),v=P.length):c===0&&(d++,P=[0]),F[l++]=d,c&&P[0]?P[v++]=$[H]||0:(P=[$[H]],v=1);while((H++<Y||P[0]!==void 0)&&y--);p=P[0]!==void 0}F[0]||F.shift()}if(f==1)b.e=m,an=p;else{for(l=1,d=F[0];d>=10;d/=10)l++;b.e=l+m*f-1,x(b,a?o+b.e+1:o,s,p)}return b}}();function x(r,e,t,n){var i,o,s,a,u,c,m,l,d,f=r.constructor;e:if(e!=null){if(l=r.d,!l)return r;for(i=1,a=l[0];a>=10;a/=10)i++;if(o=e-i,o<0)o+=A,s=e,m=l[d=0],u=m/ee(10,i-s-1)%10|0;else if(d=Math.ceil((o+1)/A),a=l.length,d>=a)if(n){for(;a++<=d;)l.push(0);m=u=0,i=1,o%=A,s=o-A+1}else break e;else{for(m=a=l[d],i=1;a>=10;a/=10)i++;o%=A,s=o-A+i,u=s<0?0:m/ee(10,i-s-1)%10|0}if(n=n||e<0||l[d+1]!==void 0||(s<0?m:m%ee(10,i-s-1)),c=t<4?(u||n)&&(t==0||t==(r.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?m/ee(10,i-s):0:l[d-1])%10&1||t==(r.s<0?8:7)),e<1||!l[0])return l.length=0,c?(e-=r.e+1,l[0]=ee(10,(A-e%A)%A),r.e=-e||0):l[0]=r.e=0,r;if(o==0?(l.length=d,a=1,d--):(l.length=d+1,a=ee(10,A-o),l[d]=s>0?(m/ee(10,i-s)%ee(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=l[0];s>=10;s/=10)o++;for(s=l[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(r.e++,l[0]==xe&&(l[0]=1));break}else{if(l[d]+=a,l[d]!=xe)break;l[d--]=0,a=1}for(o=l.length;l[--o]===0;)l.pop()}return k&&(r.e>f.maxE?(r.d=null,r.e=NaN):r.e<f.minE&&(r.e=0,r.d=[0])),r}function Be(r,e,t){if(!r.isFinite())return gn(r);var n,i=r.e,o=re(r.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Fe(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(r.e<0?"e":"e+")+r.e):i<0?(o="0."+Fe(-i-1)+o,t&&(n=t-s)>0&&(o+=Fe(n))):i>=s?(o+=Fe(i+1-s),t&&(n=t-i-1)>0&&(o=o+"."+Fe(n))):((n=i+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(i+1===s&&(o+="."),o+=Fe(n))),o}function wt(r,e){var t=r[0];for(e*=A;t>=10;t/=10)e++;return e}function ht(r,e,t){if(e>tr)throw k=!0,t&&(r.precision=t),Error(un);return x(new r(pt),e,1,!0)}function Te(r,e,t){if(e>Et)throw Error(un);return x(new r(gt),e,t,!0)}function dn(r){var e=r.length-1,t=e*A+1;if(e=r[e],e){for(;e%10==0;e/=10)t--;for(e=r[0];e>=10;e/=10)t++}return t}function Fe(r){for(var e="";r--;)e+="0";return e}function fn(r,e,t,n){var i,o=new r(1),s=Math.ceil(n/A+4);for(k=!1;;){if(t%2&&(o=o.times(e),on(o.d,s)&&(i=!0)),t=oe(t/2),t===0){t=o.d.length-1,i&&o.d[t]===0&&++o.d[t];break}e=e.times(e),on(e.d,s)}return k=!0,o}function rn(r){return r.d[r.d.length-1]&1}function pn(r,e,t){for(var n,i=new r(e[0]),o=0;++o<e.length;)if(n=new r(e[o]),n.s)i[t](n)&&(i=n);else{i=n;break}return i}function Rt(r,e){var t,n,i,o,s,a,u,c=0,m=0,l=0,d=r.constructor,f=d.rounding,p=d.precision;if(!r.d||!r.d[0]||r.e>17)return new d(r.d?r.d[0]?r.s<0?0:1/0:1:r.s?r.s<0?0:r:0/0);for(e==null?(k=!1,u=p):u=e,a=new d(.03125);r.e>-2;)r=r.times(a),l+=5;for(n=Math.log(ee(2,l))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=x(o.times(r),u,1),t=t.times(++m),a=s.plus(q(o,t,u,1)),re(a.d).slice(0,u)===re(s.d).slice(0,u)){for(i=l;i--;)s=x(s.times(s),u,1);if(e==null)if(c<3&&Je(s.d,u-n,f,c))d.precision=u+=10,t=o=a=new d(1),m=0,c++;else return x(s,d.precision=p,f,k=!0);else return d.precision=p,s}s=a}}function _e(r,e){var t,n,i,o,s,a,u,c,m,l,d,f=1,p=10,h=r,w=h.d,b=h.constructor,F=b.rounding,P=b.precision;if(h.s<0||!w||!w[0]||!h.e&&w[0]==1&&w.length==1)return new b(w&&!w[0]?-1/0:h.s!=1?NaN:w?0:h);if(e==null?(k=!1,m=P):m=e,b.precision=m+=p,t=re(w),n=t.charAt(0),Math.abs(o=h.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)h=h.times(r),t=re(h.d),n=t.charAt(0),f++;o=h.e,n>1?(h=new b("0."+t),o++):h=new b(n+"."+t.slice(1))}else return c=ht(b,m+2,P).times(o+""),h=_e(new b(n+"."+t.slice(1)),m-p).plus(c),b.precision=P,e==null?x(h,P,F,k=!0):h;for(l=h,u=s=h=q(h.minus(1),h.plus(1),m,1),d=x(h.times(h),m,1),i=3;;){if(s=x(s.times(d),m,1),c=u.plus(q(s,new b(i),m,1)),re(c.d).slice(0,m)===re(u.d).slice(0,m))if(u=u.times(2),o!==0&&(u=u.plus(ht(b,m+2,P).times(o+""))),u=q(u,new b(f),m,1),e==null)if(Je(u.d,m-p,F,a))b.precision=m+=p,c=s=h=q(l.minus(1),l.plus(1),m,1),d=x(h.times(h),m,1),i=a=1;else return x(u,b.precision=P,F,k=!0);else return b.precision=P,u;u=c,i+=2}}function gn(r){return String(r.s*r.s/0)}function Mt(r,e){var t,n,i;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(n,i),e){if(i-=n,r.e=t=t-n-1,r.d=[],n=(t+1)%A,t<0&&(n+=A),n<i){for(n&&r.d.push(+e.slice(0,n)),i-=A;n<i;)r.d.push(+e.slice(n,n+=A));e=e.slice(n),n=A-e.length}else n-=i;for(;n--;)e+="0";r.d.push(+e),k&&(r.e>r.constructor.maxE?(r.d=null,r.e=NaN):r.e<r.constructor.minE&&(r.e=0,r.d=[0]))}else r.e=0,r.d=[0];return r}function rr(r,e){var t,n,i,o,s,a,u,c,m;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),ln.test(e))return Mt(r,e)}else if(e==="Infinity"||e==="NaN")return+e||(r.s=NaN),r.e=NaN,r.d=null,r;if(Jn.test(e))t=16,e=e.toLowerCase();else if(Yn.test(e))t=2;else if($n.test(e))t=8;else throw Error(ve+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=r.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,i=fn(n,new n(t),o,o*2)),c=ft(e,t,xe),m=c.length-1,o=m;c[o]===0;--o)c.pop();return o<0?new n(r.s*0):(r.e=wt(c,m),r.d=c,k=!1,s&&(r=q(r,i,a*4)),u&&(r=r.times(Math.abs(u)<54?ee(2,u):$e.pow(2,u))),k=!0,r)}function ir(r,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:Ze(r,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/yt(5,t)),e=Ze(r,2,e,e);for(var i,o=new r(5),s=new r(16),a=new r(20);t--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(a))));return e}function Ze(r,e,t,n,i){var o,s,a,u,c=1,m=r.precision,l=Math.ceil(m/A);for(k=!1,u=t.times(t),a=new r(n);;){if(s=q(a.times(u),new r(e++*e++),m,1),a=i?n.plus(s):n.minus(s),n=q(s.times(u),new r(e++*e++),m,1),s=a.plus(n),s.d[l]!==void 0){for(o=l;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return k=!0,s.d.length=l+1,s}function yt(r,e){for(var t=r;--e;)t*=r;return t}function hn(r,e){var t,n=e.s<0,i=Te(r,r.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return Se=n?4:1,e;if(t=e.divToInt(i),t.isZero())Se=n?3:2;else{if(e=e.minus(t.times(i)),e.lte(o))return Se=rn(t)?n?2:3:n?4:1,e;Se=rn(t)?n?1:4:n?3:2}return e.minus(i).abs()}function Ft(r,e,t,n){var i,o,s,a,u,c,m,l,d,f=r.constructor,p=t!==void 0;if(p?(le(t,1,Oe),n===void 0?n=f.rounding:le(n,0,8)):(t=f.precision,n=f.rounding),!r.isFinite())m=gn(r);else{for(m=Be(r),s=m.indexOf("."),p?(i=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):i=e,s>=0&&(m=m.replace(".",""),d=new f(1),d.e=m.length-s,d.d=ft(Be(d),10,i),d.e=d.d.length),l=ft(m,10,i),o=u=l.length;l[--u]==0;)l.pop();if(!l[0])m=p?"0p+0":"0";else{if(s<0?o--:(r=new f(r),r.d=l,r.e=o,r=q(r,d,t,n,0,i),l=r.d,o=r.e,c=an),s=l[t],a=i/2,c=c||l[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(r.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&l[t-1]&1||n===(r.s<0?8:7)),l.length=t,c)for(;++l[--t]>i-1;)l[t]=0,t||(++o,l.unshift(1));for(u=l.length;!l[u-1];--u);for(s=0,m="";s<u;s++)m+=Ct.charAt(l[s]);if(p){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)m+="0";for(l=ft(m,i,e),u=l.length;!l[u-1];--u);for(s=1,m="1.";s<u;s++)m+=Ct.charAt(l[s])}else m=m.charAt(0)+"."+m.slice(1);m=m+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)m="0"+m;m="0."+m}else if(++o>u)for(o-=u;o--;)m+="0";else o<u&&(m=m.slice(0,o)+"."+m.slice(o))}m=(e==16?"0x":e==2?"0b":e==8?"0o":"")+m}return r.s<0?"-"+m:m}function on(r,e){if(r.length>e)return r.length=e,!0}function or(r){return new this(r).abs()}function sr(r){return new this(r).acos()}function ar(r){return new this(r).acosh()}function ur(r,e){return new this(r).plus(e)}function cr(r){return new this(r).asin()}function mr(r){return new this(r).asinh()}function lr(r){return new this(r).atan()}function dr(r){return new this(r).atanh()}function fr(r,e){r=new this(r),e=new this(e);var t,n=this.precision,i=this.rounding,o=n+4;return!r.s||!e.s?t=new this(NaN):!r.d&&!e.d?(t=Te(this,o,1).times(e.s>0?.25:.75),t.s=r.s):!e.d||r.isZero()?(t=e.s<0?Te(this,n,i):new this(0),t.s=r.s):!r.d||e.isZero()?(t=Te(this,o,1).times(.5),t.s=r.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(q(r,e,o,1)),e=Te(this,o,1),this.precision=n,this.rounding=i,t=r.s<0?t.minus(e):t.plus(e)):t=this.atan(q(r,e,o,1)),t}function pr(r){return new this(r).cbrt()}function gr(r){return x(r=new this(r),r.e+1,2)}function hr(r,e,t){return new this(r).clamp(e,t)}function br(r){if(!r||typeof r!="object")throw Error(bt+"Object expected");var e,t,n,i=r.defaults===!0,o=["precision",1,Oe,"rounding",0,8,"toExpNeg",-je,0,"toExpPos",0,je,"maxE",0,je,"minE",-je,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],i&&(this[t]=Lt[t]),(n=r[t])!==void 0)if(oe(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(ve+t+": "+n);if(t="crypto",i&&(this[t]=Lt[t]),(n=r[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(cn);else this[t]=!1;else throw Error(ve+t+": "+n);return this}function wr(r){return new this(r).cos()}function yr(r){return new this(r).cosh()}function bn(r){var e,t,n;function i(o){var s,a,u,c=this;if(!(c instanceof i))return new i(o);if(c.constructor=i,sn(o)){c.s=o.s,k?!o.d||o.e>i.maxE?(c.e=NaN,c.d=null):o.e<i.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;k?s>i.maxE?(c.e=NaN,c.d=null):s<i.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return Mt(c,o.toString())}else if(u!=="string")throw Error(ve+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),ln.test(o)?Mt(c,o):rr(c,o)}if(i.prototype=g,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=br,i.clone=bn,i.isDecimal=sn,i.abs=or,i.acos=sr,i.acosh=ar,i.add=ur,i.asin=cr,i.asinh=mr,i.atan=lr,i.atanh=dr,i.atan2=fr,i.cbrt=pr,i.ceil=gr,i.clamp=hr,i.cos=wr,i.cosh=yr,i.div=Tr,i.exp=xr,i.floor=Ar,i.hypot=Pr,i.ln=kr,i.log=Br,i.log10=Nr,i.log2=Ir,i.max=Sr,i.min=Cr,i.mod=Lr,i.mul=Er,i.pow=Rr,i.random=Mr,i.round=Fr,i.sign=_r,i.sin=vr,i.sinh=Or,i.sqrt=Dr,i.sub=Kr,i.sum=qr,i.tan=Gr,i.tanh=Vr,i.trunc=Ur,r===void 0&&(r={}),r&&r.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)r.hasOwnProperty(t=n[e++])||(r[t]=this[t]);return i.config(r),i}function Tr(r,e){return new this(r).div(e)}function xr(r){return new this(r).exp()}function Ar(r){return x(r=new this(r),r.e+1,3)}function Pr(){var r,e,t=new this(0);for(k=!1,r=0;r<arguments.length;)if(e=new this(arguments[r++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return k=!0,new this(1/0);t=e}return k=!0,t.sqrt()}function sn(r){return r instanceof $e||r&&r.toStringTag===mn||!1}function kr(r){return new this(r).ln()}function Br(r,e){return new this(r).log(e)}function Ir(r){return new this(r).log(2)}function Nr(r){return new this(r).log(10)}function Sr(){return pn(this,arguments,"lt")}function Cr(){return pn(this,arguments,"gt")}function Lr(r,e){return new this(r).mod(e)}function Er(r,e){return new this(r).mul(e)}function Rr(r,e){return new this(r).pow(e)}function Mr(r){var e,t,n,i,o=0,s=new this(1),a=[];if(r===void 0?r=this.precision:le(r,1,Oe),n=Math.ceil(r/A),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(i%1e7),o+=4);o=n/4}else throw Error(cn);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],r%=A,n&&r&&(i=ee(10,A-r),a[o]=(n/i|0)*i);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=A)a.shift();for(n=1,i=a[0];i>=10;i/=10)n++;n<A&&(t-=A-n)}return s.e=t,s.d=a,s}function Fr(r){return x(r=new this(r),r.e+1,this.rounding)}function _r(r){return r=new this(r),r.d?r.d[0]?r.s:0*r.s:r.s||NaN}function vr(r){return new this(r).sin()}function Or(r){return new this(r).sinh()}function Dr(r){return new this(r).sqrt()}function Kr(r,e){return new this(r).sub(e)}function qr(){var r=0,e=arguments,t=new this(e[r]);for(k=!1;t.s&&++r<e.length;)t=t.plus(e[r]);return k=!0,x(t,this.precision,this.rounding)}function Gr(r){return new this(r).tan()}function Vr(r){return new this(r).tanh()}function Ur(r){return x(r=new this(r),r.e+1,1)}g[Symbol.for("nodejs.util.inspect.custom")]=g.toString;g[Symbol.toStringTag]="Decimal";var $e=g.constructor=bn(Lt);pt=new $e(pt);gt=new $e(gt);var T=$e;import Ae from"bn.js";var et=1e4;function Z(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i={...e,olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}},o=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new Ae(o.maximumFee.toString()),a=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===et){let u=new Ae(o.maximumFee.toString());return{amount:r.add(u),fee:u,expirationTime:a}}else{let u=_t(r.mul(new Ae(et)),new Ae(et-o.transferFeeBasisPoints)),c=new Ae(o.maximumFee.toString()),m=u.sub(r).gt(c)?r.add(c):u,l=_t(m.mul(new Ae(o.transferFeeBasisPoints)),new Ae(et)),d=l.gt(s)?s:l;return{amount:m,fee:d,expirationTime:a}}else{let u=_t(r.mul(new Ae(o.transferFeeBasisPoints)),new Ae(et)),c=u.gt(s)?s:u;return{amount:r,fee:c,expirationTime:a}}}function De(r,e){return r===void 0?e:e===void 0?r:Math.min(r,e)}function _t(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new Ae(0))?t.add(new Ae(1)):t}import we from"bn.js";var Q=new we(0),Ie=new we(1),Ce=new we(-1),fe=new we(1).shln(64),Tt=new we(1).shln(128),vt=fe.sub(Ie),tt=64,wn=Tt.subn(1),se=-443636,ue=-se,Ve=new we("4295048016"),Ue=new we("79226673521066979257578248091"),ji=new we("4295048017"),Zi=new we("79226673521066979257578248090"),yn=16,Tn="59543866431248",xn="184467440737095516",An="15793534762490258745",xt=new we(10).pow(new we(6));var Qi=new we("18446744073700000000");import{PublicKey as Hr}from"@solana/web3.js";import{get as Pn,set as Wr}from"lodash";var Ot=class{logLevel;name;constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},kn={},Xr={};function pe(r){let e=Pn(kn,r);if(!e){let t=Pn(Xr,r);e=new Ot({name:r,logLevel:t}),Wr(kn,r,e)}return e}import{MINT_SIZE as ao,TOKEN_PROGRAM_ID as uo,getTransferFeeConfig as co,unpackMint as mo}from"@solana/spl-token";var Dt=pe("Raydium_accountInfo_util");async function Ke(r,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:o=100}={batchRequest:!1,...t},s=Kt(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(l=>{let d=r._buildArgs([l.map(f=>f.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=Kt(u,10);a=(await(await Promise.all(c.map(async l=>await r._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&Dt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(d=>{if(d){let{data:f,executable:p,lamports:h,owner:w,rentEpoch:b}=d;return f.length!==2&&f[1]!=="base64"&&Dt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:p,lamports:h,owner:new Hr(w),rentEpoch:b}}return null})))}else try{a=await Promise.all(s.map(u=>r.getMultipleAccountsInfo(u,i)))}catch(u){u instanceof Error&&Dt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function qt(r,e,t){let n=await Ke(r,e.map(i=>i.pubkey),t);return e.map((i,o)=>({...i,accountInfo:n[o]}))}import Ee from"bn.js";import ei from"big.js";import Bt from"bn.js";import zr from"toformat";var jr=zr,nt=jr;import kt from"big.js";import Qr from"bn.js";import Yr from"decimal.js-light";import rt from"bn.js";var Bn=9007199254740991;function ge(r){let e=pe("Raydium_parseBigNumberish");if(r instanceof rt)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new rt(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=Bn||r<=-Bn)&&e.logWithError(`BigNumberish number overflow: ${r}`),new rt(String(r))):typeof r=="bigint"?new rt(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new rt(0))}var Pt=pe("module/fraction"),Vt=nt(kt),it=nt(Yr),Jr={[0]:it.ROUND_DOWN,[1]:it.ROUND_HALF_UP,[2]:it.ROUND_UP},$r={[0]:kt.roundDown,[1]:kt.roundHalfUp,[2]:kt.roundUp},O=class{numerator;denominator;constructor(e,t=new Qr(1)){this.numerator=ge(e),this.denominator=ge(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new O(this.denominator,this.numerator)}add(e){let t=e instanceof O?e:new O(ge(e));return this.denominator.eq(t.denominator)?new O(this.numerator.add(t.numerator),this.denominator):new O(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof O?e:new O(ge(e));return this.denominator.eq(t.denominator)?new O(this.numerator.sub(t.numerator),this.denominator):new O(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof O?e:new O(ge(e));return new O(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof O?e:new O(ge(e));return new O(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Pt.logWithError(`${e} is not an integer.`),e<=0&&Pt.logWithError(`${e} is not positive.`),it.set({precision:e+1,rounding:Jr[n]});let i=new it(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Pt.logWithError(`${e} is not an integer.`),e<0&&Pt.logWithError(`${e} is negative.`),Vt.DP=e,Vt.RM=$r[n]||1,new Vt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var ti=pe("Raydium_amount"),In=nt(ei);function ni(r,e){let t="0",n="0";if(r.includes(".")){let i=r.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):ti.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var ae=class extends O{token;logger;constructor(e,t,n=!0,i){let o=new Bt(0),s=Ut.pow(new Bt(e.decimals));if(n)o=ge(t);else{let a=new Bt(0),u=new Bt(0);if(typeof t=="string"||typeof t=="number"||typeof t=="bigint"){let[c,m]=ni(t.toString(),e.decimals);a=ge(c),u=ge(m)}a=a.mul(s),o=a.add(u)}super(o,s),this.logger=pe(i||"TokenAmount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new ae(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new ae(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,t,n=0){return super.toSignificant(e,t,n)}toFixed(e=this.token.decimals,t,n=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,t,n)}toExact(e={groupSeparator:""}){return In.DP=this.token.decimals,new In(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};import{PublicKey as ri}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Nn}from"@solana/spl-token";var Sn={chainId:101,address:ri.default.toBase58(),programId:Nn.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},We={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Nn.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Ht}from"@solana/web3.js";import{PublicKey as U,SystemProgram as Cn,SYSVAR_RENT_PUBKEY as ii}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as oi}from"@solana/spl-token";function Wt({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var Uo=[Wt({pubkey:oi,isWritable:!1}),Wt({pubkey:Cn.programId,isWritable:!1}),Wt({pubkey:ii,isWritable:!1})];function Xt({publicKey:r,transformSol:e}){let t=Ln(r.toString());if(t instanceof U)return e&&t.equals(ot)?Gt:t;if(e&&t.toString()===ot.toBase58())return Gt;if(typeof t=="string"){if(t===U.default.toBase58())return U.default;try{return new U(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Ln(r){try{return new U(r)}catch{return r}}var Wo=new U("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Xo=new U("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ho=new U("SysvarRent111111111111111111111111111111111"),zo=new U("SysvarC1ock11111111111111111111111111111111"),si=new U("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),jo=new U("Sysvar1nstructions1111111111111111111111111"),Zo=Cn.programId,Qo=new U("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Yo=new U("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Jo=new U("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),$o=new U("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),es=new U("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ts=new U("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ns=new U("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),rs=new U("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),is=new U("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),os=new U("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ss=new U("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Gt=new U("So11111111111111111111111111111111111111112"),ot=U.default;function At(r){return Xt({publicKey:r,transformSol:!0})}var zt=class{symbol;name;decimals;isToken2022;mint;constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===ot.toBase58()||e instanceof Ht&&ot.equals(e)){this.decimals=We.decimals,this.symbol=We.symbol,this.name=We.name,this.mint=new Ht(We.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?Ht.default:Xt({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Le=zt;dt(Le,"WSOL",new zt({...We,mint:We.address}));var jt=class{symbol;name;decimals;constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},It=jt;dt(It,"SOL",new jt(Sn));import ai from"bn.js";var En=new O(new ai(100)),qe=class extends O{toSignificant(e=5,t,n){return this.mul(En).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(En).toFixed(e,t,n)}};var ui=pe("Raydium_price"),Pe=class extends O{baseToken;quoteToken;scalar;constructor(e){let{baseToken:t,quoteToken:n,numerator:i,denominator:o}=e;super(i,o),this.baseToken=t,this.quoteToken=n,this.scalar=new O(Zt(t.decimals),Zt(n.decimals))}get raw(){return new O(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Pe({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&ui.logWithError("mul token not equals");let t=super.mul(e);return new Pe({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:t.denominator,numerator:t.numerator})}toSignificant(e=this.quoteToken.decimals,t,n){return this.adjusted.toSignificant(e,t,n)}toFixed(e=this.quoteToken.decimals,t,n){return this.adjusted.toFixed(e,t,n)}};import{PublicKey as Ds}from"@solana/web3.js";import qs from"bn.js";var ci=new Ee(0),ia=new Ee(1),oa=new Ee(2),sa=new Ee(3),aa=new Ee(5),Ut=new Ee(10),ua=new Ee(100),ca=new Ee(1e3),ma=new Ee(1e4);function Zt(r){return Ut.pow(ge(r))}function Kt(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Fa}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as va}from"@solana/spl-token";import{ComputeBudgetProgram as wa,Keypair as xa,PublicKey as li,Transaction as Pa,TransactionMessage as Ba,VersionedTransaction as Ia}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as La}from"@solana/spl-token";var Ea=pe("Raydium_txUtil");function st(r,e){let[t,n]=li.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}import{PublicKey as B}from"@solana/web3.js";var qa=new B("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Ga=new B("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Va=new B("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ua=new B("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Wa=new B("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Xa=new B("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Ha=new B("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),za=new B("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ja=new B("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Za=new B("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Qa=new B("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Ya=new B("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ja=new B("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),$a=new B("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),eu=new B("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),tu=new B("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),nu=new B("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ru=new B("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),iu=new B("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ou=new B("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),su=new B("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),au=new B("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),di=new B("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),fi=new B("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),pi=new B("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),uu=new B("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),gi=new B("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),cu=new B("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),hi=new B("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),mu=new B("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),lu=new B("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),bi=new B("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),wi=new B("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var du={SERUM_MARKET:B.default,OPENBOOK_MARKET:new B("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:B.default,FarmV3:new B("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new B("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new B("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new B("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new B("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new B("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new B("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new B("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new B("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:di,CREATE_CPMM_POOL_AUTH:fi,CREATE_CPMM_POOL_FEE_ACC:pi,FEE_DESTINATION_ID:new B("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:gi,LCOK_CPMM_AUTH:hi,LAUNCHPAD_PROGRAM:bi,LAUNCHPAD_AUTH:wi};import{PublicKey as yi,AddressLookupTableAccount as Rn}from"@solana/web3.js";var Ti={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Rn({key:new yi("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Rn.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as Cu,sendAndConfirmTransaction as Lu,SystemProgram as Mu,Transaction as Fu,TransactionMessage as vu,VersionedTransaction as Ou}from"@solana/web3.js";import Ku from"axios";import xi from"bn.js";var Hu=new xi(1e6);function Mn(r){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,r,!1),new Uint8Array(e)}function Qt(r,e){let t=0;for(let n=r-1;n>=0&&!e.testn(n);n--)t++;return t}function Yt(r,e){let t=0;for(let n=0;n<r&&!e.testn(n);n++)t++;return t}function at(r,e){for(let t=0;t<r;t++)if(e.testn(t))return!1;return!0}function Fn(r,e){return at(r,e)?null:Qt(r,e)}function _n(r,e){return at(r,e)?null:Yt(r,e)}var bc=Buffer.from("amm_config","utf8"),wc=Buffer.from("pool","utf8"),yc=Buffer.from("pool_vault","utf8"),Tc=Buffer.from("pool_reward_vault","utf8"),Ai=Buffer.from("position","utf8"),Pi=Buffer.from("tick_array","utf8"),xc=Buffer.from("operation","utf8"),ki=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Ac=Buffer.from("observation","utf8");function ce(r,e,t){return st([Pi,e.toBuffer(),Mn(t)],r)}function vn(r,e){return st([Ai,e.toBuffer()],r)}function Nt(r,e){return st([ki,e.toBuffer()],r)}var Pc=Buffer.from("locked_position","utf8");var kc=Buffer.from("support_mint","utf8");import{PublicKey as be}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as jn}from"@solana/spl-token";import V from"bn.js";import{PublicKey as Mi}from"@solana/web3.js";import qn,{isBN as Gn}from"bn.js";import{bits as Nc,BitStructure as Sc,blob as Bi,Blob as Cc,cstr as Lc,f32 as Ec,f32be as Rc,f64 as Mc,f64be as Fc,greedy as _c,Layout as Ii,ns64 as vc,ns64be as Oc,nu64 as Dc,nu64be as Kc,offset as qc,s16 as Gc,s16be as Vc,s24 as Uc,s24be as Wc,s32 as Ni,s32be as Xc,s40 as Hc,s40be as zc,s48 as jc,s48be as Zc,s8 as Qc,seq as Si,struct as Yc,Structure as Ci,u16 as Li,u16be as Jc,u24 as $c,u24be as em,u32 as tm,u32be as nm,u40 as rm,u40be as im,u48 as om,u48be as sm,u8 as Ei,UInt as Ri,union as am,Union as um,unionLayoutDiscriminator as cm,utf8 as mm}from"@solana/buffer-layout";var Jt=Ii,On=Ci;var $t=Ri;var Dn=Ei,ut=Li;var Ge=Ni;var Kn=Si;var he=Bi;var Qe=class extends Jt{blob;signed;constructor(e,t,n){super(e,n),this.blob=he(e),this.signed=t}decode(e,t=0){let n=new qn(this.blob.decode(e,t),10,"le");return this.signed?n.fromTwos(this.span*8).clone():n}encode(e,t,n=0){return typeof e=="number"&&(e=new qn(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),t,n)}};function de(r){return new $t(1,r)}function Ye(r){return new $t(4,r)}function R(r){return new Qe(8,!1,r)}function z(r){return new Qe(16,!1,r)}function Vn(r){return new Qe(8,!0,r)}function Un(r){return new Qe(16,!0,r)}var St=class extends Jt{layout;decoder;encoder;constructor(e,t,n,i){super(e.span,i),this.layout=e,this.decoder=t,this.encoder=n}decode(e,t){return this.decoder(this.layout.decode(e,t))}encode(e,t,n){return this.layout.encode(this.encoder(e),t,n)}getSpan(e,t){return this.layout.getSpan(e,t)}};function K(r){return new St(he(32),e=>new Mi(e),e=>e.toBuffer(),r)}function Wn(r){return new St(Dn(),Fi,_i,r)}function Fi(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function _i(r){return r?1:0}var en=class extends On{decode(e,t){return super.decode(e,t)}};function me(r,e,t){return new en(r,e,t)}function W(r,e,t){let n,i=typeof e=="number"?e:Gn(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Gn(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Kn(r,i,t)}import Oi from"bn.js";var vi=15,M=class{static async getTickArrays(e,t,n,i,o,s,a){let u=[],c=I.getTickArrayStartIndexByTick(i,o),m=I.getInitializedTickArrayInRange(s,a,o,c,Math.floor(vi/2));for(let f=0;f<m.length;f++){let{publicKey:p}=ce(t,n,m[f]);u.push(p)}let l=(await Ke(e,u)).map(f=>f!==null?ct.decode(f.data):null),d={};for(let f=0;f<u.length;f++){let p=l[f];p!==null&&(d[p.startTickIndex]={...p,address:u[f]})}return d}static nextInitializedTick(e,t,n,i,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,i,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=I.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let m=n[c];if(m===void 0)continue;let{nextTick:l,tickArrayAddress:d,tickArrayStartTickIndex:f}=this.firstInitializedTickInOneArray(e,t,m,s);[a,u,c]=[l,d,f]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,i,o){let s=Math.floor(e/M.tickCount(t)),a=n?I.searchLowBitFromStart(i,o,s-1,1,t):I.searchHightBitFromStart(i,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let o;if(i){let a=te-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<te;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=ce(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,o,s){let a=I.getTickArrayStartIndexByTick(i,o),u=Math.floor((i-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let m;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){m=d;break}u=u-1}else for(u=u+1;u<te;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){m=d;break}u=u+1}let{publicKey:l}=ce(e,t,a);return{initializedTick:m,tickArrayAddress:l,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(I.checkIsOutOfBoundary(e)){if(e>ue)return!1;let n=I.getTickArrayStartIndexByTick(se,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return te*e}};var te=60,He=512,I=class{static getTickArrayAddressByTick(e,t,n,i){let o=I.getTickArrayStartIndexByTick(n,i),{publicKey:s}=ce(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=I.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=te)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=M.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*M.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*te,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*te,o=Math.floor(t/i)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*te:e+t*te}static mergeTickArrayBitmap(e){let t=new Oi(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,o){let s=Math.floor(i/(n*te));return[...I.searchLowBitFromStart(e,t,s-1,o,n),...I.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return I.searchHightBitFromStart(e,t,-7680,He,n)}static getAllInitializedTickArrayInfo(e,t,n,i,o){let s=[],a=I.getAllInitializedTickArrayStartIndex(n,i,o);for(let u of a){let{publicKey:c}=ce(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>I.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),m=(n+7680)%512;if(s[c].testn(m)&&a.push(n),n--,a.length===i)break}let u=M.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>I.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),m=(n+7680)%512;if(s[c].testn(m)&&a.push(n),n++,a.length===i)break}let u=M.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<se||e>ue}static nextInitTick(e,t,n,i,o){if(M.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(i)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<te;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=te-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<te;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=N.getSqrtPriceX64FromTick(t),o=N.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new T(1).div(o),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new T(1).div(t),o=Xe.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=N.getSqrtPriceX64FromTick(o),a=N.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new T(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=N.getSqrtPriceX64FromTick(t),o=N.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new T(1).div(o),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new T(1).div(t),o=Xe.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=N.getSqrtPriceX64FromTick(o),a=N.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new T(1).div(a)}}};var tn=14,Re=class{static maxTickInTickarrayBitmap(e){return e*te*He}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let o=n*i;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!M.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=i?t-M.tickCount(n):t+M.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*te,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(i){let m=e.shln(1024-c-1),l=Fn(1024,m);if(l!==null){let d=(c-l-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let m=e.shrn(c),l=_n(1024,m);if(l!==null){let d=(c+l-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-M.tickCount(n)}}}},mt=class{static getBitmapOffset(e,t){if(!M.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=Re.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=Re.maxTickInTickarrayBitmap(e),n=-t;if(ue<=t)throw Error(`extensionTickBoundary check error: ${ue}, ${t}`);if(n<=se)throw Error(`extensionTickBoundary check error: ${n}, ${se}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:I.mergeTickArrayBitmap(i).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let o=M.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,i);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:o,maxValue:s}=Re.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(i){let u=I.mergeTickArrayBitmap(e).shln(He-1-a),c=at(512,u)?null:Qt(512,u);if(c!==null){let m=t-c*M.tickCount(n);return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:o}}else{let u=I.mergeTickArrayBitmap(e).shrn(a),c=at(512,u)?null:Yt(512,u);if(c!==null){let m=t+c*M.tickCount(n);return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:s-M.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%Re.maxTickInTickarrayBitmap(t),i=Math.floor(n/M.tickCount(t));return e<0&&n!=0&&(i=He-i),i}};var Hm=me([he(8),de("bump"),ut("index"),K(""),Ye("protocolFeeRate"),Ye("tradeFeeRate"),ut("tickSpacing"),W(R(),8,"")]),Di=me([Ye("blockTimestamp"),Vn("tickCumulative"),W(R(),4)]),zm=me([he(8),Wn("initialized"),R("recentEpoch"),ut("observationIndex"),K("poolId"),W(Di,100,"observations"),W(R(),4)]),Ki=me([de("rewardState"),R("openTime"),R("endTime"),R("lastUpdateTime"),z("emissionsPerSecondX64"),R("rewardTotalEmissioned"),R("rewardClaimed"),K("tokenMint"),K("tokenVault"),K("creator"),z("rewardGrowthGlobalX64")]),Xn=me([he(8),de("bump"),K("ammConfig"),K("creator"),K("mintA"),K("mintB"),K("vaultA"),K("vaultB"),K("observationId"),de("mintDecimalsA"),de("mintDecimalsB"),ut("tickSpacing"),z("liquidity"),z("sqrtPriceX64"),Ge("tickCurrent"),Ye(),z("feeGrowthGlobalX64A"),z("feeGrowthGlobalX64B"),R("protocolFeesTokenA"),R("protocolFeesTokenB"),z("swapInAmountTokenA"),z("swapOutAmountTokenB"),z("swapInAmountTokenB"),z("swapOutAmountTokenA"),de("status"),W(de(),7,""),W(Ki,3,"rewardInfos"),W(R(),16,"tickArrayBitmap"),R("totalFeesTokenA"),R("totalFeesClaimedTokenA"),R("totalFeesTokenB"),R("totalFeesClaimedTokenB"),R("fundFeesTokenA"),R("fundFeesTokenB"),R("startTime"),W(R(),15*4-3,"padding")]),qi=me([z("growthInsideLastX64"),R("rewardAmountOwed")]),Hn=me([he(8),de("bump"),K("nftMint"),K("poolId"),Ge("tickLower"),Ge("tickUpper"),z("liquidity"),z("feeGrowthInsideLastX64A"),z("feeGrowthInsideLastX64B"),R("tokenFeesOwedA"),R("tokenFeesOwedB"),W(qi,3,"rewardInfos"),W(R(),8,"")]),jm=me([he(8),de("bump"),K("poolId"),Ge("tickLowerIndex"),Ge("tickUpperIndex"),z("liquidity"),z("feeGrowthInsideLastX64A"),z("feeGrowthInsideLastX64B"),R("tokenFeesOwedA"),R("tokenFeesOwedB"),W(z(),3,"rewardGrowthInside"),W(R(),8,"")]),Gi=me([Ge("tick"),Un("liquidityNet"),z("liquidityGross"),z("feeGrowthOutsideX64A"),z("feeGrowthOutsideX64B"),W(z(),3,"rewardGrowthsOutsideX64"),W(Ye(),13,"")]),ct=me([he(8),K("poolId"),Ge("startTickIndex"),W(Gi,te,"ticks"),de("initializedTickCount"),W(de(),115,"")]),Zm=me([he(329),W(K(),100,"whitelistMints")]),zn=me([he(8),K("poolId"),W(W(R(),8),tn,"positiveTickArrayBitmap"),W(W(R(),8),tn,"negativeTickArrayBitmap")]),Qm=me([R(),de("bump"),K("owner"),K("poolId"),K("positionId"),K("nftAccount"),W(R(),8)]),Ym=me([he(8),de("bump"),K("lockOwner"),K("poolId"),K("positionId"),K("nftAccount"),K("lockNftMint"),R("recentEpoch"),W(R(),8)]);import Ne from"bn.js";var lt=class{static getfeeGrowthInside(e,t,n){let i=new Ne(0),o=new Ne(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Ne(0),a=new Ne(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=S.wrappingSubU128(S.wrappingSubU128(e.feeGrowthGlobalX64A,i),s),c=S.wrappingSubU128(S.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=S.mulDivFloor(S.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,fe),u=t.tokenFeesOwedA.add(a),c=S.mulDivFloor(S.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,fe),m=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:m}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=S.mulDivFloor(S.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,fe),u=t.tokenFeesOwedA.add(a),c=S.mulDivFloor(S.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,fe),m=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:m}}static GetPositionRewardsV2(e,t,n,i){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],m=S.wrappingSubU128(u,c.growthInsideLastX64),l=S.mulDivFloor(m,t.liquidity,fe),d=c.rewardAmountOwed.add(l);o.push(d)}return o}static GetPositionRewards(e,t,n,i){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],m=S.wrappingSubU128(u,c.growthInsideLastX64),l=S.mulDivFloor(m,t.liquidity,fe),d=c.rewardAmountOwed.add(l);o.push(d)}return o}static getRewardGrowthInside(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new Ne(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Ne(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(S.wrappingSubU128(S.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new Ne(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Ne(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(S.wrappingSubU128(S.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:o,epochInfo:s}){let a=N.priceToSqrtPriceX64(new T(e.price),e.mintA.decimals,e.mintB.decimals),u=N.getSqrtPriceX64FromTick(t.tickLower),c=N.getSqrtPriceX64FromTick(t.tickUpper),m=o?1+i:1-i,l=_.getAmountsFromLiquidity(a,u,c,n,o),[d,f]=[Z(l.amountA,e.mintA.extensions?.feeConfig,s,!0),Z(l.amountB,e.mintB.extensions?.feeConfig,s,!0)],[p,h]=[Z(new Ne(new T(l.amountA.toString()).mul(m).toFixed(0)),e.mintA.extensions?.feeConfig,s,!0),Z(new Ne(new T(l.amountB.toString()).mul(m).toFixed(0)),e.mintB.extensions?.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:f,amountSlippageA:p,amountSlippageB:h,expirationTime:De(d.expirationTime,f.expirationTime)}}};var ke=class{static getOutputAmountAndRemainAccounts(e,t,n,i,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:m,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,a);if(!c||m===void 0||!l)throw new Error("Invalid tick array");u.push(l);let{allTrade:d,amountCalculated:f,accounts:p,sqrtPriceX64:h,feeAmount:w}=ze.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,m,o,s);return u.push(...p),{allTrade:d,expectedAmountOut:f.mul(Ce),remainingAccounts:u,executionPrice:h,feeAmount:w}}static getInputAmountAndRemainAccounts(e,t,n,i,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!m)throw new Error("Invalid tick array");try{let h=this.preInitializedTickArrayStartIndex(e,s);if(h.isExist){let{publicKey:w}=ce(e.programId,e.id,h.nextStartIndex);a.push(w)}}catch{}a.push(m);let{amountCalculated:l,accounts:d,sqrtPriceX64:f,feeAmount:p}=ze.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(Ce),c,o);return a.push(...d),{expectedAmountIn:l,remainingAccounts:a,executionPrice:f,feeAmount:p}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=ke.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?mt.checkTickArrayIsInit(M.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):I.checkTickArrayIsInitialized(I.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=ce(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,M.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=ce(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/M.tickCount(e.tickSpacing)),i=t?I.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):I.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=M.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:o}=Re.nextInitializedTickArrayStartIndex(I.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=mt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<se||t>ue)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:o}){let s=[];for(let a=0;a<o.length;a++){let u=o[a],c=t.rewardDefaultInfos[a]?.mint.programId??(await e.getAccountInfo(u.tokenMint))?.owner;if(c===void 0)throw Error("get new reward mint info error");let m={...u,perSecond:S.x64ToDecimal(u.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new be(c)};if(m.tokenMint.equals(be.default))continue;if(n<=m.openTime.toNumber()||i.eq(Q)){s.push(m);continue}let l=new V(Math.min(m.endTime.toNumber(),n)),d=l.sub(m.lastUpdateTime),f=S.mulDivFloor(d,m.emissionsPerSecondX64,i),p=m.rewardGrowthGlobalX64.add(f),h=S.mulDivFloor(d,m.emissionsPerSecondX64,fe),w=m.rewardTotalEmissioned.add(h);s.push({...m,rewardGrowthGlobalX64:p,rewardTotalEmissioned:w,lastUpdateTime:l})}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let o of t){let s=I.getTickArrayStartIndexByTick(o,e);if(s>=n||s<i)return!0}return!1}static tickRange(e){let t=Re.maxTickInTickarrayBitmap(e),n=-t;return t>ue&&(t=M.getArrayStartIndex(ue,e)+M.tickCount(e)),n<se&&(n=M.getArrayStartIndex(se,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!M.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/M.tickCount(t)*He}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await qt(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of i)s.accountInfo!==null&&(o[s.pubkey.toString()]=zn.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},o=[];for(let u of t){let c=I.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),m=I.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let l of m){let{publicKey:d}=ce(u.programId,u.id,l);o.push({pubkey:d}),i[d.toString()]=u.id}}let s=await qt(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=i[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let m=ct.decode(u.accountInfo.data);a[c.toString()][m.startTickIndex]={...m,address:u.pubkey}}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:o=!0}){let s=[];for(let a=0;a<e.length;a++){let u=e[a];u!==null&&(s.find(c=>c.equals(u.state.programId))||s.push(u.state.programId))}if(n){let a=n.tokenAccounts.map(l=>l.accountInfo.mint),u=[];for(let l of a)for(let d of s)u.push(vn(d,l).publicKey);let c=await Ke(t,u,{batchRequest:i}),m={};for(let l of c){if(l===null)continue;let d=Hn.decode(l.data),f=d.poolId.toString(),p=e.find(X=>X.state.id.toBase58()===f);if(p===void 0)continue;let h=p.state,w=I._getTickPriceLegacy({poolInfo:h,tick:d.tickLower,baseIn:!0}),b=I._getTickPriceLegacy({poolInfo:h,tick:d.tickUpper,baseIn:!0}),{amountA:F,amountB:P}=_.getAmountsFromLiquidity(h.sqrtPriceX64,w.tickSqrtPriceX64,b.tickSqrtPriceX64,d.liquidity,!1),v=1/(1-Math.sqrt(Math.sqrt(w.price.div(b.price).toNumber())));p.positionAccount=[...p.positionAccount??[],{poolId:d.poolId,nftMint:d.nftMint,priceLower:w.price,priceUpper:b.price,amountA:F,amountB:P,tickLower:d.tickLower,tickUpper:d.tickUpper,liquidity:d.liquidity,feeGrowthInsideLastX64A:d.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:d.feeGrowthInsideLastX64B,tokenFeesOwedA:d.tokenFeesOwedA,tokenFeesOwedB:d.tokenFeesOwedB,rewardInfos:d.rewardInfos.map(X=>({...X,pendingReward:new V(0)})),leverage:v,tokenFeeAmountA:new V(0),tokenFeeAmountB:new V(0)}];let j=await I.getTickArrayAddressByTick(p.state.programId,d.poolId,d.tickLower,p.state.tickSpacing),y=await I.getTickArrayAddressByTick(p.state.programId,d.poolId,d.tickUpper,p.state.tickSpacing);m[`${p.state.programId.toString()}-${d.poolId.toString()}-${d.tickLower}`]=j,m[`${p.state.programId.toString()}-${d.poolId.toString()}-${d.tickUpper}`]=y}if(o){let l=Object.values(m),d=await Ke(t,l,{batchRequest:i}),f={};for(let p=0;p<l.length;p++){let h=d[p];if(h===null)continue;let w=l[p].toString();f[w]=ct.decode(h.data)}for(let{state:p,positionAccount:h}of e)if(!!h)for(let w of h){let b=`${p.programId.toString()}-${p.id.toString()}-${w.tickLower}`,F=`${p.programId.toString()}-${p.id.toString()}-${w.tickUpper}`,P=f[m[b].toString()],v=f[m[F].toString()],j=P.ticks[I.getTickOffsetInArray(w.tickLower,p.tickSpacing)],y=v.ticks[I.getTickOffsetInArray(w.tickUpper,p.tickSpacing)],{tokenFeeAmountA:X,tokenFeeAmountB:H}=await lt.GetPositionFees(p,w,j,y),Y=await lt.GetPositionRewards(p,w,j,y);w.tokenFeeAmountA=X.gte(new V(0))?X:new V(0),w.tokenFeeAmountB=H.gte(new V(0))?H:new V(0);for(let J=0;J<Y.length;J++)w.rewardInfos[J].pendingReward=Y[J].gte(new V(0))?Y[J]:new V(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountIn:o,slippage:s,priceLimit:a=new T(0),catchLiquidityInsufficient:u=!1}){let c,m=n.toBase58()===e.mintA.address,[l,d]=m?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new T(0))?c=m?Ve.add(new V(1)):Ue.sub(new V(1)):c=N.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let f=Z(o,l,i,!1),{allTrade:p,expectedAmountOut:h,remainingAccounts:w,executionPrice:b,feeAmount:F}=ke.getOutputAmountAndRemainAccounts(e,t,n,f.amount.sub(f.fee??Q),c,u),P=Z(h,d,i,!1),v=N.sqrtPriceX64ToPrice(b,e.mintA.decimals,e.mintB.decimals),j=m?v:new T(1).div(v),y=h.mul(new V(Math.floor((1-s)*1e10))).div(new V(1e10)),X=Z(y,d,i,!1),H=m?e.currentPrice:new T(1).div(e.currentPrice),Y=new T(j).sub(H).abs(),J=H,D=new qe(new T(Y).mul(10**15).toFixed(0),new T(J).mul(10**15).toFixed(0));return{allTrade:p,realAmountIn:f,amountOut:P,minAmountOut:X,expirationTime:De(f.expirationTime,P.expirationTime),currentPrice:e.currentPrice,executionPrice:j,priceImpact:D,fee:F,remainingAccounts:w,executionPriceX64:b}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:i,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=i.address===e.mintB.address,[c,m]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[l,d]=[new Le({...c,mint:c.address,isToken2022:c.programId===jn.toBase58()}),new Le({...m,mint:m.address,isToken2022:m.programId===jn.toBase58()})],{allTrade:f,realAmountIn:p,amountOut:h,minAmountOut:w,expirationTime:b,currentPrice:F,executionPrice:P,priceImpact:v,fee:j,remainingAccounts:y,executionPriceX64:X}=ke.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new be(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),H={...p,amount:new ae(l,p.amount),fee:p.fee===void 0?void 0:new ae(l,p.fee)},Y={...h,amount:new ae(d,h.amount),fee:h.fee===void 0?void 0:new ae(d,h.fee)},J={...w,amount:new ae(d,w.amount),fee:w.fee===void 0?void 0:new ae(d,w.fee)},D=new Pe({baseToken:l,denominator:new V(10).pow(new V(20+l.decimals)),quoteToken:d,numerator:F.mul(new T(10**(20+d.decimals))).toFixed(0)}),ye=new Pe({baseToken:l,denominator:new V(10).pow(new V(20+l.decimals)),quoteToken:d,numerator:P.mul(new T(10**(20+d.decimals))).toFixed(0)}),ie=new ae(l,j);return{allTrade:f,realAmountIn:H,amountOut:Y,minAmountOut:J,expirationTime:b,currentPrice:D,executionPrice:ye,priceImpact:v,fee:ie,remainingAccounts:y,executionPriceX64:X}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountOut:o,slippage:s,priceLimit:a=new T(0)}){let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},m;a.equals(new T(0))?m=u?Ue.sub(new V(1)):Ve.add(new V(1)):m=N.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let l=Z(o,c[n.toString()],i,!0),{expectedAmountIn:d,remainingAccounts:f,executionPrice:p,feeAmount:h}=ke.getInputAmountAndRemainAccounts(e,t,n,l.amount.sub(l.fee??Q),m),w=u?e.mintB.address:e.mintA.address,b=Z(d,c[w],i,!1),F=N.sqrtPriceX64ToPrice(p,e.mintA.decimals,e.mintB.decimals),P=u?F:new T(1).div(F),v=d.mul(new V(Math.floor((1+s)*1e10))).div(new V(1e10)),j=Z(v,c[w],i,!0),y=u?e.currentPrice:new T(1).div(e.currentPrice),X=new T(P).sub(y).abs(),H=y,Y=new qe(new T(X).mul(10**15).toFixed(0),new T(H).mul(10**15).toFixed(0));return{amountIn:b,maxAmountIn:j,realAmountOut:l,expirationTime:De(b.expirationTime,l.expirationTime),currentPrice:e.currentPrice,executionPrice:P,priceImpact:Y,fee:h,remainingAccounts:f}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){let o=e[t],s=I.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=I.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),m=Math.min(a,o.priceMax)-u,l=a-s,d=o.priceMax-o.priceMin,f;return m<=0?f=0:l===m?f=d/m:d===m?f=m/l:f=m/d*(m/l),{feeApr:o.feeApr*f,rewardsApr:[(o.rewardApr[0]??0)*f,(o.rewardApr[1]??0)*f,(o.rewardApr[2]??0)*f],apr:o.apr*f}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,m=e[n],l=i[At(e.mintA.address).toString()],d=i[At(e.mintB.address).toString()],f=e.mintA.decimals,p=e.mintB.decimals;if(!m||!l||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let h=N.priceToSqrtPriceX64(new T(e.price),e.mintA.decimals,e.mintB.decimals),w=N.getSqrtPriceX64FromTick(s),b=N.getSqrtPriceX64FromTick(a),{amountSlippageA:F,amountSlippageB:P}=_.getAmountsFromLiquidityWithSlippage(h,w,b,t,!1,!1,0),{amountSlippageA:v,amountSlippageB:j}=_.getAmountsFromLiquidityWithSlippage(h,w,b,o,!1,!1,0),y=new T(F.toString()).div(new T(10).pow(f)).mul(l.value).add(new T(P.toString()).div(new T(10).pow(p)).mul(d.value)),X=new T(v.toString()).div(new T(10).pow(f)).mul(l.value).add(new T(j.toString()).div(new T(10).pow(p)).mul(d.value)),H=new T(1).div(y.add(X)),J=new T(m.volumeFee).mul(365).div(c).mul(H).mul(100).toNumber(),D=3600*24*365,ye=e.rewardDefaultInfos.map(ie=>{let Me=ie.mint.decimals,$=i[ie.mint.address];return u<(ie.startTime??0)||u>(ie.endTime??0)||!ie.perSecond||!$||Me===void 0?0:new T($.value).mul(new T(ie.perSecond).mul(D)).div(new T(10).pow(Me)).mul(H).mul(100).toNumber()});return{feeApr:J,rewardsApr:ye,apr:J+ye.reduce((ie,Me)=>ie+Me,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){let m=N.priceToSqrtPriceX64(new T(e.price),e.mintA.decimals,e.mintB.decimals),l=N.getSqrtPriceX64FromTick(n),d=N.getSqrtPriceX64FromTick(i),f=Z(o,e[t?"mintA":"mintB"].extensions?.feeConfig,u,!c),p=new V(new T(f.amount.sub(f.fee??Q).toString()).toFixed(0)),h;if(m.lte(l))h=t?_.getLiquidityFromTokenAmountA(l,d,p,!a):new V(0);else if(m.lte(d)){let b=_.getLiquidityFromTokenAmountA(m,d,p,!a),F=_.getLiquidityFromTokenAmountB(l,m,p);h=t?b:F}else h=t?new V(0):_.getLiquidityFromTokenAmountB(l,d,p);let w=await ke.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:i,liquidity:h,slippage:s,add:a});return{liquidity:h,amountA:t?f:w.amountA,amountB:t?w.amountB:f,amountSlippageA:t?f:w.amountSlippageA,amountSlippageB:t?w.amountSlippageB:f,expirationTime:w.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:o,slippage:s,add:a}){let u=N.getSqrtPriceX64FromTick(n),c=N.getSqrtPriceX64FromTick(i),m=a?1+s:1-s,l=_.getAmountsFromLiquidity(N.priceToSqrtPriceX64(new T(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,f]=[Z(l.amountA,t.mintA.extensions?.feeConfig,e,!0),Z(l.amountB,t.mintB.extensions?.feeConfig,e,!0)],[p,h]=[Z(l.amountA.muln(m),t.mintA.extensions?.feeConfig,e,!0),Z(l.amountB.muln(m),t.mintB.extensions?.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:f,amountSlippageA:p,amountSlippageB:h,expirationTime:De(d.expirationTime,f.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let i=t.filter(u=>!n[u.id]).map(u=>new be(u.id));(await Ke(e,i)).forEach((u,c)=>{!u||(n[i[c].toBase58()]=Xn.decode(u.data))});let s=t.map(u=>Nt(new be(u.programId),new be(u.id)).publicKey),a=await ke.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>({...u,[c.id]:{...n[c.id],id:new be(c.id),version:6,programId:new be(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:{...c.config,id:new be(c.config.id),fundOwner:""},currentPrice:new T(c.price),exBitmapAccount:Nt(new be(c.programId),new be(c.id)).publicKey,exBitmapInfo:a[Nt(new be(c.programId),new be(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber(),rewardInfos:n[c.id].rewardInfos}}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var S=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),o=i.div(n);return i.mod(n).eq(Q)||(o=o.add(Ie)),o}static mulDivFloor(e,t,n){if(n.eq(Q))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(Q))throw new Error("division by 0");return e.mul(t).add(n.sub(Ie)).div(n)}static x64ToDecimal(e,t){return new T(e.toString()).div(T.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new C(e.mul(T.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Tt).sub(t).mod(Tt)}};function ne(r,e){return nn(r.mul(e),64,256)}function Vi(r,e,t){let n=r.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function nn(r,e,t){let n=r.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var N=class{static sqrtPriceX64ToPrice(e,t,n){return S.x64ToDecimal(e).pow(2).mul(T.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return S.decimalToX64(e.mul(T.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(Q))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(Q))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(Q))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(Q))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(Q))return e;let o=t.shln(tt);if(i){let s=o,a=o.add(n.mul(e));return a.gte(s)?S.mulDivCeil(s,e,a):S.mulDivRoundingUp(s,Ie,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return S.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let o=n.shln(tt);if(i)return e.add(o.div(t));{let s=S.mulDivRoundingUp(o,Ie,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<se||e>ue)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new C("18445821805675395072"):new C("18446744073709551616");return(t&2)!=0&&(n=ne(n,new C("18444899583751176192"))),(t&4)!=0&&(n=ne(n,new C("18443055278223355904"))),(t&8)!=0&&(n=ne(n,new C("18439367220385607680"))),(t&16)!=0&&(n=ne(n,new C("18431993317065453568"))),(t&32)!=0&&(n=ne(n,new C("18417254355718170624"))),(t&64)!=0&&(n=ne(n,new C("18387811781193609216"))),(t&128)!=0&&(n=ne(n,new C("18329067761203558400"))),(t&256)!=0&&(n=ne(n,new C("18212142134806163456"))),(t&512)!=0&&(n=ne(n,new C("17980523815641700352"))),(t&1024)!=0&&(n=ne(n,new C("17526086738831433728"))),(t&2048)!=0&&(n=ne(n,new C("16651378430235570176"))),(t&4096)!=0&&(n=ne(n,new C("15030750278694412288"))),(t&8192)!=0&&(n=ne(n,new C("12247334978884435968"))),(t&16384)!=0&&(n=ne(n,new C("8131365268886854656"))),(t&32768)!=0&&(n=ne(n,new C("3584323654725218816"))),(t&65536)!=0&&(n=ne(n,new C("696457651848324352"))),(t&131072)!=0&&(n=ne(n,new C("26294789957507116"))),(t&262144)!=0&&(n=ne(n,new C("37481735321082"))),e>0&&(n=wn.div(n)),n}static getTickFromPrice(e,t,n){return N.getTickFromSqrtPriceX64(N.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Ue)||e.lt(Ve))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new C(t-64),i=Vi(n,32,128),o=new C("8000000000000000","hex"),s=0,a=new C(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new C(0))&&s<yn;){u=u.mul(u);let p=u.shrn(127);u=u.shrn(63+p.toNumber()),a=a.add(o.mul(p)),o=o.shrn(1),s+=1}let c=a.shrn(32),l=i.add(c).mul(new C(Tn)),d=nn(l.sub(new C(xn)),64,128).toNumber(),f=nn(l.add(new C(An)),64,128).toNumber();return d==f?d:N.getSqrtPriceX64FromTick(f).lte(e)?f:d}},Xe=class{static getTickWithPriceAndTickspacing(e,t,n,i){let s=N.getTickFromSqrtPriceX64(N.priceToSqrtPriceX64(e,n,i))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,i){let o=Xe.getTickWithPriceAndTickspacing(e,t,n,i),s=N.getSqrtPriceX64FromTick(o);return N.sqrtPriceX64ToPrice(s,n,i)}},_=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(Q))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(tt),s=t.sub(e);return i?S.mulDivRoundingUp(S.mulDivCeil(o,s,t),Ie,e):S.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(Q))throw new Error("sqrtPriceX64A must greater than 0");return i?S.mulDivCeil(n,t.sub(e),fe):S.mulDivFloor(n,t.sub(e),fe)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return i?S.mulDivRoundingUp(a,Ie,vt):a.shrn(tt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),S.mulDivFloor(n,vt,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return _.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let s=_.getLiquidityFromTokenAmountA(e,n,i,!1),a=_.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return _.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:_.getTokenAmountAFromLiquidity(t,n,i,o),amountB:new C(0)};if(e.lt(n)){let s=_.getTokenAmountAFromLiquidity(e,n,i,o),a=_.getTokenAmountBFromLiquidity(t,e,i,o);return{amountA:s,amountB:a}}else return{amountA:new C(0),amountB:_.getTokenAmountBFromLiquidity(t,n,i,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,o,s,a){let{amountA:u,amountB:c}=_.getAmountsFromLiquidity(e,t,n,i,s),m=o?1+a:1-a,l=new C(new T(u.toString()).mul(m).toFixed(0)),d=new C(new T(c.toString()).mul(m).toFixed(0));return{amountSlippageA:l,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:o,add:s,epochInfo:a,amountAddFee:u}){let c=N.priceToSqrtPriceX64(new T(e.price),e.mintA.decimals,e.mintB.decimals),m=N.getSqrtPriceX64FromTick(t),l=N.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,f=_.getAmountsFromLiquidity(c,m,l,i,s),[p,h]=[Z(f.amountA,e.mintA.extensions?.feeConfig,a,u),Z(f.amountB,e.mintB.extensions?.feeConfig,a,u)],[w,b]=[Z(new C(new T(f.amountA.toString()).mul(d).toFixed(0)),e.mintA.extensions?.feeConfig,a,u),Z(new C(new T(f.amountB.toString()).mul(d).toFixed(0)),e.mintB.extensions?.feeConfig,a,u)];return{liquidity:i,amountA:p,amountB:h,amountSlippageA:w,amountSlippageB:b,expirationTime:De(p.expirationTime,h.expirationTime)}}},ze=class{static swapCompute(e,t,n,i,o,s,a,u,c,m,l,d,f,p,h=!1){if(d.eq(Q))throw new Error("amountSpecified must not be 0");if(p||(p=s?Ve.add(Ie):Ue.sub(Ie)),s){if(p.lt(Ve))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(p.gte(l))throw new Error("sqrtPriceX64 must smaller than current")}else{if(p.gt(Ue))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(p.lte(l))throw new Error("sqrtPriceX64 must greater than current")}let w=d.gt(Q),b={amountSpecifiedRemaining:d,amountCalculated:Q,sqrtPriceX64:l,tick:c>f?Math.min(f+M.tickCount(m)-1,c):f,accounts:[],liquidity:u,feeAmount:new C(0)},F=f,P=n[f],v=0,j=!s&&P.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(Q)&&!b.sqrtPriceX64.eq(p);){v>10;let y={};y.sqrtPriceStartX64=b.sqrtPriceX64;let X=I.nextInitTick(P,b.tick,m,s,j),H=X||null,Y=null;if(!H?.liquidityGross.gtn(0)){let D=ke.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:m,tickArrayBitmap:i,exBitmapInfo:o},F,s);if(!D.isExist){if(h)return{allTrade:!1,amountSpecifiedRemaining:b.amountSpecifiedRemaining,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts};throw Error("swapCompute LiquidityInsufficient")}F=D.nextStartIndex;let{publicKey:ye}=ce(e,t,F);Y=ye,P=n[F];try{H=I.firstInitializedTick(P,s)}catch{throw Error("not found next tick info")}}y.tickNext=H.tick,y.initialized=H.liquidityGross.gtn(0),f!==F&&Y&&(b.accounts.push(Y),f=F),y.tickNext<se?y.tickNext=se:y.tickNext>ue&&(y.tickNext=ue),y.sqrtPriceNextX64=N.getSqrtPriceX64FromTick(y.tickNext);let J;if(s&&y.sqrtPriceNextX64.lt(p)||!s&&y.sqrtPriceNextX64.gt(p)?J=p:J=y.sqrtPriceNextX64,[b.sqrtPriceX64,y.amountIn,y.amountOut,y.feeAmount]=ze.swapStepCompute(b.sqrtPriceX64,J,b.liquidity,b.amountSpecifiedRemaining,a,s),b.feeAmount=b.feeAmount.add(y.feeAmount),w?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(y.amountIn.add(y.feeAmount)),b.amountCalculated=b.amountCalculated.sub(y.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(y.amountOut),b.amountCalculated=b.amountCalculated.add(y.amountIn.add(y.feeAmount))),b.sqrtPriceX64.eq(y.sqrtPriceNextX64)){if(y.initialized){let D=H.liquidityNet;s&&(D=D.mul(Ce)),b.liquidity=_.addDelta(b.liquidity,D)}j=y.tickNext!=b.tick&&!s&&P.startTickIndex===y.tickNext,b.tick=s?y.tickNext-1:y.tickNext}else if(b.sqrtPriceX64!=y.sqrtPriceStartX64){let D=N.getTickFromSqrtPriceX64(b.sqrtPriceX64);j=D!=b.tick&&!s&&P.startTickIndex===D,b.tick=D}++v}try{let{nextStartIndex:y,isExist:X}=M.nextInitializedTickArray(b.tick,m,s,i,o);X&&f!==y&&(b.accounts.push(ce(e,t,y).publicKey),f=y)}catch{}return{allTrade:!0,amountSpecifiedRemaining:Q,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,i,o,s){let a={sqrtPriceX64Next:new C(0),amountIn:new C(0),amountOut:new C(0),feeAmount:new C(0)},u=i.gte(Q);if(u){let m=S.mulDivFloor(i,xt.sub(new C(o.toString())),xt);a.amountIn=s?_.getTokenAmountAFromLiquidity(t,e,n,!0):_.getTokenAmountBFromLiquidity(e,t,n,!0),m.gte(a.amountIn)?a.sqrtPriceX64Next=t:a.sqrtPriceX64Next=N.getNextSqrtPriceX64FromInput(e,n,m,s)}else a.amountOut=s?_.getTokenAmountBFromLiquidity(t,e,n,!1):_.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(Ce).gte(a.amountOut)?a.sqrtPriceX64Next=t:a.sqrtPriceX64Next=N.getNextSqrtPriceX64FromOutput(e,n,i.mul(Ce),s);let c=t.eq(a.sqrtPriceX64Next);return s?(c&&u||(a.amountIn=_.getTokenAmountAFromLiquidity(a.sqrtPriceX64Next,e,n,!0)),c&&!u||(a.amountOut=_.getTokenAmountBFromLiquidity(a.sqrtPriceX64Next,e,n,!1))):(a.amountIn=c&&u?a.amountIn:_.getTokenAmountBFromLiquidity(e,a.sqrtPriceX64Next,n,!0),a.amountOut=c&&!u?a.amountOut:_.getTokenAmountAFromLiquidity(e,a.sqrtPriceX64Next,n,!1)),!u&&a.amountOut.gt(i.mul(Ce))&&(a.amountOut=i.mul(Ce)),u&&!a.sqrtPriceX64Next.eq(t)?a.feeAmount=i.sub(a.amountIn):a.feeAmount=S.mulDivCeil(a.amountIn,new C(o),xt.sub(new C(o))),[a.sqrtPriceX64Next,a.amountIn,a.amountOut,a.feeAmount]}};export{_ as LiquidityMath,S as MathUtil,N as SqrtPriceMath,ze as SwapMath,Xe as TickMath};
//# sourceMappingURL=math.mjs.map