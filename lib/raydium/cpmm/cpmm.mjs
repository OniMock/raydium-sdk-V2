var Yi=Object.defineProperty;var Ji=(n,e,t)=>e in n?Yi(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var At=(n,e,t)=>(Ji(n,typeof e!="symbol"?e+"":e,t),t);import{PublicKey as h}from"@solana/web3.js";import{AccountLayout as En,createAssociatedTokenAccountIdempotentInstruction as ji,getAssociatedTokenAddressSync as Qi,NATIVE_MINT as Je,TOKEN_PROGRAM_ID as ue}from"@solana/spl-token";import ke from"bn.js";var Ve=9e15,Ke=1e9,Jt="0123456789abcdef",Tt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",ht="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",$t={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Ve,maxE:Ve,crypto:!1},Gn,Te,O=!0,xt="[DecimalError] ",Ce=xt+"Invalid argument: ",Xn=xt+"Precision limit exceeded",Hn=xt+"crypto unavailable",zn="[object Decimal]",oe=Math.floor,ee=Math.pow,$i=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,er=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,tr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Zn=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,fe=1e7,R=7,nr=9007199254740991,ir=Tt.length-1,en=ht.length-1,P={toStringTag:zn};P.absoluteValue=P.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),N(n)};P.ceil=function(){return N(new this.constructor(this),this.e+1,2)};P.clampedTo=P.clamp=function(n,e){var t,i=this,o=i.constructor;if(n=new o(n),e=new o(e),!n.s||!e.s)return new o(NaN);if(n.gt(e))throw Error(Ce+e);return t=i.cmp(n),t<0?n:i.cmp(e)>0?e:new o(i)};P.comparedTo=P.cmp=function(n){var e,t,i,o,r=this,s=r.d,a=(n=new r.constructor(n)).d,c=r.s,u=n.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(r.e!==n.e)return r.e>n.e^c<0?1:-1;for(i=s.length,o=a.length,e=0,t=i<o?i:o;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return i===o?0:i>o^c<0?1:-1};P.cosine=P.cos=function(){var n,e,t=this,i=t.constructor;return t.d?t.d[0]?(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+R,i.rounding=1,t=rr(i,$n(i,t)),i.precision=n,i.rounding=e,N(Te==2||Te==3?t.neg():t,n,e,!0)):new i(1):new i(NaN)};P.cubeRoot=P.cbrt=function(){var n,e,t,i,o,r,s,a,c,u,m=this,l=m.constructor;if(!m.isFinite()||m.isZero())return new l(m);for(O=!1,r=m.s*ee(m.s*m,1/3),!r||Math.abs(r)==1/0?(t=ie(m.d),n=m.e,(r=(n-t.length+1)%3)&&(t+=r==1||r==-2?"0":"00"),r=ee(t,1/3),n=oe((n+1)/3)-(n%3==(n<0?-1:2)),r==1/0?t="5e"+n:(t=r.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),i=new l(t),i.s=m.s):i=new l(r.toString()),s=(n=l.precision)+3;;)if(a=i,c=a.times(a).times(a),u=c.plus(m),i=U(u.plus(m).times(a),u.plus(c),s+2,1),ie(a.d).slice(0,s)===(t=ie(i.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!o&&t=="4999"){if(!o&&(N(a,n+1,0),a.times(a).times(a).eq(m))){i=a;break}s+=4,o=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(N(i,n+1,1),e=!i.times(i).times(i).eq(m));break}return O=!0,N(i,n,l.rounding,e)};P.decimalPlaces=P.dp=function(){var n,e=this.d,t=NaN;if(e){if(n=e.length-1,t=(n-oe(this.e/R))*R,n=e[n],n)for(;n%10==0;n/=10)t--;t<0&&(t=0)}return t};P.dividedBy=P.div=function(n){return U(this,new this.constructor(n))};P.dividedToIntegerBy=P.divToInt=function(n){var e=this,t=e.constructor;return N(U(e,new t(n),0,1,1),t.precision,t.rounding)};P.equals=P.eq=function(n){return this.cmp(n)===0};P.floor=function(){return N(new this.constructor(this),this.e+1,3)};P.greaterThan=P.gt=function(n){return this.cmp(n)>0};P.greaterThanOrEqualTo=P.gte=function(n){var e=this.cmp(n);return e==1||e===0};P.hyperbolicCosine=P.cosh=function(){var n,e,t,i,o,r=this,s=r.constructor,a=new s(1);if(!r.isFinite())return new s(r.s?1/0:NaN);if(r.isZero())return a;t=s.precision,i=s.rounding,s.precision=t+Math.max(r.e,r.sd())+4,s.rounding=1,o=r.d.length,o<32?(n=Math.ceil(o/3),e=(1/St(4,n)).toString()):(n=16,e="2.3283064365386962890625e-10"),r=_e(s,1,r.times(e),new s(1),!0);for(var c,u=n,m=new s(8);u--;)c=r.times(r),r=a.minus(c.times(m.minus(c.times(m))));return N(r,s.precision=t,s.rounding=i,!0)};P.hyperbolicSine=P.sinh=function(){var n,e,t,i,o=this,r=o.constructor;if(!o.isFinite()||o.isZero())return new r(o);if(e=r.precision,t=r.rounding,r.precision=e+Math.max(o.e,o.sd())+4,r.rounding=1,i=o.d.length,i<3)o=_e(r,2,o,o,!0);else{n=1.4*Math.sqrt(i),n=n>16?16:n|0,o=o.times(1/St(5,n)),o=_e(r,2,o,o,!0);for(var s,a=new r(5),c=new r(16),u=new r(20);n--;)s=o.times(o),o=o.times(a.plus(s.times(c.times(s).plus(u))))}return r.precision=e,r.rounding=t,N(o,e,t,!0)};P.hyperbolicTangent=P.tanh=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+7,i.rounding=1,U(t.sinh(),t.cosh(),i.precision=n,i.rounding=e)):new i(t.s)};P.inverseCosine=P.acos=function(){var n,e=this,t=e.constructor,i=e.abs().cmp(1),o=t.precision,r=t.rounding;return i!==-1?i===0?e.isNeg()?pe(t,o,r):new t(0):new t(NaN):e.isZero()?pe(t,o+4,r).times(.5):(t.precision=o+6,t.rounding=1,e=e.asin(),n=pe(t,o+4,r).times(.5),t.precision=o,t.rounding=r,n.minus(e))};P.inverseHyperbolicCosine=P.acosh=function(){var n,e,t=this,i=t.constructor;return t.lte(1)?new i(t.eq(1)?0:NaN):t.isFinite()?(n=i.precision,e=i.rounding,i.precision=n+Math.max(Math.abs(t.e),t.sd())+4,i.rounding=1,O=!1,t=t.times(t).minus(1).sqrt().plus(t),O=!0,i.precision=n,i.rounding=e,t.ln()):new i(t)};P.inverseHyperbolicSine=P.asinh=function(){var n,e,t=this,i=t.constructor;return!t.isFinite()||t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+2*Math.max(Math.abs(t.e),t.sd())+6,i.rounding=1,O=!1,t=t.times(t).plus(1).sqrt().plus(t),O=!0,i.precision=n,i.rounding=e,t.ln())};P.inverseHyperbolicTangent=P.atanh=function(){var n,e,t,i,o=this,r=o.constructor;return o.isFinite()?o.e>=0?new r(o.abs().eq(1)?o.s/0:o.isZero()?o:NaN):(n=r.precision,e=r.rounding,i=o.sd(),Math.max(i,n)<2*-o.e-1?N(new r(o),n,e,!0):(r.precision=t=i-o.e,o=U(o.plus(1),new r(1).minus(o),t+n,1),r.precision=n+4,r.rounding=1,o=o.ln(),r.precision=n,r.rounding=e,o.times(.5))):new r(NaN)};P.inverseSine=P.asin=function(){var n,e,t,i,o=this,r=o.constructor;return o.isZero()?new r(o):(e=o.abs().cmp(1),t=r.precision,i=r.rounding,e!==-1?e===0?(n=pe(r,t+4,i).times(.5),n.s=o.s,n):new r(NaN):(r.precision=t+6,r.rounding=1,o=o.div(new r(1).minus(o.times(o)).sqrt().plus(1)).atan(),r.precision=t,r.rounding=i,o.times(2)))};P.inverseTangent=P.atan=function(){var n,e,t,i,o,r,s,a,c,u=this,m=u.constructor,l=m.precision,d=m.rounding;if(u.isFinite()){if(u.isZero())return new m(u);if(u.abs().eq(1)&&l+4<=en)return s=pe(m,l+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new m(NaN);if(l+4<=en)return s=pe(m,l+4,d).times(.5),s.s=u.s,s}for(m.precision=a=l+10,m.rounding=1,t=Math.min(28,a/R+2|0),n=t;n;--n)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(O=!1,e=Math.ceil(a/R),i=1,c=u.times(u),s=new m(u),o=u;n!==-1;)if(o=o.times(c),r=s.minus(o.div(i+=2)),o=o.times(c),s=r.plus(o.div(i+=2)),s.d[e]!==void 0)for(n=e;s.d[n]===r.d[n]&&n--;);return t&&(s=s.times(2<<t-1)),O=!0,N(s,m.precision=l,m.rounding=d,!0)};P.isFinite=function(){return!!this.d};P.isInteger=P.isInt=function(){return!!this.d&&oe(this.e/R)>this.d.length-2};P.isNaN=function(){return!this.s};P.isNegative=P.isNeg=function(){return this.s<0};P.isPositive=P.isPos=function(){return this.s>0};P.isZero=function(){return!!this.d&&this.d[0]===0};P.lessThan=P.lt=function(n){return this.cmp(n)<0};P.lessThanOrEqualTo=P.lte=function(n){return this.cmp(n)<1};P.logarithm=P.log=function(n){var e,t,i,o,r,s,a,c,u=this,m=u.constructor,l=m.precision,d=m.rounding,p=5;if(n==null)n=new m(10),e=!0;else{if(n=new m(n),t=n.d,n.s<0||!t||!t[0]||n.eq(1))return new m(NaN);e=n.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new m(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)r=!0;else{for(o=t[0];o%10===0;)o/=10;r=o!==1}if(O=!1,a=l+p,s=Se(u,a),i=e?Bt(m,a+10):Se(n,a),c=U(s,i,a,1),et(c.d,o=l,d))do if(a+=10,s=Se(u,a),i=e?Bt(m,a+10):Se(n,a),c=U(s,i,a,1),!r){+ie(c.d).slice(o+1,o+15)+1==1e14&&(c=N(c,l+1,0));break}while(et(c.d,o+=10,d));return O=!0,N(c,l,d)};P.minus=P.sub=function(n){var e,t,i,o,r,s,a,c,u,m,l,d,p=this,f=p.constructor;if(n=new f(n),!p.d||!n.d)return!p.s||!n.s?n=new f(NaN):p.d?n.s=-n.s:n=new f(n.d||p.s!==n.s?p:NaN),n;if(p.s!=n.s)return n.s=-n.s,p.plus(n);if(u=p.d,d=n.d,a=f.precision,c=f.rounding,!u[0]||!d[0]){if(d[0])n.s=-n.s;else if(u[0])n=new f(p);else return new f(c===3?-0:0);return O?N(n,a,c):n}if(t=oe(n.e/R),m=oe(p.e/R),u=u.slice(),r=m-t,r){for(l=r<0,l?(e=u,r=-r,s=d.length):(e=d,t=m,s=u.length),i=Math.max(Math.ceil(a/R),s)+2,r>i&&(r=i,e.length=1),e.reverse(),i=r;i--;)e.push(0);e.reverse()}else{for(i=u.length,s=d.length,l=i<s,l&&(s=i),i=0;i<s;i++)if(u[i]!=d[i]){l=u[i]<d[i];break}r=0}for(l&&(e=u,u=d,d=e,n.s=-n.s),s=u.length,i=d.length-s;i>0;--i)u[s++]=0;for(i=d.length;i>r;){if(u[--i]<d[i]){for(o=i;o&&u[--o]===0;)u[o]=fe-1;--u[o],u[i]+=fe}u[i]-=d[i]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(n.d=u,n.e=It(u,t),O?N(n,a,c):n):new f(c===3?-0:0)};P.modulo=P.mod=function(n){var e,t=this,i=t.constructor;return n=new i(n),!t.d||!n.s||n.d&&!n.d[0]?new i(NaN):!n.d||t.d&&!t.d[0]?N(new i(t),i.precision,i.rounding):(O=!1,i.modulo==9?(e=U(t,n.abs(),0,3,1),e.s*=n.s):e=U(t,n,0,i.modulo,1),e=e.times(n),O=!0,t.minus(e))};P.naturalExponential=P.exp=function(){return tn(this)};P.naturalLogarithm=P.ln=function(){return Se(this)};P.negated=P.neg=function(){var n=new this.constructor(this);return n.s=-n.s,N(n)};P.plus=P.add=function(n){var e,t,i,o,r,s,a,c,u,m,l=this,d=l.constructor;if(n=new d(n),!l.d||!n.d)return!l.s||!n.s?n=new d(NaN):l.d||(n=new d(n.d||l.s===n.s?l:NaN)),n;if(l.s!=n.s)return n.s=-n.s,l.minus(n);if(u=l.d,m=n.d,a=d.precision,c=d.rounding,!u[0]||!m[0])return m[0]||(n=new d(l)),O?N(n,a,c):n;if(r=oe(l.e/R),i=oe(n.e/R),u=u.slice(),o=r-i,o){for(o<0?(t=u,o=-o,s=m.length):(t=m,i=r,s=u.length),r=Math.ceil(a/R),s=r>s?r+1:s+1,o>s&&(o=s,t.length=1),t.reverse();o--;)t.push(0);t.reverse()}for(s=u.length,o=m.length,s-o<0&&(o=s,t=m,m=u,u=t),e=0;o;)e=(u[--o]=u[o]+m[o]+e)/fe|0,u[o]%=fe;for(e&&(u.unshift(e),++i),s=u.length;u[--s]==0;)u.pop();return n.d=u,n.e=It(u,i),O?N(n,a,c):n};P.precision=P.sd=function(n){var e,t=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(Ce+n);return t.d?(e=jn(t.d),n&&t.e+1>e&&(e=t.e+1)):e=NaN,e};P.round=function(){var n=this,e=n.constructor;return N(new e(n),n.e+1,e.rounding)};P.sine=P.sin=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+R,i.rounding=1,t=sr(i,$n(i,t)),i.precision=n,i.rounding=e,N(Te>2?t.neg():t,n,e,!0)):new i(NaN)};P.squareRoot=P.sqrt=function(){var n,e,t,i,o,r,s=this,a=s.d,c=s.e,u=s.s,m=s.constructor;if(u!==1||!a||!a[0])return new m(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(O=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=ie(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=oe((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),i=new m(e)):i=new m(u.toString()),t=(c=m.precision)+3;;)if(r=i,i=r.plus(U(s,r,t+2,1)).times(.5),ie(r.d).slice(0,t)===(e=ie(i.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!o&&e=="4999"){if(!o&&(N(r,c+1,0),r.times(r).eq(s))){i=r;break}t+=4,o=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(N(i,c+1,1),n=!i.times(i).eq(s));break}return O=!0,N(i,c,m.rounding,n)};P.tangent=P.tan=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+10,i.rounding=1,t=t.sin(),t.s=1,t=U(t,new i(1).minus(t.times(t)).sqrt(),n+10,0),i.precision=n,i.rounding=e,N(Te==2||Te==4?t.neg():t,n,e,!0)):new i(NaN)};P.times=P.mul=function(n){var e,t,i,o,r,s,a,c,u,m=this,l=m.constructor,d=m.d,p=(n=new l(n)).d;if(n.s*=m.s,!d||!d[0]||!p||!p[0])return new l(!n.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?n.s/0:n.s*0);for(t=oe(m.e/R)+oe(n.e/R),c=d.length,u=p.length,c<u&&(r=d,d=p,p=r,s=c,c=u,u=s),r=[],s=c+u,i=s;i--;)r.push(0);for(i=u;--i>=0;){for(e=0,o=c+i;o>i;)a=r[o]+p[i]*d[o-i-1]+e,r[o--]=a%fe|0,e=a/fe|0;r[o]=(r[o]+e)%fe|0}for(;!r[--s];)r.pop();return e?++t:r.shift(),n.d=r,n.e=It(r,t),O?N(n,l.precision,l.rounding):n};P.toBinary=function(n,e){return rn(this,2,n,e)};P.toDecimalPlaces=P.toDP=function(n,e){var t=this,i=t.constructor;return t=new i(t),n===void 0?t:(ae(n,0,Ke),e===void 0?e=i.rounding:ae(e,0,8),N(t,n+t.e+1,e))};P.toExponential=function(n,e){var t,i=this,o=i.constructor;return n===void 0?t=ye(i,!0):(ae(n,0,Ke),e===void 0?e=o.rounding:ae(e,0,8),i=N(new o(i),n+1,e),t=ye(i,!0,n+1)),i.isNeg()&&!i.isZero()?"-"+t:t};P.toFixed=function(n,e){var t,i,o=this,r=o.constructor;return n===void 0?t=ye(o):(ae(n,0,Ke),e===void 0?e=r.rounding:ae(e,0,8),i=N(new r(o),n+o.e+1,e),t=ye(i,!1,n+i.e+1)),o.isNeg()&&!o.isZero()?"-"+t:t};P.toFraction=function(n){var e,t,i,o,r,s,a,c,u,m,l,d,p=this,f=p.d,g=p.constructor;if(!f)return new g(p);if(u=t=new g(1),i=c=new g(0),e=new g(i),r=e.e=jn(f)-p.e-1,s=r%R,e.d[0]=ee(10,s<0?R+s:s),n==null)n=r>0?e:u;else{if(a=new g(n),!a.isInt()||a.lt(u))throw Error(Ce+a);n=a.gt(e)?r>0?e:u:a}for(O=!1,a=new g(ie(f)),m=g.precision,g.precision=r=f.length*R*2;l=U(a,e,0,1,1),o=t.plus(l.times(i)),o.cmp(n)!=1;)t=i,i=o,o=u,u=c.plus(l.times(o)),c=o,o=e,e=a.minus(l.times(o)),a=o;return o=U(n.minus(t),i,0,1,1),c=c.plus(o.times(u)),t=t.plus(o.times(i)),c.s=u.s=p.s,d=U(u,i,r,1).minus(p).abs().cmp(U(c,t,r,1).minus(p).abs())<1?[u,i]:[c,t],g.precision=m,O=!0,d};P.toHexadecimal=P.toHex=function(n,e){return rn(this,16,n,e)};P.toNearest=function(n,e){var t=this,i=t.constructor;if(t=new i(t),n==null){if(!t.d)return t;n=new i(1),e=i.rounding}else{if(n=new i(n),e===void 0?e=i.rounding:ae(e,0,8),!t.d)return n.s?t:n;if(!n.d)return n.s&&(n.s=t.s),n}return n.d[0]?(O=!1,t=U(t,n,0,e,1).times(n),O=!0,N(t)):(n.s=t.s,t=n),t};P.toNumber=function(){return+this};P.toOctal=function(n,e){return rn(this,8,n,e)};P.toPower=P.pow=function(n){var e,t,i,o,r,s,a=this,c=a.constructor,u=+(n=new c(n));if(!a.d||!n.d||!a.d[0]||!n.d[0])return new c(ee(+a,u));if(a=new c(a),a.eq(1))return a;if(i=c.precision,r=c.rounding,n.eq(1))return N(a,i,r);if(e=oe(n.e/R),e>=n.d.length-1&&(t=u<0?-u:u)<=nr)return o=Qn(c,a,t,i),n.s<0?new c(1).div(o):N(o,i,r);if(s=a.s,s<0){if(e<n.d.length-1)return new c(NaN);if((n.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ee(+a,u),e=t==0||!isFinite(t)?oe(u*(Math.log("0."+ie(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(O=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),o=tn(n.times(Se(a,i+t)),i),o.d&&(o=N(o,i+5,1),et(o.d,i,r)&&(e=i+10,o=N(tn(n.times(Se(a,e+t)),e),e+5,1),+ie(o.d).slice(i+1,i+15)+1==1e14&&(o=N(o,i+1,0)))),o.s=s,O=!0,c.rounding=r,N(o,i,r))};P.toPrecision=function(n,e){var t,i=this,o=i.constructor;return n===void 0?t=ye(i,i.e<=o.toExpNeg||i.e>=o.toExpPos):(ae(n,1,Ke),e===void 0?e=o.rounding:ae(e,0,8),i=N(new o(i),n,e),t=ye(i,n<=i.e||i.e<=o.toExpNeg,n)),i.isNeg()&&!i.isZero()?"-"+t:t};P.toSignificantDigits=P.toSD=function(n,e){var t=this,i=t.constructor;return n===void 0?(n=i.precision,e=i.rounding):(ae(n,1,Ke),e===void 0?e=i.rounding:ae(e,0,8)),N(new i(t),n,e)};P.toString=function(){var n=this,e=n.constructor,t=ye(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()&&!n.isZero()?"-"+t:t};P.truncated=P.trunc=function(){return N(new this.constructor(this),this.e+1,1)};P.valueOf=P.toJSON=function(){var n=this,e=n.constructor,t=ye(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()?"-"+t:t};function ie(n){var e,t,i,o=n.length-1,r="",s=n[0];if(o>0){for(r+=s,e=1;e<o;e++)i=n[e]+"",t=R-i.length,t&&(r+=Ie(t)),r+=i;s=n[e],i=s+"",t=R-i.length,t&&(r+=Ie(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return r+s}function ae(n,e,t){if(n!==~~n||n<e||n>t)throw Error(Ce+n)}function et(n,e,t,i){var o,r,s,a;for(r=n[0];r>=10;r/=10)--e;return--e<0?(e+=R,o=0):(o=Math.ceil((e+1)/R),e%=R),r=ee(10,R-e),a=n[o]%r|0,i==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==r||t>3&&a+1==r/2)&&(n[o+1]/r/100|0)==ee(10,e-2)-1||(a==r/2||a==0)&&(n[o+1]/r/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(i||t<4)&&a==9999||!i&&t>3&&a==4999):s=((i||t<4)&&a+1==r||!i&&t>3&&a+1==r/2)&&(n[o+1]/r/1e3|0)==ee(10,e-3)-1,s}function kt(n,e,t){for(var i,o=[0],r,s=0,a=n.length;s<a;){for(r=o.length;r--;)o[r]*=e;for(o[0]+=Jt.indexOf(n.charAt(s++)),i=0;i<o.length;i++)o[i]>t-1&&(o[i+1]===void 0&&(o[i+1]=0),o[i+1]+=o[i]/t|0,o[i]%=t)}return o.reverse()}function rr(n,e){var t,i,o;if(e.isZero())return e;i=e.d.length,i<32?(t=Math.ceil(i/3),o=(1/St(4,t)).toString()):(t=16,o="2.3283064365386962890625e-10"),n.precision+=t,e=_e(n,1,e.times(o),new n(1));for(var r=t;r--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return n.precision-=t,e}var U=function(){function n(i,o,r){var s,a=0,c=i.length;for(i=i.slice();c--;)s=i[c]*o+a,i[c]=s%r|0,a=s/r|0;return a&&i.unshift(a),i}function e(i,o,r,s){var a,c;if(r!=s)c=r>s?1:-1;else for(a=c=0;a<r;a++)if(i[a]!=o[a]){c=i[a]>o[a]?1:-1;break}return c}function t(i,o,r,s){for(var a=0;r--;)i[r]-=a,a=i[r]<o[r]?1:0,i[r]=a*s+i[r]-o[r];for(;!i[0]&&i.length>1;)i.shift()}return function(i,o,r,s,a,c){var u,m,l,d,p,f,g,y,k,w,b,A,T,x,B,S,L,E,M,_,W=i.constructor,$=i.s==o.s?1:-1,V=i.d,D=o.d;if(!V||!V[0]||!D||!D[0])return new W(!i.s||!o.s||(V?D&&V[0]==D[0]:!D)?NaN:V&&V[0]==0||!D?$*0:$/0);for(c?(p=1,m=i.e-o.e):(c=fe,p=R,m=oe(i.e/p)-oe(o.e/p)),M=D.length,L=V.length,k=new W($),w=k.d=[],l=0;D[l]==(V[l]||0);l++);if(D[l]>(V[l]||0)&&m--,r==null?(x=r=W.precision,s=W.rounding):a?x=r+(i.e-o.e)+1:x=r,x<0)w.push(1),f=!0;else{if(x=x/p+2|0,l=0,M==1){for(d=0,D=D[0],x++;(l<L||d)&&x--;l++)B=d*c+(V[l]||0),w[l]=B/D|0,d=B%D|0;f=d||l<L}else{for(d=c/(D[0]+1)|0,d>1&&(D=n(D,d,c),V=n(V,d,c),M=D.length,L=V.length),S=M,b=V.slice(0,M),A=b.length;A<M;)b[A++]=0;_=D.slice(),_.unshift(0),E=D[0],D[1]>=c/2&&++E;do d=0,u=e(D,b,M,A),u<0?(T=b[0],M!=A&&(T=T*c+(b[1]||0)),d=T/E|0,d>1?(d>=c&&(d=c-1),g=n(D,d,c),y=g.length,A=b.length,u=e(g,b,y,A),u==1&&(d--,t(g,M<y?_:D,y,c))):(d==0&&(u=d=1),g=D.slice()),y=g.length,y<A&&g.unshift(0),t(b,g,A,c),u==-1&&(A=b.length,u=e(D,b,M,A),u<1&&(d++,t(b,M<A?_:D,A,c))),A=b.length):u===0&&(d++,b=[0]),w[l++]=d,u&&b[0]?b[A++]=V[S]||0:(b=[V[S]],A=1);while((S++<L||b[0]!==void 0)&&x--);f=b[0]!==void 0}w[0]||w.shift()}if(p==1)k.e=m,Gn=f;else{for(l=1,d=w[0];d>=10;d/=10)l++;k.e=l+m*p-1,N(k,a?r+k.e+1:r,s,f)}return k}}();function N(n,e,t,i){var o,r,s,a,c,u,m,l,d,p=n.constructor;e:if(e!=null){if(l=n.d,!l)return n;for(o=1,a=l[0];a>=10;a/=10)o++;if(r=e-o,r<0)r+=R,s=e,m=l[d=0],c=m/ee(10,o-s-1)%10|0;else if(d=Math.ceil((r+1)/R),a=l.length,d>=a)if(i){for(;a++<=d;)l.push(0);m=c=0,o=1,r%=R,s=r-R+1}else break e;else{for(m=a=l[d],o=1;a>=10;a/=10)o++;r%=R,s=r-R+o,c=s<0?0:m/ee(10,o-s-1)%10|0}if(i=i||e<0||l[d+1]!==void 0||(s<0?m:m%ee(10,o-s-1)),u=t<4?(c||i)&&(t==0||t==(n.s<0?3:2)):c>5||c==5&&(t==4||i||t==6&&(r>0?s>0?m/ee(10,o-s):0:l[d-1])%10&1||t==(n.s<0?8:7)),e<1||!l[0])return l.length=0,u?(e-=n.e+1,l[0]=ee(10,(R-e%R)%R),n.e=-e||0):l[0]=n.e=0,n;if(r==0?(l.length=d,a=1,d--):(l.length=d+1,a=ee(10,R-r),l[d]=s>0?(m/ee(10,o-s)%ee(10,s)|0)*a:0),u)for(;;)if(d==0){for(r=1,s=l[0];s>=10;s/=10)r++;for(s=l[0]+=a,a=1;s>=10;s/=10)a++;r!=a&&(n.e++,l[0]==fe&&(l[0]=1));break}else{if(l[d]+=a,l[d]!=fe)break;l[d--]=0,a=1}for(r=l.length;l[--r]===0;)l.pop()}return O&&(n.e>p.maxE?(n.d=null,n.e=NaN):n.e<p.minE&&(n.e=0,n.d=[0])),n}function ye(n,e,t){if(!n.isFinite())return Jn(n);var i,o=n.e,r=ie(n.d),s=r.length;return e?(t&&(i=t-s)>0?r=r.charAt(0)+"."+r.slice(1)+Ie(i):s>1&&(r=r.charAt(0)+"."+r.slice(1)),r=r+(n.e<0?"e":"e+")+n.e):o<0?(r="0."+Ie(-o-1)+r,t&&(i=t-s)>0&&(r+=Ie(i))):o>=s?(r+=Ie(o+1-s),t&&(i=t-o-1)>0&&(r=r+"."+Ie(i))):((i=o+1)<s&&(r=r.slice(0,i)+"."+r.slice(i)),t&&(i=t-s)>0&&(o+1===s&&(r+="."),r+=Ie(i))),r}function It(n,e){var t=n[0];for(e*=R;t>=10;t/=10)e++;return e}function Bt(n,e,t){if(e>ir)throw O=!0,t&&(n.precision=t),Error(Xn);return N(new n(Tt),e,1,!0)}function pe(n,e,t){if(e>en)throw Error(Xn);return N(new n(ht),e,t,!0)}function jn(n){var e=n.length-1,t=e*R+1;if(e=n[e],e){for(;e%10==0;e/=10)t--;for(e=n[0];e>=10;e/=10)t++}return t}function Ie(n){for(var e="";n--;)e+="0";return e}function Qn(n,e,t,i){var o,r=new n(1),s=Math.ceil(i/R+4);for(O=!1;;){if(t%2&&(r=r.times(e),qn(r.d,s)&&(o=!0)),t=oe(t/2),t===0){t=r.d.length-1,o&&r.d[t]===0&&++r.d[t];break}e=e.times(e),qn(e.d,s)}return O=!0,r}function _n(n){return n.d[n.d.length-1]&1}function Yn(n,e,t){for(var i,o=new n(e[0]),r=0;++r<e.length;)if(i=new n(e[r]),i.s)o[t](i)&&(o=i);else{o=i;break}return o}function tn(n,e){var t,i,o,r,s,a,c,u=0,m=0,l=0,d=n.constructor,p=d.rounding,f=d.precision;if(!n.d||!n.d[0]||n.e>17)return new d(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:0/0);for(e==null?(O=!1,c=f):c=e,a=new d(.03125);n.e>-2;)n=n.times(a),l+=5;for(i=Math.log(ee(2,l))/Math.LN10*2+5|0,c+=i,t=r=s=new d(1),d.precision=c;;){if(r=N(r.times(n),c,1),t=t.times(++m),a=s.plus(U(r,t,c,1)),ie(a.d).slice(0,c)===ie(s.d).slice(0,c)){for(o=l;o--;)s=N(s.times(s),c,1);if(e==null)if(u<3&&et(s.d,c-i,p,u))d.precision=c+=10,t=r=a=new d(1),m=0,u++;else return N(s,d.precision=f,p,O=!0);else return d.precision=f,s}s=a}}function Se(n,e){var t,i,o,r,s,a,c,u,m,l,d,p=1,f=10,g=n,y=g.d,k=g.constructor,w=k.rounding,b=k.precision;if(g.s<0||!y||!y[0]||!g.e&&y[0]==1&&y.length==1)return new k(y&&!y[0]?-1/0:g.s!=1?NaN:y?0:g);if(e==null?(O=!1,m=b):m=e,k.precision=m+=f,t=ie(y),i=t.charAt(0),Math.abs(r=g.e)<15e14){for(;i<7&&i!=1||i==1&&t.charAt(1)>3;)g=g.times(n),t=ie(g.d),i=t.charAt(0),p++;r=g.e,i>1?(g=new k("0."+t),r++):g=new k(i+"."+t.slice(1))}else return u=Bt(k,m+2,b).times(r+""),g=Se(new k(i+"."+t.slice(1)),m-f).plus(u),k.precision=b,e==null?N(g,b,w,O=!0):g;for(l=g,c=s=g=U(g.minus(1),g.plus(1),m,1),d=N(g.times(g),m,1),o=3;;){if(s=N(s.times(d),m,1),u=c.plus(U(s,new k(o),m,1)),ie(u.d).slice(0,m)===ie(c.d).slice(0,m))if(c=c.times(2),r!==0&&(c=c.plus(Bt(k,m+2,b).times(r+""))),c=U(c,new k(p),m,1),e==null)if(et(c.d,m-f,w,a))k.precision=m+=f,u=s=g=U(l.minus(1),l.plus(1),m,1),d=N(g.times(g),m,1),o=a=1;else return N(c,k.precision=b,w,O=!0);else return k.precision=b,c;c=u,o+=2}}function Jn(n){return String(n.s*n.s/0)}function nn(n,e){var t,i,o;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(t<0&&(t=i),t+=+e.slice(i+1),e=e.substring(0,i)):t<0&&(t=e.length),i=0;e.charCodeAt(i)===48;i++);for(o=e.length;e.charCodeAt(o-1)===48;--o);if(e=e.slice(i,o),e){if(o-=i,n.e=t=t-i-1,n.d=[],i=(t+1)%R,t<0&&(i+=R),i<o){for(i&&n.d.push(+e.slice(0,i)),o-=R;i<o;)n.d.push(+e.slice(i,i+=R));e=e.slice(i),i=R-e.length}else i-=o;for(;i--;)e+="0";n.d.push(+e),O&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function or(n,e){var t,i,o,r,s,a,c,u,m;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Zn.test(e))return nn(n,e)}else if(e==="Infinity"||e==="NaN")return+e||(n.s=NaN),n.e=NaN,n.d=null,n;if(er.test(e))t=16,e=e.toLowerCase();else if($i.test(e))t=2;else if(tr.test(e))t=8;else throw Error(Ce+e);for(r=e.search(/p/i),r>0?(c=+e.slice(r+1),e=e.substring(2,r)):e=e.slice(2),r=e.indexOf("."),s=r>=0,i=n.constructor,s&&(e=e.replace(".",""),a=e.length,r=a-r,o=Qn(i,new i(t),r,r*2)),u=kt(e,t,fe),m=u.length-1,r=m;u[r]===0;--r)u.pop();return r<0?new i(n.s*0):(n.e=It(u,m),n.d=u,O=!1,s&&(n=U(n,o,a*4)),c&&(n=n.times(Math.abs(c)<54?ee(2,c):tt.pow(2,c))),O=!0,n)}function sr(n,e){var t,i=e.d.length;if(i<3)return e.isZero()?e:_e(n,2,e,e);t=1.4*Math.sqrt(i),t=t>16?16:t|0,e=e.times(1/St(5,t)),e=_e(n,2,e,e);for(var o,r=new n(5),s=new n(16),a=new n(20);t--;)o=e.times(e),e=e.times(r.plus(o.times(s.times(o).minus(a))));return e}function _e(n,e,t,i,o){var r,s,a,c,u=1,m=n.precision,l=Math.ceil(m/R);for(O=!1,c=t.times(t),a=new n(i);;){if(s=U(a.times(c),new n(e++*e++),m,1),a=o?i.plus(s):i.minus(s),i=U(s.times(c),new n(e++*e++),m,1),s=a.plus(i),s.d[l]!==void 0){for(r=l;s.d[r]===a.d[r]&&r--;);if(r==-1)break}r=a,a=i,i=s,s=r,u++}return O=!0,s.d.length=l+1,s}function St(n,e){for(var t=n;--e;)t*=n;return t}function $n(n,e){var t,i=e.s<0,o=pe(n,n.precision,1),r=o.times(.5);if(e=e.abs(),e.lte(r))return Te=i?4:1,e;if(t=e.divToInt(o),t.isZero())Te=i?3:2;else{if(e=e.minus(t.times(o)),e.lte(r))return Te=_n(t)?i?2:3:i?4:1,e;Te=_n(t)?i?1:4:i?3:2}return e.minus(o).abs()}function rn(n,e,t,i){var o,r,s,a,c,u,m,l,d,p=n.constructor,f=t!==void 0;if(f?(ae(t,1,Ke),i===void 0?i=p.rounding:ae(i,0,8)):(t=p.precision,i=p.rounding),!n.isFinite())m=Jn(n);else{for(m=ye(n),s=m.indexOf("."),f?(o=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):o=e,s>=0&&(m=m.replace(".",""),d=new p(1),d.e=m.length-s,d.d=kt(ye(d),10,o),d.e=d.d.length),l=kt(m,10,o),r=c=l.length;l[--c]==0;)l.pop();if(!l[0])m=f?"0p+0":"0";else{if(s<0?r--:(n=new p(n),n.d=l,n.e=r,n=U(n,d,t,i,0,o),l=n.d,r=n.e,u=Gn),s=l[t],a=o/2,u=u||l[t+1]!==void 0,u=i<4?(s!==void 0||u)&&(i===0||i===(n.s<0?3:2)):s>a||s===a&&(i===4||u||i===6&&l[t-1]&1||i===(n.s<0?8:7)),l.length=t,u)for(;++l[--t]>o-1;)l[t]=0,t||(++r,l.unshift(1));for(c=l.length;!l[c-1];--c);for(s=0,m="";s<c;s++)m+=Jt.charAt(l[s]);if(f){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)m+="0";for(l=kt(m,o,e),c=l.length;!l[c-1];--c);for(s=1,m="1.";s<c;s++)m+=Jt.charAt(l[s])}else m=m.charAt(0)+"."+m.slice(1);m=m+(r<0?"p":"p+")+r}else if(r<0){for(;++r;)m="0"+m;m="0."+m}else if(++r>c)for(r-=c;r--;)m+="0";else r<c&&(m=m.slice(0,r)+"."+m.slice(r))}m=(e==16?"0x":e==2?"0b":e==8?"0o":"")+m}return n.s<0?"-"+m:m}function qn(n,e){if(n.length>e)return n.length=e,!0}function ar(n){return new this(n).abs()}function ur(n){return new this(n).acos()}function cr(n){return new this(n).acosh()}function lr(n,e){return new this(n).plus(e)}function mr(n){return new this(n).asin()}function dr(n){return new this(n).asinh()}function pr(n){return new this(n).atan()}function fr(n){return new this(n).atanh()}function br(n,e){n=new this(n),e=new this(e);var t,i=this.precision,o=this.rounding,r=i+4;return!n.s||!e.s?t=new this(NaN):!n.d&&!e.d?(t=pe(this,r,1).times(e.s>0?.25:.75),t.s=n.s):!e.d||n.isZero()?(t=e.s<0?pe(this,i,o):new this(0),t.s=n.s):!n.d||e.isZero()?(t=pe(this,r,1).times(.5),t.s=n.s):e.s<0?(this.precision=r,this.rounding=1,t=this.atan(U(n,e,r,1)),e=pe(this,r,1),this.precision=i,this.rounding=o,t=n.s<0?t.minus(e):t.plus(e)):t=this.atan(U(n,e,r,1)),t}function gr(n){return new this(n).cbrt()}function yr(n){return N(n=new this(n),n.e+1,2)}function wr(n,e,t){return new this(n).clamp(e,t)}function Pr(n){if(!n||typeof n!="object")throw Error(xt+"Object expected");var e,t,i,o=n.defaults===!0,r=["precision",1,Ke,"rounding",0,8,"toExpNeg",-Ve,0,"toExpPos",0,Ve,"maxE",0,Ve,"minE",-Ve,0,"modulo",0,9];for(e=0;e<r.length;e+=3)if(t=r[e],o&&(this[t]=$t[t]),(i=n[t])!==void 0)if(oe(i)===i&&i>=r[e+1]&&i<=r[e+2])this[t]=i;else throw Error(Ce+t+": "+i);if(t="crypto",o&&(this[t]=$t[t]),(i=n[t])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Hn);else this[t]=!1;else throw Error(Ce+t+": "+i);return this}function Ar(n){return new this(n).cos()}function kr(n){return new this(n).cosh()}function ei(n){var e,t,i;function o(r){var s,a,c,u=this;if(!(u instanceof o))return new o(r);if(u.constructor=o,Un(r)){u.s=r.s,O?!r.d||r.e>o.maxE?(u.e=NaN,u.d=null):r.e<o.minE?(u.e=0,u.d=[0]):(u.e=r.e,u.d=r.d.slice()):(u.e=r.e,u.d=r.d?r.d.slice():r.d);return}if(c=typeof r,c==="number"){if(r===0){u.s=1/r<0?-1:1,u.e=0,u.d=[0];return}if(r<0?(r=-r,u.s=-1):u.s=1,r===~~r&&r<1e7){for(s=0,a=r;a>=10;a/=10)s++;O?s>o.maxE?(u.e=NaN,u.d=null):s<o.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[r]):(u.e=s,u.d=[r]);return}else if(r*0!==0){r||(u.s=NaN),u.e=NaN,u.d=null;return}return nn(u,r.toString())}else if(c!=="string")throw Error(Ce+r);return(a=r.charCodeAt(0))===45?(r=r.slice(1),u.s=-1):(a===43&&(r=r.slice(1)),u.s=1),Zn.test(r)?nn(u,r):or(u,r)}if(o.prototype=P,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.EUCLID=9,o.config=o.set=Pr,o.clone=ei,o.isDecimal=Un,o.abs=ar,o.acos=ur,o.acosh=cr,o.add=lr,o.asin=mr,o.asinh=dr,o.atan=pr,o.atanh=fr,o.atan2=br,o.cbrt=gr,o.ceil=yr,o.clamp=wr,o.cos=Ar,o.cosh=kr,o.div=Tr,o.exp=hr,o.floor=Br,o.hypot=xr,o.ln=Ir,o.log=Sr,o.log10=Kr,o.log2=Cr,o.max=Nr,o.min=Lr,o.mod=Rr,o.mul=Mr,o.pow=Or,o.random=Fr,o.round=vr,o.sign=Er,o.sin=Dr,o.sinh=Wr,o.sqrt=Vr,o.sub=_r,o.sum=qr,o.tan=Ur,o.tanh=Gr,o.trunc=Xr,n===void 0&&(n={}),n&&n.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<i.length;)n.hasOwnProperty(t=i[e++])||(n[t]=this[t]);return o.config(n),o}function Tr(n,e){return new this(n).div(e)}function hr(n){return new this(n).exp()}function Br(n){return N(n=new this(n),n.e+1,3)}function xr(){var n,e,t=new this(0);for(O=!1,n=0;n<arguments.length;)if(e=new this(arguments[n++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return O=!0,new this(1/0);t=e}return O=!0,t.sqrt()}function Un(n){return n instanceof tt||n&&n.toStringTag===zn||!1}function Ir(n){return new this(n).ln()}function Sr(n,e){return new this(n).log(e)}function Cr(n){return new this(n).log(2)}function Kr(n){return new this(n).log(10)}function Nr(){return Yn(this,arguments,"lt")}function Lr(){return Yn(this,arguments,"gt")}function Rr(n,e){return new this(n).mod(e)}function Mr(n,e){return new this(n).mul(e)}function Or(n,e){return new this(n).pow(e)}function Fr(n){var e,t,i,o,r=0,s=new this(1),a=[];if(n===void 0?n=this.precision:ae(n,1,Ke),i=Math.ceil(n/R),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(i));r<i;)o=e[r],o>=429e7?e[r]=crypto.getRandomValues(new Uint32Array(1))[0]:a[r++]=o%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(i*=4);r<i;)o=e[r]+(e[r+1]<<8)+(e[r+2]<<16)+((e[r+3]&127)<<24),o>=214e7?crypto.randomBytes(4).copy(e,r):(a.push(o%1e7),r+=4);r=i/4}else throw Error(Hn);else for(;r<i;)a[r++]=Math.random()*1e7|0;for(i=a[--r],n%=R,i&&n&&(o=ee(10,R-n),a[r]=(i/o|0)*o);a[r]===0;r--)a.pop();if(r<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=R)a.shift();for(i=1,o=a[0];o>=10;o/=10)i++;i<R&&(t-=R-i)}return s.e=t,s.d=a,s}function vr(n){return N(n=new this(n),n.e+1,this.rounding)}function Er(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function Dr(n){return new this(n).sin()}function Wr(n){return new this(n).sinh()}function Vr(n){return new this(n).sqrt()}function _r(n,e){return new this(n).sub(e)}function qr(){var n=0,e=arguments,t=new this(e[n]);for(O=!1;t.s&&++n<e.length;)t=t.plus(e[n]);return O=!0,N(t,this.precision,this.rounding)}function Ur(n){return new this(n).tan()}function Gr(n){return new this(n).tanh()}function Xr(n){return N(n=new this(n),n.e+1,1)}P[Symbol.for("nodejs.util.inspect.custom")]=P.toString;P[Symbol.toStringTag]="Decimal";var tt=P.constructor=ei($t);Tt=new tt(Tt);ht=new tt(ht);var Z=tt;import Mo from"big.js";import hc from"bn.js";import{get as ti,set as Hr}from"lodash";var on=class{logLevel;name;constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(i=>typeof i=="object"?JSON.stringify(i):i).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ni={},zr={};function ne(n){let e=ti(ni,n);if(!e){let t=ti(zr,n);e=new on({name:n,logLevel:t}),Hr(ni,n,e)}return e}import{PublicKey as ii}from"@solana/web3.js";import{MINT_SIZE as Zr,TOKEN_PROGRAM_ID as jr,getTransferFeeConfig as Qr,unpackMint as Yr}from"@solana/spl-token";var sn=ne("Raydium_accountInfo_util");async function nt(n,e,t){let{batchRequest:i,commitment:o="confirmed",chunkCount:r=100}={batchRequest:!1,...t},s=an(e,r),a=new Array(s.length).fill([]);if(i){let c=s.map(l=>{let d=n._buildArgs([l.map(p=>p.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=an(c,10);a=(await(await Promise.all(u.map(async l=>await n._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&sn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(d=>{if(d){let{data:p,executable:f,lamports:g,owner:y,rentEpoch:k}=d;return p.length!==2&&p[1]!=="base64"&&sn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:f,lamports:g,owner:new ii(y),rentEpoch:k}}return null})))}else try{a=await Promise.all(s.map(c=>n.getMultipleAccountsInfo(c,o)))}catch(c){c instanceof Error&&sn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function he(n,e,t){let i=await nt(n,e.map(o=>o.pubkey),t);return e.map((o,r)=>({...o,accountInfo:i[r]}))}async function un({connection:n,mints:e,config:t}){if(e.length===0)return{};let i=await he(n,e.map(r=>({pubkey:it(r)})),t),o={};for(let r of i){if(!r.accountInfo||r.accountInfo.data.length<Zr){console.log("invalid mint account",r.pubkey.toBase58());continue}let s=Yr(r.pubkey,r.accountInfo,r.accountInfo?.owner);o[r.pubkey.toString()]={...s,programId:r.accountInfo?.owner||jr,feeConfig:Qr(s)??void 0}}return o[ii.default.toBase58()]=o[ce.toBase58()],o}import rt from"bn.js";var ri=9007199254740991;function we(n){let e=ne("Raydium_parseBigNumberish");if(n instanceof rt)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new rt(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=ri||n<=-ri)&&e.logWithError(`BigNumberish number overflow: ${n}`),new rt(String(n))):typeof n=="bigint"?new rt(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new rt(0))}import{PublicKey as Jr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as oi}from"@solana/spl-token";var cn={chainId:101,address:Jr.default.toBase58(),programId:oi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Ne={chainId:101,address:"So11111111111111111111111111111111111111112",programId:oi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as dn}from"@solana/web3.js";import{PublicKey as j,SystemProgram as si,SYSVAR_RENT_PUBKEY as $r}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as eo}from"@solana/spl-token";function ln({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var qs=[ln({pubkey:eo,isWritable:!1}),ln({pubkey:si.programId,isWritable:!1}),ln({pubkey:$r,isWritable:!1})];function mn({publicKey:n,transformSol:e}){let t=ai(n.toString());if(t instanceof j)return e&&t.equals(ot)?ce:t;if(e&&t.toString()===ot.toBase58())return ce;if(typeof t=="string"){if(t===j.default.toBase58())return j.default;try{return new j(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ai(n){try{return new j(n)}catch{return n}}var to=new j("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ct=new j("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Kt=new j("SysvarRent111111111111111111111111111111111"),Us=new j("SysvarC1ock11111111111111111111111111111111"),qe=new j("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Gs=new j("Sysvar1nstructions1111111111111111111111111"),ui=si.programId,Xs=new j("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Hs=new j("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),zs=new j("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Zs=new j("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),js=new j("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Qs=new j("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ys=new j("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Js=new j("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),$s=new j("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),ea=new j("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ta=new j("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ce=new j("So11111111111111111111111111111111111111112"),ot=j.default;function it(n){return mn({publicKey:n,transformSol:!0})}var pn=class{symbol;name;decimals;isToken2022;mint;constructor({mint:e,decimals:t,symbol:i,name:o,skipMint:r=!1,isToken2022:s=!1}){if(e===ot.toBase58()||e instanceof dn&&ot.equals(e)){this.decimals=Ne.decimals,this.symbol=Ne.symbol,this.name=Ne.name,this.mint=new dn(Ne.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=i||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=r?dn.default:mn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Le=pn;At(Le,"WSOL",new pn({...Ne,mint:Ne.address}));var fn=class{symbol;name;decimals;constructor({decimals:e,symbol:t="UNKNOWN",name:i="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=i}equals(e){return this===e}},Nt=fn;At(Nt,"SOL",new fn(cn));import no from"toformat";var io=no,st=io;import Rt from"big.js";import oo from"bn.js";import so from"decimal.js-light";var Lt=ne("module/fraction"),bn=st(Rt),at=st(so),ao={[0]:at.ROUND_DOWN,[1]:at.ROUND_HALF_UP,[2]:at.ROUND_UP},uo={[0]:Rt.roundDown,[1]:Rt.roundHalfUp,[2]:Rt.roundUp},X=class{numerator;denominator;constructor(e,t=new oo(1)){this.numerator=we(e),this.denominator=we(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new X(this.denominator,this.numerator)}add(e){let t=e instanceof X?e:new X(we(e));return this.denominator.eq(t.denominator)?new X(this.numerator.add(t.numerator),this.denominator):new X(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof X?e:new X(we(e));return this.denominator.eq(t.denominator)?new X(this.numerator.sub(t.numerator),this.denominator):new X(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof X?e:new X(we(e));return new X(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof X?e:new X(we(e));return new X(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},i=1){Number.isInteger(e)||Lt.logWithError(`${e} is not an integer.`),e<=0&&Lt.logWithError(`${e} is not positive.`),at.set({precision:e+1,rounding:ao[i]});let o=new at(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},i=1){return Number.isInteger(e)||Lt.logWithError(`${e} is not an integer.`),e<0&&Lt.logWithError(`${e} is negative.`),bn.DP=e,bn.RM=uo[i]||1,new bn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};import co from"bn.js";var ci=new X(new co(100)),le=class extends X{toSignificant(e=5,t,i){return this.mul(ci).toSignificant(e,t,i)}toFixed(e=2,t,i){return this.mul(ci).toFixed(e,t,i)}};var Ca=ne("Raydium_price");function an(n,e=1,t=[]){let i=[...n];if(e<=0)return t;for(;i.length;)t.push(i.splice(0,e));return t}import{PublicKey as yo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as wo}from"@solana/spl-token";import{ComputeBudgetProgram as li,Keypair as di,PublicKey as lo,Transaction as pi,TransactionMessage as mo,VersionedTransaction as fi}from"@solana/web3.js";var te={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip",NonceAccount:"NonceAccount"};import{TOKEN_PROGRAM_ID as po}from"@solana/spl-token";var mi=ne("Raydium_txUtil"),bi=1644;function Ue(n){let e=[],t=[];return n.microLamports&&(e.push(li.setComputeUnitPrice({microLamports:n.microLamports})),t.push(te.SetComputeUnitPrice)),n.units&&(e.push(li.setComputeUnitLimit({units:n.units})),t.push(te.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Ge(n,e){let t=e??"confirmed";return(await n.getLatestBlockhash?.({commitment:t}))?.blockhash}async function Ot(n,e){return n.getSignatureStatuses([e]),new Promise((t,i)=>{let o=setTimeout(i,6e4);n.onSignature(e,r=>{if(clearTimeout(o),!r.err){t("");return}i(Object.assign(r.err,{txId:e}))},"confirmed")})}function fo(n,e){n.length<1&&mi.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&mi.logWithError(`no signers provided:, ${e.toString()}`);let t=new pi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<bi}catch{return!1}}function be(n,e){let[t,i]=lo.findProgramAddressSync(n,e);return{publicKey:t,nonce:i}}function ut({instructions:n,payer:e,signers:t}){return fo(n,[e,...t])}function ct({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:i=di.generate().publicKey.toString()}){let r=new mo({payerKey:e,recentBlockhash:i,instructions:n}).compileToV0Message(Object.values(t??{}));try{return Buffer.from(new fi(r).serialize()).toString("base64").length<bi}catch{return!1}}var bo=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),go=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof fi&&(e=bo(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Oe(n){let e=[];return n.forEach(t=>{t instanceof pi&&(t.recentBlockhash||(t.recentBlockhash=po.toBase58()),t.feePayer||(t.feePayer=di.generate().publicKey)),e.push(go(t))}),console.log("simulate tx string:",e),e}function Pe(n,e,t){return be([n.toBuffer(),(t??wo).toBuffer(),e.toBuffer()],new yo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as F}from"@solana/web3.js";var uu=new F("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),cu=new F("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),lu=new F("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),mu=new F("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),du=new F("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),pu=new F("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),fu=new F("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),bu=new F("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),gu=new F("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),yu=new F("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Po=new F("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Ao=new F("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ko=new F("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),wu=new F("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Pu=new F("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Au=new F("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),ku=new F("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Tu=new F("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),hu=new F("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),gi=new F("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),yi=new F("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Bu=new F("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),To=new F("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),ho=new F("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Bo=new F("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Ft=new F("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),xo=new F("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),vt=new F("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Io=new F("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),xu=new F("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Iu=new F("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),So=new F("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),Co=new F("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var Su={SERUM_MARKET:F.default,OPENBOOK_MARKET:new F("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:F.default,FarmV3:new F("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new F("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new F("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new F("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new F("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new F("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new F("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new F("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new F("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:To,CREATE_CPMM_POOL_AUTH:ho,CREATE_CPMM_POOL_FEE_ACC:Bo,FEE_DESTINATION_ID:new F("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:xo,LCOK_CPMM_AUTH:Io,LAUNCHPAD_PROGRAM:So,LAUNCHPAD_AUTH:Co};import ge from"bn.js";var lt=1e4;function Ae(n,e,t,i){if(e===void 0)return{amount:n,fee:void 0,expirationTime:void 0};let o={...e,olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}},r=t.epoch<o.newerTransferFee.epoch?o.olderTransferFee:o.newerTransferFee,s=new ge(r.maximumFee.toString()),a=t.epoch<o.newerTransferFee.epoch?(Number(o.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(i)if(r.transferFeeBasisPoints===lt){let c=new ge(r.maximumFee.toString());return{amount:n.add(c),fee:c,expirationTime:a}}else{let c=Xe(n.mul(new ge(lt)),new ge(lt-r.transferFeeBasisPoints)),u=new ge(r.maximumFee.toString()),m=c.sub(n).gt(u)?n.add(u):c,l=Xe(m.mul(new ge(r.transferFeeBasisPoints)),new ge(lt)),d=l.gt(s)?s:l;return{amount:m,fee:d,expirationTime:a}}else{let c=Xe(n.mul(new ge(r.transferFeeBasisPoints)),new ge(lt)),u=c.gt(s)?s:c;return{amount:n,fee:u,expirationTime:a}}}function Xe(n,e){let{div:t,mod:i}=n.divmod(e);return i.gt(new ge(0))?t.add(new ge(1)):t}import{PublicKey as wi,AddressLookupTableAccount as Et}from"@solana/web3.js";async function wn({connection:n,address:e}){let t=await nt(n,[...new Set(e.map(o=>o.toString()))].map(o=>new wi(o))),i={};for(let o=0;o<e.length;o++){let r=t[o],s=e[o];if(!r)continue;let a=new Et({key:s,state:Et.deserialize(r.data)});i[s.toString()]=a,Dt[s.toString()]=a}return i}var Dt={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Et({key:new wi("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Et.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as He,sendAndConfirmTransaction as Pn,SystemProgram as No,Transaction as mt,TransactionMessage as dt,VersionedTransaction as pt}from"@solana/web3.js";import Lo from"axios";var Wt=2e3,Vt=class{connection;owner;instructions=[];endInstructions=[];lookupTableAddress=[];signers=[];instructionTypes=[];endInstructionTypes=[];feePayer;cluster;signAllTransactions;blockhashCommitment;loopMultiTxStatus;constructor(e){this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){let e=(await Lo.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=e?.[15]??{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:i}=Ue(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...i),!0}return!1}addTipInstruction(e){return e?(this.endInstructions.push(No.transfer({fromPubkey:e.feePayer??this.feePayer,toPubkey:new He(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(te.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let i=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(i))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:i=[],instructionTypes:o=[],endInstructionTypes:r=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...i),this.instructionTypes.push(...o),this.endInstructionTypes.push(...r),this.lookupTableAddress.push(...s.filter(a=>a!==He.default.toString())),this}async versionBuild({txVersion:e,extInfo:t},i){return e===0?await this.buildV0({...t||{}},i):this.build(t,i)}build(e,t){let i=new mt;return this.allInstructions.length&&i.add(...this.allInstructions),i.feePayer=this.feePayer,this.owner?.signer&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:i,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{let{recentBlockHash:r,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=o||{},u=r??t??await Ge(this.connection,this.blockhashCommitment);if(i.recentBlockhash=u,this.signers.length&&i.sign(...this.signers),Oe([i]),this.owner?.isKeyPair)return{txId:a?await Pn(this.connection,i,this.signers.find(l=>l.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(i.serialize(),{skipPreflight:s}),signedTx:i};if(this.signAllTransactions){let m=await this.signAllTransactions([i]);if(this.signers.length)for(let l of m)try{l.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:i}=e,{transaction:o}=this.build(i),r=t.filter(u=>u.transaction.instructions.length>0),s=[o,...r.map(u=>u.transaction)],a=[this.signers,...r.map(u=>u.signers)],c=[...this.instructionTypes,...r.map(u=>u.instructionTypes).flat()];return this.owner?.signer&&a.forEach(u=>{u.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async u=>{let{sequentially:m,onTxUpdate:l,skipTxCount:d=0,recentBlockHash:p,skipPreflight:f=!0}=u||{},g=p??await Ge(this.connection,this.blockhashCommitment);if(this.owner?.isKeyPair){if(m){let y=[],k=0;for(let w of s){if(++k,k<=d)continue;let b=await Pn(this.connection,w,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});y.push(b)}return{txIds:y,signedTxs:s}}return{txIds:await await Promise.all(s.map(async y=>(y.recentBlockhash=g,await this.connection.sendRawTransaction(y.serialize(),{skipPreflight:f})))),signedTxs:s}}if(this.signAllTransactions){let y=s.map((w,b)=>(w.recentBlockhash=g,a[b].length&&w.sign(...a[b]),w));Oe(y);let k=await this.signAllTransactions(y);if(m){let w=0,b=[],A=async()=>{if(!k[w])return;let T=await this.connection.sendRawTransaction(k[w].serialize(),{skipPreflight:f});b.push({txId:T,status:"sent",signedTx:k[w]}),l?.([...b]),w++;let x=!1,B=null,S=null,L=E=>{B!==null&&clearInterval(B),S!==null&&this.connection.removeSignatureListener(S);let M=b.findIndex(_=>_.txId===T);if(M>-1){if(b[M].status==="error"||b[M].status==="success")return;b[M].status=E.err?"error":"success"}l?.([...b]),E.err||A()};this.loopMultiTxStatus&&(B=setInterval(async()=>{if(x){clearInterval(B);return}try{let E=await this.connection.getTransaction(T,{commitment:"confirmed",maxSupportedTransactionVersion:0});E&&(x=!0,clearInterval(B),L({err:E.meta?.err||null}),console.log("tx status from getTransaction:",T))}catch(E){x=!0,clearInterval(B),console.error("getTransaction timeout:",E,T)}},Wt)),S=this.connection.onSignature(T,E=>{if(x){this.connection.removeSignatureListener(S);return}x=!0,L(E)},"confirmed"),this.connection.getSignatureStatus(T)};return await A(),{txIds:b.map(T=>T.txId),signedTxs:k}}else{let w=[];for(let b=0;b<k.length;b+=1){let A=await this.connection.sendRawTransaction(k[b].serialize(),{skipPreflight:f});w.push(A)}return{txIds:w,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:i}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:i||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:i})}async buildV0(e,t){let{lookupTableCache:i={},lookupTableAddress:o=[],forerunCreate:r,recentBlockhash:s,...a}=e||{},c={...this.cluster==="devnet"?{}:Dt,...i},u=Array.from(new Set([...o,...this.lookupTableAddress])),m=[];for(let f of u)c[f]===void 0&&m.push(new He(f));if(m.length>0){let f=await wn({connection:this.connection,address:m});for(let[g,y]of Object.entries(f))c[g]=y}let l=t??(r?He.default.toBase58():s??await Ge(this.connection,this.blockhashCommitment)),d=new dt({payerKey:this.feePayer,recentBlockhash:l,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(c));this.owner?.signer&&!this.signers.some(f=>f.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new pt(d);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async f=>{let{skipPreflight:g=!0,sendAndConfirm:y,notSendToRpc:k}=f||{};if(Oe([p]),this.owner?.isKeyPair){let w=await this.connection.sendTransaction(p,{skipPreflight:g});return y&&await Ot(this.connection,w),{txId:w,signedTx:p}}if(this.signAllTransactions){let w=await this.signAllTransactions([p]);if(this.signers.length)for(let b of w)try{b.sign(this.signers)}catch{}return{txId:k?"":await this.connection.sendTransaction(w[0],{skipPreflight:g}),signedTx:w[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(e){let{extraPreBuildData:t=[],buildProps:i}=e,{transaction:o}=await this.buildV0(i),r=t.filter(u=>u.builder.instructions.length>0),s=[o,...r.map(u=>u.transaction)],a=[this.signers,...r.map(u=>u.signers)],c=[...this.instructionTypes,...r.map(u=>u.instructionTypes).flat()];return this.owner?.signer&&a.forEach(u=>{u.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(u,m)=>{u.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:i,execute:async u=>{let{sequentially:m,onTxUpdate:l,recentBlockHash:d,skipPreflight:p=!0}=u||{};if(d&&s.forEach(f=>f.message.recentBlockhash=d),Oe(s),this.owner?.isKeyPair){if(m){let f=[];for(let g of s){let y=await this.connection.sendTransaction(g,{skipPreflight:p});await Ot(this.connection,y),f.push(y)}return{txIds:f,signedTxs:s}}return{txIds:await Promise.all(s.map(async f=>await this.connection.sendTransaction(f,{skipPreflight:p}))),signedTxs:s}}if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(m){let g=0,y=[],k=async()=>{if(!f[g])return;let w=await this.connection.sendTransaction(f[g],{skipPreflight:p});y.push({txId:w,status:"sent",signedTx:f[g]}),l?.([...y]),g++;let b=!1,A=null,T=null,x=B=>{A!==null&&clearInterval(A),T!==null&&this.connection.removeSignatureListener(T);let S=y.findIndex(L=>L.txId===w);if(S>-1){if(y[S].status==="error"||y[S].status==="success")return;y[S].status=B.err?"error":"success"}l?.([...y]),B.err||k()};this.loopMultiTxStatus&&(A=setInterval(async()=>{if(b){clearInterval(A);return}try{let B=await this.connection.getTransaction(w,{commitment:"confirmed",maxSupportedTransactionVersion:0});B&&(b=!0,clearInterval(A),x({err:B.meta?.err||null}),console.log("tx status from getTransaction:",w))}catch(B){b=!0,clearInterval(A),console.error("getTransaction timeout:",B,w)}},Wt)),T=this.connection.onSignature(w,B=>{if(b){this.connection.removeSignatureListener(T);return}b=!0,x(B)},"confirmed"),this.connection.getSignatureStatus(w)};return k(),{txIds:[],signedTxs:f}}else{let g=[];for(let y=0;y<f.length;y+=1){let k=await this.connection.sendTransaction(f[y],{skipPreflight:p});g.push(k)}return{txIds:g,signedTxs:f}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuild(e){let{splitIns:t=[],computeBudgetConfig:i,...o}=e||{},r=i?Ue(i):{instructions:[],instructionTypes:[]},s=this.signers.reduce((l,d)=>({...l,[d.publicKey.toBase58()]:d}),{}),a=[],c=[],u=[],m=0;if(this.allInstructions.forEach(l=>{let d=[...u,l],p=i?[...r.instructions,...d]:d,g=[...new Set(d.map(y=>y.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(y=>new He(y));if(l!==t[m]&&u.length<12&&(ut({instructions:p,payer:this.feePayer,signers:g})||ut({instructions:d,payer:this.feePayer,signers:g})))u.push(l);else{if(u.length===0)throw Error("item ins too big");m+=l===t[m]?1:0,ut({instructions:i?[...r.instructions,...u]:[...u],payer:this.feePayer,signers:g})?a.push(new mt().add(...r.instructions,...u)):a.push(new mt().add(...u)),c.push(Array.from(new Set(u.map(y=>y.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(y=>s[y]).filter(y=>y!==void 0)),u=[l]}}),u.length>0){let d=[...new Set(u.map(p=>p.keys.filter(f=>f.isSigner).map(f=>f.pubkey.toString())).flat()).values()].map(p=>s[p]).filter(p=>p!==void 0);ut({instructions:i?[...r.instructions,...u]:[...u],payer:this.feePayer,signers:d.map(p=>p.publicKey)})?a.push(new mt().add(...r.instructions,...u)):a.push(new mt().add(...u)),c.push(d)}return a.forEach(l=>l.feePayer=this.feePayer),this.owner?.signer&&c.forEach(l=>{l.some(d=>d.publicKey.equals(this.owner.publicKey))||l.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async l=>{let{sequentially:d,onTxUpdate:p,skipTxCount:f=0,recentBlockHash:g,skipPreflight:y=!0}=l||{},k=g??await Ge(this.connection,this.blockhashCommitment);if(a.forEach(async(w,b)=>{w.recentBlockhash=k,c[b].length&&w.sign(...c[b])}),Oe(a),this.owner?.isKeyPair){if(d){let w=0,b=[];for(let A of a){if(++w,w<=f){b.push("tx skipped");continue}let T=await Pn(this.connection,A,this.signers.find(x=>x.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});b.push(T)}return{txIds:b,signedTxs:a}}return{txIds:await Promise.all(a.map(async w=>await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:y}))),signedTxs:a}}if(this.signAllTransactions){let w=await this.signAllTransactions(a.slice(f,a.length)),b=[...a.slice(0,f),...w];if(d){let A=0,T=[],x=async()=>{if(!b[A])return;A<f&&(T.push({txId:"",status:"success",signedTx:b[A]}),p?.([...T]),A++,x());let B=await this.connection.sendRawTransaction(b[A].serialize(),{skipPreflight:y});T.push({txId:B,status:"sent",signedTx:b[A]}),p?.([...T]),A++;let S=!1,L=null,E=null,M=_=>{L!==null&&clearInterval(L),E!==null&&this.connection.removeSignatureListener(E);let W=T.findIndex($=>$.txId===B);if(W>-1){if(T[W].status==="error"||T[W].status==="success")return;T[W].status=_.err?"error":"success"}p?.([...T]),_.err||x()};this.loopMultiTxStatus&&(L=setInterval(async()=>{if(S){clearInterval(L);return}try{let _=await this.connection.getTransaction(B,{commitment:"confirmed",maxSupportedTransactionVersion:0});_&&(S=!0,clearInterval(L),M({err:_.meta?.err||null}),console.log("tx status from getTransaction:",B))}catch(_){S=!0,clearInterval(L),console.error("getTransaction timeout:",_,B)}},Wt)),E=this.connection.onSignature(B,_=>{if(S){this.connection.removeSignatureListener(E);return}S=!0,M(_)},"confirmed"),this.connection.getSignatureStatus(B)};return await x(),{txIds:T.map(B=>B.txId),signedTxs:b}}else{let A=[];for(let T=0;T<b.length;T+=1){let x=await this.connection.sendRawTransaction(b[T].serialize(),{skipPreflight:y});A.push(x)}return{txIds:A,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(e){let{computeBudgetConfig:t,splitIns:i=[],lookupTableCache:o={},lookupTableAddress:r=[],...s}=e||{},a={...this.cluster==="devnet"?{}:Dt,...o},c=Array.from(new Set([...this.lookupTableAddress,...r])),u=[];for(let w of c)a[w]===void 0&&u.push(new He(w));let m=await wn({connection:this.connection,address:u});for(let[w,b]of Object.entries(m))a[w]=b;let l=t?Ue(t):{instructions:[],instructionTypes:[]},d=await Ge(this.connection,this.blockhashCommitment),p=this.signers.reduce((w,b)=>({...w,[b.publicKey.toBase58()]:b}),{}),f=[],g=[],y=[],k=0;if(this.allInstructions.forEach(w=>{let b=[...y,w],A=t?[...l.instructions,...b]:b;if(w!==i[k]&&y.length<12&&(ct({instructions:A,payer:this.feePayer,lookupTableAddressAccount:a})||ct({instructions:b,payer:this.feePayer,lookupTableAddressAccount:a})))y.push(w);else{if(y.length===0)throw Error("item ins too big");k+=w===i[k]?1:0;let T={};for(let x of[...new Set(c)])a[x]!==void 0&&(T[x]=a[x]);if(t&&ct({instructions:[...l.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let x=new dt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...l.instructions,...y]}).compileToV0Message(Object.values(a));f.push(new pt(x))}else{let x=new dt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...y]}).compileToV0Message(Object.values(a));f.push(new pt(x))}g.push(Array.from(new Set(y.map(x=>x.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(x=>p[x]).filter(x=>x!==void 0)),y=[w]}}),y.length>0){let b=[...new Set(y.map(A=>A.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(A=>p[A]).filter(A=>A!==void 0);if(t&&ct({instructions:[...l.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let A=new dt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...l.instructions,...y]}).compileToV0Message(Object.values(a));f.push(new pt(A))}else{let A=new dt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...y]}).compileToV0Message(Object.values(a));f.push(new pt(A))}g.push(b)}return this.owner?.signer&&g.forEach(w=>{w.some(b=>b.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),f.forEach((w,b)=>{w.sign(g[b])}),{builder:this,transactions:f,buildProps:e,signers:g,instructionTypes:this.instructionTypes,execute:async w=>{let{sequentially:b,onTxUpdate:A,skipTxCount:T=0,recentBlockHash:x,skipPreflight:B=!0}=w||{};if(f.map(async(S,L)=>{g[L].length&&S.sign(g[L]),x&&(S.message.recentBlockhash=x)}),Oe(f),this.owner?.isKeyPair){if(b){let S=0,L=[];for(let E of f){if(++S,S<=T){console.log("skip tx: ",S),L.push("tx skipped");continue}let M=await this.connection.sendTransaction(E,{skipPreflight:B});await Ot(this.connection,M),L.push(M)}return{txIds:L,signedTxs:f}}return{txIds:await Promise.all(f.map(async S=>await this.connection.sendTransaction(S,{skipPreflight:B}))),signedTxs:f}}if(this.signAllTransactions){let S=await this.signAllTransactions(f.slice(T,f.length)),L=[...f.slice(0,T),...S];if(b){let E=0,M=[],_=async()=>{if(!L[E])return;if(E<T){M.push({txId:"",status:"success",signedTx:L[E]}),A?.([...M]),E++,_();return}let W=await this.connection.sendTransaction(L[E],{skipPreflight:B});M.push({txId:W,status:"sent",signedTx:L[E]}),A?.([...M]),E++;let $=!1,V=null,D=null,de=H=>{V!==null&&clearInterval(V),D!==null&&this.connection.removeSignatureListener(D);let re=M.findIndex(Me=>Me.txId===W);if(re>-1){if(M[re].status==="error"||M[re].status==="success")return;M[re].status=H.err?"error":"success"}A?.([...M]),H.err||_()};this.loopMultiTxStatus&&(V=setInterval(async()=>{if($){clearInterval(V);return}try{let H=await this.connection.getTransaction(W,{commitment:"confirmed",maxSupportedTransactionVersion:0});H&&($=!0,clearInterval(V),de({err:H.meta?.err||null}),console.log("tx status from getTransaction:",W))}catch(H){$=!0,clearInterval(V),console.error("getTransaction timeout:",H,W)}},Wt)),D=this.connection.onSignature(W,H=>{if($){this.connection.removeSignatureListener(D);return}$=!0,de(H)},"confirmed"),this.connection.getSignatureStatus(W)};return _(),{txIds:[],signedTxs:L}}else{let E=[];for(let M=0;M<L.length;M+=1){let _=await this.connection.sendTransaction(L[M],{skipPreflight:B});E.push(_)}return{txIds:E,signedTxs:L}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};import{PublicKey as Zu}from"@solana/web3.js";import Qu from"bn.js";import Ro from"bn.js";var _t=new Ro(1e6);var Rc=ne("Raydium_amount"),Mc=st(Mo);var yn=new ke(0),jc=new ke(1),Qc=new ke(2),Yc=new ke(3),Jc=new ke(5),Oo=new ke(10),$c=new ke(100),el=new ke(1e3),tl=new ke(1e4);function Pi(n,e,t){return n.mul(e).add(t).sub(new ke(1)).div(t)}function An(n,e,t){return n.mul(e).div(t)}import kn from"bn.js";import Xt from"decimal.js-light";import ft from"bn.js";function qt(n,e){if(e.isZero())throw Error("divisor is zero");return n.mod(e)}function Fo(n,e){if(e.isZero())throw Error("rhs is zero");let t=n.div(e);if(t.isZero())throw Error("quotient is zero");let i=qt(n,e);return i.gt(ze)&&(t=t.add(new ft(1)),e=n.div(t),i=qt(n,t),i.gt(ze)&&(e=e.add(new ft(1)))),[t,e]}var ze=new ft(0),Ut=class{static swapWithoutFees(e,t,i){let o=t.mul(i),r=t.add(e),[s]=Fo(o,r),a=i.sub(s);if(a.isZero())throw Error("destinationAmountSwapped is zero");return{destinationAmountSwapped:a}}static lpTokensToTradingTokens(e,t,i,o,r){let s=e.mul(i).div(t),a=e.mul(o).div(t);if(r===0)return{tokenAmount0:s,tokenAmount1:a};if(r===1)return qt(e.mul(i),t).gt(ze)&&s.gt(ze)&&(s=s.add(new ft(1))),qt(e.mul(o),t).gt(ze)&&a.gt(ze)&&(a=a.add(new ft(1))),{tokenAmount0:s,tokenAmount1:a};throw Error("roundDirection value error")}};var Gt=class{static tradingFee(e,t){return Pi(e,t,_t)}static protocolFee(e,t){return An(e,t,_t)}static fundFee(e,t){return An(e,t,_t)}};var Ht=class{static validate_supply(e,t){if(e.isZero())throw Error("tokenAmount0 is zero");if(t.isZero())throw Error("tokenAmount1 is zero")}static swap(e,t,i,o){let r=Gt.tradingFee(e,o),s=e.sub(r),{destinationAmountSwapped:a}=Ut.swapWithoutFees(s,t,i);return{newSwapDestinationAmount:i.sub(a),sourceAmountSwapped:e,destinationAmountSwapped:a,tradeFee:r}}static swapBaseOut({poolMintA:e,poolMintB:t,tradeFeeRate:i,baseReserve:o,quoteReserve:r,outputMint:s,outputAmount:a}){let[c,u,m,l,d]=t.address===s.toString()?[o,r,e.decimals,t.decimals,e.address]:[r,o,t.decimals,e.decimals,t.address],p=new Xt(u.toString()).div(10**l).div(new Xt(c.toString()).div(10**m)),f=a.gte(u)?u.sub(new kn(1)):a,g=u.sub(f),y=Xe(c.mul(f),g),k=Xe(y.mul(new kn(1e6)),new kn(1e6).sub(i)),w=k.sub(y),b=new Xt(f.toString()).div(10**l).div(new Xt(k.toString()).div(10**m)),A=p.isZero()?0:b.sub(p).div(p).abs().toNumber();return{amountRealOut:f,amountIn:k,amountInWithoutFee:y,tradeFee:w,priceImpact:A}}};import Y from"bn.js";var Tn=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ze=class{scope;disabled=!1;logger;constructor({scope:e,moduleName:t}){this.scope=e,this.logger=ne(t)}createTxBuilder(e){return this.scope.checkOwner(),new Vt({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Tn(e))}logInfo(...e){this.logger.info(Tn(e))}logAndCreateError(...e){let t=Tn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Go}from"@solana/web3.js";import hi,{isBN as Bi}from"bn.js";import{bits as hl,BitStructure as Bl,blob as vo,Blob as xl,cstr as Il,f32 as Sl,f32be as Cl,f64 as Kl,f64be as Nl,greedy as Ll,Layout as Eo,ns64 as Rl,ns64be as Ml,nu64 as Ol,nu64be as Fl,offset as vl,s16 as El,s16be as Dl,s24 as Wl,s24be as Vl,s32 as Do,s32be as _l,s40 as ql,s40be as Ul,s48 as Gl,s48be as Xl,s8 as Hl,seq as Wo,struct as zl,Structure as Vo,u16 as _o,u16be as Zl,u24 as jl,u24be as Ql,u32 as Yl,u32be as Jl,u40 as $l,u40be as em,u48 as tm,u48be as nm,u8 as qo,UInt as Uo,union as im,Union as rm,unionLayoutDiscriminator as om,utf8 as sm}from"@solana/buffer-layout";var hn=Eo,Ai=Vo;var Bn=Uo;var ki=qo,Fe=_o;var Be=Do;var Ti=Wo;var se=vo;var je=class extends hn{blob;signed;constructor(e,t,i){super(e,i),this.blob=se(e),this.signed=t}decode(e,t=0){let i=new hi(this.blob.decode(e,t),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(e,t,i=0){return typeof e=="number"&&(e=new hi(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),t,i)}};function z(n){return new Bn(1,n)}function xe(n){return new Bn(4,n)}function I(n){return new je(8,!1,n)}function Q(n){return new je(16,!1,n)}function xi(n){return new je(8,!0,n)}function Ii(n){return new je(16,!0,n)}var zt=class extends hn{layout;decoder;encoder;constructor(e,t,i,o){super(e.span,o),this.layout=e,this.decoder=t,this.encoder=i}decode(e,t){return this.decoder(this.layout.decode(e,t))}encode(e,t,i){return this.layout.encode(this.encoder(e),t,i)}getSpan(e,t){return this.layout.getSpan(e,t)}};function v(n){return new zt(se(32),e=>new Go(e),e=>e.toBuffer(),n)}function ve(n){return new zt(ki(),Xo,Ho,n)}function Xo(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function Ho(n){return n?1:0}var xn=class extends Ai{decode(e,t){return super.decode(e,t)}};function q(n,e,t){return new xn(n,e,t)}function G(n,e,t){let i,o=typeof e=="number"?e:Bi(e)?e.toNumber():new Proxy(e,{get(r,s){if(!i){let a=Reflect.get(r,"count");i=Bi(a)?a.toNumber():a,Reflect.set(r,"count",i)}return Reflect.get(r,s)},set(r,s,a){return s==="count"&&(i=a),Reflect.set(r,s,a)}});return Ti(n,o,t)}var Am=q([xe("mintAuthorityOption"),v("mintAuthority"),I("supply"),z("decimals"),z("isInitialized"),xe("freezeAuthorityOption"),v("freezeAuthority")]);import{PublicKey as Bm}from"@solana/web3.js";import{MintLayout as Im,TOKEN_PROGRAM_ID as Cm}from"@solana/spl-token";var Ee=({address:n,programId:e,decimals:t,...i})=>({chainId:101,address:it(n).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:i.extensions||{},...i}),Qe=n=>n?{...n,transferFeeConfigAuthority:n.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:n.withdrawWithheldAuthority.toBase58(),withheldAmount:n.withheldAmount.toString(),olderTransferFee:{...n.olderTransferFee,epoch:n.olderTransferFee.epoch.toString(),maximumFee:n.olderTransferFee.maximumFee.toString()},newerTransferFee:{...n.newerTransferFee,epoch:n.newerTransferFee.epoch.toString(),maximumFee:n.newerTransferFee.maximumFee.toString()}}:void 0;import{PublicKey as Pt,TransactionInstruction as De,Keypair as bs,SystemProgram as gs}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as _i,TOKEN_2022_PROGRAM_ID as On,TOKEN_PROGRAM_ID as Re}from"@solana/spl-token";var zo=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Vm=Buffer.from("amm_config","utf8"),Zo=Buffer.from("pool","utf8"),jo=Buffer.from("pool_lp_mint","utf8"),Qo=Buffer.from("pool_vault","utf8"),Yo=Buffer.from("observation","utf8");function Zt(n){return be([zo],n)}function In(n,e,t,i){return be([Zo,e.toBuffer(),t.toBuffer(),i.toBuffer()],n)}function Jo(n,e){return be([jo,e.toBuffer()],n)}function Si(n,e,t){return be([Qo,e.toBuffer(),t.toBuffer()],n)}function bt(n,e){return be([Yo,e.toBuffer()],n)}function Ci({poolId:n,programId:e,configId:t,mintA:i,mintB:o}){let r=Zt(e).publicKey,s=n||In(e,t,i,o).publicKey,a=Jo(e,s).publicKey,c=Si(e,s,i).publicKey,u=Si(e,s,o).publicKey,m=bt(e,s).publicKey;return{poolId:s,configId:t,authority:r,lpMint:a,vaultA:c,vaultB:u,observationId:m}}var $o=Buffer.from("locked_liquidity","utf8");function jt(n,e){return be([$o,e.toBuffer()],n)}import{PublicKey as Tf}from"@solana/web3.js";import Bf from"bn.js";import{AccountLayout as Cf,TOKEN_2022_PROGRAM_ID as Kf,TOKEN_PROGRAM_ID as Nf}from"@solana/spl-token";import{Keypair as Zp,PublicKey as jp,SystemProgram as Yp,TransactionInstruction as Jp}from"@solana/web3.js";import ef from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as rf,TOKEN_2022_PROGRAM_ID as of,TOKEN_PROGRAM_ID as sf}from"@solana/spl-token";import Sp from"bn.js";import me from"bn.js";var Sn=new me(0),Ki=new me(1),Ni=new me(-1),Qt=new me(1).shln(64),Li=new me(1).shln(128),es=Qt.sub(Ki);var ts=Li.subn(1),Ye=-443636,gt=-Ye,Cn=new me("4295048016"),Kn=new me("79226673521066979257578248091"),Um=new me("4295048017"),Gm=new me("79226673521066979257578248090");var ns=new me(10).pow(new me(6));var Xm=new me("18446744073700000000");import pp from"bn.js";var Jm=Buffer.from("amm_config","utf8"),$m=Buffer.from("pool","utf8"),ed=Buffer.from("pool_vault","utf8"),td=Buffer.from("pool_reward_vault","utf8"),nd=Buffer.from("position","utf8"),id=Buffer.from("tick_array","utf8"),rd=Buffer.from("operation","utf8"),od=Buffer.from("pool_tick_array_bitmap_extension","utf8"),sd=Buffer.from("observation","utf8");function Nn(n){return be([Buffer.from("metadata","utf8"),qe.toBuffer(),n.toBuffer()],qe)}var ad=Buffer.from("locked_position","utf8");var ud=Buffer.from("support_mint","utf8");import{PublicKey as _d}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Ud}from"@solana/spl-token";import Xd from"bn.js";import md from"bn.js";var Mn=14;var Yt=60;var ss=q([se(8),z("bump"),Fe("index"),v(""),xe("protocolFeeRate"),xe("tradeFeeRate"),Fe("tickSpacing"),G(I(),8,"")]),as=q([xe("blockTimestamp"),xi("tickCumulative"),G(I(),4)]),Vi=q([se(8),ve("initialized"),I("recentEpoch"),Fe("observationIndex"),v("poolId"),G(as,100,"observations"),G(I(),4)]),us=q([z("rewardState"),I("openTime"),I("endTime"),I("lastUpdateTime"),Q("emissionsPerSecondX64"),I("rewardTotalEmissioned"),I("rewardClaimed"),v("tokenMint"),v("tokenVault"),v("creator"),Q("rewardGrowthGlobalX64")]),Ei=q([se(8),z("bump"),v("ammConfig"),v("creator"),v("mintA"),v("mintB"),v("vaultA"),v("vaultB"),v("observationId"),z("mintDecimalsA"),z("mintDecimalsB"),Fe("tickSpacing"),Q("liquidity"),Q("sqrtPriceX64"),Be("tickCurrent"),xe(),Q("feeGrowthGlobalX64A"),Q("feeGrowthGlobalX64B"),I("protocolFeesTokenA"),I("protocolFeesTokenB"),Q("swapInAmountTokenA"),Q("swapOutAmountTokenB"),Q("swapInAmountTokenB"),Q("swapOutAmountTokenA"),z("status"),G(z(),7,""),G(us,3,"rewardInfos"),G(I(),16,"tickArrayBitmap"),I("totalFeesTokenA"),I("totalFeesClaimedTokenA"),I("totalFeesTokenB"),I("totalFeesClaimedTokenB"),I("fundFeesTokenA"),I("fundFeesTokenB"),I("startTime"),G(I(),15*4-3,"padding")]),cs=q([Q("growthInsideLastX64"),I("rewardAmountOwed")]),Di=q([se(8),z("bump"),v("nftMint"),v("poolId"),Be("tickLower"),Be("tickUpper"),Q("liquidity"),Q("feeGrowthInsideLastX64A"),Q("feeGrowthInsideLastX64B"),I("tokenFeesOwedA"),I("tokenFeesOwedB"),G(cs,3,"rewardInfos"),G(I(),8,"")]),Ep=q([se(8),z("bump"),v("poolId"),Be("tickLowerIndex"),Be("tickUpperIndex"),Q("liquidity"),Q("feeGrowthInsideLastX64A"),Q("feeGrowthInsideLastX64B"),I("tokenFeesOwedA"),I("tokenFeesOwedB"),G(Q(),3,"rewardGrowthInside"),G(I(),8,"")]),ls=q([Be("tick"),Ii("liquidityNet"),Q("liquidityGross"),Q("feeGrowthOutsideX64A"),Q("feeGrowthOutsideX64B"),G(Q(),3,"rewardGrowthsOutsideX64"),G(xe(),13,"")]),Oi=q([se(8),v("poolId"),Be("startTickIndex"),G(ls,Yt,"ticks"),z("initializedTickCount"),G(z(),115,"")]),ms=q([se(329),G(v(),100,"whitelistMints")]),os=q([se(8),v("poolId"),G(G(I(),8),Mn,"positiveTickArrayBitmap"),G(G(I(),8),Mn,"negativeTickArrayBitmap")]),Dp=q([I(),z("bump"),v("owner"),v("poolId"),v("positionId"),v("nftAccount"),G(I(),8)]),Wp=q([se(8),z("bump"),v("lockOwner"),v("poolId"),v("positionId"),v("nftAccount"),v("lockNftMint"),I("recentEpoch"),G(I(),8)]);Vi.span;var bf=ne("Raydium_Clmm");var ys=ne("Raydium_cpmm"),We={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function qi(n,e,t,i,o,r,s,a,c,u,m,l,d,p,f,g,y,k,w,b){let A=q([I("amountMaxA"),I("amountMaxB"),I("openTime")]),T=In(n,t,r,s).publicKey,x=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!o.equals(T),isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:Re,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:_i,isSigner:!1,isWritable:!1},{pubkey:ui,isSigner:!1,isWritable:!1},{pubkey:Kt,isSigner:!1,isWritable:!1}],B=Buffer.alloc(A.span);return A.encode({amountMaxA:k,amountMaxB:w,openTime:b},B),new De({keys:x,programId:n,data:Buffer.from([...We.initialize,...B])})}function Ui(n,e,t,i,o,r,s,a,c,u,m,l,d,p,f){let g=q([I("lpAmount"),I("amountMaxA"),I("amountMaxB")]),y=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:Re,isSigner:!1,isWritable:!1},{pubkey:On,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0}],k=Buffer.alloc(g.span);return ys.debug("cpmm deposit data",{lpAmount:d.toString(),amountMaxA:p.toString(),amountMaxB:f.toString()}),g.encode({lpAmount:d,amountMaxA:p,amountMaxB:f},k),new De({keys:y,programId:n,data:Buffer.from([...We.deposit,...k])})}function Gi(n,e,t,i,o,r,s,a,c,u,m,l,d,p,f){let g=q([I("lpAmount"),I("amountMinA"),I("amountMinB")]),y=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:Re,isSigner:!1,isWritable:!1},{pubkey:On,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:Ct,isSigner:!1,isWritable:!1}],k=Buffer.alloc(g.span);return g.encode({lpAmount:d,amountMinA:p,amountMinB:f},k),new De({keys:y,programId:n,data:Buffer.from([...We.withdraw,...k])})}function Xi(n,e,t,i,o,r,s,a,c,u,m,l,d,p,f,g){let y=q([I("amountIn"),I("amounOutMin")]),k=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],w=Buffer.alloc(y.span);return y.encode({amountIn:f,amounOutMin:g},w),new De({keys:k,programId:n,data:Buffer.from([...We.swapBaseInput,...w])})}function Hi(n,e,t,i,o,r,s,a,c,u,m,l,d,p,f,g){let y=q([I("amountInMax"),I("amountOut")]),k=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],w=Buffer.alloc(y.span);return y.encode({amountInMax:f,amountOut:g},w),new De({keys:k,programId:n,data:Buffer.from([...We.swapBaseOutput,...w])})}async function zi(n){let{ownerInfo:e,poolInfo:t,poolKeys:i,feeNftOwner:o,getEphemeralSigners:r}=n,s=[],[a,c]=[new Pt(t.id),new Pt(t.lpMint.address)],u;if(r)u=new Pt((await r(1))[0]);else{let y=bs.generate();s.push(y),u=y.publicKey}let{publicKey:m}=Pe(o,u,Re),{publicKey:l}=Nn(u),{publicKey:d}=jt(n.lockProgram,u),{publicKey:p}=Pe(e.wallet,c,Re),{publicKey:f}=Pe(n.lockAuthProgram,c,Re),g=ws({programId:n.lockProgram,auth:n.lockAuthProgram,payer:e.feePayer,liquidityOwner:e.wallet,nftOwner:o,nftMint:u,nftAccount:m,poolId:a,lockPda:d,mintLp:c,userLpVault:p,lockLpVault:f,poolVaultA:new Pt(i.vault.A),poolVaultB:new Pt(i.vault.B),metadataAccount:l,lpAmount:n.lpAmount,withMetadata:n.withMetadata??!0});return{address:{nftMint:u,nftAccount:m,metadataAccount:l,lockPda:d,userLpVault:p,lockLpVault:f},instructions:[g],signers:s,instructionTypes:[te.CpmmLockLp],lookupTableAddress:[]}}function ws({programId:n,auth:e,payer:t,liquidityOwner:i,nftOwner:o,nftMint:r,nftAccount:s,poolId:a,lockPda:c,mintLp:u,userLpVault:m,lockLpVault:l,poolVaultA:d,poolVaultB:p,metadataAccount:f,lpAmount:g,withMetadata:y}){let k=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Kt,isSigner:!1,isWritable:!1},{pubkey:gs.programId,isSigner:!1,isWritable:!1},{pubkey:Re,isSigner:!1,isWritable:!1},{pubkey:_i,isSigner:!1,isWritable:!1},{pubkey:qe,isSigner:!1,isWritable:!1}],w=q([I("lpAmount"),ve("withMetadata")]),b=Buffer.alloc(w.span);w.encode({lpAmount:g,withMetadata:y},b);let A=Buffer.from([...We.lockCpLiquidity,...b]);return new De({keys:k,programId:n,data:A})}function Zi({programId:n,nftOwner:e,auth:t,nftAccount:i,lockPda:o,poolId:r,mintLp:s,userVaultA:a,userVaultB:c,poolVaultA:u,poolVaultB:m,mintA:l,mintB:d,lockLpVault:p,lpFeeAmount:f,cpmmProgram:g,cpmmAuthProgram:y}){let k=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:g??gi,isSigner:!1,isWritable:!1},{pubkey:y??yi,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Re,isSigner:!1,isWritable:!1},{pubkey:On,isSigner:!1,isWritable:!1},{pubkey:Ct,isSigner:!1,isWritable:!1}],w=q([I("lpFeeAmount")]),b=Buffer.alloc(w.span);w.encode({lpFeeAmount:f},b);let A=Buffer.from([...We.collectCpFee,...b]);return new De({keys:k,programId:n,data:A})}var Fn=q([se(8),z("bump"),ve("disableCreatePool"),Fe("index"),I("tradeFeeRate"),I("protocolFeeRate"),I("fundFeeRate"),I("createPoolFee"),v("protocolOwner"),v("fundOwner"),G(I(),16)]),vn=q([se(8),v("configId"),v("poolCreator"),v("vaultA"),v("vaultB"),v("mintLp"),v("mintA"),v("mintB"),v("mintProgramA"),v("mintProgramB"),v("observationId"),z("bump"),z("status"),z("lpDecimals"),z("mintDecimalA"),z("mintDecimalB"),I("lpAmount"),I("protocolFeesMintA"),I("protocolFeesMintB"),I("fundFeesMintA"),I("fundFeesMintB"),I("openTime"),G(I(),32)]);var J=n=>((performance.now()-n)/1e3).toFixed(2),Dn=class extends Ze{constructor(e){super(e)}async load(){this.checkDisabled()}async getCpmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async getRpcPoolInfo(e,t,i){if(!e&&!t?.marketAccount)throw new Error("Either poolId or accountInfos.marketAccount must be provided");let o=e?(await he(this.scope.connection,[{pubkey:new h(e)}]))[0]:t.marketAccount;if(!o?.accountInfo){let T=e||t?.marketAccount?.pubkey?.toBase58()||"unknown";throw new Error(`Pool account not found: ${T}`)}let r={...vn.decode(o.accountInfo.data),programId:o.accountInfo.owner},s=[],a=[r.vaultA,r.vaultB];e&&(s.push(...a.map(T=>({pubkey:new h(T)}))),i&&s.push({pubkey:new h(r.configId)}));let c=[];e&&s.length>0&&(c=await he(this.scope.connection,s));let u;if(i){let T=e?c[c.length-1]:t?.configState;if(!T?.accountInfo)throw new Error(`Config account not found: ${r.configId}`);u=Fn.decode(T.accountInfo.data)}let m=e?c[0]?.accountInfo:t?.vaultAInfo?.accountInfo,l=e?c[1]?.accountInfo:t?.vaultBInfo?.accountInfo;if(!m||!l)throw new Error(`Vault accounts not found: A=${r.vaultA}, B=${r.vaultB}`);let d=new Y(En.decode(m.data).amount.toString()),p=new Y(En.decode(l.data).amount.toString()),f=d.sub(r.protocolFeesMintA).sub(r.fundFeesMintA),g=p.sub(r.protocolFeesMintB).sub(r.fundFeesMintB),y=new Z(10).pow(r.mintDecimalA),k=new Z(10).pow(r.mintDecimalB),w=new Z(f.toString()).div(y),b=new Z(g.toString()).div(k),A=w.isZero()?new Z(0):b.div(w);return{...r,baseReserve:f,quoteReserve:g,vaultAAmount:d,vaultBAmount:p,configInfo:u,poolPrice:A}}async getRpcPoolInfos(e,t){let i=await he(this.scope.connection,e.map(l=>({pubkey:new h(l)}))),o={},r=new Set,s=[];for(let l=0;l<e.length;l++){let d=i[l];if(d.accountInfo===null)throw Error("fetch pool info error: "+String(e[l]));let p=vn.decode(d.accountInfo.data);o[String(e[l])]={...p,programId:d.accountInfo.owner},r.add(String(p.configId)),s.push(p.vaultA,p.vaultB)}let a={};if(t){let l=[...r],d=await he(this.scope.connection,l.map(p=>({pubkey:new h(p)})));for(let p=0;p<l.length;p++){let f=d[p].accountInfo;if(f===null)throw Error("fetch pool config error: "+l[p]);a[l[p]]=Fn.decode(f.data)}}let c={},u=await he(this.scope.connection,s.map(l=>({pubkey:new h(l)})));for(let l=0;l<s.length;l++){let d=u[l].accountInfo;if(d===null)throw Error("fetch vault info error: "+s[l]);c[String(s[l])]=new Y(En.decode(d.data).amount.toString())}let m={};for(let[l,d]of Object.entries(o)){let p=c[d.vaultA.toString()].sub(d.protocolFeesMintA).sub(d.fundFeesMintA),f=c[d.vaultB.toString()].sub(d.protocolFeesMintB).sub(d.fundFeesMintB);m[l]={...d,baseReserve:p,quoteReserve:f,vaultAAmount:c[d.vaultA.toString()],vaultBAmount:c[d.vaultB.toString()],configInfo:a[d.configId.toString()],poolPrice:new Z(f.toString()).div(new Z(10).pow(d.mintDecimalB)).div(new Z(p.toString()).div(new Z(10).pow(d.mintDecimalA)))}}return m}toComputePoolInfos({pools:e,mintInfos:t}){return Object.keys(e).reduce((i,o)=>{let r=e[o],[s,a]=[r.mintA.toBase58(),r.mintB.toBase58()];return{...i,[o]:{...r,id:new h(o),configInfo:r.configInfo,version:7,authority:Zt(r.programId).publicKey,mintA:Ee({address:s,decimals:r.mintDecimalA,programId:r.mintProgramA.toBase58(),extensions:{feeConfig:t[s]?.feeConfig?Qe(t[s]?.feeConfig):void 0}}),mintB:Ee({address:a,decimals:r.mintDecimalB,programId:r.mintProgramB.toBase58(),extensions:{feeConfig:t[a]?.feeConfig?Qe(t[a]?.feeConfig):void 0}})}}},{})}async getPoolInfoFromRpc(e,t,i){t=t||await this.getRpcPoolInfo(e,void 0,!0),i=i||await un({connection:this.scope.connection,mints:[t.mintA,t.mintB]});let o=Ee({address:t.mintA.toBase58(),decimals:t.mintDecimalA,programId:t.mintProgramA.toBase58(),extensions:{feeConfig:i[t.mintA.toBase58()].feeConfig?Qe(i[t.mintA.toBase58()].feeConfig):void 0}}),r=Ee({address:t.mintB.toBase58(),decimals:t.mintDecimalB,programId:t.mintProgramB.toBase58(),extensions:{feeConfig:i[t.mintB.toBase58()].feeConfig?Qe(i[t.mintB.toBase58()].feeConfig):void 0}}),s=Ee({address:t.mintLp.toBase58(),decimals:t.lpDecimals,programId:ue.toBase58()}),a={id:t.configId.toBase58(),index:t.configInfo.index,protocolFeeRate:t.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:t.configInfo.tradeFeeRate.toNumber(),fundFeeRate:t.configInfo.fundFeeRate.toNumber(),createPoolFee:t.configInfo.createPoolFee.toString()},c={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};return{poolInfo:{programId:t.programId.toBase58(),id:e,type:"Standard",lpMint:s,lpPrice:0,lpAmount:t.lpAmount.toNumber(),config:a,mintA:o,mintB:r,rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:t.poolPrice.toNumber(),mintAmountA:new Z(t.vaultAAmount.toString()).div(10**o.decimals).toNumber(),mintAmountB:new Z(t.vaultBAmount.toString()).div(10**r.decimals).toNumber(),feeRate:t.configInfo.tradeFeeRate.toNumber(),openTime:t.openTime.toString(),tvl:0,burnPercent:0,day:c,week:c,month:c,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0},poolKeys:{programId:t.programId.toBase58(),id:e,mintA:o,mintB:r,openTime:t.openTime.toString(),vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},authority:Zt(t.programId).publicKey.toBase58(),mintLp:s,config:a,observationId:bt(t.programId,new h(e)).publicKey.toBase58()},rpcData:t}}async createPool({poolId:e,programId:t,poolFeeAccount:i,startTime:o,ownerInfo:r,associatedOnly:s=!1,checkCreateATAOwner:a=!1,txVersion:c,feeConfig:u,computeBudgetConfig:m,txTipConfig:l,feePayer:d,...p}){let f=r.feePayer||this.scope.owner?.publicKey,g=new Y(new h(p.mintA.address).toBuffer()).lte(new Y(new h(p.mintB.address).toBuffer())),[y,k]=g?[p.mintA,p.mintB]:[p.mintB,p.mintA],[w,b]=g?[p.mintAAmount,p.mintBAmount]:[p.mintBAmount,p.mintAAmount],A=r.useSOLBalance&&y.address===Je.toBase58(),T=r.useSOLBalance&&k.address===Je.toBase58(),[x,B]=[new h(y.address),new h(k.address)],S=this.createTxBuilder(d),{account:L,instructionParams:E}=await this.scope.account.getOrCreateTokenAccount({mint:x,tokenProgram:y.programId,owner:this.scope.ownerPubKey,createInfo:A?{payer:f,amount:w}:void 0,notUseTokenAccount:A,skipCloseAccount:!A,associatedOnly:A?!1:s,checkCreateATAOwner:a});S.addInstruction(E||{});let{account:M,instructionParams:_}=await this.scope.account.getOrCreateTokenAccount({mint:new h(k.address),tokenProgram:k.programId,owner:this.scope.ownerPubKey,createInfo:T?{payer:f,amount:b}:void 0,notUseTokenAccount:T,skipCloseAccount:!T,associatedOnly:T?!1:s,checkCreateATAOwner:a});if(S.addInstruction(_||{}),L===void 0||M===void 0)throw Error("you don't has some token account");let W=Ci({poolId:e,programId:t,configId:new h(u.id),mintA:x,mintB:B});return S.addInstruction({instructions:[qi(t,this.scope.ownerPubKey,new h(u.id),W.authority,W.poolId,x,B,W.lpMint,L,M,Pe(this.scope.ownerPubKey,W.lpMint).publicKey,W.vaultA,W.vaultB,i,new h(y.programId??ue),new h(k.programId??ue),W.observationId,w,b,o)],instructionTypes:[te.CpmmCreatePool]}),S.addCustomComputeBudget(m),S.addTipInstruction(l),S.versionBuild({txVersion:c,extInfo:{address:{...W,mintA:y,mintB:k,programId:t,poolFeeAccount:i,feeConfig:u}}})}async addLiquidity(e){let{poolInfo:t,poolKeys:i,inputAmount:o,baseIn:r,slippage:s,computeResult:a,computeBudgetConfig:c,txTipConfig:u,config:m,txVersion:l,feePayer:d}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),o.isZero()&&this.logAndCreateError("amounts must greater than zero","amountInA",{amountInA:o.toString()});let{account:p}=this.scope,{bypassAssociatedCheck:f,checkCreateATAOwner:g}={bypassAssociatedCheck:!1,checkCreateATAOwner:!1,...m},y=a?void 0:await this.getRpcPoolInfo(t.id),{liquidity:k,inputAmountFee:w,anotherAmount:b}=a||this.computePairAmount({poolInfo:{...t,lpAmount:new Z(y.lpAmount.toString()).div(10**t.lpMint.decimals).toNumber()},baseReserve:y.baseReserve,quoteReserve:y.quoteReserve,slippage:new le(0),baseIn:r,epochInfo:await this.scope.fetchEpochInfo(),amount:new Z(o.toString()).div(10**(r?t.mintA.decimals:t.mintB.decimals))}),A=b.amount,T=t.mintA.address===Je.toString(),x=t.mintB.address===Je.toString(),B=this.createTxBuilder(d),[S,L]=[new h(t.mintA.address),new h(t.mintB.address)],{account:E,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new h(t.mintA.address),owner:this.scope.ownerPubKey,createInfo:T||(r?o:A).isZero()?{payer:this.scope.ownerPubKey,amount:r?o:A}:void 0,skipCloseAccount:!T,notUseTokenAccount:T,associatedOnly:!1,checkCreateATAOwner:g});B.addInstruction(M||{});let{account:_,instructionParams:W}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new h(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:x||(r?A:o).isZero()?{payer:this.scope.ownerPubKey,amount:r?A:o}:void 0,skipCloseAccount:!x,notUseTokenAccount:x,associatedOnly:!1,checkCreateATAOwner:g});B.addInstruction(W||{}),!E&&!_&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",p.tokenAccounts);let $=await p.getCreatedTokenAccount({mint:new h(t.lpMint.address)}),{tokenAccount:V,...D}=await p.handleTokenAccount({side:"out",amount:0,mint:new h(t.lpMint.address),tokenAccount:$,bypassAssociatedCheck:f,checkCreateATAOwner:g});B.addInstruction(D);let de=i??await this.getCpmmPoolKeys(t.id),H=new le(new Y(1)).sub(s);return B.addInstruction({instructions:[Ui(new h(t.programId),this.scope.ownerPubKey,new h(de.authority),new h(t.id),V,E,_,new h(de.vault.A),new h(de.vault.B),S,L,new h(t.lpMint.address),a?a?.liquidity:H.mul(k).quotient,r?w.amount:A,r?A:w.amount)],instructionTypes:[te.CpmmAddLiquidity],lookupTableAddress:de.lookupTableAccount?[de.lookupTableAccount]:[]}),B.addCustomComputeBudget(c),B.addTipInstruction(u),B.versionBuild({txVersion:l})}async withdrawLiquidity(e){let{poolInfo:t,poolKeys:i,lpAmount:o,slippage:r,computeBudgetConfig:s,txTipConfig:a,txVersion:c,feePayer:u,closeWsol:m=!0}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let l=new le(new Y(1)).sub(r),d=await this.getRpcPoolInfo(t.id),[p,f]=[l.mul(o.mul(d.baseReserve).div(d.lpAmount)).quotient,l.mul(o.mul(d.quoteReserve).div(d.lpAmount)).quotient],g=await this.scope.fetchEpochInfo(),[y,k]=[Ae(p,t.mintA.extensions.feeConfig,g,!1),Ae(f,t.mintB.extensions.feeConfig,g,!1)],{account:w}=this.scope,b=this.createTxBuilder(u),[A,T]=[new h(t.mintA.address),new h(t.mintB.address)],x=A.equals(ce),B=T.equals(ce),S,L,{account:E,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new h(t.mintA.address),notUseTokenAccount:x,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(x&&m),associatedOnly:!x,checkCreateATAOwner:!1});S=E,M&&b.addInstruction(M);let{account:_,instructionParams:W}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new h(t.mintB.address),notUseTokenAccount:B,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(B&&m),associatedOnly:!B,checkCreateATAOwner:!1});L=_,W&&b.addInstruction(W),(!S||!L)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",w.tokenAccounts);let $=await w.getCreatedTokenAccount({mint:new h(t.lpMint.address)});$||this.logAndCreateError("cannot found lp token account","tokenAccounts",w.tokenAccounts);let V=i??await this.getCpmmPoolKeys(t.id);return b.addInstruction({instructions:[Gi(new h(t.programId),this.scope.ownerPubKey,new h(V.authority),new h(t.id),$,S,L,new h(V.vault.A),new h(V.vault.B),A,T,new h(t.lpMint.address),o,p.sub(y.fee??new Y(0)),f.sub(k.fee??new Y(0)))],instructionTypes:[te.CpmmWithdrawLiquidity],lookupTableAddress:V.lookupTableAccount?[V.lookupTableAccount]:[]}),b.addCustomComputeBudget(s),b.addTipInstruction(a),b.versionBuild({txVersion:c})}async swap(e){await new Promise(H=>setImmediate(H));let{poolInfo:t,poolKeys:i,baseIn:o,fixedOut:r,inputAmount:s,swapResult:a,slippage:c=0,config:u,computeBudgetConfig:m,txTipConfig:l,txVersion:d,feePayer:p,nonce:f}=e,{bypassAssociatedCheck:g,checkCreateATAOwner:y,associatedOnly:k,useIdempotent:w=!1}={bypassAssociatedCheck:!1,checkCreateATAOwner:!1,associatedOnly:!0,useIdempotent:!1,...u},b=performance.now();console.log(`Swap start: ${J(b)}s, baseIn: ${o}, fixedOut: ${r}, inputAmount: ${s.toString()}`);let A=this.createTxBuilder(p);if(console.log(`TxBuilder created: ${J(b)}s`),f&&f?.instruction&&(A.addInstruction({instructions:[f.instruction],instructionTypes:[f.instruction].map(()=>te.NonceAccount)}),console.log(`Nonce instruction added: ${J(b)}s`)),m){let{instructions:H,instructionTypes:re}=Ue(m);A.addInstruction({instructions:H,instructionTypes:re}),console.log(`Compute budget added: ${J(b)}s`)}r?a.sourceAmountSwapped=a.sourceAmountSwapped.mul(new Y((1+c)*1e4)).div(new Y(1e4)):a.destinationAmountSwapped=a.destinationAmountSwapped.mul(new Y((1-c)*1e4)).div(new Y(1e4)),console.log(`Slippage applied: ${J(b)}s`);let[T,x]=[new h(t.mintA.address),new h(t.mintB.address)],B,S;if(console.log(`Mints prepared: ${J(b)}s`),w){let H=new h(t.mintA.programId??ue),re=new h(t.mintB.programId??ue),Me=T.equals(Je),$e=x.equals(Je);console.log(`${J(b)}s: mintAIsSOL: ${Me}, mintBIsSOL: ${$e}`),B=Qi(T,this.scope.ownerPubKey,!1,H),console.log(`${J(b)}s: mintATokenAcc prepared: ${B.toBase58()}`),S=Qi(x,this.scope.ownerPubKey,!1,re),console.log(`${J(b)}s: mintBTokenAcc prepared: ${S.toBase58()}`),Me||(A.addInstruction({instructions:[ji(this.scope.ownerPubKey,B,this.scope.ownerPubKey,T,H)],instructionTypes:[te.CreateATA]}),console.log(`Idempotent ATA for mintA added: ${J(b)}s`)),$e||(A.addInstruction({instructions:[ji(this.scope.ownerPubKey,S,this.scope.ownerPubKey,x,re)],instructionTypes:[te.CreateATA]}),console.log(`Idempotent ATA for mintB added: ${J(b)}s`))}else{let H=t.mintA.address===ce.toBase58(),re=t.mintB.address===ce.toBase58();console.log(`mintAUseSOLBalance: ${H}, mintBUseSOLBalance: ${re}, ${J(b)}s`);let{account:Me,instructionParams:$e}=await this.scope.account.getOrCreateTokenAccount({mint:T,tokenProgram:new h(t.mintA.programId??ue),owner:this.scope.ownerPubKey,createInfo:H||!o?{payer:this.scope.ownerPubKey,amount:o?a.sourceAmountSwapped:0}:void 0,notUseTokenAccount:H,skipCloseAccount:!H,associatedOnly:H?!1:k,checkCreateATAOwner:y});console.log(`mintATokenAccResult: ${JSON.stringify(Me)}, ${J(b)}s`),$e&&A.addInstruction($e),console.log(`mintATokenAccInstruction added: ${J(b)}s`),B=Me;let{account:Wn,instructionParams:Vn}=await this.scope.account.getOrCreateTokenAccount({mint:x,tokenProgram:new h(t.mintB.programId??ue),owner:this.scope.ownerPubKey,createInfo:re||o?{payer:this.scope.ownerPubKey,amount:o?0:a.sourceAmountSwapped}:void 0,notUseTokenAccount:re,skipCloseAccount:!re,associatedOnly:re?!1:k,checkCreateATAOwner:y});console.log(`mintBTokenAccResult: ${JSON.stringify(Wn)}, ${J(b)}s`),Vn&&A.addInstruction(Vn),console.log(`mintBTokenAccInstruction added: ${J(b)}s`),S=Wn,(!B||!S)&&this.logAndCreateError("user do not have token account",{mintA:t.mintA.symbol||t.mintA.address,mintB:t.mintB.symbol||t.mintB.address,mintATokenAcc:B,mintBTokenAcc:S,mintAUseSOLBalance:H,mintBUseSOLBalance:re,associatedOnly:k})}let L=i??await this.getCpmmPoolKeys(t.id);console.log(`Pool keys fetched: ${J(b)}s`);let E=o?B:S,M=o?S:B,_=o?T:x,W=o?x:T,$=o?L.vault.A:L.vault.B,V=o?L.vault.B:L.vault.A,D=o?new h(t.mintA.programId??ue):new h(t.mintB.programId??ue),de=o?new h(t.mintB.programId??ue):new h(t.mintA.programId??ue);return console.log(`Swap parameters prepared: ${J(b)}s`),A.addInstruction({instructions:[r?Hi(new h(t.programId),this.scope.ownerPubKey,new h(L.authority),new h(L.config.id),new h(t.id),E,M,new h($),new h(V),D,de,_,W,bt(new h(t.programId),new h(t.id)).publicKey,a.sourceAmountSwapped,a.destinationAmountSwapped):Xi(new h(t.programId),this.scope.ownerPubKey,new h(L.authority),new h(L.config.id),new h(t.id),E,M,new h($),new h(V),D,de,_,W,bt(new h(t.programId),new h(t.id)).publicKey,s,a.destinationAmountSwapped)],instructionTypes:[r?te.CpmmSwapBaseOut:te.CpmmSwapBaseIn]}),console.log(`Swap instruction added: ${J(b)}s`),A.addTipInstruction(l),console.log(`Tip instruction added: ${J(b)}s`),A.versionBuild({txVersion:d},f?.nonce)}async lockLp(e){let{poolInfo:t,lpAmount:i,computeBudgetConfig:o,txTipConfig:r,txVersion:s,feePayer:a,feeNftOwner:c}=e;i.isZero()&&this.logAndCreateError("lpAmount must greater than zero",{lpAmount:i.toString()});let u=this.createTxBuilder(a),m=e.poolKeys??await this.getCpmmPoolKeys(t.id),l=await zi({poolInfo:t,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,feePayer:e.feePayer??this.scope.ownerPubKey},feeNftOwner:c??this.scope.ownerPubKey,lockProgram:e.programId??Ft,lockAuthProgram:e.authProgram??vt,lpAmount:i,withMetadata:e.withMetadata??!0,getEphemeralSigners:e.getEphemeralSigners});return u.addInstruction(l),u.addCustomComputeBudget(o),u.addTipInstruction(r),u.versionBuild({txVersion:s,extInfo:l.address})}async harvestLockLp(e){let{poolInfo:t,lpFeeAmount:i,nftMint:o,programId:r=Ft,authProgram:s=vt,cpmmProgram:a,computeBudgetConfig:c,txTipConfig:u,txVersion:m,closeWsol:l=!0}=e;i.isZero()&&this.logAndCreateError("lpFeeAmount must greater than zero",{lpAmount:i.toString()});let d=e.feePayer||this.scope.ownerPubKey,p=this.createTxBuilder(d),[f,g]=[new h(t.mintA.address),new h(t.mintB.address)],y=f.equals(ce),k=g.equals(ce),w,b,{account:A,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new h(t.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(y&&l),associatedOnly:!y,checkCreateATAOwner:!1});w=A,T&&p.addInstruction(T);let{account:x,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new h(t.mintB.address),notUseTokenAccount:k,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(k&&l),associatedOnly:!k,checkCreateATAOwner:!1});b=x,B&&p.addInstruction(B),(!w||!b)&&this.logAndCreateError("cannot found target token accounts",{tokenAccountA:w,tokenAccountB:b});let S=e.poolKeys??await this.getCpmmPoolKeys(t.id),{publicKey:L}=Pe(d,o,ue),{publicKey:E}=jt(r,o),{publicKey:M}=Pe(s,new h(t.lpMint.address),ue);return p.addInstruction({instructions:[Zi({programId:r??Ft,nftOwner:this.scope.ownerPubKey,auth:s??vt,nftMint:o,nftAccount:L,lockPda:E,poolId:new h(t.id),mintLp:new h(S.mintLp.address),userVaultA:w,userVaultB:b,poolVaultA:new h(S.vault.A),poolVaultB:new h(S.vault.B),mintA:f,mintB:g,lockLpVault:M,lpFeeAmount:i,cpmmProgram:a?.programId,cpmmAuthProgram:a?.authProgram})],instructionTypes:[te.CpmmCollectLockFee]}),p.addCustomComputeBudget(c),p.addTipInstruction(u),p.versionBuild({txVersion:m})}computeSwapAmount({pool:e,amountIn:t,outputMint:i,slippage:o}){let r=i.toString()===e.mintB.address,s=Ht.swap(t,r?e.baseReserve:e.quoteReserve,r?e.quoteReserve:e.baseReserve,e.configInfo.tradeFeeRate),a=new Z(s.destinationAmountSwapped.toString()).div(s.sourceAmountSwapped.toString()),c=s.destinationAmountSwapped.mul(new Y((1-o)*1e4)).div(new Y(1e4));return{allTrade:s.sourceAmountSwapped.eq(t),amountIn:t,amountOut:s.destinationAmountSwapped,minAmountOut:c,executionPrice:a,fee:s.tradeFee,priceImpact:e.poolPrice.sub(a).div(e.poolPrice)}}computePairAmount({poolInfo:e,baseReserve:t,quoteReserve:i,amount:o,slippage:r,epochInfo:s,baseIn:a}){let c=1-Number(r.toSignificant())/100,u=new Y(new Z(o).mul(10**e[a?"mintA":"mintB"].decimals).mul(c).toFixed(0)),m=Ae(u,e[a?"mintA":"mintB"].extensions.feeConfig,s,!1),l=u.sub(m.fee??new Y(0)),d=new Y(new Z(e.lpAmount).mul(10**e.lpMint.decimals).toFixed(0,Z.ROUND_DOWN));this.logDebug("baseReserve:",t.toString(),"quoteReserve:",i.toString()),this.logDebug("tokenIn:",a?e.mintA.symbol:e.mintB.symbol,"amountIn:",u.toString(),"amountInFee:",m.fee?.toString()??0,"anotherToken:",a?e.mintB.symbol:e.mintA.symbol,"slippage:",`${r.toSignificant()}%`);let p=a?"base":"quote";this.logDebug("input side:",p);let f=l.mul(d).div(p==="base"?t:i),g={amount:yn,fee:void 0,expirationTime:void 0};if(!l.isZero()){let A=Ps(f,t,i,d);this.logDebug("lpAmountData:",{amountA:A.amountA.toString(),amountB:A.amountB.toString()}),g=Ae(A[a?"amountB":"amountA"],e[a?"mintB":"mintA"].extensions.feeConfig,s,!0)}let y=new le(new Y(1)).add(r),k=new le(new Y(1)).sub(r),w=Ae(y.mul(g.amount.sub(g.fee??new Y(0))).quotient,e[a?"mintB":"mintA"].extensions.feeConfig,s,!0),b=Ae(k.mul(g.amount.sub(g.fee??new Y(0))).quotient,e[a?"mintB":"mintA"].extensions.feeConfig,s,!0);return this.logDebug("anotherAmount:",g.amount.toString(),"anotherAmountFee:",g.fee?.toString()??0,"maxAnotherAmount:",w.amount.toString(),"maxAnotherAmountFee:",w.fee?.toString()??0),{inputAmountFee:m,anotherAmount:g,maxAnotherAmount:w,minAnotherAmount:b,liquidity:f}}};function Ps(n,e,t,i){let o=n.mul(e).div(i);!o.isZero()&&!n.mul(e).mod(i).isZero()&&(o=o.add(new Y(1)));let r=n.mul(t).div(i);return!r.isZero()&&!n.mul(t).mod(i).isZero()&&(r=r.add(new Y(1))),{amountA:o,amountB:r}}export{Dn as default};
//# sourceMappingURL=cpmm.mjs.map