var Qn=Object.create;var je=Object.defineProperty;var Xn=Object.getOwnPropertyDescriptor;var Jn=Object.getOwnPropertyNames;var Yn=Object.getPrototypeOf,$n=Object.prototype.hasOwnProperty;var eo=(t,e,r)=>e in t?je(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var to=(t,e)=>{for(var r in e)je(t,r,{get:e[r],enumerable:!0})},vr=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Jn(e))!$n.call(t,o)&&o!==r&&je(t,o,{get:()=>e[o],enumerable:!(n=Xn(e,o))||n.enumerable});return t};var re=(t,e,r)=>(r=t!=null?Qn(Yn(t)):{},vr(e||!t||!t.__esModule?je(r,"default",{value:t,enumerable:!0}):r,t)),ro=t=>vr(je({},"__esModule",{value:!0}),t);var ct=(t,e,r)=>(eo(t,typeof e!="symbol"?e+"":e,r),r);var qi={};to(qi,{default:()=>Et});module.exports=ro(qi);var G=require("@solana/web3.js"),Zn=require("@solana/spl-token");var Mr=require("@solana/web3.js");var Ze=require("lodash");var _t=class{logLevel;name;constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let r=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(r)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Vr={},no={};function $(t){let e=(0,Ze.get)(Vr,t);if(!e){let r=(0,Ze.get)(no,t);e=new _t({name:t,logLevel:r}),(0,Ze.set)(Vr,t,e)}return e}var lt=require("@solana/spl-token"),Dt=$("Raydium_accountInfo_util");async function Nr(t,e,r){let{batchRequest:n,commitment:o="confirmed",chunkCount:i=100}={batchRequest:!1,...r},s=Ot(e,i),a=new Array(s.length).fill([]);if(n){let c=s.map(l=>{let p=t._buildArgs([l.map(m=>m.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:p}}),u=Ot(c,10);a=(await(await Promise.all(u.map(async l=>await t._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&Dt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(p=>{if(p){let{data:m,executable:f,lamports:y,owner:w,rentEpoch:k}=p;return m.length!==2&&m[1]!=="base64"&&Dt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(m[0],"base64"),executable:f,lamports:y,owner:new Mr.PublicKey(w),rentEpoch:k}}return null})))}else try{a=await Promise.all(s.map(c=>t.getMultipleAccountsInfo(c,o)))}catch(c){c instanceof Error&&Dt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}var he=re(require("bn.js"));var _e=9e15,Re=1e9,Wt="0123456789abcdef",ft="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",mt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Ut={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-_e,maxE:_e,crypto:!1},Dr,Te,M=!0,yt="[DecimalError] ",Be=yt+"Invalid argument: ",Or=yt+"Precision limit exceeded",Wr=yt+"crypto unavailable",Ur="[object Decimal]",ie=Math.floor,te=Math.pow,oo=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,io=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,so=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,qr=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,fe=1e7,v=7,ao=9007199254740991,uo=ft.length-1,qt=mt.length-1,h={toStringTag:Ur};h.absoluteValue=h.abs=function(){var t=new this.constructor(this);return t.s<0&&(t.s=1),B(t)};h.ceil=function(){return B(new this.constructor(this),this.e+1,2)};h.clampedTo=h.clamp=function(t,e){var r,n=this,o=n.constructor;if(t=new o(t),e=new o(e),!t.s||!e.s)return new o(NaN);if(t.gt(e))throw Error(Be+e);return r=n.cmp(t),r<0?t:n.cmp(e)>0?e:new o(n)};h.comparedTo=h.cmp=function(t){var e,r,n,o,i=this,s=i.d,a=(t=new i.constructor(t)).d,c=i.s,u=t.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(i.e!==t.e)return i.e>t.e^c<0?1:-1;for(n=s.length,o=a.length,e=0,r=n<o?n:o;e<r;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===o?0:n>o^c<0?1:-1};h.cosine=h.cos=function(){var t,e,r=this,n=r.constructor;return r.d?r.d[0]?(t=n.precision,e=n.rounding,n.precision=t+Math.max(r.e,r.sd())+v,n.rounding=1,r=co(n,zr(n,r)),n.precision=t,n.rounding=e,B(Te==2||Te==3?r.neg():r,t,e,!0)):new n(1):new n(NaN)};h.cubeRoot=h.cbrt=function(){var t,e,r,n,o,i,s,a,c,u,d=this,l=d.constructor;if(!d.isFinite()||d.isZero())return new l(d);for(M=!1,i=d.s*te(d.s*d,1/3),!i||Math.abs(i)==1/0?(r=oe(d.d),t=d.e,(i=(t-r.length+1)%3)&&(r+=i==1||i==-2?"0":"00"),i=te(r,1/3),t=ie((t+1)/3)-(t%3==(t<0?-1:2)),i==1/0?r="5e"+t:(r=i.toExponential(),r=r.slice(0,r.indexOf("e")+1)+t),n=new l(r),n.s=d.s):n=new l(i.toString()),s=(t=l.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(d),n=X(u.plus(d).times(a),u.plus(c),s+2,1),oe(a.d).slice(0,s)===(r=oe(n.d)).slice(0,s))if(r=r.slice(s-3,s+1),r=="9999"||!o&&r=="4999"){if(!o&&(B(a,t+1,0),a.times(a).times(a).eq(d))){n=a;break}s+=4,o=1}else{(!+r||!+r.slice(1)&&r.charAt(0)=="5")&&(B(n,t+1,1),e=!n.times(n).times(n).eq(d));break}return M=!0,B(n,t,l.rounding,e)};h.decimalPlaces=h.dp=function(){var t,e=this.d,r=NaN;if(e){if(t=e.length-1,r=(t-ie(this.e/v))*v,t=e[t],t)for(;t%10==0;t/=10)r--;r<0&&(r=0)}return r};h.dividedBy=h.div=function(t){return X(this,new this.constructor(t))};h.dividedToIntegerBy=h.divToInt=function(t){var e=this,r=e.constructor;return B(X(e,new r(t),0,1,1),r.precision,r.rounding)};h.equals=h.eq=function(t){return this.cmp(t)===0};h.floor=function(){return B(new this.constructor(this),this.e+1,3)};h.greaterThan=h.gt=function(t){return this.cmp(t)>0};h.greaterThanOrEqualTo=h.gte=function(t){var e=this.cmp(t);return e==1||e===0};h.hyperbolicCosine=h.cosh=function(){var t,e,r,n,o,i=this,s=i.constructor,a=new s(1);if(!i.isFinite())return new s(i.s?1/0:NaN);if(i.isZero())return a;r=s.precision,n=s.rounding,s.precision=r+Math.max(i.e,i.sd())+4,s.rounding=1,o=i.d.length,o<32?(t=Math.ceil(o/3),e=(1/bt(4,t)).toString()):(t=16,e="2.3283064365386962890625e-10"),i=De(s,1,i.times(e),new s(1),!0);for(var c,u=t,d=new s(8);u--;)c=i.times(i),i=a.minus(c.times(d.minus(c.times(d))));return B(i,s.precision=r,s.rounding=n,!0)};h.hyperbolicSine=h.sinh=function(){var t,e,r,n,o=this,i=o.constructor;if(!o.isFinite()||o.isZero())return new i(o);if(e=i.precision,r=i.rounding,i.precision=e+Math.max(o.e,o.sd())+4,i.rounding=1,n=o.d.length,n<3)o=De(i,2,o,o,!0);else{t=1.4*Math.sqrt(n),t=t>16?16:t|0,o=o.times(1/bt(5,t)),o=De(i,2,o,o,!0);for(var s,a=new i(5),c=new i(16),u=new i(20);t--;)s=o.times(o),o=o.times(a.plus(s.times(c.times(s).plus(u))))}return i.precision=e,i.rounding=r,B(o,e,r,!0)};h.hyperbolicTangent=h.tanh=function(){var t,e,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(t=n.precision,e=n.rounding,n.precision=t+7,n.rounding=1,X(r.sinh(),r.cosh(),n.precision=t,n.rounding=e)):new n(r.s)};h.inverseCosine=h.acos=function(){var t,e=this,r=e.constructor,n=e.abs().cmp(1),o=r.precision,i=r.rounding;return n!==-1?n===0?e.isNeg()?pe(r,o,i):new r(0):new r(NaN):e.isZero()?pe(r,o+4,i).times(.5):(r.precision=o+6,r.rounding=1,e=e.asin(),t=pe(r,o+4,i).times(.5),r.precision=o,r.rounding=i,t.minus(e))};h.inverseHyperbolicCosine=h.acosh=function(){var t,e,r=this,n=r.constructor;return r.lte(1)?new n(r.eq(1)?0:NaN):r.isFinite()?(t=n.precision,e=n.rounding,n.precision=t+Math.max(Math.abs(r.e),r.sd())+4,n.rounding=1,M=!1,r=r.times(r).minus(1).sqrt().plus(r),M=!0,n.precision=t,n.rounding=e,r.ln()):new n(r)};h.inverseHyperbolicSine=h.asinh=function(){var t,e,r=this,n=r.constructor;return!r.isFinite()||r.isZero()?new n(r):(t=n.precision,e=n.rounding,n.precision=t+2*Math.max(Math.abs(r.e),r.sd())+6,n.rounding=1,M=!1,r=r.times(r).plus(1).sqrt().plus(r),M=!0,n.precision=t,n.rounding=e,r.ln())};h.inverseHyperbolicTangent=h.atanh=function(){var t,e,r,n,o=this,i=o.constructor;return o.isFinite()?o.e>=0?new i(o.abs().eq(1)?o.s/0:o.isZero()?o:NaN):(t=i.precision,e=i.rounding,n=o.sd(),Math.max(n,t)<2*-o.e-1?B(new i(o),t,e,!0):(i.precision=r=n-o.e,o=X(o.plus(1),new i(1).minus(o),r+t,1),i.precision=t+4,i.rounding=1,o=o.ln(),i.precision=t,i.rounding=e,o.times(.5))):new i(NaN)};h.inverseSine=h.asin=function(){var t,e,r,n,o=this,i=o.constructor;return o.isZero()?new i(o):(e=o.abs().cmp(1),r=i.precision,n=i.rounding,e!==-1?e===0?(t=pe(i,r+4,n).times(.5),t.s=o.s,t):new i(NaN):(i.precision=r+6,i.rounding=1,o=o.div(new i(1).minus(o.times(o)).sqrt().plus(1)).atan(),i.precision=r,i.rounding=n,o.times(2)))};h.inverseTangent=h.atan=function(){var t,e,r,n,o,i,s,a,c,u=this,d=u.constructor,l=d.precision,p=d.rounding;if(u.isFinite()){if(u.isZero())return new d(u);if(u.abs().eq(1)&&l+4<=qt)return s=pe(d,l+4,p).times(.25),s.s=u.s,s}else{if(!u.s)return new d(NaN);if(l+4<=qt)return s=pe(d,l+4,p).times(.5),s.s=u.s,s}for(d.precision=a=l+10,d.rounding=1,r=Math.min(28,a/v+2|0),t=r;t;--t)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(M=!1,e=Math.ceil(a/v),n=1,c=u.times(u),s=new d(u),o=u;t!==-1;)if(o=o.times(c),i=s.minus(o.div(n+=2)),o=o.times(c),s=i.plus(o.div(n+=2)),s.d[e]!==void 0)for(t=e;s.d[t]===i.d[t]&&t--;);return r&&(s=s.times(2<<r-1)),M=!0,B(s,d.precision=l,d.rounding=p,!0)};h.isFinite=function(){return!!this.d};h.isInteger=h.isInt=function(){return!!this.d&&ie(this.e/v)>this.d.length-2};h.isNaN=function(){return!this.s};h.isNegative=h.isNeg=function(){return this.s<0};h.isPositive=h.isPos=function(){return this.s>0};h.isZero=function(){return!!this.d&&this.d[0]===0};h.lessThan=h.lt=function(t){return this.cmp(t)<0};h.lessThanOrEqualTo=h.lte=function(t){return this.cmp(t)<1};h.logarithm=h.log=function(t){var e,r,n,o,i,s,a,c,u=this,d=u.constructor,l=d.precision,p=d.rounding,m=5;if(t==null)t=new d(10),e=!0;else{if(t=new d(t),r=t.d,t.s<0||!r||!r[0]||t.eq(1))return new d(NaN);e=t.eq(10)}if(r=u.d,u.s<0||!r||!r[0]||u.eq(1))return new d(r&&!r[0]?-1/0:u.s!=1?NaN:r?0:1/0);if(e)if(r.length>1)i=!0;else{for(o=r[0];o%10===0;)o/=10;i=o!==1}if(M=!1,a=l+m,s=Le(u,a),n=e?gt(d,a+10):Le(t,a),c=X(s,n,a,1),ze(c.d,o=l,p))do if(a+=10,s=Le(u,a),n=e?gt(d,a+10):Le(t,a),c=X(s,n,a,1),!i){+oe(c.d).slice(o+1,o+15)+1==1e14&&(c=B(c,l+1,0));break}while(ze(c.d,o+=10,p));return M=!0,B(c,l,p)};h.minus=h.sub=function(t){var e,r,n,o,i,s,a,c,u,d,l,p,m=this,f=m.constructor;if(t=new f(t),!m.d||!t.d)return!m.s||!t.s?t=new f(NaN):m.d?t.s=-t.s:t=new f(t.d||m.s!==t.s?m:NaN),t;if(m.s!=t.s)return t.s=-t.s,m.plus(t);if(u=m.d,p=t.d,a=f.precision,c=f.rounding,!u[0]||!p[0]){if(p[0])t.s=-t.s;else if(u[0])t=new f(m);else return new f(c===3?-0:0);return M?B(t,a,c):t}if(r=ie(t.e/v),d=ie(m.e/v),u=u.slice(),i=d-r,i){for(l=i<0,l?(e=u,i=-i,s=p.length):(e=p,r=d,s=u.length),n=Math.max(Math.ceil(a/v),s)+2,i>n&&(i=n,e.length=1),e.reverse(),n=i;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=p.length,l=n<s,l&&(s=n),n=0;n<s;n++)if(u[n]!=p[n]){l=u[n]<p[n];break}i=0}for(l&&(e=u,u=p,p=e,t.s=-t.s),s=u.length,n=p.length-s;n>0;--n)u[s++]=0;for(n=p.length;n>i;){if(u[--n]<p[n]){for(o=n;o&&u[--o]===0;)u[o]=fe-1;--u[o],u[n]+=fe}u[n]-=p[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--r;return u[0]?(t.d=u,t.e=ht(u,r),M?B(t,a,c):t):new f(c===3?-0:0)};h.modulo=h.mod=function(t){var e,r=this,n=r.constructor;return t=new n(t),!r.d||!t.s||t.d&&!t.d[0]?new n(NaN):!t.d||r.d&&!r.d[0]?B(new n(r),n.precision,n.rounding):(M=!1,n.modulo==9?(e=X(r,t.abs(),0,3,1),e.s*=t.s):e=X(r,t,0,n.modulo,1),e=e.times(t),M=!0,r.minus(e))};h.naturalExponential=h.exp=function(){return Gt(this)};h.naturalLogarithm=h.ln=function(){return Le(this)};h.negated=h.neg=function(){var t=new this.constructor(this);return t.s=-t.s,B(t)};h.plus=h.add=function(t){var e,r,n,o,i,s,a,c,u,d,l=this,p=l.constructor;if(t=new p(t),!l.d||!t.d)return!l.s||!t.s?t=new p(NaN):l.d||(t=new p(t.d||l.s===t.s?l:NaN)),t;if(l.s!=t.s)return t.s=-t.s,l.minus(t);if(u=l.d,d=t.d,a=p.precision,c=p.rounding,!u[0]||!d[0])return d[0]||(t=new p(l)),M?B(t,a,c):t;if(i=ie(l.e/v),n=ie(t.e/v),u=u.slice(),o=i-n,o){for(o<0?(r=u,o=-o,s=d.length):(r=d,n=i,s=u.length),i=Math.ceil(a/v),s=i>s?i+1:s+1,o>s&&(o=s,r.length=1),r.reverse();o--;)r.push(0);r.reverse()}for(s=u.length,o=d.length,s-o<0&&(o=s,r=d,d=u,u=r),e=0;o;)e=(u[--o]=u[o]+d[o]+e)/fe|0,u[o]%=fe;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return t.d=u,t.e=ht(u,n),M?B(t,a,c):t};h.precision=h.sd=function(t){var e,r=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(Be+t);return r.d?(e=Gr(r.d),t&&r.e+1>e&&(e=r.e+1)):e=NaN,e};h.round=function(){var t=this,e=t.constructor;return B(new e(t),t.e+1,e.rounding)};h.sine=h.sin=function(){var t,e,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(t=n.precision,e=n.rounding,n.precision=t+Math.max(r.e,r.sd())+v,n.rounding=1,r=po(n,zr(n,r)),n.precision=t,n.rounding=e,B(Te>2?r.neg():r,t,e,!0)):new n(NaN)};h.squareRoot=h.sqrt=function(){var t,e,r,n,o,i,s=this,a=s.d,c=s.e,u=s.s,d=s.constructor;if(u!==1||!a||!a[0])return new d(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(M=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=oe(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=ie((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new d(e)):n=new d(u.toString()),r=(c=d.precision)+3;;)if(i=n,n=i.plus(X(s,i,r+2,1)).times(.5),oe(i.d).slice(0,r)===(e=oe(n.d)).slice(0,r))if(e=e.slice(r-3,r+1),e=="9999"||!o&&e=="4999"){if(!o&&(B(i,c+1,0),i.times(i).eq(s))){n=i;break}r+=4,o=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(B(n,c+1,1),t=!n.times(n).eq(s));break}return M=!0,B(n,c,d.rounding,t)};h.tangent=h.tan=function(){var t,e,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(t=n.precision,e=n.rounding,n.precision=t+10,n.rounding=1,r=r.sin(),r.s=1,r=X(r,new n(1).minus(r.times(r)).sqrt(),t+10,0),n.precision=t,n.rounding=e,B(Te==2||Te==4?r.neg():r,t,e,!0)):new n(NaN)};h.times=h.mul=function(t){var e,r,n,o,i,s,a,c,u,d=this,l=d.constructor,p=d.d,m=(t=new l(t)).d;if(t.s*=d.s,!p||!p[0]||!m||!m[0])return new l(!t.s||p&&!p[0]&&!m||m&&!m[0]&&!p?NaN:!p||!m?t.s/0:t.s*0);for(r=ie(d.e/v)+ie(t.e/v),c=p.length,u=m.length,c<u&&(i=p,p=m,m=i,s=c,c=u,u=s),i=[],s=c+u,n=s;n--;)i.push(0);for(n=u;--n>=0;){for(e=0,o=c+n;o>n;)a=i[o]+m[n]*p[o-n-1]+e,i[o--]=a%fe|0,e=a/fe|0;i[o]=(i[o]+e)%fe|0}for(;!i[--s];)i.pop();return e?++r:i.shift(),t.d=i,t.e=ht(i,r),M?B(t,l.precision,l.rounding):t};h.toBinary=function(t,e){return jt(this,2,t,e)};h.toDecimalPlaces=h.toDP=function(t,e){var r=this,n=r.constructor;return r=new n(r),t===void 0?r:(ue(t,0,Re),e===void 0?e=n.rounding:ue(e,0,8),B(r,t+r.e+1,e))};h.toExponential=function(t,e){var r,n=this,o=n.constructor;return t===void 0?r=ye(n,!0):(ue(t,0,Re),e===void 0?e=o.rounding:ue(e,0,8),n=B(new o(n),t+1,e),r=ye(n,!0,t+1)),n.isNeg()&&!n.isZero()?"-"+r:r};h.toFixed=function(t,e){var r,n,o=this,i=o.constructor;return t===void 0?r=ye(o):(ue(t,0,Re),e===void 0?e=i.rounding:ue(e,0,8),n=B(new i(o),t+o.e+1,e),r=ye(n,!1,t+n.e+1)),o.isNeg()&&!o.isZero()?"-"+r:r};h.toFraction=function(t){var e,r,n,o,i,s,a,c,u,d,l,p,m=this,f=m.d,y=m.constructor;if(!f)return new y(m);if(u=r=new y(1),n=c=new y(0),e=new y(n),i=e.e=Gr(f)-m.e-1,s=i%v,e.d[0]=te(10,s<0?v+s:s),t==null)t=i>0?e:u;else{if(a=new y(t),!a.isInt()||a.lt(u))throw Error(Be+a);t=a.gt(e)?i>0?e:u:a}for(M=!1,a=new y(oe(f)),d=y.precision,y.precision=i=f.length*v*2;l=X(a,e,0,1,1),o=r.plus(l.times(n)),o.cmp(t)!=1;)r=n,n=o,o=u,u=c.plus(l.times(o)),c=o,o=e,e=a.minus(l.times(o)),a=o;return o=X(t.minus(r),n,0,1,1),c=c.plus(o.times(u)),r=r.plus(o.times(n)),c.s=u.s=m.s,p=X(u,n,i,1).minus(m).abs().cmp(X(c,r,i,1).minus(m).abs())<1?[u,n]:[c,r],y.precision=d,M=!0,p};h.toHexadecimal=h.toHex=function(t,e){return jt(this,16,t,e)};h.toNearest=function(t,e){var r=this,n=r.constructor;if(r=new n(r),t==null){if(!r.d)return r;t=new n(1),e=n.rounding}else{if(t=new n(t),e===void 0?e=n.rounding:ue(e,0,8),!r.d)return t.s?r:t;if(!t.d)return t.s&&(t.s=r.s),t}return t.d[0]?(M=!1,r=X(r,t,0,e,1).times(t),M=!0,B(r)):(t.s=r.s,r=t),r};h.toNumber=function(){return+this};h.toOctal=function(t,e){return jt(this,8,t,e)};h.toPower=h.pow=function(t){var e,r,n,o,i,s,a=this,c=a.constructor,u=+(t=new c(t));if(!a.d||!t.d||!a.d[0]||!t.d[0])return new c(te(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,i=c.rounding,t.eq(1))return B(a,n,i);if(e=ie(t.e/v),e>=t.d.length-1&&(r=u<0?-u:u)<=ao)return o=Hr(c,a,r,n),t.s<0?new c(1).div(o):B(o,n,i);if(s=a.s,s<0){if(e<t.d.length-1)return new c(NaN);if((t.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return r=te(+a,u),e=r==0||!isFinite(r)?ie(u*(Math.log("0."+oe(a.d))/Math.LN10+a.e+1)):new c(r+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(M=!1,c.rounding=a.s=1,r=Math.min(12,(e+"").length),o=Gt(t.times(Le(a,n+r)),n),o.d&&(o=B(o,n+5,1),ze(o.d,n,i)&&(e=n+10,o=B(Gt(t.times(Le(a,e+r)),e),e+5,1),+oe(o.d).slice(n+1,n+15)+1==1e14&&(o=B(o,n+1,0)))),o.s=s,M=!0,c.rounding=i,B(o,n,i))};h.toPrecision=function(t,e){var r,n=this,o=n.constructor;return t===void 0?r=ye(n,n.e<=o.toExpNeg||n.e>=o.toExpPos):(ue(t,1,Re),e===void 0?e=o.rounding:ue(e,0,8),n=B(new o(n),t,e),r=ye(n,t<=n.e||n.e<=o.toExpNeg,t)),n.isNeg()&&!n.isZero()?"-"+r:r};h.toSignificantDigits=h.toSD=function(t,e){var r=this,n=r.constructor;return t===void 0?(t=n.precision,e=n.rounding):(ue(t,1,Re),e===void 0?e=n.rounding:ue(e,0,8)),B(new n(r),t,e)};h.toString=function(){var t=this,e=t.constructor,r=ye(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()&&!t.isZero()?"-"+r:r};h.truncated=h.trunc=function(){return B(new this.constructor(this),this.e+1,1)};h.valueOf=h.toJSON=function(){var t=this,e=t.constructor,r=ye(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()?"-"+r:r};function oe(t){var e,r,n,o=t.length-1,i="",s=t[0];if(o>0){for(i+=s,e=1;e<o;e++)n=t[e]+"",r=v-n.length,r&&(i+=Se(r)),i+=n;s=t[e],n=s+"",r=v-n.length,r&&(i+=Se(r))}else if(s===0)return"0";for(;s%10===0;)s/=10;return i+s}function ue(t,e,r){if(t!==~~t||t<e||t>r)throw Error(Be+t)}function ze(t,e,r,n){var o,i,s,a;for(i=t[0];i>=10;i/=10)--e;return--e<0?(e+=v,o=0):(o=Math.ceil((e+1)/v),e%=v),i=te(10,v-e),a=t[o]%i|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=r<4&&a==99999||r>3&&a==49999||a==5e4||a==0):s=(r<4&&a+1==i||r>3&&a+1==i/2)&&(t[o+1]/i/100|0)==te(10,e-2)-1||(a==i/2||a==0)&&(t[o+1]/i/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||r<4)&&a==9999||!n&&r>3&&a==4999):s=((n||r<4)&&a+1==i||!n&&r>3&&a+1==i/2)&&(t[o+1]/i/1e3|0)==te(10,e-3)-1,s}function pt(t,e,r){for(var n,o=[0],i,s=0,a=t.length;s<a;){for(i=o.length;i--;)o[i]*=e;for(o[0]+=Wt.indexOf(t.charAt(s++)),n=0;n<o.length;n++)o[n]>r-1&&(o[n+1]===void 0&&(o[n+1]=0),o[n+1]+=o[n]/r|0,o[n]%=r)}return o.reverse()}function co(t,e){var r,n,o;if(e.isZero())return e;n=e.d.length,n<32?(r=Math.ceil(n/3),o=(1/bt(4,r)).toString()):(r=16,o="2.3283064365386962890625e-10"),t.precision+=r,e=De(t,1,e.times(o),new t(1));for(var i=r;i--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return t.precision-=r,e}var X=function(){function t(n,o,i){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*o+a,n[c]=s%i|0,a=s/i|0;return a&&n.unshift(a),n}function e(n,o,i,s){var a,c;if(i!=s)c=i>s?1:-1;else for(a=c=0;a<i;a++)if(n[a]!=o[a]){c=n[a]>o[a]?1:-1;break}return c}function r(n,o,i,s){for(var a=0;i--;)n[i]-=a,a=n[i]<o[i]?1:0,n[i]=a*s+n[i]-o[i];for(;!n[0]&&n.length>1;)n.shift()}return function(n,o,i,s,a,c){var u,d,l,p,m,f,y,w,k,T,b,x,S,A,R,_,N,L,C,E,H=n.constructor,O=n.s==o.s?1:-1,q=n.d,W=o.d;if(!q||!q[0]||!W||!W[0])return new H(!n.s||!o.s||(q?W&&q[0]==W[0]:!W)?NaN:q&&q[0]==0||!W?O*0:O/0);for(c?(m=1,d=n.e-o.e):(c=fe,m=v,d=ie(n.e/m)-ie(o.e/m)),C=W.length,N=q.length,k=new H(O),T=k.d=[],l=0;W[l]==(q[l]||0);l++);if(W[l]>(q[l]||0)&&d--,i==null?(A=i=H.precision,s=H.rounding):a?A=i+(n.e-o.e)+1:A=i,A<0)T.push(1),f=!0;else{if(A=A/m+2|0,l=0,C==1){for(p=0,W=W[0],A++;(l<N||p)&&A--;l++)R=p*c+(q[l]||0),T[l]=R/W|0,p=R%W|0;f=p||l<N}else{for(p=c/(W[0]+1)|0,p>1&&(W=t(W,p,c),q=t(q,p,c),C=W.length,N=q.length),_=C,b=q.slice(0,C),x=b.length;x<C;)b[x++]=0;E=W.slice(),E.unshift(0),L=W[0],W[1]>=c/2&&++L;do p=0,u=e(W,b,C,x),u<0?(S=b[0],C!=x&&(S=S*c+(b[1]||0)),p=S/L|0,p>1?(p>=c&&(p=c-1),y=t(W,p,c),w=y.length,x=b.length,u=e(y,b,w,x),u==1&&(p--,r(y,C<w?E:W,w,c))):(p==0&&(u=p=1),y=W.slice()),w=y.length,w<x&&y.unshift(0),r(b,y,x,c),u==-1&&(x=b.length,u=e(W,b,C,x),u<1&&(p++,r(b,C<x?E:W,x,c))),x=b.length):u===0&&(p++,b=[0]),T[l++]=p,u&&b[0]?b[x++]=q[_]||0:(b=[q[_]],x=1);while((_++<N||b[0]!==void 0)&&A--);f=b[0]!==void 0}T[0]||T.shift()}if(m==1)k.e=d,Dr=f;else{for(l=1,p=T[0];p>=10;p/=10)l++;k.e=l+d*m-1,B(k,a?i+k.e+1:i,s,f)}return k}}();function B(t,e,r,n){var o,i,s,a,c,u,d,l,p,m=t.constructor;e:if(e!=null){if(l=t.d,!l)return t;for(o=1,a=l[0];a>=10;a/=10)o++;if(i=e-o,i<0)i+=v,s=e,d=l[p=0],c=d/te(10,o-s-1)%10|0;else if(p=Math.ceil((i+1)/v),a=l.length,p>=a)if(n){for(;a++<=p;)l.push(0);d=c=0,o=1,i%=v,s=i-v+1}else break e;else{for(d=a=l[p],o=1;a>=10;a/=10)o++;i%=v,s=i-v+o,c=s<0?0:d/te(10,o-s-1)%10|0}if(n=n||e<0||l[p+1]!==void 0||(s<0?d:d%te(10,o-s-1)),u=r<4?(c||n)&&(r==0||r==(t.s<0?3:2)):c>5||c==5&&(r==4||n||r==6&&(i>0?s>0?d/te(10,o-s):0:l[p-1])%10&1||r==(t.s<0?8:7)),e<1||!l[0])return l.length=0,u?(e-=t.e+1,l[0]=te(10,(v-e%v)%v),t.e=-e||0):l[0]=t.e=0,t;if(i==0?(l.length=p,a=1,p--):(l.length=p+1,a=te(10,v-i),l[p]=s>0?(d/te(10,o-s)%te(10,s)|0)*a:0),u)for(;;)if(p==0){for(i=1,s=l[0];s>=10;s/=10)i++;for(s=l[0]+=a,a=1;s>=10;s/=10)a++;i!=a&&(t.e++,l[0]==fe&&(l[0]=1));break}else{if(l[p]+=a,l[p]!=fe)break;l[p--]=0,a=1}for(i=l.length;l[--i]===0;)l.pop()}return M&&(t.e>m.maxE?(t.d=null,t.e=NaN):t.e<m.minE&&(t.e=0,t.d=[0])),t}function ye(t,e,r){if(!t.isFinite())return Zr(t);var n,o=t.e,i=oe(t.d),s=i.length;return e?(r&&(n=r-s)>0?i=i.charAt(0)+"."+i.slice(1)+Se(n):s>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(t.e<0?"e":"e+")+t.e):o<0?(i="0."+Se(-o-1)+i,r&&(n=r-s)>0&&(i+=Se(n))):o>=s?(i+=Se(o+1-s),r&&(n=r-o-1)>0&&(i=i+"."+Se(n))):((n=o+1)<s&&(i=i.slice(0,n)+"."+i.slice(n)),r&&(n=r-s)>0&&(o+1===s&&(i+="."),i+=Se(n))),i}function ht(t,e){var r=t[0];for(e*=v;r>=10;r/=10)e++;return e}function gt(t,e,r){if(e>uo)throw M=!0,r&&(t.precision=r),Error(Or);return B(new t(ft),e,1,!0)}function pe(t,e,r){if(e>qt)throw Error(Or);return B(new t(mt),e,r,!0)}function Gr(t){var e=t.length-1,r=e*v+1;if(e=t[e],e){for(;e%10==0;e/=10)r--;for(e=t[0];e>=10;e/=10)r++}return r}function Se(t){for(var e="";t--;)e+="0";return e}function Hr(t,e,r,n){var o,i=new t(1),s=Math.ceil(n/v+4);for(M=!1;;){if(r%2&&(i=i.times(e),Er(i.d,s)&&(o=!0)),r=ie(r/2),r===0){r=i.d.length-1,o&&i.d[r]===0&&++i.d[r];break}e=e.times(e),Er(e.d,s)}return M=!0,i}function Fr(t){return t.d[t.d.length-1]&1}function jr(t,e,r){for(var n,o=new t(e[0]),i=0;++i<e.length;)if(n=new t(e[i]),n.s)o[r](n)&&(o=n);else{o=n;break}return o}function Gt(t,e){var r,n,o,i,s,a,c,u=0,d=0,l=0,p=t.constructor,m=p.rounding,f=p.precision;if(!t.d||!t.d[0]||t.e>17)return new p(t.d?t.d[0]?t.s<0?0:1/0:1:t.s?t.s<0?0:t:0/0);for(e==null?(M=!1,c=f):c=e,a=new p(.03125);t.e>-2;)t=t.times(a),l+=5;for(n=Math.log(te(2,l))/Math.LN10*2+5|0,c+=n,r=i=s=new p(1),p.precision=c;;){if(i=B(i.times(t),c,1),r=r.times(++d),a=s.plus(X(i,r,c,1)),oe(a.d).slice(0,c)===oe(s.d).slice(0,c)){for(o=l;o--;)s=B(s.times(s),c,1);if(e==null)if(u<3&&ze(s.d,c-n,m,u))p.precision=c+=10,r=i=a=new p(1),d=0,u++;else return B(s,p.precision=f,m,M=!0);else return p.precision=f,s}s=a}}function Le(t,e){var r,n,o,i,s,a,c,u,d,l,p,m=1,f=10,y=t,w=y.d,k=y.constructor,T=k.rounding,b=k.precision;if(y.s<0||!w||!w[0]||!y.e&&w[0]==1&&w.length==1)return new k(w&&!w[0]?-1/0:y.s!=1?NaN:w?0:y);if(e==null?(M=!1,d=b):d=e,k.precision=d+=f,r=oe(w),n=r.charAt(0),Math.abs(i=y.e)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)y=y.times(t),r=oe(y.d),n=r.charAt(0),m++;i=y.e,n>1?(y=new k("0."+r),i++):y=new k(n+"."+r.slice(1))}else return u=gt(k,d+2,b).times(i+""),y=Le(new k(n+"."+r.slice(1)),d-f).plus(u),k.precision=b,e==null?B(y,b,T,M=!0):y;for(l=y,c=s=y=X(y.minus(1),y.plus(1),d,1),p=B(y.times(y),d,1),o=3;;){if(s=B(s.times(p),d,1),u=c.plus(X(s,new k(o),d,1)),oe(u.d).slice(0,d)===oe(c.d).slice(0,d))if(c=c.times(2),i!==0&&(c=c.plus(gt(k,d+2,b).times(i+""))),c=X(c,new k(m),d,1),e==null)if(ze(c.d,d-f,T,a))k.precision=d+=f,u=s=y=X(l.minus(1),l.plus(1),d,1),p=B(y.times(y),d,1),o=a=1;else return B(c,k.precision=b,T,M=!0);else return k.precision=b,c;c=u,o+=2}}function Zr(t){return String(t.s*t.s/0)}function Ht(t,e){var r,n,o;for((r=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(r<0&&(r=n),r+=+e.slice(n+1),e=e.substring(0,n)):r<0&&(r=e.length),n=0;e.charCodeAt(n)===48;n++);for(o=e.length;e.charCodeAt(o-1)===48;--o);if(e=e.slice(n,o),e){if(o-=n,t.e=r=r-n-1,t.d=[],n=(r+1)%v,r<0&&(n+=v),n<o){for(n&&t.d.push(+e.slice(0,n)),o-=v;n<o;)t.d.push(+e.slice(n,n+=v));e=e.slice(n),n=v-e.length}else n-=o;for(;n--;)e+="0";t.d.push(+e),M&&(t.e>t.constructor.maxE?(t.d=null,t.e=NaN):t.e<t.constructor.minE&&(t.e=0,t.d=[0]))}else t.e=0,t.d=[0];return t}function lo(t,e){var r,n,o,i,s,a,c,u,d;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),qr.test(e))return Ht(t,e)}else if(e==="Infinity"||e==="NaN")return+e||(t.s=NaN),t.e=NaN,t.d=null,t;if(io.test(e))r=16,e=e.toLowerCase();else if(oo.test(e))r=2;else if(so.test(e))r=8;else throw Error(Be+e);for(i=e.search(/p/i),i>0?(c=+e.slice(i+1),e=e.substring(2,i)):e=e.slice(2),i=e.indexOf("."),s=i>=0,n=t.constructor,s&&(e=e.replace(".",""),a=e.length,i=a-i,o=Hr(n,new n(r),i,i*2)),u=pt(e,r,fe),d=u.length-1,i=d;u[i]===0;--i)u.pop();return i<0?new n(t.s*0):(t.e=ht(u,d),t.d=u,M=!1,s&&(t=X(t,o,a*4)),c&&(t=t.times(Math.abs(c)<54?te(2,c):Qe.pow(2,c))),M=!0,t)}function po(t,e){var r,n=e.d.length;if(n<3)return e.isZero()?e:De(t,2,e,e);r=1.4*Math.sqrt(n),r=r>16?16:r|0,e=e.times(1/bt(5,r)),e=De(t,2,e,e);for(var o,i=new t(5),s=new t(16),a=new t(20);r--;)o=e.times(e),e=e.times(i.plus(o.times(s.times(o).minus(a))));return e}function De(t,e,r,n,o){var i,s,a,c,u=1,d=t.precision,l=Math.ceil(d/v);for(M=!1,c=r.times(r),a=new t(n);;){if(s=X(a.times(c),new t(e++*e++),d,1),a=o?n.plus(s):n.minus(s),n=X(s.times(c),new t(e++*e++),d,1),s=a.plus(n),s.d[l]!==void 0){for(i=l;s.d[i]===a.d[i]&&i--;);if(i==-1)break}i=a,a=n,n=s,s=i,u++}return M=!0,s.d.length=l+1,s}function bt(t,e){for(var r=t;--e;)r*=t;return r}function zr(t,e){var r,n=e.s<0,o=pe(t,t.precision,1),i=o.times(.5);if(e=e.abs(),e.lte(i))return Te=n?4:1,e;if(r=e.divToInt(o),r.isZero())Te=n?3:2;else{if(e=e.minus(r.times(o)),e.lte(i))return Te=Fr(r)?n?2:3:n?4:1,e;Te=Fr(r)?n?1:4:n?3:2}return e.minus(o).abs()}function jt(t,e,r,n){var o,i,s,a,c,u,d,l,p,m=t.constructor,f=r!==void 0;if(f?(ue(r,1,Re),n===void 0?n=m.rounding:ue(n,0,8)):(r=m.precision,n=m.rounding),!t.isFinite())d=Zr(t);else{for(d=ye(t),s=d.indexOf("."),f?(o=2,e==16?r=r*4-3:e==8&&(r=r*3-2)):o=e,s>=0&&(d=d.replace(".",""),p=new m(1),p.e=d.length-s,p.d=pt(ye(p),10,o),p.e=p.d.length),l=pt(d,10,o),i=c=l.length;l[--c]==0;)l.pop();if(!l[0])d=f?"0p+0":"0";else{if(s<0?i--:(t=new m(t),t.d=l,t.e=i,t=X(t,p,r,n,0,o),l=t.d,i=t.e,u=Dr),s=l[r],a=o/2,u=u||l[r+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(t.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&l[r-1]&1||n===(t.s<0?8:7)),l.length=r,u)for(;++l[--r]>o-1;)l[r]=0,r||(++i,l.unshift(1));for(c=l.length;!l[c-1];--c);for(s=0,d="";s<c;s++)d+=Wt.charAt(l[s]);if(f){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)d+="0";for(l=pt(d,o,e),c=l.length;!l[c-1];--c);for(s=1,d="1.";s<c;s++)d+=Wt.charAt(l[s])}else d=d.charAt(0)+"."+d.slice(1);d=d+(i<0?"p":"p+")+i}else if(i<0){for(;++i;)d="0"+d;d="0."+d}else if(++i>c)for(i-=c;i--;)d+="0";else i<c&&(d=d.slice(0,i)+"."+d.slice(i))}d=(e==16?"0x":e==2?"0b":e==8?"0o":"")+d}return t.s<0?"-"+d:d}function Er(t,e){if(t.length>e)return t.length=e,!0}function fo(t){return new this(t).abs()}function mo(t){return new this(t).acos()}function go(t){return new this(t).acosh()}function yo(t,e){return new this(t).plus(e)}function ho(t){return new this(t).asin()}function bo(t){return new this(t).asinh()}function wo(t){return new this(t).atan()}function To(t){return new this(t).atanh()}function xo(t,e){t=new this(t),e=new this(e);var r,n=this.precision,o=this.rounding,i=n+4;return!t.s||!e.s?r=new this(NaN):!t.d&&!e.d?(r=pe(this,i,1).times(e.s>0?.25:.75),r.s=t.s):!e.d||t.isZero()?(r=e.s<0?pe(this,n,o):new this(0),r.s=t.s):!t.d||e.isZero()?(r=pe(this,i,1).times(.5),r.s=t.s):e.s<0?(this.precision=i,this.rounding=1,r=this.atan(X(t,e,i,1)),e=pe(this,i,1),this.precision=n,this.rounding=o,r=t.s<0?r.minus(e):r.plus(e)):r=this.atan(X(t,e,i,1)),r}function Po(t){return new this(t).cbrt()}function ko(t){return B(t=new this(t),t.e+1,2)}function Ao(t,e,r){return new this(t).clamp(e,r)}function Io(t){if(!t||typeof t!="object")throw Error(yt+"Object expected");var e,r,n,o=t.defaults===!0,i=["precision",1,Re,"rounding",0,8,"toExpNeg",-_e,0,"toExpPos",0,_e,"maxE",0,_e,"minE",-_e,0,"modulo",0,9];for(e=0;e<i.length;e+=3)if(r=i[e],o&&(this[r]=Ut[r]),(n=t[r])!==void 0)if(ie(n)===n&&n>=i[e+1]&&n<=i[e+2])this[r]=n;else throw Error(Be+r+": "+n);if(r="crypto",o&&(this[r]=Ut[r]),(n=t[r])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[r]=!0;else throw Error(Wr);else this[r]=!1;else throw Error(Be+r+": "+n);return this}function So(t){return new this(t).cos()}function Lo(t){return new this(t).cosh()}function Qr(t){var e,r,n;function o(i){var s,a,c,u=this;if(!(u instanceof o))return new o(i);if(u.constructor=o,_r(i)){u.s=i.s,M?!i.d||i.e>o.maxE?(u.e=NaN,u.d=null):i.e<o.minE?(u.e=0,u.d=[0]):(u.e=i.e,u.d=i.d.slice()):(u.e=i.e,u.d=i.d?i.d.slice():i.d);return}if(c=typeof i,c==="number"){if(i===0){u.s=1/i<0?-1:1,u.e=0,u.d=[0];return}if(i<0?(i=-i,u.s=-1):u.s=1,i===~~i&&i<1e7){for(s=0,a=i;a>=10;a/=10)s++;M?s>o.maxE?(u.e=NaN,u.d=null):s<o.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[i]):(u.e=s,u.d=[i]);return}else if(i*0!==0){i||(u.s=NaN),u.e=NaN,u.d=null;return}return Ht(u,i.toString())}else if(c!=="string")throw Error(Be+i);return(a=i.charCodeAt(0))===45?(i=i.slice(1),u.s=-1):(a===43&&(i=i.slice(1)),u.s=1),qr.test(i)?Ht(u,i):lo(u,i)}if(o.prototype=h,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.EUCLID=9,o.config=o.set=Io,o.clone=Qr,o.isDecimal=_r,o.abs=fo,o.acos=mo,o.acosh=go,o.add=yo,o.asin=ho,o.asinh=bo,o.atan=wo,o.atanh=To,o.atan2=xo,o.cbrt=Po,o.ceil=ko,o.clamp=Ao,o.cos=So,o.cosh=Lo,o.div=Bo,o.exp=Ro,o.floor=Co,o.hypot=Ko,o.ln=vo,o.log=Vo,o.log10=No,o.log2=Mo,o.max=Fo,o.min=Eo,o.mod=_o,o.mul=Do,o.pow=Oo,o.random=Wo,o.round=Uo,o.sign=qo,o.sin=Go,o.sinh=Ho,o.sqrt=jo,o.sub=Zo,o.sum=zo,o.tan=Qo,o.tanh=Xo,o.trunc=Jo,t===void 0&&(t={}),t&&t.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)t.hasOwnProperty(r=n[e++])||(t[r]=this[r]);return o.config(t),o}function Bo(t,e){return new this(t).div(e)}function Ro(t){return new this(t).exp()}function Co(t){return B(t=new this(t),t.e+1,3)}function Ko(){var t,e,r=new this(0);for(M=!1,t=0;t<arguments.length;)if(e=new this(arguments[t++]),e.d)r.d&&(r=r.plus(e.times(e)));else{if(e.s)return M=!0,new this(1/0);r=e}return M=!0,r.sqrt()}function _r(t){return t instanceof Qe||t&&t.toStringTag===Ur||!1}function vo(t){return new this(t).ln()}function Vo(t,e){return new this(t).log(e)}function Mo(t){return new this(t).log(2)}function No(t){return new this(t).log(10)}function Fo(){return jr(this,arguments,"lt")}function Eo(){return jr(this,arguments,"gt")}function _o(t,e){return new this(t).mod(e)}function Do(t,e){return new this(t).mul(e)}function Oo(t,e){return new this(t).pow(e)}function Wo(t){var e,r,n,o,i=0,s=new this(1),a=[];if(t===void 0?t=this.precision:ue(t,1,Re),n=Math.ceil(t/v),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));i<n;)o=e[i],o>=429e7?e[i]=crypto.getRandomValues(new Uint32Array(1))[0]:a[i++]=o%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);i<n;)o=e[i]+(e[i+1]<<8)+(e[i+2]<<16)+((e[i+3]&127)<<24),o>=214e7?crypto.randomBytes(4).copy(e,i):(a.push(o%1e7),i+=4);i=n/4}else throw Error(Wr);else for(;i<n;)a[i++]=Math.random()*1e7|0;for(n=a[--i],t%=v,n&&t&&(o=te(10,v-t),a[i]=(n/o|0)*o);a[i]===0;i--)a.pop();if(i<0)r=0,a=[0];else{for(r=-1;a[0]===0;r-=v)a.shift();for(n=1,o=a[0];o>=10;o/=10)n++;n<v&&(r-=v-n)}return s.e=r,s.d=a,s}function Uo(t){return B(t=new this(t),t.e+1,this.rounding)}function qo(t){return t=new this(t),t.d?t.d[0]?t.s:0*t.s:t.s||NaN}function Go(t){return new this(t).sin()}function Ho(t){return new this(t).sinh()}function jo(t){return new this(t).sqrt()}function Zo(t,e){return new this(t).sub(e)}function zo(){var t=0,e=arguments,r=new this(e[t]);for(M=!1;r.s&&++t<e.length;)r=r.plus(e[t]);return M=!0,B(r,this.precision,this.rounding)}function Qo(t){return new this(t).tan()}function Xo(t){return new this(t).tanh()}function Jo(t){return B(t=new this(t),t.e+1,1)}h[Symbol.for("nodejs.util.inspect.custom")]=h.toString;h[Symbol.toStringTag]="Decimal";var Qe=h.constructor=Qr(Ut);ft=new Qe(ft);mt=new Qe(mt);var Zt=Qe;var tn=re(require("big.js")),$e=re(require("bn.js"));var Xr=re(require("toformat")),Yo=Xr.default,Xe=Yo;var Je=re(require("big.js")),Yr=re(require("bn.js")),$r=re(require("decimal.js-light"));var Oe=re(require("bn.js"));var Jr=9007199254740991;function D(t){let e=$("Raydium_parseBigNumberish");if(t instanceof Oe.default)return t;if(typeof t=="string"){if(t.match(/^-?[0-9]+$/))return new Oe.default(t);e.logWithError(`invalid BigNumberish string: ${t}`)}return typeof t=="number"?(t%1&&e.logWithError(`BigNumberish number underflow: ${t}`),(t>=Jr||t<=-Jr)&&e.logWithError(`BigNumberish number overflow: ${t}`),new Oe.default(String(t))):typeof t=="bigint"?new Oe.default(t.toString()):(e.error(`invalid BigNumberish value: ${t}`),new Oe.default(0))}var wt=$("module/fraction"),zt=Xe(Je.default),Ye=Xe($r.default),ei={[0]:Ye.ROUND_DOWN,[1]:Ye.ROUND_HALF_UP,[2]:Ye.ROUND_UP},ti={[0]:Je.default.roundDown,[1]:Je.default.roundHalfUp,[2]:Je.default.roundUp},j=class{numerator;denominator;constructor(e,r=new Yr.default(1)){this.numerator=D(e),this.denominator=D(r)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new j(this.denominator,this.numerator)}add(e){let r=e instanceof j?e:new j(D(e));return this.denominator.eq(r.denominator)?new j(this.numerator.add(r.numerator),this.denominator):new j(this.numerator.mul(r.denominator).add(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}sub(e){let r=e instanceof j?e:new j(D(e));return this.denominator.eq(r.denominator)?new j(this.numerator.sub(r.numerator),this.denominator):new j(this.numerator.mul(r.denominator).sub(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}mul(e){let r=e instanceof j?e:new j(D(e));return new j(this.numerator.mul(r.numerator),this.denominator.mul(r.denominator))}div(e){let r=e instanceof j?e:new j(D(e));return new j(this.numerator.mul(r.denominator),this.denominator.mul(r.numerator))}toSignificant(e,r={groupSeparator:""},n=1){Number.isInteger(e)||wt.logWithError(`${e} is not an integer.`),e<=0&&wt.logWithError(`${e} is not positive.`),Ye.set({precision:e+1,rounding:ei[n]});let o=new Ye(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),r)}toFixed(e,r={groupSeparator:""},n=1){return Number.isInteger(e)||wt.logWithError(`${e} is not an integer.`),e<0&&wt.logWithError(`${e} is negative.`),zt.DP=e,zt.RM=ti[n]||1,new zt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,r)}isZero(){return this.numerator.isZero()}};var ri=$("Raydium_amount"),en=Xe(tn.default);function ni(t,e){let r="0",n="0";if(t.includes(".")){let o=t.split(".");o.length===2?([r,n]=o,n=n.padEnd(e,"0")):ri.logWithError(`invalid number string, num: ${t}`)}else r=t;return[r,n.slice(0,e)||n]}var xe=class extends j{token;logger;constructor(e,r,n=!0,o){let i=new $e.default(0),s=Qt.pow(new $e.default(e.decimals));if(n)i=D(r);else{let a=new $e.default(0),c=new $e.default(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[u,d]=ni(r.toString(),e.decimals);a=D(u),c=D(d)}a=a.mul(s),i=a.add(c)}super(i,s),this.logger=$(o||"TokenAmount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new xe(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new xe(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,r,n=0){return super.toSignificant(e,r,n)}toFixed(e=this.token.decimals,r,n=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,r,n)}toExact(e={groupSeparator:""}){return en.DP=this.token.decimals,new en(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};var rn=require("@solana/web3.js"),Xt=require("@solana/spl-token"),nn={chainId:101,address:rn.PublicKey.default.toBase58(),programId:Xt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ae={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Xt.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Tt=require("@solana/web3.js");var z=require("@solana/web3.js"),on=require("@solana/spl-token");function g({pubkey:t,isSigner:e=!1,isWritable:r=!0}){return{pubkey:t,isWritable:r,isSigner:e}}var Jt=[g({pubkey:on.TOKEN_PROGRAM_ID,isWritable:!1}),g({pubkey:z.SystemProgram.programId,isWritable:!1}),g({pubkey:z.SYSVAR_RENT_PUBKEY,isWritable:!1})];function Yt({publicKey:t,transformSol:e}){let r=$t(t.toString());if(r instanceof z.PublicKey)return e&&r.equals(ne)?we:r;if(e&&r.toString()===ne.toBase58())return we;if(typeof r=="string"){if(r===z.PublicKey.default.toBase58())return z.PublicKey.default;try{return new z.PublicKey(r)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function $t(t){try{return new z.PublicKey(t)}catch{return t}}var bs=new z.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ws=new z.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),oi=new z.PublicKey("SysvarRent111111111111111111111111111111111"),Ts=new z.PublicKey("SysvarC1ock11111111111111111111111111111111"),xs=new z.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ii=new z.PublicKey("Sysvar1nstructions1111111111111111111111111"),Ps=z.SystemProgram.programId,ks=new z.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),As=new z.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Is=new z.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ss=new z.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ls=new z.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Bs=new z.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Rs=new z.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Cs=new z.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ks=new z.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),vs=new z.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Vs=new z.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),we=new z.PublicKey("So11111111111111111111111111111111111111112"),ne=z.PublicKey.default;function dt(t){return Yt({publicKey:t,transformSol:!0})}var er=class{symbol;name;decimals;isToken2022;mint;constructor({mint:e,decimals:r,symbol:n,name:o,skipMint:i=!1,isToken2022:s=!1}){if(e===ne.toBase58()||e instanceof Tt.PublicKey&&ne.equals(e)){this.decimals=ae.decimals,this.symbol=ae.symbol,this.name=ae.name,this.mint=new Tt.PublicKey(ae.address),this.isToken2022=!1;return}this.decimals=r,this.symbol=n||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=i?Tt.PublicKey.default:Yt({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Me=er;ct(Me,"WSOL",new er({...ae,mint:ae.address}));var tr=class{symbol;name;decimals;constructor({decimals:e,symbol:r="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=r,this.name=n}equals(e){return this===e}},xt=tr;ct(xt,"SOL",new tr(nn));var an=re(require("bn.js"));var sn=new j(new an.default(100)),We=class extends j{toSignificant(e=5,r,n){return this.mul(sn).toSignificant(e,r,n)}toFixed(e=2,r,n){return this.mul(sn).toFixed(e,r,n)}};var si=$("Raydium_price"),Pe=class extends j{baseToken;quoteToken;scalar;constructor(e){let{baseToken:r,quoteToken:n,numerator:o,denominator:i}=e;super(o,i),this.baseToken=r,this.quoteToken=n,this.scalar=new j(rr(r.decimals),rr(n.decimals))}get raw(){return new j(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Pe({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&si.logWithError("mul token not equals");let r=super.mul(e);return new Pe({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(e=this.quoteToken.decimals,r,n){return this.adjusted.toSignificant(e,r,n)}toFixed(e=this.quoteToken.decimals,r,n){return this.adjusted.toFixed(e,r,n)}};var un=require("@solana/web3.js"),cn=re(require("bn.js"));function ln(t){return typeof t=="object"&&t!==null&&![Me,xe,un.PublicKey,j,cn.default,Pe,We].some(e=>typeof e=="object"&&t instanceof e)}function ke(t){return typeof t=="string"?$t(t):Array.isArray(t)?t.map(e=>ke(e)):ln(t)?Object.fromEntries(Object.entries(t).map(([e,r])=>[e,ke(r)])):t}var nr=new he.default(0),ka=new he.default(1),Aa=new he.default(2),Ia=new he.default(3),Sa=new he.default(5),Qt=new he.default(10),La=new he.default(100),Ba=new he.default(1e3),Ra=new he.default(1e4);function rr(t){return Qt.pow(D(t))}function Ot(t,e=1,r=[]){let n=[...t];if(e<=0)return r;for(;n.length;)r.push(n.splice(0,e));return r}var mn=require("@solana/web3.js"),gn=require("@solana/spl-token");var se=require("@solana/web3.js");var Q={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip",NonceAccount:"NonceAccount"};var pn=require("@solana/spl-token"),dn=$("Raydium_txUtil"),fn=1644;function Pt(t){let e=[],r=[];return t.microLamports&&(e.push(se.ComputeBudgetProgram.setComputeUnitPrice({microLamports:t.microLamports})),r.push(Q.SetComputeUnitPrice)),t.units&&(e.push(se.ComputeBudgetProgram.setComputeUnitLimit({units:t.units})),r.push(Q.SetComputeUnitLimit)),{instructions:e,instructionTypes:r}}async function Ue(t,e){let r=e??"confirmed";return(await t.getLatestBlockhash?.({commitment:r}))?.blockhash}async function kt(t,e){return t.getSignatureStatuses([e]),new Promise((r,n)=>{let o=setTimeout(n,6e4);t.onSignature(e,i=>{if(clearTimeout(o),!i.err){r("");return}n(Object.assign(i.err,{txId:e}))},"confirmed")})}function ai(t,e){t.length<1&&dn.logWithError(`no instructions provided: ${t.toString()}`),e.length<1&&dn.logWithError(`no signers provided:, ${e.toString()}`);let r=new se.Transaction;r.recentBlockhash="11111111111111111111111111111111",r.feePayer=e[0],r.add(...t);try{return Buffer.from(r.serialize({verifySignatures:!1})).toString("base64").length<fn}catch{return!1}}function Ne(t,e){let[r,n]=se.PublicKey.findProgramAddressSync(t,e);return{publicKey:r,nonce:n}}function et({instructions:t,payer:e,signers:r}){return ai(t,[e,...r])}function tt({instructions:t,payer:e,lookupTableAddressAccount:r,recentBlockhash:n=se.Keypair.generate().publicKey.toString()}){let i=new se.TransactionMessage({payerKey:e,recentBlockhash:n,instructions:t}).compileToV0Message(Object.values(r??{}));try{return Buffer.from(new se.VersionedTransaction(i).serialize()).toString("base64").length<fn}catch{return!1}}var ui=t=>Buffer.isBuffer(t)?t:t instanceof Uint8Array?Buffer.from(t.buffer,t.byteOffset,t.byteLength):Buffer.from(t),ci=t=>{let e=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof se.VersionedTransaction&&(e=ui(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Fe(t){let e=[];return t.forEach(r=>{r instanceof se.Transaction&&(r.recentBlockhash||(r.recentBlockhash=pn.TOKEN_PROGRAM_ID.toBase58()),r.feePayer||(r.feePayer=se.Keypair.generate().publicKey)),e.push(ci(r))}),console.log("simulate tx string:",e),e}function qe(t,e,r){return Ne([t.toBuffer(),(r??gn.TOKEN_PROGRAM_ID).toBuffer(),e.toBuffer()],new mn.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var V=require("@solana/web3.js"),yn=new V.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),hn=new V.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),bn=new V.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),rt=new V.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Ha=new V.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ja=new V.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Za=new V.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),za=new V.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Qa=new V.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Xa=new V.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ja=new V.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Ya=new V.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),$a=new V.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),eu=new V.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),tu=new V.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ru=new V.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),nu=new V.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ou=new V.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),iu=new V.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),su=new V.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),au=new V.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),uu=new V.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),li=new V.PublicKey("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),di=new V.PublicKey("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),pi=new V.PublicKey("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),cu=new V.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),fi=new V.PublicKey("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),lu=new V.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),mi=new V.PublicKey("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),du=new V.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),pu=new V.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),gi=new V.PublicKey("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),yi=new V.PublicKey("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var fu={SERUM_MARKET:V.PublicKey.default,OPENBOOK_MARKET:new V.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:V.PublicKey.default,FarmV3:new V.PublicKey("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new V.PublicKey("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new V.PublicKey("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new V.PublicKey("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new V.PublicKey("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new V.PublicKey("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new V.PublicKey("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new V.PublicKey("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new V.PublicKey("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:li,CREATE_CPMM_POOL_AUTH:di,CREATE_CPMM_POOL_FEE_ACC:pi,FEE_DESTINATION_ID:new V.PublicKey("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:fi,LCOK_CPMM_AUTH:mi,LAUNCHPAD_PROGRAM:gi,LAUNCHPAD_AUTH:yi};var hi=re(require("bn.js"));var Ce=require("@solana/web3.js");async function or({connection:t,address:e}){let r=await Nr(t,[...new Set(e.map(o=>o.toString()))].map(o=>new Ce.PublicKey(o))),n={};for(let o=0;o<e.length;o++){let i=r[o],s=e[o];if(!i)continue;let a=new Ce.AddressLookupTableAccount({key:s,state:Ce.AddressLookupTableAccount.deserialize(i.data)});n[s.toString()]=a,At[s.toString()]=a}return n}var At={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Ce.AddressLookupTableAccount({key:new Ce.PublicKey("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Ce.AddressLookupTableAccount.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};var Z=require("@solana/web3.js"),wn=re(require("axios"));var It=2e3,St=class{connection;owner;instructions=[];endInstructions=[];lookupTableAddress=[];signers=[];instructionTypes=[];endInstructionTypes=[];feePayer;cluster;signAllTransactions;blockhashCommitment;loopMultiTxStatus;constructor(e){this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){let e=(await wn.default.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:r}=e?.[15]??{};if(!!r)return{units:6e5,microLamports:Math.min(Math.ceil(r*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:r,instructionTypes:n}=Pt(e);return this.instructions.unshift(...r),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){return e?(this.endInstructions.push(Z.SystemProgram.transfer({fromPubkey:e.feePayer??this.feePayer,toPubkey:new Z.PublicKey(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(Q.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:r}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;r&&this.instructions.unshift(...r)}catch{r&&this.instructions.unshift(...r)}}addInstruction({instructions:e=[],endInstructions:r=[],signers:n=[],instructionTypes:o=[],endInstructionTypes:i=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...r),this.signers.push(...n),this.instructionTypes.push(...o),this.endInstructionTypes.push(...i),this.lookupTableAddress.push(...s.filter(a=>a!==Z.PublicKey.default.toString())),this}async versionBuild({txVersion:e,extInfo:r},n){return e===0?await this.buildV0({...r||{}},n):this.build(r,n)}build(e,r){let n=new Z.Transaction;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,this.owner?.signer&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:n,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{let{recentBlockHash:i,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=o||{},u=i??r??await Ue(this.connection,this.blockhashCommitment);if(n.recentBlockhash=u,this.signers.length&&n.sign(...this.signers),Fe([n]),this.owner?.isKeyPair)return{txId:a?await(0,Z.sendAndConfirmTransaction)(this.connection,n,this.signers.find(l=>l.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(n.serialize(),{skipPreflight:s}),signedTx:n};if(this.signAllTransactions){let d=await this.signAllTransactions([n]);if(this.signers.length)for(let l of d)try{l.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(d[0].serialize(),{skipPreflight:s}),signedTx:d[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:r=[],extInfo:n}=e,{transaction:o}=this.build(n),i=r.filter(u=>u.transaction.instructions.length>0),s=[o,...i.map(u=>u.transaction)],a=[this.signers,...i.map(u=>u.signers)],c=[...this.instructionTypes,...i.map(u=>u.instructionTypes).flat()];return this.owner?.signer&&a.forEach(u=>{u.some(d=>d.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async u=>{let{sequentially:d,onTxUpdate:l,skipTxCount:p=0,recentBlockHash:m,skipPreflight:f=!0}=u||{},y=m??await Ue(this.connection,this.blockhashCommitment);if(this.owner?.isKeyPair){if(d){let w=[],k=0;for(let T of s){if(++k,k<=p)continue;let b=await(0,Z.sendAndConfirmTransaction)(this.connection,T,this.signers.find(x=>x.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});w.push(b)}return{txIds:w,signedTxs:s}}return{txIds:await await Promise.all(s.map(async w=>(w.recentBlockhash=y,await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:f})))),signedTxs:s}}if(this.signAllTransactions){let w=s.map((T,b)=>(T.recentBlockhash=y,a[b].length&&T.sign(...a[b]),T));Fe(w);let k=await this.signAllTransactions(w);if(d){let T=0,b=[],x=async()=>{if(!k[T])return;let S=await this.connection.sendRawTransaction(k[T].serialize(),{skipPreflight:f});b.push({txId:S,status:"sent",signedTx:k[T]}),l?.([...b]),T++;let A=!1,R=null,_=null,N=L=>{R!==null&&clearInterval(R),_!==null&&this.connection.removeSignatureListener(_);let C=b.findIndex(E=>E.txId===S);if(C>-1){if(b[C].status==="error"||b[C].status==="success")return;b[C].status=L.err?"error":"success"}l?.([...b]),L.err||x()};this.loopMultiTxStatus&&(R=setInterval(async()=>{if(A){clearInterval(R);return}try{let L=await this.connection.getTransaction(S,{commitment:"confirmed",maxSupportedTransactionVersion:0});L&&(A=!0,clearInterval(R),N({err:L.meta?.err||null}),console.log("tx status from getTransaction:",S))}catch(L){A=!0,clearInterval(R),console.error("getTransaction timeout:",L,S)}},It)),_=this.connection.onSignature(S,L=>{if(A){this.connection.removeSignatureListener(_);return}A=!0,N(L)},"confirmed"),this.connection.getSignatureStatus(S)};return await x(),{txIds:b.map(S=>S.txId),signedTxs:k}}else{let T=[];for(let b=0;b<k.length;b+=1){let x=await this.connection.sendRawTransaction(k[b].serialize(),{skipPreflight:f});T.push(x)}return{txIds:T,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:r,extInfo:n}){return r===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e,r){let{lookupTableCache:n={},lookupTableAddress:o=[],forerunCreate:i,recentBlockhash:s,...a}=e||{},c={...this.cluster==="devnet"?{}:At,...n},u=Array.from(new Set([...o,...this.lookupTableAddress])),d=[];for(let f of u)c[f]===void 0&&d.push(new Z.PublicKey(f));if(d.length>0){let f=await or({connection:this.connection,address:d});for(let[y,w]of Object.entries(f))c[y]=w}let l=r??(i?Z.PublicKey.default.toBase58():s??await Ue(this.connection,this.blockhashCommitment)),p=new Z.TransactionMessage({payerKey:this.feePayer,recentBlockhash:l,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(c));this.owner?.signer&&!this.signers.some(f=>f.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let m=new Z.VersionedTransaction(p);return m.sign(this.signers),{builder:this,transaction:m,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async f=>{let{skipPreflight:y=!0,sendAndConfirm:w,notSendToRpc:k}=f||{};if(Fe([m]),this.owner?.isKeyPair){let T=await this.connection.sendTransaction(m,{skipPreflight:y});return w&&await kt(this.connection,T),{txId:T,signedTx:m}}if(this.signAllTransactions){let T=await this.signAllTransactions([m]);if(this.signers.length)for(let b of T)try{b.sign(this.signers)}catch{}return{txId:k?"":await this.connection.sendTransaction(T[0],{skipPreflight:y}),signedTx:T[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(e){let{extraPreBuildData:r=[],buildProps:n}=e,{transaction:o}=await this.buildV0(n),i=r.filter(u=>u.builder.instructions.length>0),s=[o,...i.map(u=>u.transaction)],a=[this.signers,...i.map(u=>u.signers)],c=[...this.instructionTypes,...i.map(u=>u.instructionTypes).flat()];return this.owner?.signer&&a.forEach(u=>{u.some(d=>d.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(u,d)=>{u.sign(a[d])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async u=>{let{sequentially:d,onTxUpdate:l,recentBlockHash:p,skipPreflight:m=!0}=u||{};if(p&&s.forEach(f=>f.message.recentBlockhash=p),Fe(s),this.owner?.isKeyPair){if(d){let f=[];for(let y of s){let w=await this.connection.sendTransaction(y,{skipPreflight:m});await kt(this.connection,w),f.push(w)}return{txIds:f,signedTxs:s}}return{txIds:await Promise.all(s.map(async f=>await this.connection.sendTransaction(f,{skipPreflight:m}))),signedTxs:s}}if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(d){let y=0,w=[],k=async()=>{if(!f[y])return;let T=await this.connection.sendTransaction(f[y],{skipPreflight:m});w.push({txId:T,status:"sent",signedTx:f[y]}),l?.([...w]),y++;let b=!1,x=null,S=null,A=R=>{x!==null&&clearInterval(x),S!==null&&this.connection.removeSignatureListener(S);let _=w.findIndex(N=>N.txId===T);if(_>-1){if(w[_].status==="error"||w[_].status==="success")return;w[_].status=R.err?"error":"success"}l?.([...w]),R.err||k()};this.loopMultiTxStatus&&(x=setInterval(async()=>{if(b){clearInterval(x);return}try{let R=await this.connection.getTransaction(T,{commitment:"confirmed",maxSupportedTransactionVersion:0});R&&(b=!0,clearInterval(x),A({err:R.meta?.err||null}),console.log("tx status from getTransaction:",T))}catch(R){b=!0,clearInterval(x),console.error("getTransaction timeout:",R,T)}},It)),S=this.connection.onSignature(T,R=>{if(b){this.connection.removeSignatureListener(S);return}b=!0,A(R)},"confirmed"),this.connection.getSignatureStatus(T)};return k(),{txIds:[],signedTxs:f}}else{let y=[];for(let w=0;w<f.length;w+=1){let k=await this.connection.sendTransaction(f[w],{skipPreflight:m});y.push(k)}return{txIds:y,signedTxs:f}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){let{splitIns:r=[],computeBudgetConfig:n,...o}=e||{},i=n?Pt(n):{instructions:[],instructionTypes:[]},s=this.signers.reduce((l,p)=>({...l,[p.publicKey.toBase58()]:p}),{}),a=[],c=[],u=[],d=0;if(this.allInstructions.forEach(l=>{let p=[...u,l],m=n?[...i.instructions,...p]:p,y=[...new Set(p.map(w=>w.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(w=>new Z.PublicKey(w));if(l!==r[d]&&u.length<12&&(et({instructions:m,payer:this.feePayer,signers:y})||et({instructions:p,payer:this.feePayer,signers:y})))u.push(l);else{if(u.length===0)throw Error("item ins too big");d+=l===r[d]?1:0,et({instructions:n?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:y})?a.push(new Z.Transaction().add(...i.instructions,...u)):a.push(new Z.Transaction().add(...u)),c.push(Array.from(new Set(u.map(w=>w.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(w=>s[w]).filter(w=>w!==void 0)),u=[l]}}),u.length>0){let p=[...new Set(u.map(m=>m.keys.filter(f=>f.isSigner).map(f=>f.pubkey.toString())).flat()).values()].map(m=>s[m]).filter(m=>m!==void 0);et({instructions:n?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:p.map(m=>m.publicKey)})?a.push(new Z.Transaction().add(...i.instructions,...u)):a.push(new Z.Transaction().add(...u)),c.push(p)}return a.forEach(l=>l.feePayer=this.feePayer),this.owner?.signer&&c.forEach(l=>{l.some(p=>p.publicKey.equals(this.owner.publicKey))||l.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async l=>{let{sequentially:p,onTxUpdate:m,skipTxCount:f=0,recentBlockHash:y,skipPreflight:w=!0}=l||{},k=y??await Ue(this.connection,this.blockhashCommitment);if(a.forEach(async(T,b)=>{T.recentBlockhash=k,c[b].length&&T.sign(...c[b])}),Fe(a),this.owner?.isKeyPair){if(p){let T=0,b=[];for(let x of a){if(++T,T<=f){b.push("tx skipped");continue}let S=await(0,Z.sendAndConfirmTransaction)(this.connection,x,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});b.push(S)}return{txIds:b,signedTxs:a}}return{txIds:await Promise.all(a.map(async T=>await this.connection.sendRawTransaction(T.serialize(),{skipPreflight:w}))),signedTxs:a}}if(this.signAllTransactions){let T=await this.signAllTransactions(a.slice(f,a.length)),b=[...a.slice(0,f),...T];if(p){let x=0,S=[],A=async()=>{if(!b[x])return;x<f&&(S.push({txId:"",status:"success",signedTx:b[x]}),m?.([...S]),x++,A());let R=await this.connection.sendRawTransaction(b[x].serialize(),{skipPreflight:w});S.push({txId:R,status:"sent",signedTx:b[x]}),m?.([...S]),x++;let _=!1,N=null,L=null,C=E=>{N!==null&&clearInterval(N),L!==null&&this.connection.removeSignatureListener(L);let H=S.findIndex(O=>O.txId===R);if(H>-1){if(S[H].status==="error"||S[H].status==="success")return;S[H].status=E.err?"error":"success"}m?.([...S]),E.err||A()};this.loopMultiTxStatus&&(N=setInterval(async()=>{if(_){clearInterval(N);return}try{let E=await this.connection.getTransaction(R,{commitment:"confirmed",maxSupportedTransactionVersion:0});E&&(_=!0,clearInterval(N),C({err:E.meta?.err||null}),console.log("tx status from getTransaction:",R))}catch(E){_=!0,clearInterval(N),console.error("getTransaction timeout:",E,R)}},It)),L=this.connection.onSignature(R,E=>{if(_){this.connection.removeSignatureListener(L);return}_=!0,C(E)},"confirmed"),this.connection.getSignatureStatus(R)};return await A(),{txIds:S.map(R=>R.txId),signedTxs:b}}else{let x=[];for(let S=0;S<b.length;S+=1){let A=await this.connection.sendRawTransaction(b[S].serialize(),{skipPreflight:w});x.push(A)}return{txIds:x,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(e){let{computeBudgetConfig:r,splitIns:n=[],lookupTableCache:o={},lookupTableAddress:i=[],...s}=e||{},a={...this.cluster==="devnet"?{}:At,...o},c=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let T of c)a[T]===void 0&&u.push(new Z.PublicKey(T));let d=await or({connection:this.connection,address:u});for(let[T,b]of Object.entries(d))a[T]=b;let l=r?Pt(r):{instructions:[],instructionTypes:[]},p=await Ue(this.connection,this.blockhashCommitment),m=this.signers.reduce((T,b)=>({...T,[b.publicKey.toBase58()]:b}),{}),f=[],y=[],w=[],k=0;if(this.allInstructions.forEach(T=>{let b=[...w,T],x=r?[...l.instructions,...b]:b;if(T!==n[k]&&w.length<12&&(tt({instructions:x,payer:this.feePayer,lookupTableAddressAccount:a})||tt({instructions:b,payer:this.feePayer,lookupTableAddressAccount:a})))w.push(T);else{if(w.length===0)throw Error("item ins too big");k+=T===n[k]?1:0;let S={};for(let A of[...new Set(c)])a[A]!==void 0&&(S[A]=a[A]);if(r&&tt({instructions:[...l.instructions,...w],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:p})){let A=new Z.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...l.instructions,...w]}).compileToV0Message(Object.values(a));f.push(new Z.VersionedTransaction(A))}else{let A=new Z.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...w]}).compileToV0Message(Object.values(a));f.push(new Z.VersionedTransaction(A))}y.push(Array.from(new Set(w.map(A=>A.keys.filter(R=>R.isSigner).map(R=>R.pubkey.toString())).flat())).map(A=>m[A]).filter(A=>A!==void 0)),w=[T]}}),w.length>0){let b=[...new Set(w.map(x=>x.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat()).values()].map(x=>m[x]).filter(x=>x!==void 0);if(r&&tt({instructions:[...l.instructions,...w],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:p})){let x=new Z.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...l.instructions,...w]}).compileToV0Message(Object.values(a));f.push(new Z.VersionedTransaction(x))}else{let x=new Z.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...w]}).compileToV0Message(Object.values(a));f.push(new Z.VersionedTransaction(x))}y.push(b)}return this.owner?.signer&&y.forEach(T=>{T.some(b=>b.publicKey.equals(this.owner.publicKey))||T.push(this.owner.signer)}),f.forEach((T,b)=>{T.sign(y[b])}),{builder:this,transactions:f,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async T=>{let{sequentially:b,onTxUpdate:x,skipTxCount:S=0,recentBlockHash:A,skipPreflight:R=!0}=T||{};if(f.map(async(_,N)=>{y[N].length&&_.sign(y[N]),A&&(_.message.recentBlockhash=A)}),Fe(f),this.owner?.isKeyPair){if(b){let _=0,N=[];for(let L of f){if(++_,_<=S){console.log("skip tx: ",_),N.push("tx skipped");continue}let C=await this.connection.sendTransaction(L,{skipPreflight:R});await kt(this.connection,C),N.push(C)}return{txIds:N,signedTxs:f}}return{txIds:await Promise.all(f.map(async _=>await this.connection.sendTransaction(_,{skipPreflight:R}))),signedTxs:f}}if(this.signAllTransactions){let _=await this.signAllTransactions(f.slice(S,f.length)),N=[...f.slice(0,S),..._];if(b){let L=0,C=[],E=async()=>{if(!N[L])return;if(L<S){C.push({txId:"",status:"success",signedTx:N[L]}),x?.([...C]),L++,E();return}let H=await this.connection.sendTransaction(N[L],{skipPreflight:R});C.push({txId:H,status:"sent",signedTx:N[L]}),x?.([...C]),L++;let O=!1,q=null,W=null,at=le=>{q!==null&&clearInterval(q),W!==null&&this.connection.removeSignatureListener(W);let ut=C.findIndex(zn=>zn.txId===H);if(ut>-1){if(C[ut].status==="error"||C[ut].status==="success")return;C[ut].status=le.err?"error":"success"}x?.([...C]),le.err||E()};this.loopMultiTxStatus&&(q=setInterval(async()=>{if(O){clearInterval(q);return}try{let le=await this.connection.getTransaction(H,{commitment:"confirmed",maxSupportedTransactionVersion:0});le&&(O=!0,clearInterval(q),at({err:le.meta?.err||null}),console.log("tx status from getTransaction:",H))}catch(le){O=!0,clearInterval(q),console.error("getTransaction timeout:",le,H)}},It)),W=this.connection.onSignature(H,le=>{if(O){this.connection.removeSignatureListener(W);return}O=!0,at(le)},"confirmed"),this.connection.getSignatureStatus(H)};return E(),{txIds:[],signedTxs:N}}else{let L=[];for(let C=0;C<N.length;C+=1){let E=await this.connection.sendTransaction(N[C],{skipPreflight:R});L.push(E)}return{txIds:L,signedTxs:N}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};var Tn=re(require("bn.js")),Ru=new Tn.default(1e6);var Vt=require("@solana/web3.js"),Ii=re(require("bn.js"));var Kn=require("@solana/spl-token");function wi(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function ir(t,...e){if(!wi(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function sr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function xn(t,e){ir(t);let r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}var Bt=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),me=(t,e)=>t<<32-e|t>>>e;var Yu=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Ti(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function ar(t){return typeof t=="string"&&(t=Ti(t)),ir(t),t}var Lt=class{clone(){return this._cloneInto()}},$u={}.toString;function Pn(t){let e=n=>t().update(ar(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function xi(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),a=Number(r&i),c=n?4:0,u=n?0:4;t.setUint32(e+c,s,n),t.setUint32(e+u,a,n)}var kn=(t,e,r)=>t&e^~t&r,An=(t,e,r)=>t&e^t&r^e&r,Rt=class extends Lt{constructor(e,r,n,o){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Bt(this.buffer)}update(e){sr(this);let{view:r,buffer:n,blockLen:o}=this;e=ar(e);let i=e.length;for(let s=0;s<i;){let a=Math.min(o-this.pos,i-s);if(a===o){let c=Bt(e);for(;o<=i-s;s+=o)this.process(c,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){sr(this),xn(e,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:i}=this,{pos:s}=this;r[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(n,0),s=0);for(let l=s;l<o;l++)r[l]=0;xi(n,o-8,BigInt(this.length*8),i),this.process(n,0);let a=Bt(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,d=this.get();if(u>d.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,d[l],i)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:i,destroyed:s,pos:a}=this;return e.length=o,e.pos=a,e.finished=i,e.destroyed=s,o%r&&e.buffer.set(n),e}};var Pi=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ke=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ve=new Uint32Array(64),ur=class extends Rt{constructor(){super(64,32,8,!1),this.A=Ke[0]|0,this.B=Ke[1]|0,this.C=Ke[2]|0,this.D=Ke[3]|0,this.E=Ke[4]|0,this.F=Ke[5]|0,this.G=Ke[6]|0,this.H=Ke[7]|0}get(){let{A:e,B:r,C:n,D:o,E:i,F:s,G:a,H:c}=this;return[e,r,n,o,i,s,a,c]}set(e,r,n,o,i,s,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=a|0,this.H=c|0}process(e,r){for(let l=0;l<16;l++,r+=4)ve[l]=e.getUint32(r,!1);for(let l=16;l<64;l++){let p=ve[l-15],m=ve[l-2],f=me(p,7)^me(p,18)^p>>>3,y=me(m,17)^me(m,19)^m>>>10;ve[l]=y+ve[l-7]+f+ve[l-16]|0}let{A:n,B:o,C:i,D:s,E:a,F:c,G:u,H:d}=this;for(let l=0;l<64;l++){let p=me(a,6)^me(a,11)^me(a,25),m=d+p+kn(a,c,u)+Pi[l]+ve[l]|0,y=(me(n,2)^me(n,13)^me(n,22))+An(n,o,i)|0;d=u,u=c,c=a,a=s+m|0,s=i,i=o,o=n,n=m+y|0}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,d=d+this.H|0,this.set(n,o,i,s,a,c,u,d)}roundClean(){ve.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var In=Pn(()=>new ur);var Rn=require("@solana/web3.js"),Ge=re(require("bn.js"));var K=require("@solana/buffer-layout"),cr=K.Layout,Sn=K.Structure;var lr=K.UInt;var Ln=K.u8;var Bn=K.seq;var Ee=K.blob;var He=class extends cr{blob;signed;constructor(e,r,n){super(e,n),this.blob=Ee(e),this.signed=r}decode(e,r=0){let n=new Ge.default(this.blob.decode(e,r),10,"le");return this.signed?n.fromTwos(this.span*8).clone():n}encode(e,r,n=0){return typeof e=="number"&&(e=new Ge.default(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),r,n)}};function ee(t){return new lr(1,t)}function nt(t){return new lr(4,t)}function P(t){return new He(8,!1,t)}function Ae(t){return new He(16,!1,t)}function Cn(t){return new He(1,!0,t)}function Kt(t){return new He(8,!0,t)}var Ct=class extends cr{layout;decoder;encoder;constructor(e,r,n,o){super(e.span,o),this.layout=e,this.decoder=r,this.encoder=n}decode(e,r){return this.decoder(this.layout.decode(e,r))}encode(e,r,n){return this.layout.encode(this.encoder(e),r,n)}getSpan(e,r){return this.layout.getSpan(e,r)}};function U(t){return new Ct(Ee(32),e=>new Rn.PublicKey(e),e=>e.toBuffer(),t)}function vt(t){return new Ct(Ln(),ki,Ai,t)}function ki(t){if(t===0)return!1;if(t===1)return!0;throw new Error("Invalid bool: "+t)}function Ai(t){return t?1:0}var dr=class extends Sn{decode(e,r){return super.decode(e,r)}};function J(t,e,r){return new dr(t,e,r)}function Y(t,e,r){let n,o=typeof e=="number"?e:(0,Ge.isBN)(e)?e.toNumber():new Proxy(e,{get(i,s){if(!n){let a=Reflect.get(i,"count");n=(0,Ge.isBN)(a)?a.toNumber():a,Reflect.set(i,"count",n)}return Reflect.get(i,s)},set(i,s,a){return s==="count"&&(n=a),Reflect.set(i,s,a)}});return Bn(t,o,r)}var ot=J([U("mint"),U("owner"),P("amount"),nt("delegateOption"),U("delegate"),ee("state"),nt("isNativeOption"),P("isNative"),P("delegatedAmount"),nt("closeAuthorityOption"),U("closeAuthority")]);var Ic=$("Raydium_Util");function Mt({fromPublicKey:t,programId:e=Kn.TOKEN_PROGRAM_ID,assignSeed:r}){let n=r?btoa(r).slice(0,32):Vt.Keypair.generate().publicKey.toBase58().slice(0,32);return{publicKey:Si(t,n,e),seed:n}}function Si(t,e,r){let n=Buffer.concat([t.toBuffer(),Buffer.from(e),r.toBuffer()]),o=In(n);return new Vt.PublicKey(o)}var Nt=require("@solana/web3.js"),vn=re(require("bn.js"));var ge=require("@solana/spl-token");function Li(t){let{mint:e,tokenAccount:r,owner:n,programId:o=ge.TOKEN_PROGRAM_ID}=t;return(0,ge.createInitializeAccountInstruction)(r,e,n,o)}function Bi(t){let{tokenAccount:e,payer:r,multiSigners:n=[],owner:o,programId:i=ge.TOKEN_PROGRAM_ID}=t;return(0,ge.createCloseAccountInstruction)(e,r,o,n,i)}async function pr(t){let{connection:e,amount:r,commitment:n,payer:o,owner:i,skipCloseAccount:s}=t,a=await e.getMinimumBalanceForRentExemption(ot.span,n),c=D(r).add(new vn.default(a)),u=Mt({fromPublicKey:o,programId:ge.TOKEN_PROGRAM_ID});return{addresses:{newAccount:u.publicKey},signers:[],instructions:[Nt.SystemProgram.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:u.seed,newAccountPubkey:u.publicKey,lamports:c.toNumber(),space:ot.span,programId:ge.TOKEN_PROGRAM_ID}),Li({mint:new Nt.PublicKey(ae.address),tokenAccount:u.publicKey,owner:i,programId:ge.TOKEN_PROGRAM_ID})],instructionTypes:[Q.CreateAccount,Q.InitAccount],endInstructionTypes:s?[]:[Q.CloseAccount],endInstructions:s?[]:[Bi({tokenAccount:u.publicKey,payer:o,owner:i})]}}var fr=(...t)=>t.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),it=class{scope;disabled=!1;logger;constructor({scope:e,moduleName:r}){this.scope=e,this.logger=$(r)}createTxBuilder(e){return this.scope.checkOwner(),new St({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(fr(e))}logInfo(...e){this.logger.info(fr(e))}logAndCreateError(...e){let r=fr(e);throw new Error(r)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var Tr=require("@solana/web3.js");var mr=J([ee("instruction")]),gr=J([ee("instruction")]),Ri=J([P("rewardState"),P("rewardOpenTime"),P("rewardEndTime"),P("rewardLastUpdateTime"),P("totalReward"),P("totalRewardEmissioned"),P("rewardClaimed"),P("rewardPerSecond"),Ae("accRewardPerShare"),U("rewardVault"),U("rewardMint"),U("rewardSender"),P("rewardType"),Y(P(),15,"padding")]),Ci=J([P("state"),P("nonce"),U("lpVault"),U("rewardVault"),U(),U(),P(),P(),P("totalReward"),Ae("perShareReward"),P("lastSlot"),P("perSlotReward")]),Ki=J([P("state"),P("nonce"),U("lpVault"),U("rewardVaultA"),P("totalRewardA"),Ae("perShareRewardA"),P("perSlotRewardA"),ee("option"),U("rewardVaultB"),Ee(7),P("totalRewardB"),Ae("perShareRewardB"),P("perSlotRewardB"),P("lastSlot"),U()]),vi=J([P(),P("state"),P("nonce"),P("validRewardTokenNum"),Ae("rewardMultiplier"),P("rewardPeriodMax"),P("rewardPeriodMin"),P("rewardPeriodExtend"),U("lpMint"),U("lpVault"),Y(Ri,5,"rewardInfos"),U("creator"),U(),Y(P(),32,"padding")]),Vi=new Proxy(Ci,{get(t,e,r){return e==="decode"?(...n)=>{let o=t.decode(...n);return{...o,version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]}}:Reflect.get(t,e,r)}}),Mi=new Proxy(Ki,{get(t,e,r){return e==="decode"?(...n)=>{let o=t.decode(...n);return{...o,version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]}}:Reflect.get(t,e,r)}}),Ft=new Proxy(vi,{get(t,e,r){return e==="decode"?(...n)=>{let o=t.decode(...n);return{...o,version:6,rewardInfos:o.rewardInfos.map(i=>({...i,rewardType:(Object.entries(Ve).find(s=>String(s[1])===i.rewardType.toString())??["Standard SPL"])[0]}))}}:Reflect.get(t,e,r)}}),Ni=J([P("isSet"),P("rewardPerSecond"),P("rewardOpenTime"),P("rewardEndTime"),P("rewardType")]),yr=J([ee("instruction"),P("nonce"),Y(Ni,5,"rewardTimeInfo")]),hr=J([ee("instruction"),P("rewardReopenTime"),P("rewardEndTime"),P("rewardPerSecond")]),br=J([ee("instruction"),P("isSet"),P("rewardPerSecond"),P("rewardOpenTime"),P("rewardEndTime"),P("rewardType")]),Zc=J([P("state"),U("id"),U("owner"),P("deposited"),Y(P(),1,"rewardDebts")]),wr=J([P("state"),U("id"),U("owner"),P("deposited"),Y(Ae(),1,"rewardDebts"),P(""),P("voteLockedBalance"),Y(P(),15)]),zc=J([P("state"),U("id"),U("owner"),P("deposited"),Y(P(),2,"rewardDebts")]),Vn=J([P("state"),U("id"),U("owner"),P("deposited"),Y(Ae(),2,"rewardDebts"),Y(P(),17)]),Mn=J([P(),P("state"),U("id"),U("owner"),P("deposited"),Y(Ae(),5,"rewardDebts"),Y(P(),16)]),ce=J([ee("instruction"),P("amount")]),Fi=J([U("mint"),U("grantAuthority"),P("baselineVoteWeightScaledFactor"),P("maxExtraLockupVoteWeightScaledFactor"),P("lockupSaturationSecs"),Cn("digitShift"),Y(ee(),7,"reserved1"),Y(P(),7,"reserved2")]),Ei=J([Ee(8),U("governanceProgramId"),U("realm"),U("realmGoverningTokenMint"),U("realmAuthority"),Y(ee(),32,"reserved1"),Y(Fi,4,"votingMints"),Kt("timeOffset"),ee("bump"),Y(ee(),7,"reserved2"),Y(P(),11,"reserved3")]),_i=J([Kt("startTime"),Kt("endTime"),ee("kind"),Y(ee(),15,"reserved")]),Di=J([Y(_i,1,"lockup"),P("amountDeposited_native"),P("amountInitiallyLockedNative"),vt("isUsed"),vt("allowClawback"),ee("votingMintConfigIdx"),Y(ee(),29,"reserved")]),Oi=J([Ee(8),U("voterAuthority"),U("registrar"),Y(Di,32,"deposits"),ee("voterBump"),ee("voterWweightRecordBump"),Y(ee(),94,"reserved")]);var tl=$("Raydium_farm_config"),Nn=new Tr.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Fn=new Tr.PublicKey("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var En={3:wr,5:Vn,6:Mn},xr=t=>[3,4,5,6].indexOf(t)!==-1,Pr=t=>{let{version:e,rewardInfos:r,rewardTokenAccountsPublicKeys:n}=t,o=`rewardInfo:${JSON.stringify(r)}, rewardAccount:${JSON.stringify(n)}`;return{3:()=>{if(r.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${o}`},5:()=>{if(r.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${o}`},6:()=>{if(!n.length||r.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${o}`}}[e]?.()},Ve={"Standard SPL":0,"Option tokens":1},Ie={[yn.toString()]:3,[hn.toString()]:4,[bn.toString()]:5,[rt.toString()]:6};var I=require("@solana/web3.js"),Ir=re(require("bn.js")),de=require("@solana/spl-token");var _n=re(require("bn.js"));var Wi=$("Raydium.farm.util");function st({programId:t,poolId:e,mint:r,type:n}){let{publicKey:o}=Ne([e.toBuffer(),r.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],t);return o}function be({programId:t,poolId:e,owner:r,version:n}){let{publicKey:o}=Ne([e.toBuffer(),r.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],t);return o}var Dn=({programId:t,poolId:e})=>Ne([e.toBuffer()],t);function On(t){return{isSet:new _n.default(1),rewardPerSecond:D(t.perSecond),rewardOpenTime:D(t.openTime),rewardEndTime:D(t.endTime),rewardType:D(Ve[t.rewardType])}}function kr(t){return D(t.endTime).sub(D(t.openTime)).mul(D(t.perSecond))}function Ar(t){let e=En[t];return e||Wi.logWithError("invalid version",t),e}var Ui=$("Raydium_farm_instruction"),Ol={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function Sr(t){let{version:e,id:r,ledger:n,programId:o,owner:i}=t,s={3:9,5:10}[e];s||Ui.logWithError(`invalid farm pool version: ${e}`);let a=Buffer.alloc(mr.span);mr.encode({instruction:s},a);let c=[g({pubkey:r}),g({pubkey:n}),g({pubkey:i,isWritable:!1}),g({pubkey:I.SystemProgram.programId,isWritable:!1}),g({pubkey:I.SYSVAR_RENT_PUBKEY,isWritable:!1})];return{instruction:new I.TransactionInstruction({programId:o,keys:c,data:a}),instructionType:Q.FarmV3CreateLedger}}function Wn(t){let e=Buffer.alloc(yr.span);yr.encode({instruction:0,nonce:new Ir.default(t.nonce),rewardTimeInfo:t.rewardInfoConfig},e);let r=[...Jt,g({pubkey:t.farmId}),g({pubkey:t.farmAuthority,isWritable:!1}),g({pubkey:t.lpVault}),g({pubkey:t.lpMint,isWritable:!1}),g({pubkey:t.lockVault}),g({pubkey:t.lockMint,isWritable:!1}),g({pubkey:t.lockUserAccount??ne}),g({pubkey:t.owner,isWritable:!1,isSigner:!0})];for(let n of t.rewardInfo)r.push(g({pubkey:n.rewardMint,isWritable:!1}),g({pubkey:n.rewardVault}),g({pubkey:n.userRewardToken}));return{instruction:new I.TransactionInstruction({programId:t.programId,keys:r,data:e}),instructionType:Q.FarmV6Create}}function Un(t){let e=Buffer.alloc(gr.span);gr.encode({instruction:5},e);let r=[g({pubkey:de.TOKEN_PROGRAM_ID,isWritable:!1}),g({pubkey:t.id}),g({pubkey:t.authority,isWritable:!1}),g({pubkey:t.lpVault,isWritable:!1}),g({pubkey:t.rewardVault}),g({pubkey:t.userRewardToken}),g({pubkey:t.owner,isWritable:!1,isSigner:!0})];return{instruction:new I.TransactionInstruction({programId:t.programId,keys:r,data:e}),instructionType:Q.FarmV6CreatorWithdraw}}function Lr({payer:t,rewardVault:e,userRewardTokenPub:r,farmKeys:n,rewardInfo:o}){let i=Buffer.alloc(hr.span);hr.encode({instruction:3,rewardReopenTime:D(o.openTime),rewardEndTime:D(o.endTime),rewardPerSecond:D(o.perSecond)},i);let s=[g({pubkey:de.TOKEN_PROGRAM_ID,isWritable:!1}),g({pubkey:n.id}),g({pubkey:n.lpVault,isWritable:!1}),g({pubkey:e}),g({pubkey:r}),g({pubkey:t,isWritable:!1,isSigner:!0})];return new I.TransactionInstruction({programId:n.programId,keys:s,data:i})}function Br({payer:t,userRewardTokenPub:e,farmKeys:r,rewardVault:n,rewardInfo:o}){let i=Buffer.alloc(br.span);br.encode({instruction:4,isSet:new Ir.default(1),rewardPerSecond:D(o.perSecond),rewardOpenTime:D(o.openTime),rewardEndTime:D(o.endTime),rewardType:D(Ve[o.rewardType])},i);let s=[...Jt,g({pubkey:r.id}),g({pubkey:r.authority,isWritable:!1}),g({pubkey:o.mint,isWritable:!1}),g({pubkey:n}),g({pubkey:e}),g({pubkey:t,isWritable:!1,isSigner:!0})];return new I.TransactionInstruction({programId:r.programId,keys:s,data:i})}function Rr(t){let{farmInfo:e,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s}=t,[a,c]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],u=be({programId:a,poolId:c,owner:i,version:6}),d=Buffer.alloc(ce.span);ce.encode({instruction:2,amount:D(s)},d);let l=[g({pubkey:de.TOKEN_PROGRAM_ID,isWritable:!1}),g({pubkey:c}),g({pubkey:new I.PublicKey(r.authority),isWritable:!1}),g({pubkey:new I.PublicKey(r.lpVault)}),g({pubkey:u}),g({pubkey:i,isWritable:!1,isSigner:!0}),g({pubkey:n})];for(let p=0;p<r.rewardInfos.length;p++)l.push(g({pubkey:new I.PublicKey(r.rewardInfos[p].vault)})),l.push(g({pubkey:o[p]}));return new I.TransactionInstruction({programId:a,keys:l,data:d})}function Cr(t){let{farmInfo:e,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=t,[c,u]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],d=be({programId:c,poolId:u,owner:i,version:5}),l=Buffer.alloc(ce.span);ce.encode({instruction:12,amount:D(s)},l);let p=[g({pubkey:u}),g({pubkey:new I.PublicKey(r.authority),isWritable:!1}),g({pubkey:d}),g({pubkey:i,isWritable:!1,isSigner:!0}),g({pubkey:n}),g({pubkey:new I.PublicKey(r.lpVault)}),g({pubkey:o[0]}),g({pubkey:new I.PublicKey(r.rewardInfos[0].vault)}),g({pubkey:I.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),g({pubkey:de.TOKEN_PROGRAM_ID,isWritable:!1})];for(let m=1;m<r.rewardInfos.length;m++)p.push(g({pubkey:o[m]})),p.push(g({pubkey:new I.PublicKey(r.rewardInfos[m].vault)}));if(a)for(let m of a)p.push(g({pubkey:m}));return new I.TransactionInstruction({programId:c,keys:p,data:l})}function qn(t){let{farmInfo:e,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=t,[c,u]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],d=J([ee("instruction"),P("amount")]),l=[g({pubkey:u}),g({pubkey:new I.PublicKey(r.authority),isWritable:!1}),g({pubkey:a[0]}),g({pubkey:i,isSigner:!0,isWritable:!1}),g({pubkey:n}),g({pubkey:new I.PublicKey(r.lpVault)}),g({pubkey:o[0]}),g({pubkey:new I.PublicKey(r.rewardInfos[0].vault)}),g({pubkey:I.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),g({pubkey:de.TOKEN_PROGRAM_ID,isWritable:!1}),g({pubkey:o[1]}),g({pubkey:new I.PublicKey(r.rewardInfos[1].vault)})],p=Buffer.alloc(d.span);return d.encode({instruction:2,amount:s},p),new I.TransactionInstruction({keys:l,programId:c,data:p})}function Kr(t){let{farmInfo:e,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=t,[c,u]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],d=be({programId:c,poolId:u,owner:i,version:3}),l=Buffer.alloc(ce.span);ce.encode({instruction:11,amount:D(s)},l);let p=[g({pubkey:u}),g({pubkey:new I.PublicKey(r.authority),isWritable:!1}),g({pubkey:d}),g({pubkey:i,isWritable:!1,isSigner:!0}),g({pubkey:n}),g({pubkey:new I.PublicKey(r.lpVault)}),g({pubkey:o[0]}),g({pubkey:new I.PublicKey(r.rewardInfos[0].vault)}),g({pubkey:I.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),g({pubkey:de.TOKEN_PROGRAM_ID,isWritable:!1})];if(a)for(let m of a)p.push(g({pubkey:m}));return new I.TransactionInstruction({programId:c,keys:p,data:l})}function Gn(t){let{farmInfo:e,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=t,[c,u]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],d=be({programId:c,poolId:u,owner:i,version:3}),l=Buffer.alloc(ce.span);ce.encode({instruction:10,amount:D(s)},l);let p=[g({pubkey:u}),g({pubkey:new I.PublicKey(r.authority),isWritable:!1}),g({pubkey:d}),g({pubkey:i,isWritable:!1,isSigner:!0}),g({pubkey:n}),g({pubkey:new I.PublicKey(r.lpVault)}),g({pubkey:o[0]}),g({pubkey:new I.PublicKey(r.rewardInfos[0].vault)}),g({pubkey:I.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),g({pubkey:de.TOKEN_PROGRAM_ID,isWritable:!1})];if(a)for(let m of a)p.push(g({pubkey:m}));return new I.TransactionInstruction({programId:c,keys:p,data:l})}function Hn(t){let{farmInfo:e,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=t,[c,u]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],d=be({programId:c,poolId:u,owner:i,version:5}),l=Buffer.alloc(ce.span);ce.encode({instruction:11,amount:D(s)},l);let p=[g({pubkey:u}),g({pubkey:new I.PublicKey(r.authority),isWritable:!1}),g({pubkey:d}),g({pubkey:i,isWritable:!1,isSigner:!0}),g({pubkey:n}),g({pubkey:new I.PublicKey(r.lpVault)}),g({pubkey:o[0]}),g({pubkey:new I.PublicKey(r.rewardInfos[0].vault)}),g({pubkey:I.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),g({pubkey:de.TOKEN_PROGRAM_ID,isWritable:!1})];for(let m=1;m<r.rewardInfos.length;m++)p.push(g({pubkey:o[m]})),p.push(g({pubkey:new I.PublicKey(r.rewardInfos[m].vault)}));if(a)for(let m of a)p.push(g({pubkey:m}));return new I.TransactionInstruction({programId:c,keys:p,data:l})}function jn(t){let{farmInfo:e,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s}=t,[a,c]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],u=be({programId:a,poolId:c,owner:i,version:6}),d=Buffer.alloc(ce.span);ce.encode({instruction:1,amount:D(s)},d);let l=[g({pubkey:de.TOKEN_PROGRAM_ID,isWritable:!1}),g({pubkey:I.SystemProgram.programId,isWritable:!1}),g({pubkey:c}),g({pubkey:new I.PublicKey(r.authority),isWritable:!1}),g({pubkey:new I.PublicKey(r.lpVault)}),g({pubkey:u}),g({pubkey:i,isWritable:!1,isSigner:!0}),g({pubkey:n})];for(let p=0;p<r.rewardInfos.length;p++)l.push(g({pubkey:new I.PublicKey(r.rewardInfos[p].vault)})),l.push(g({pubkey:o[p]}));return new I.TransactionInstruction({programId:a,keys:l,data:d})}var Et=class extends it{async _getUserRewardInfo({payer:e,rewardInfo:r}){if(r.mint.equals(ne)){let n=await pr({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:e,amount:kr({...r,openTime:r.openTime.toString(),endTime:r.endTime.toString()})});return{rewardPubKey:n.addresses.newAccount,newInstruction:n}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:r.mint,associatedOnly:!1})}}async create({poolInfo:e,rewardInfos:r,payer:n,programId:o=rt,txVersion:i,feePayer:s}){this.checkDisabled(),this.scope.checkOwner();let c={lpMint:new G.PublicKey(e.lpMint.address),lockInfo:{lockMint:Nn,lockVault:Fn},version:6,rewardInfos:r,programId:o},u=this.createTxBuilder(s),d=n??this.scope.ownerPubKey,l=Mt({fromPublicKey:d,programId:c.programId}),p=await this.scope.connection.getMinimumBalanceForRentExemption(Ft.span);u.addInstruction({instructions:[G.SystemProgram.createAccountWithSeed({fromPubkey:d,basePubkey:d,seed:l.seed,newAccountPubkey:l.publicKey,lamports:p,space:Ft.span,programId:c.programId})]});let{publicKey:m,nonce:f}=Dn({programId:new G.PublicKey(c.programId),poolId:l.publicKey}),y=st({programId:c.programId,poolId:l.publicKey,mint:c.lpMint,type:"lpVault"}),w=[],k=[];for(let A of c.rewardInfos){A.openTime>=A.endTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",A.openTime.toString()),isNaN(Ve[A.rewardType])&&this.logAndCreateError("rewardType error",A.rewardType),Number(A.perSecond)<=0&&this.logAndCreateError("rewardPerSecond error",A.perSecond),w.push(On(A));let{rewardPubKey:R,newInstruction:_}=await this._getUserRewardInfo({rewardInfo:A,payer:d});_&&u.addInstruction(_),R||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let N=A.mint.equals(ne)?new G.PublicKey(ae.address):A.mint;k.push({rewardMint:N,rewardVault:st({programId:c.programId,poolId:l.publicKey,mint:N,type:"rewardVault"}),userRewardToken:R})}let{account:T,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({mint:new G.PublicKey(c.lockInfo.lockMint),owner:this.scope.ownerPubKey,skipCloseAccount:!1,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:!1});b&&u.addInstruction(b),T||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let{instruction:x,instructionType:S}=Wn({farmId:l.publicKey,owner:this.scope.ownerPubKey,farmAuthority:m,lpVault:y,lpMint:c.lpMint,lockVault:c.lockInfo.lockVault,lockMint:c.lockInfo.lockMint,lockUserAccount:T,programId:c.programId,rewardInfo:k,rewardInfoConfig:w,nonce:f});return u.addInstruction({instructions:[x],instructionTypes:[S]}).versionBuild({txVersion:i,extInfo:{farmId:l.publicKey,farmAuthority:m,lpVault:y,lockUserAccount:T,nonce:f}})}async restartReward({farmInfo:e,payer:r,newRewardInfo:n,txVersion:o,feePayer:i}){let s=Ie[e.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=ke((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),c={id:a.id,rewardInfos:e.rewardInfos,lpVault:a.lpVault,programId:a.programId};n.openTime>=n.endTime&&this.logAndCreateError("start time error","newRewardInfo",n);let u=r||this.scope.ownerPubKey,d=n.mint.equals(ne)?new G.PublicKey(ae.address):n.mint,l=c.rewardInfos.findIndex(k=>new G.PublicKey(k.mint.address).equals(d)),p=a.rewardInfos[l];p||this.logAndCreateError("configuration does not exist","rewardMint",d);let m=p.vault??ne,f=this.createTxBuilder(i),{rewardPubKey:y,newInstruction:w}=await this._getUserRewardInfo({rewardInfo:n,payer:u});return w&&f.addInstruction(w),y||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts),f.addInstruction({instructions:[Lr({payer:this.scope.ownerPubKey,rewardVault:m,userRewardTokenPub:y,farmKeys:c,rewardInfo:n})],instructionTypes:[Q.FarmV6Restart]}).versionBuild({txVersion:o})}async restartRewards({farmInfo:e,payer:r,newRewardInfos:n,txVersion:o,feePayer:i}){let s=Ie[e.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=ke((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),c={id:a.id,rewardInfos:e.rewardInfos,lpVault:a.lpVault,programId:a.programId};n.forEach(l=>{l.openTime>=l.endTime&&this.logAndCreateError("start time error","newRewardInfo",l)});let u=r||this.scope.ownerPubKey,d=this.createTxBuilder(i);for(let l of n){let p=l.mint.equals(ne)?new G.PublicKey(ae.address):l.mint,m=c.rewardInfos.findIndex(b=>new G.PublicKey(b.mint.address).equals(p)),f=a.rewardInfos[m];f||this.logAndCreateError("configuration does not exist","rewardMint",p);let y=f.vault??ne,{rewardPubKey:w,newInstruction:k}=await this._getUserRewardInfo({rewardInfo:l,payer:u});k&&d.addInstruction(k),w||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let T=Lr({payer:this.scope.ownerPubKey,rewardVault:y,userRewardTokenPub:w,farmKeys:c,rewardInfo:l});d.addInstruction({instructions:[T],instructionTypes:[Q.FarmV6Restart]})}return d.versionBuild({txVersion:o})}async addNewRewardToken(e){let{txVersion:r,farmInfo:n,newRewardInfo:o,payer:i,feePayer:s}=e,a=Ie[n.programId];a!==6&&this.logAndCreateError("invalid farm version ",a);let c=ke((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),u=i??this.scope.ownerPubKey,d=this.createTxBuilder(s),l=o.mint.equals(ne)?new G.PublicKey(ae.address):o.mint,p=st({programId:new G.PublicKey(n.programId),poolId:new G.PublicKey(n.id),mint:l,type:"rewardVault"}),{rewardPubKey:m,newInstruction:f}=await this._getUserRewardInfo({rewardInfo:o,payer:u});return f&&d.addInstruction(f),m||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts),o.mint=l,d.addInstruction({instructions:[Br({payer:this.scope.ownerPubKey,userRewardTokenPub:m,farmKeys:c,rewardVault:p,rewardInfo:o})],instructionTypes:[Q.FarmV6CreatorAddReward]}).versionBuild({txVersion:r})}async addNewRewardsToken(e){let{txVersion:r,farmInfo:n,newRewardInfos:o,payer:i,feePayer:s}=e,a=Ie[n.programId];a!==6&&this.logAndCreateError("invalid farm version ",a);let c=ke((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),u=i??this.scope.ownerPubKey,d=this.createTxBuilder(s);for(let l of o){let p=l.mint.equals(ne)?new G.PublicKey(ae.address):l.mint,m=st({programId:new G.PublicKey(n.programId),poolId:new G.PublicKey(n.id),mint:p,type:"rewardVault"}),{rewardPubKey:f,newInstruction:y}=await this._getUserRewardInfo({rewardInfo:l,payer:u});y&&d.addInstruction(y),f||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let w=Br({payer:this.scope.ownerPubKey,userRewardTokenPub:f,farmKeys:c,rewardVault:m,rewardInfo:{...l,mint:p}});d.addInstruction({instructions:[w],instructionTypes:[Q.FarmV6CreatorAddReward]})}return d.versionBuild({txVersion:r})}async deposit(e){let{txVersion:r,farmInfo:n,amount:o,feePayer:i,useSOLBalance:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1,userAuxiliaryLedgers:u,computeBudgetConfig:d,txTipConfig:l}=e;this.scope.availability.addFarm===!1&&this.logAndCreateError("farm deposit feature disabled in your region");let{rewardInfos:p,programId:m}=n,f=Ie[m];f===4&&this.logAndCreateError("V4 has suspended deposits:",n.programId),xr(f)||this.logAndCreateError("invalid farm program:",n.programId);let[y,w]=[new G.PublicKey(n.programId),new G.PublicKey(n.id)],k=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],T=be({programId:y,poolId:w,owner:this.scope.ownerPubKey,version:f}),b=this.createTxBuilder(i);b.addCustomComputeBudget(d),b.addTipInstruction(l);let x={};for(let O of this.scope.account.tokenAccounts)if(a){let q=qe(this.scope.ownerPubKey,O.mint,O.programId).publicKey;O.publicKey&&q.equals(O.publicKey)&&(x[O.mint.toString()]=O.publicKey)}else x[O.mint.toString()]=O.publicKey;let S=k.lpMint,A=x[S.address];A||this.logAndCreateError("you don't have any lp","lp zero",x);let R=[];for(let O of p){let q=s&&O.mint.address===we.toString(),W=x[O.mint.address];if(!W){let{account:at,instructionParams:le}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:O.mint.programId,mint:new G.PublicKey(O.mint.address),notUseTokenAccount:q,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!q,associatedOnly:q?!1:a,checkCreateATAOwner:c});W=at,le&&b.addInstruction(le)}x[O.mint.address]=W,R.push(W)}let _,N=await this.scope.connection.getAccountInfo(T);if(N&&(_=Ar(f).decode(N.data)),n.programId!==rt.toString()&&!_){let{instruction:O,instructionType:q}=Sr({id:w,programId:y,version:f,ledger:T,owner:this.scope.ownerPubKey});b.addInstruction({instructions:[O],instructionTypes:[q]})}let L=Pr({version:f,rewardInfos:p,rewardTokenAccountsPublicKeys:R});L&&this.logAndCreateError(L);let C={amount:D(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:k,lpAccount:A,rewardAccounts:R,userAuxiliaryLedgers:u?.map(O=>new G.PublicKey(O))},E=f===6?jn(C):f===5?Hn(C):Gn(C),H={3:Q.FarmV3Deposit,5:Q.FarmV5Deposit,6:Q.FarmV6Deposit};return b.addInstruction({instructions:[E],instructionTypes:[H[f]]}).versionBuild({txVersion:r})}async withdraw(e){let{txVersion:r,farmInfo:n,amount:o,deposited:i,useSOLBalance:s,feePayer:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,userAuxiliaryLedgers:d,computeBudgetConfig:l,txTipConfig:p}=e,{rewardInfos:m}=n;this.scope.availability.removeFarm===!1&&this.logAndCreateError("farm withdraw feature disabled in your region");let f=Ie[n.programId];xr(f)||this.logAndCreateError("invalid farm program:",n.programId);let y=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],w=this.createTxBuilder(a);w.addCustomComputeBudget(l),w.addTipInstruction(p);let k={};for(let L of this.scope.account.tokenAccounts)if(c){let C=qe(this.scope.ownerPubKey,L.mint).publicKey;L.publicKey&&C.equals(L.publicKey)&&(k[L.mint.toString()]=L.publicKey)}else k[L.mint.toString()]=L.publicKey;if(f!==4){let L=be({programId:new G.PublicKey(n.programId),poolId:new G.PublicKey(n.id),owner:this.scope.ownerPubKey,version:f}),C=await this.scope.connection.getAccountInfo(L);if(C)Ar(f).decode(C.data).deposited.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else if(f!==6){let{instruction:E,instructionType:H}=Sr({id:new G.PublicKey(y.id),programId:new G.PublicKey(y.programId),version:f,ledger:L,owner:this.scope.ownerPubKey});w.addInstruction({instructions:[E],instructionTypes:[H]})}}i&&i.isZero()&&!(d||[]).length&&this.logAndCreateError("no deposited lp",{farmId:n.id});let T=y.lpMint.address,b=s&&T===we.toString(),x=k[T.toString()];if(!x){let{account:L,instructionParams:C}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:y.lpMint.programId,mint:new G.PublicKey(T),notUseTokenAccount:b,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:b?!1:c,checkCreateATAOwner:u});x=L,C&&w.addInstruction(C)}k[T.toString()]=x;let S=[];for(let L of m){let C=s&&L.mint.address===we.toString(),E=k[L.mint.address];if(!E){let{account:H,instructionParams:O}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:L.mint.programId,mint:new G.PublicKey(L.mint.address),notUseTokenAccount:C,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!C,associatedOnly:C?!1:c,checkCreateATAOwner:u});E=H,O&&w.addInstruction(O)}k[L.mint.address]=E,S.push(E)}let A=Pr({version:f,rewardInfos:m,rewardTokenAccountsPublicKeys:S});A&&this.logAndCreateError(A);let R={amount:D(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:y,lpAccount:x,rewardAccounts:S,userAuxiliaryLedgers:d?.map(L=>new G.PublicKey(L))},_=f===6?Rr(R):f===5?Cr(R):f===4?qn(R):Kr(R),N={3:Q.FarmV3Withdraw,4:Q.FarmV4Withdraw,5:Q.FarmV5Withdraw,6:Q.FarmV6Withdraw};return w.addInstruction({instructions:[_],instructionTypes:[N[f]]}).versionBuild({txVersion:r})}async withdrawFarmReward({farmInfo:e,withdrawMint:r,txVersion:n,computeBudgetConfig:o,txTipConfig:i,feePayer:s}){this.scope.checkOwner();let a=ke((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),c=Ie[e.programId];c!==6&&this.logAndCreateError("invalid farm version",c);let u=a.rewardInfos.find(y=>dt(y.mint.address).equals(dt(r)));u||this.logAndCreateError("withdraw mint error","rewardInfos",e);let d=u?.vault??ne,l=this.createTxBuilder(s),p;if(r.equals(ne)||r.equals(G.PublicKey.default)){let y=await pr({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:kr({...u,openTime:u.openTime,endTime:u.endTime,perSecond:new Zt(u.perSecond).mul(10**u.mint.decimals).toString()})});p=y.addresses.newAccount,l.addInstruction(y)}else{let y=await this.scope.account.getCreatedTokenAccount({mint:r});y===null?(p=await this.scope.account.getAssociatedTokenAccount(r),l.addInstruction({instructions:[(0,Zn.createAssociatedTokenAccountInstruction)(this.scope.ownerPubKey,p,this.scope.ownerPubKey,r)],instructionTypes:[Q.CreateATA]})):p=y}let{instruction:m,instructionType:f}=Un({programId:a.programId,id:a.id,authority:a.authority,lpVault:a.lpVault,rewardVault:d,userRewardToken:p,owner:this.scope.ownerPubKey});return l.addCustomComputeBudget(o),l.addTipInstruction(i),l.addInstruction({instructions:[m],instructionTypes:[f]}).versionBuild({txVersion:n})}async harvestAllRewards(e){let{farmInfoList:r,useSOLBalance:n,feePayer:o,associatedOnly:i=!0,checkCreateATAOwner:s=!1,userAuxiliaryLedgers:a,txVersion:c,computeBudgetConfig:u}=e,d=this.createTxBuilder(o),l={};for(let f of this.scope.account.tokenAccounts)if(i){let y=qe(this.scope.ownerPubKey,f.mint).publicKey;f.publicKey&&y.equals(f.publicKey)&&(l[f.mint.toString()]=f.publicKey)}else l[f.mint.toString()]=f.publicKey;let m=(await this.scope.api.fetchFarmKeysById({ids:Object.values(r).map(f=>f.id).join(",")})).reduce((f,y)=>({...f,[y.id]:y}),{});for(let f of Object.values(r)){let{programId:y,lpMint:w,rewardInfos:k,id:T}=f,b=Ie[y],x=w.address,S=n&&x===we.toString(),A=l[x];if(!A){let{account:E,instructionParams:H}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:w.programId,mint:new G.PublicKey(x),notUseTokenAccount:S,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:S?!1:i,checkCreateATAOwner:s});A=E,H&&d.addInstruction(H)}l[x.toString()]=A;let R=[];for(let E of k){let H=n&&E.mint.address===we.toString(),O=l[E.mint.address];if(!O){let{account:q,instructionParams:W}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:E.mint.programId,mint:new G.PublicKey(E.mint.address),notUseTokenAccount:H,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!H,associatedOnly:H?!1:i,checkCreateATAOwner:s});O=q,W&&d.addInstruction(W)}l[E.mint.address]=O,R.push(O)}let _=m[T],N={amount:nr,owner:this.scope.ownerPubKey,farmInfo:f,farmKeys:_,lpAccount:A,rewardAccounts:R,userAuxiliaryLedgers:a?.map(E=>new G.PublicKey(E))},L=b===6?Rr(N):b===5?Cr(N):Kr(N),C={3:Q.FarmV3Withdraw,5:Q.FarmV5Withdraw,6:Q.FarmV6Withdraw};d.addInstruction({instructions:[L],instructionTypes:[C[b]]})}return c===1?d.sizeCheckBuild({computeBudgetConfig:u}):d.sizeCheckBuildV0({computeBudgetConfig:u})}};0&&(module.exports={});
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=farm.js.map