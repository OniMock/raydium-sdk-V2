var Fn=Object.defineProperty;var En=(t,e,r)=>e in t?Fn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var st=(t,e,r)=>(En(t,typeof e!="symbol"?e+"":e,r),r);import{PublicKey as Z,SystemProgram as is}from"@solana/web3.js";import{createAssociatedTokenAccountInstruction as ss}from"@solana/spl-token";import{PublicKey as On}from"@solana/web3.js";import{get as Lr,set as _n}from"lodash";var Vt=class{logLevel;name;constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let r=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(r)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Br={},Dn={};function Y(t){let e=Lr(Br,t);if(!e){let r=Lr(Dn,t);e=new Vt({name:t,logLevel:r}),_n(Br,t,e)}return e}import{MINT_SIZE as hs,TOKEN_PROGRAM_ID as bs,getTransferFeeConfig as ws,unpackMint as Ts}from"@solana/spl-token";var Mt=Y("Raydium_accountInfo_util");async function Rr(t,e,r){let{batchRequest:n,commitment:o="confirmed",chunkCount:i=100}={batchRequest:!1,...r},s=Nt(e,i),a=new Array(s.length).fill([]);if(n){let c=s.map(l=>{let p=t._buildArgs([l.map(m=>m.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:p}}),u=Nt(c,10);a=(await(await Promise.all(u.map(async l=>await t._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&Mt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(p=>{if(p){let{data:m,executable:f,lamports:y,owner:w,rentEpoch:k}=p;return m.length!==2&&m[1]!=="base64"&&Mt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(m[0],"base64"),executable:f,lamports:y,owner:new On(w),rentEpoch:k}}return null})))}else try{a=await Promise.all(s.map(c=>t.getMultipleAccountsInfo(c,o)))}catch(c){c instanceof Error&&Mt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}import we from"bn.js";var Me=9e15,Se=1e9,Ft="0123456789abcdef",ct="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",lt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Et={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Me,maxE:Me,crypto:!1},Vr,ge,K=!0,pt="[DecimalError] ",Ie=pt+"Invalid argument: ",Mr=pt+"Precision limit exceeded",Nr=pt+"crypto unavailable",Fr="[object Decimal]",ne=Math.floor,ee=Math.pow,Wn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Un=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,qn=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Er=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,le=1e7,C=7,Gn=9007199254740991,Hn=ct.length-1,_t=lt.length-1,h={toStringTag:Fr};h.absoluteValue=h.abs=function(){var t=new this.constructor(this);return t.s<0&&(t.s=1),L(t)};h.ceil=function(){return L(new this.constructor(this),this.e+1,2)};h.clampedTo=h.clamp=function(t,e){var r,n=this,o=n.constructor;if(t=new o(t),e=new o(e),!t.s||!e.s)return new o(NaN);if(t.gt(e))throw Error(Ie+e);return r=n.cmp(t),r<0?t:n.cmp(e)>0?e:new o(n)};h.comparedTo=h.cmp=function(t){var e,r,n,o,i=this,s=i.d,a=(t=new i.constructor(t)).d,c=i.s,u=t.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(i.e!==t.e)return i.e>t.e^c<0?1:-1;for(n=s.length,o=a.length,e=0,r=n<o?n:o;e<r;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===o?0:n>o^c<0?1:-1};h.cosine=h.cos=function(){var t,e,r=this,n=r.constructor;return r.d?r.d[0]?(t=n.precision,e=n.rounding,n.precision=t+Math.max(r.e,r.sd())+C,n.rounding=1,r=jn(n,Ur(n,r)),n.precision=t,n.rounding=e,L(ge==2||ge==3?r.neg():r,t,e,!0)):new n(1):new n(NaN)};h.cubeRoot=h.cbrt=function(){var t,e,r,n,o,i,s,a,c,u,d=this,l=d.constructor;if(!d.isFinite()||d.isZero())return new l(d);for(K=!1,i=d.s*ee(d.s*d,1/3),!i||Math.abs(i)==1/0?(r=re(d.d),t=d.e,(i=(t-r.length+1)%3)&&(r+=i==1||i==-2?"0":"00"),i=ee(r,1/3),t=ne((t+1)/3)-(t%3==(t<0?-1:2)),i==1/0?r="5e"+t:(r=i.toExponential(),r=r.slice(0,r.indexOf("e")+1)+t),n=new l(r),n.s=d.s):n=new l(i.toString()),s=(t=l.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(d),n=z(u.plus(d).times(a),u.plus(c),s+2,1),re(a.d).slice(0,s)===(r=re(n.d)).slice(0,s))if(r=r.slice(s-3,s+1),r=="9999"||!o&&r=="4999"){if(!o&&(L(a,t+1,0),a.times(a).times(a).eq(d))){n=a;break}s+=4,o=1}else{(!+r||!+r.slice(1)&&r.charAt(0)=="5")&&(L(n,t+1,1),e=!n.times(n).times(n).eq(d));break}return K=!0,L(n,t,l.rounding,e)};h.decimalPlaces=h.dp=function(){var t,e=this.d,r=NaN;if(e){if(t=e.length-1,r=(t-ne(this.e/C))*C,t=e[t],t)for(;t%10==0;t/=10)r--;r<0&&(r=0)}return r};h.dividedBy=h.div=function(t){return z(this,new this.constructor(t))};h.dividedToIntegerBy=h.divToInt=function(t){var e=this,r=e.constructor;return L(z(e,new r(t),0,1,1),r.precision,r.rounding)};h.equals=h.eq=function(t){return this.cmp(t)===0};h.floor=function(){return L(new this.constructor(this),this.e+1,3)};h.greaterThan=h.gt=function(t){return this.cmp(t)>0};h.greaterThanOrEqualTo=h.gte=function(t){var e=this.cmp(t);return e==1||e===0};h.hyperbolicCosine=h.cosh=function(){var t,e,r,n,o,i=this,s=i.constructor,a=new s(1);if(!i.isFinite())return new s(i.s?1/0:NaN);if(i.isZero())return a;r=s.precision,n=s.rounding,s.precision=r+Math.max(i.e,i.sd())+4,s.rounding=1,o=i.d.length,o<32?(t=Math.ceil(o/3),e=(1/mt(4,t)).toString()):(t=16,e="2.3283064365386962890625e-10"),i=Ne(s,1,i.times(e),new s(1),!0);for(var c,u=t,d=new s(8);u--;)c=i.times(i),i=a.minus(c.times(d.minus(c.times(d))));return L(i,s.precision=r,s.rounding=n,!0)};h.hyperbolicSine=h.sinh=function(){var t,e,r,n,o=this,i=o.constructor;if(!o.isFinite()||o.isZero())return new i(o);if(e=i.precision,r=i.rounding,i.precision=e+Math.max(o.e,o.sd())+4,i.rounding=1,n=o.d.length,n<3)o=Ne(i,2,o,o,!0);else{t=1.4*Math.sqrt(n),t=t>16?16:t|0,o=o.times(1/mt(5,t)),o=Ne(i,2,o,o,!0);for(var s,a=new i(5),c=new i(16),u=new i(20);t--;)s=o.times(o),o=o.times(a.plus(s.times(c.times(s).plus(u))))}return i.precision=e,i.rounding=r,L(o,e,r,!0)};h.hyperbolicTangent=h.tanh=function(){var t,e,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(t=n.precision,e=n.rounding,n.precision=t+7,n.rounding=1,z(r.sinh(),r.cosh(),n.precision=t,n.rounding=e)):new n(r.s)};h.inverseCosine=h.acos=function(){var t,e=this,r=e.constructor,n=e.abs().cmp(1),o=r.precision,i=r.rounding;return n!==-1?n===0?e.isNeg()?ce(r,o,i):new r(0):new r(NaN):e.isZero()?ce(r,o+4,i).times(.5):(r.precision=o+6,r.rounding=1,e=e.asin(),t=ce(r,o+4,i).times(.5),r.precision=o,r.rounding=i,t.minus(e))};h.inverseHyperbolicCosine=h.acosh=function(){var t,e,r=this,n=r.constructor;return r.lte(1)?new n(r.eq(1)?0:NaN):r.isFinite()?(t=n.precision,e=n.rounding,n.precision=t+Math.max(Math.abs(r.e),r.sd())+4,n.rounding=1,K=!1,r=r.times(r).minus(1).sqrt().plus(r),K=!0,n.precision=t,n.rounding=e,r.ln()):new n(r)};h.inverseHyperbolicSine=h.asinh=function(){var t,e,r=this,n=r.constructor;return!r.isFinite()||r.isZero()?new n(r):(t=n.precision,e=n.rounding,n.precision=t+2*Math.max(Math.abs(r.e),r.sd())+6,n.rounding=1,K=!1,r=r.times(r).plus(1).sqrt().plus(r),K=!0,n.precision=t,n.rounding=e,r.ln())};h.inverseHyperbolicTangent=h.atanh=function(){var t,e,r,n,o=this,i=o.constructor;return o.isFinite()?o.e>=0?new i(o.abs().eq(1)?o.s/0:o.isZero()?o:NaN):(t=i.precision,e=i.rounding,n=o.sd(),Math.max(n,t)<2*-o.e-1?L(new i(o),t,e,!0):(i.precision=r=n-o.e,o=z(o.plus(1),new i(1).minus(o),r+t,1),i.precision=t+4,i.rounding=1,o=o.ln(),i.precision=t,i.rounding=e,o.times(.5))):new i(NaN)};h.inverseSine=h.asin=function(){var t,e,r,n,o=this,i=o.constructor;return o.isZero()?new i(o):(e=o.abs().cmp(1),r=i.precision,n=i.rounding,e!==-1?e===0?(t=ce(i,r+4,n).times(.5),t.s=o.s,t):new i(NaN):(i.precision=r+6,i.rounding=1,o=o.div(new i(1).minus(o.times(o)).sqrt().plus(1)).atan(),i.precision=r,i.rounding=n,o.times(2)))};h.inverseTangent=h.atan=function(){var t,e,r,n,o,i,s,a,c,u=this,d=u.constructor,l=d.precision,p=d.rounding;if(u.isFinite()){if(u.isZero())return new d(u);if(u.abs().eq(1)&&l+4<=_t)return s=ce(d,l+4,p).times(.25),s.s=u.s,s}else{if(!u.s)return new d(NaN);if(l+4<=_t)return s=ce(d,l+4,p).times(.5),s.s=u.s,s}for(d.precision=a=l+10,d.rounding=1,r=Math.min(28,a/C+2|0),t=r;t;--t)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(K=!1,e=Math.ceil(a/C),n=1,c=u.times(u),s=new d(u),o=u;t!==-1;)if(o=o.times(c),i=s.minus(o.div(n+=2)),o=o.times(c),s=i.plus(o.div(n+=2)),s.d[e]!==void 0)for(t=e;s.d[t]===i.d[t]&&t--;);return r&&(s=s.times(2<<r-1)),K=!0,L(s,d.precision=l,d.rounding=p,!0)};h.isFinite=function(){return!!this.d};h.isInteger=h.isInt=function(){return!!this.d&&ne(this.e/C)>this.d.length-2};h.isNaN=function(){return!this.s};h.isNegative=h.isNeg=function(){return this.s<0};h.isPositive=h.isPos=function(){return this.s>0};h.isZero=function(){return!!this.d&&this.d[0]===0};h.lessThan=h.lt=function(t){return this.cmp(t)<0};h.lessThanOrEqualTo=h.lte=function(t){return this.cmp(t)<1};h.logarithm=h.log=function(t){var e,r,n,o,i,s,a,c,u=this,d=u.constructor,l=d.precision,p=d.rounding,m=5;if(t==null)t=new d(10),e=!0;else{if(t=new d(t),r=t.d,t.s<0||!r||!r[0]||t.eq(1))return new d(NaN);e=t.eq(10)}if(r=u.d,u.s<0||!r||!r[0]||u.eq(1))return new d(r&&!r[0]?-1/0:u.s!=1?NaN:r?0:1/0);if(e)if(r.length>1)i=!0;else{for(o=r[0];o%10===0;)o/=10;i=o!==1}if(K=!1,a=l+m,s=Ae(u,a),n=e?dt(d,a+10):Ae(t,a),c=z(s,n,a,1),We(c.d,o=l,p))do if(a+=10,s=Ae(u,a),n=e?dt(d,a+10):Ae(t,a),c=z(s,n,a,1),!i){+re(c.d).slice(o+1,o+15)+1==1e14&&(c=L(c,l+1,0));break}while(We(c.d,o+=10,p));return K=!0,L(c,l,p)};h.minus=h.sub=function(t){var e,r,n,o,i,s,a,c,u,d,l,p,m=this,f=m.constructor;if(t=new f(t),!m.d||!t.d)return!m.s||!t.s?t=new f(NaN):m.d?t.s=-t.s:t=new f(t.d||m.s!==t.s?m:NaN),t;if(m.s!=t.s)return t.s=-t.s,m.plus(t);if(u=m.d,p=t.d,a=f.precision,c=f.rounding,!u[0]||!p[0]){if(p[0])t.s=-t.s;else if(u[0])t=new f(m);else return new f(c===3?-0:0);return K?L(t,a,c):t}if(r=ne(t.e/C),d=ne(m.e/C),u=u.slice(),i=d-r,i){for(l=i<0,l?(e=u,i=-i,s=p.length):(e=p,r=d,s=u.length),n=Math.max(Math.ceil(a/C),s)+2,i>n&&(i=n,e.length=1),e.reverse(),n=i;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=p.length,l=n<s,l&&(s=n),n=0;n<s;n++)if(u[n]!=p[n]){l=u[n]<p[n];break}i=0}for(l&&(e=u,u=p,p=e,t.s=-t.s),s=u.length,n=p.length-s;n>0;--n)u[s++]=0;for(n=p.length;n>i;){if(u[--n]<p[n]){for(o=n;o&&u[--o]===0;)u[o]=le-1;--u[o],u[n]+=le}u[n]-=p[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--r;return u[0]?(t.d=u,t.e=ft(u,r),K?L(t,a,c):t):new f(c===3?-0:0)};h.modulo=h.mod=function(t){var e,r=this,n=r.constructor;return t=new n(t),!r.d||!t.s||t.d&&!t.d[0]?new n(NaN):!t.d||r.d&&!r.d[0]?L(new n(r),n.precision,n.rounding):(K=!1,n.modulo==9?(e=z(r,t.abs(),0,3,1),e.s*=t.s):e=z(r,t,0,n.modulo,1),e=e.times(t),K=!0,r.minus(e))};h.naturalExponential=h.exp=function(){return Dt(this)};h.naturalLogarithm=h.ln=function(){return Ae(this)};h.negated=h.neg=function(){var t=new this.constructor(this);return t.s=-t.s,L(t)};h.plus=h.add=function(t){var e,r,n,o,i,s,a,c,u,d,l=this,p=l.constructor;if(t=new p(t),!l.d||!t.d)return!l.s||!t.s?t=new p(NaN):l.d||(t=new p(t.d||l.s===t.s?l:NaN)),t;if(l.s!=t.s)return t.s=-t.s,l.minus(t);if(u=l.d,d=t.d,a=p.precision,c=p.rounding,!u[0]||!d[0])return d[0]||(t=new p(l)),K?L(t,a,c):t;if(i=ne(l.e/C),n=ne(t.e/C),u=u.slice(),o=i-n,o){for(o<0?(r=u,o=-o,s=d.length):(r=d,n=i,s=u.length),i=Math.ceil(a/C),s=i>s?i+1:s+1,o>s&&(o=s,r.length=1),r.reverse();o--;)r.push(0);r.reverse()}for(s=u.length,o=d.length,s-o<0&&(o=s,r=d,d=u,u=r),e=0;o;)e=(u[--o]=u[o]+d[o]+e)/le|0,u[o]%=le;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return t.d=u,t.e=ft(u,n),K?L(t,a,c):t};h.precision=h.sd=function(t){var e,r=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(Ie+t);return r.d?(e=_r(r.d),t&&r.e+1>e&&(e=r.e+1)):e=NaN,e};h.round=function(){var t=this,e=t.constructor;return L(new e(t),t.e+1,e.rounding)};h.sine=h.sin=function(){var t,e,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(t=n.precision,e=n.rounding,n.precision=t+Math.max(r.e,r.sd())+C,n.rounding=1,r=zn(n,Ur(n,r)),n.precision=t,n.rounding=e,L(ge>2?r.neg():r,t,e,!0)):new n(NaN)};h.squareRoot=h.sqrt=function(){var t,e,r,n,o,i,s=this,a=s.d,c=s.e,u=s.s,d=s.constructor;if(u!==1||!a||!a[0])return new d(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(K=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=re(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=ne((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new d(e)):n=new d(u.toString()),r=(c=d.precision)+3;;)if(i=n,n=i.plus(z(s,i,r+2,1)).times(.5),re(i.d).slice(0,r)===(e=re(n.d)).slice(0,r))if(e=e.slice(r-3,r+1),e=="9999"||!o&&e=="4999"){if(!o&&(L(i,c+1,0),i.times(i).eq(s))){n=i;break}r+=4,o=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(L(n,c+1,1),t=!n.times(n).eq(s));break}return K=!0,L(n,c,d.rounding,t)};h.tangent=h.tan=function(){var t,e,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(t=n.precision,e=n.rounding,n.precision=t+10,n.rounding=1,r=r.sin(),r.s=1,r=z(r,new n(1).minus(r.times(r)).sqrt(),t+10,0),n.precision=t,n.rounding=e,L(ge==2||ge==4?r.neg():r,t,e,!0)):new n(NaN)};h.times=h.mul=function(t){var e,r,n,o,i,s,a,c,u,d=this,l=d.constructor,p=d.d,m=(t=new l(t)).d;if(t.s*=d.s,!p||!p[0]||!m||!m[0])return new l(!t.s||p&&!p[0]&&!m||m&&!m[0]&&!p?NaN:!p||!m?t.s/0:t.s*0);for(r=ne(d.e/C)+ne(t.e/C),c=p.length,u=m.length,c<u&&(i=p,p=m,m=i,s=c,c=u,u=s),i=[],s=c+u,n=s;n--;)i.push(0);for(n=u;--n>=0;){for(e=0,o=c+n;o>n;)a=i[o]+m[n]*p[o-n-1]+e,i[o--]=a%le|0,e=a/le|0;i[o]=(i[o]+e)%le|0}for(;!i[--s];)i.pop();return e?++r:i.shift(),t.d=i,t.e=ft(i,r),K?L(t,l.precision,l.rounding):t};h.toBinary=function(t,e){return Wt(this,2,t,e)};h.toDecimalPlaces=h.toDP=function(t,e){var r=this,n=r.constructor;return r=new n(r),t===void 0?r:(ie(t,0,Se),e===void 0?e=n.rounding:ie(e,0,8),L(r,t+r.e+1,e))};h.toExponential=function(t,e){var r,n=this,o=n.constructor;return t===void 0?r=pe(n,!0):(ie(t,0,Se),e===void 0?e=o.rounding:ie(e,0,8),n=L(new o(n),t+1,e),r=pe(n,!0,t+1)),n.isNeg()&&!n.isZero()?"-"+r:r};h.toFixed=function(t,e){var r,n,o=this,i=o.constructor;return t===void 0?r=pe(o):(ie(t,0,Se),e===void 0?e=i.rounding:ie(e,0,8),n=L(new i(o),t+o.e+1,e),r=pe(n,!1,t+n.e+1)),o.isNeg()&&!o.isZero()?"-"+r:r};h.toFraction=function(t){var e,r,n,o,i,s,a,c,u,d,l,p,m=this,f=m.d,y=m.constructor;if(!f)return new y(m);if(u=r=new y(1),n=c=new y(0),e=new y(n),i=e.e=_r(f)-m.e-1,s=i%C,e.d[0]=ee(10,s<0?C+s:s),t==null)t=i>0?e:u;else{if(a=new y(t),!a.isInt()||a.lt(u))throw Error(Ie+a);t=a.gt(e)?i>0?e:u:a}for(K=!1,a=new y(re(f)),d=y.precision,y.precision=i=f.length*C*2;l=z(a,e,0,1,1),o=r.plus(l.times(n)),o.cmp(t)!=1;)r=n,n=o,o=u,u=c.plus(l.times(o)),c=o,o=e,e=a.minus(l.times(o)),a=o;return o=z(t.minus(r),n,0,1,1),c=c.plus(o.times(u)),r=r.plus(o.times(n)),c.s=u.s=m.s,p=z(u,n,i,1).minus(m).abs().cmp(z(c,r,i,1).minus(m).abs())<1?[u,n]:[c,r],y.precision=d,K=!0,p};h.toHexadecimal=h.toHex=function(t,e){return Wt(this,16,t,e)};h.toNearest=function(t,e){var r=this,n=r.constructor;if(r=new n(r),t==null){if(!r.d)return r;t=new n(1),e=n.rounding}else{if(t=new n(t),e===void 0?e=n.rounding:ie(e,0,8),!r.d)return t.s?r:t;if(!t.d)return t.s&&(t.s=r.s),t}return t.d[0]?(K=!1,r=z(r,t,0,e,1).times(t),K=!0,L(r)):(t.s=r.s,r=t),r};h.toNumber=function(){return+this};h.toOctal=function(t,e){return Wt(this,8,t,e)};h.toPower=h.pow=function(t){var e,r,n,o,i,s,a=this,c=a.constructor,u=+(t=new c(t));if(!a.d||!t.d||!a.d[0]||!t.d[0])return new c(ee(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,i=c.rounding,t.eq(1))return L(a,n,i);if(e=ne(t.e/C),e>=t.d.length-1&&(r=u<0?-u:u)<=Gn)return o=Dr(c,a,r,n),t.s<0?new c(1).div(o):L(o,n,i);if(s=a.s,s<0){if(e<t.d.length-1)return new c(NaN);if((t.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return r=ee(+a,u),e=r==0||!isFinite(r)?ne(u*(Math.log("0."+re(a.d))/Math.LN10+a.e+1)):new c(r+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(K=!1,c.rounding=a.s=1,r=Math.min(12,(e+"").length),o=Dt(t.times(Ae(a,n+r)),n),o.d&&(o=L(o,n+5,1),We(o.d,n,i)&&(e=n+10,o=L(Dt(t.times(Ae(a,e+r)),e),e+5,1),+re(o.d).slice(n+1,n+15)+1==1e14&&(o=L(o,n+1,0)))),o.s=s,K=!0,c.rounding=i,L(o,n,i))};h.toPrecision=function(t,e){var r,n=this,o=n.constructor;return t===void 0?r=pe(n,n.e<=o.toExpNeg||n.e>=o.toExpPos):(ie(t,1,Se),e===void 0?e=o.rounding:ie(e,0,8),n=L(new o(n),t,e),r=pe(n,t<=n.e||n.e<=o.toExpNeg,t)),n.isNeg()&&!n.isZero()?"-"+r:r};h.toSignificantDigits=h.toSD=function(t,e){var r=this,n=r.constructor;return t===void 0?(t=n.precision,e=n.rounding):(ie(t,1,Se),e===void 0?e=n.rounding:ie(e,0,8)),L(new n(r),t,e)};h.toString=function(){var t=this,e=t.constructor,r=pe(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()&&!t.isZero()?"-"+r:r};h.truncated=h.trunc=function(){return L(new this.constructor(this),this.e+1,1)};h.valueOf=h.toJSON=function(){var t=this,e=t.constructor,r=pe(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()?"-"+r:r};function re(t){var e,r,n,o=t.length-1,i="",s=t[0];if(o>0){for(i+=s,e=1;e<o;e++)n=t[e]+"",r=C-n.length,r&&(i+=ke(r)),i+=n;s=t[e],n=s+"",r=C-n.length,r&&(i+=ke(r))}else if(s===0)return"0";for(;s%10===0;)s/=10;return i+s}function ie(t,e,r){if(t!==~~t||t<e||t>r)throw Error(Ie+t)}function We(t,e,r,n){var o,i,s,a;for(i=t[0];i>=10;i/=10)--e;return--e<0?(e+=C,o=0):(o=Math.ceil((e+1)/C),e%=C),i=ee(10,C-e),a=t[o]%i|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=r<4&&a==99999||r>3&&a==49999||a==5e4||a==0):s=(r<4&&a+1==i||r>3&&a+1==i/2)&&(t[o+1]/i/100|0)==ee(10,e-2)-1||(a==i/2||a==0)&&(t[o+1]/i/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||r<4)&&a==9999||!n&&r>3&&a==4999):s=((n||r<4)&&a+1==i||!n&&r>3&&a+1==i/2)&&(t[o+1]/i/1e3|0)==ee(10,e-3)-1,s}function ut(t,e,r){for(var n,o=[0],i,s=0,a=t.length;s<a;){for(i=o.length;i--;)o[i]*=e;for(o[0]+=Ft.indexOf(t.charAt(s++)),n=0;n<o.length;n++)o[n]>r-1&&(o[n+1]===void 0&&(o[n+1]=0),o[n+1]+=o[n]/r|0,o[n]%=r)}return o.reverse()}function jn(t,e){var r,n,o;if(e.isZero())return e;n=e.d.length,n<32?(r=Math.ceil(n/3),o=(1/mt(4,r)).toString()):(r=16,o="2.3283064365386962890625e-10"),t.precision+=r,e=Ne(t,1,e.times(o),new t(1));for(var i=r;i--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return t.precision-=r,e}var z=function(){function t(n,o,i){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*o+a,n[c]=s%i|0,a=s/i|0;return a&&n.unshift(a),n}function e(n,o,i,s){var a,c;if(i!=s)c=i>s?1:-1;else for(a=c=0;a<i;a++)if(n[a]!=o[a]){c=n[a]>o[a]?1:-1;break}return c}function r(n,o,i,s){for(var a=0;i--;)n[i]-=a,a=n[i]<o[i]?1:0,n[i]=a*s+n[i]-o[i];for(;!n[0]&&n.length>1;)n.shift()}return function(n,o,i,s,a,c){var u,d,l,p,m,f,y,w,k,T,b,x,I,A,B,E,V,S,R,F,G=n.constructor,D=n.s==o.s?1:-1,q=n.d,O=o.d;if(!q||!q[0]||!O||!O[0])return new G(!n.s||!o.s||(q?O&&q[0]==O[0]:!O)?NaN:q&&q[0]==0||!O?D*0:D/0);for(c?(m=1,d=n.e-o.e):(c=le,m=C,d=ne(n.e/m)-ne(o.e/m)),R=O.length,V=q.length,k=new G(D),T=k.d=[],l=0;O[l]==(q[l]||0);l++);if(O[l]>(q[l]||0)&&d--,i==null?(A=i=G.precision,s=G.rounding):a?A=i+(n.e-o.e)+1:A=i,A<0)T.push(1),f=!0;else{if(A=A/m+2|0,l=0,R==1){for(p=0,O=O[0],A++;(l<V||p)&&A--;l++)B=p*c+(q[l]||0),T[l]=B/O|0,p=B%O|0;f=p||l<V}else{for(p=c/(O[0]+1)|0,p>1&&(O=t(O,p,c),q=t(q,p,c),R=O.length,V=q.length),E=R,b=q.slice(0,R),x=b.length;x<R;)b[x++]=0;F=O.slice(),F.unshift(0),S=O[0],O[1]>=c/2&&++S;do p=0,u=e(O,b,R,x),u<0?(I=b[0],R!=x&&(I=I*c+(b[1]||0)),p=I/S|0,p>1?(p>=c&&(p=c-1),y=t(O,p,c),w=y.length,x=b.length,u=e(y,b,w,x),u==1&&(p--,r(y,R<w?F:O,w,c))):(p==0&&(u=p=1),y=O.slice()),w=y.length,w<x&&y.unshift(0),r(b,y,x,c),u==-1&&(x=b.length,u=e(O,b,R,x),u<1&&(p++,r(b,R<x?F:O,x,c))),x=b.length):u===0&&(p++,b=[0]),T[l++]=p,u&&b[0]?b[x++]=q[E]||0:(b=[q[E]],x=1);while((E++<V||b[0]!==void 0)&&A--);f=b[0]!==void 0}T[0]||T.shift()}if(m==1)k.e=d,Vr=f;else{for(l=1,p=T[0];p>=10;p/=10)l++;k.e=l+d*m-1,L(k,a?i+k.e+1:i,s,f)}return k}}();function L(t,e,r,n){var o,i,s,a,c,u,d,l,p,m=t.constructor;e:if(e!=null){if(l=t.d,!l)return t;for(o=1,a=l[0];a>=10;a/=10)o++;if(i=e-o,i<0)i+=C,s=e,d=l[p=0],c=d/ee(10,o-s-1)%10|0;else if(p=Math.ceil((i+1)/C),a=l.length,p>=a)if(n){for(;a++<=p;)l.push(0);d=c=0,o=1,i%=C,s=i-C+1}else break e;else{for(d=a=l[p],o=1;a>=10;a/=10)o++;i%=C,s=i-C+o,c=s<0?0:d/ee(10,o-s-1)%10|0}if(n=n||e<0||l[p+1]!==void 0||(s<0?d:d%ee(10,o-s-1)),u=r<4?(c||n)&&(r==0||r==(t.s<0?3:2)):c>5||c==5&&(r==4||n||r==6&&(i>0?s>0?d/ee(10,o-s):0:l[p-1])%10&1||r==(t.s<0?8:7)),e<1||!l[0])return l.length=0,u?(e-=t.e+1,l[0]=ee(10,(C-e%C)%C),t.e=-e||0):l[0]=t.e=0,t;if(i==0?(l.length=p,a=1,p--):(l.length=p+1,a=ee(10,C-i),l[p]=s>0?(d/ee(10,o-s)%ee(10,s)|0)*a:0),u)for(;;)if(p==0){for(i=1,s=l[0];s>=10;s/=10)i++;for(s=l[0]+=a,a=1;s>=10;s/=10)a++;i!=a&&(t.e++,l[0]==le&&(l[0]=1));break}else{if(l[p]+=a,l[p]!=le)break;l[p--]=0,a=1}for(i=l.length;l[--i]===0;)l.pop()}return K&&(t.e>m.maxE?(t.d=null,t.e=NaN):t.e<m.minE&&(t.e=0,t.d=[0])),t}function pe(t,e,r){if(!t.isFinite())return Wr(t);var n,o=t.e,i=re(t.d),s=i.length;return e?(r&&(n=r-s)>0?i=i.charAt(0)+"."+i.slice(1)+ke(n):s>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(t.e<0?"e":"e+")+t.e):o<0?(i="0."+ke(-o-1)+i,r&&(n=r-s)>0&&(i+=ke(n))):o>=s?(i+=ke(o+1-s),r&&(n=r-o-1)>0&&(i=i+"."+ke(n))):((n=o+1)<s&&(i=i.slice(0,n)+"."+i.slice(n)),r&&(n=r-s)>0&&(o+1===s&&(i+="."),i+=ke(n))),i}function ft(t,e){var r=t[0];for(e*=C;r>=10;r/=10)e++;return e}function dt(t,e,r){if(e>Hn)throw K=!0,r&&(t.precision=r),Error(Mr);return L(new t(ct),e,1,!0)}function ce(t,e,r){if(e>_t)throw Error(Mr);return L(new t(lt),e,r,!0)}function _r(t){var e=t.length-1,r=e*C+1;if(e=t[e],e){for(;e%10==0;e/=10)r--;for(e=t[0];e>=10;e/=10)r++}return r}function ke(t){for(var e="";t--;)e+="0";return e}function Dr(t,e,r,n){var o,i=new t(1),s=Math.ceil(n/C+4);for(K=!1;;){if(r%2&&(i=i.times(e),Kr(i.d,s)&&(o=!0)),r=ne(r/2),r===0){r=i.d.length-1,o&&i.d[r]===0&&++i.d[r];break}e=e.times(e),Kr(e.d,s)}return K=!0,i}function Cr(t){return t.d[t.d.length-1]&1}function Or(t,e,r){for(var n,o=new t(e[0]),i=0;++i<e.length;)if(n=new t(e[i]),n.s)o[r](n)&&(o=n);else{o=n;break}return o}function Dt(t,e){var r,n,o,i,s,a,c,u=0,d=0,l=0,p=t.constructor,m=p.rounding,f=p.precision;if(!t.d||!t.d[0]||t.e>17)return new p(t.d?t.d[0]?t.s<0?0:1/0:1:t.s?t.s<0?0:t:0/0);for(e==null?(K=!1,c=f):c=e,a=new p(.03125);t.e>-2;)t=t.times(a),l+=5;for(n=Math.log(ee(2,l))/Math.LN10*2+5|0,c+=n,r=i=s=new p(1),p.precision=c;;){if(i=L(i.times(t),c,1),r=r.times(++d),a=s.plus(z(i,r,c,1)),re(a.d).slice(0,c)===re(s.d).slice(0,c)){for(o=l;o--;)s=L(s.times(s),c,1);if(e==null)if(u<3&&We(s.d,c-n,m,u))p.precision=c+=10,r=i=a=new p(1),d=0,u++;else return L(s,p.precision=f,m,K=!0);else return p.precision=f,s}s=a}}function Ae(t,e){var r,n,o,i,s,a,c,u,d,l,p,m=1,f=10,y=t,w=y.d,k=y.constructor,T=k.rounding,b=k.precision;if(y.s<0||!w||!w[0]||!y.e&&w[0]==1&&w.length==1)return new k(w&&!w[0]?-1/0:y.s!=1?NaN:w?0:y);if(e==null?(K=!1,d=b):d=e,k.precision=d+=f,r=re(w),n=r.charAt(0),Math.abs(i=y.e)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)y=y.times(t),r=re(y.d),n=r.charAt(0),m++;i=y.e,n>1?(y=new k("0."+r),i++):y=new k(n+"."+r.slice(1))}else return u=dt(k,d+2,b).times(i+""),y=Ae(new k(n+"."+r.slice(1)),d-f).plus(u),k.precision=b,e==null?L(y,b,T,K=!0):y;for(l=y,c=s=y=z(y.minus(1),y.plus(1),d,1),p=L(y.times(y),d,1),o=3;;){if(s=L(s.times(p),d,1),u=c.plus(z(s,new k(o),d,1)),re(u.d).slice(0,d)===re(c.d).slice(0,d))if(c=c.times(2),i!==0&&(c=c.plus(dt(k,d+2,b).times(i+""))),c=z(c,new k(m),d,1),e==null)if(We(c.d,d-f,T,a))k.precision=d+=f,u=s=y=z(l.minus(1),l.plus(1),d,1),p=L(y.times(y),d,1),o=a=1;else return L(c,k.precision=b,T,K=!0);else return k.precision=b,c;c=u,o+=2}}function Wr(t){return String(t.s*t.s/0)}function Ot(t,e){var r,n,o;for((r=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(r<0&&(r=n),r+=+e.slice(n+1),e=e.substring(0,n)):r<0&&(r=e.length),n=0;e.charCodeAt(n)===48;n++);for(o=e.length;e.charCodeAt(o-1)===48;--o);if(e=e.slice(n,o),e){if(o-=n,t.e=r=r-n-1,t.d=[],n=(r+1)%C,r<0&&(n+=C),n<o){for(n&&t.d.push(+e.slice(0,n)),o-=C;n<o;)t.d.push(+e.slice(n,n+=C));e=e.slice(n),n=C-e.length}else n-=o;for(;n--;)e+="0";t.d.push(+e),K&&(t.e>t.constructor.maxE?(t.d=null,t.e=NaN):t.e<t.constructor.minE&&(t.e=0,t.d=[0]))}else t.e=0,t.d=[0];return t}function Zn(t,e){var r,n,o,i,s,a,c,u,d;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Er.test(e))return Ot(t,e)}else if(e==="Infinity"||e==="NaN")return+e||(t.s=NaN),t.e=NaN,t.d=null,t;if(Un.test(e))r=16,e=e.toLowerCase();else if(Wn.test(e))r=2;else if(qn.test(e))r=8;else throw Error(Ie+e);for(i=e.search(/p/i),i>0?(c=+e.slice(i+1),e=e.substring(2,i)):e=e.slice(2),i=e.indexOf("."),s=i>=0,n=t.constructor,s&&(e=e.replace(".",""),a=e.length,i=a-i,o=Dr(n,new n(r),i,i*2)),u=ut(e,r,le),d=u.length-1,i=d;u[i]===0;--i)u.pop();return i<0?new n(t.s*0):(t.e=ft(u,d),t.d=u,K=!1,s&&(t=z(t,o,a*4)),c&&(t=t.times(Math.abs(c)<54?ee(2,c):Ue.pow(2,c))),K=!0,t)}function zn(t,e){var r,n=e.d.length;if(n<3)return e.isZero()?e:Ne(t,2,e,e);r=1.4*Math.sqrt(n),r=r>16?16:r|0,e=e.times(1/mt(5,r)),e=Ne(t,2,e,e);for(var o,i=new t(5),s=new t(16),a=new t(20);r--;)o=e.times(e),e=e.times(i.plus(o.times(s.times(o).minus(a))));return e}function Ne(t,e,r,n,o){var i,s,a,c,u=1,d=t.precision,l=Math.ceil(d/C);for(K=!1,c=r.times(r),a=new t(n);;){if(s=z(a.times(c),new t(e++*e++),d,1),a=o?n.plus(s):n.minus(s),n=z(s.times(c),new t(e++*e++),d,1),s=a.plus(n),s.d[l]!==void 0){for(i=l;s.d[i]===a.d[i]&&i--;);if(i==-1)break}i=a,a=n,n=s,s=i,u++}return K=!0,s.d.length=l+1,s}function mt(t,e){for(var r=t;--e;)r*=t;return r}function Ur(t,e){var r,n=e.s<0,o=ce(t,t.precision,1),i=o.times(.5);if(e=e.abs(),e.lte(i))return ge=n?4:1,e;if(r=e.divToInt(o),r.isZero())ge=n?3:2;else{if(e=e.minus(r.times(o)),e.lte(i))return ge=Cr(r)?n?2:3:n?4:1,e;ge=Cr(r)?n?1:4:n?3:2}return e.minus(o).abs()}function Wt(t,e,r,n){var o,i,s,a,c,u,d,l,p,m=t.constructor,f=r!==void 0;if(f?(ie(r,1,Se),n===void 0?n=m.rounding:ie(n,0,8)):(r=m.precision,n=m.rounding),!t.isFinite())d=Wr(t);else{for(d=pe(t),s=d.indexOf("."),f?(o=2,e==16?r=r*4-3:e==8&&(r=r*3-2)):o=e,s>=0&&(d=d.replace(".",""),p=new m(1),p.e=d.length-s,p.d=ut(pe(p),10,o),p.e=p.d.length),l=ut(d,10,o),i=c=l.length;l[--c]==0;)l.pop();if(!l[0])d=f?"0p+0":"0";else{if(s<0?i--:(t=new m(t),t.d=l,t.e=i,t=z(t,p,r,n,0,o),l=t.d,i=t.e,u=Vr),s=l[r],a=o/2,u=u||l[r+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(t.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&l[r-1]&1||n===(t.s<0?8:7)),l.length=r,u)for(;++l[--r]>o-1;)l[r]=0,r||(++i,l.unshift(1));for(c=l.length;!l[c-1];--c);for(s=0,d="";s<c;s++)d+=Ft.charAt(l[s]);if(f){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)d+="0";for(l=ut(d,o,e),c=l.length;!l[c-1];--c);for(s=1,d="1.";s<c;s++)d+=Ft.charAt(l[s])}else d=d.charAt(0)+"."+d.slice(1);d=d+(i<0?"p":"p+")+i}else if(i<0){for(;++i;)d="0"+d;d="0."+d}else if(++i>c)for(i-=c;i--;)d+="0";else i<c&&(d=d.slice(0,i)+"."+d.slice(i))}d=(e==16?"0x":e==2?"0b":e==8?"0o":"")+d}return t.s<0?"-"+d:d}function Kr(t,e){if(t.length>e)return t.length=e,!0}function Qn(t){return new this(t).abs()}function Xn(t){return new this(t).acos()}function Jn(t){return new this(t).acosh()}function Yn(t,e){return new this(t).plus(e)}function $n(t){return new this(t).asin()}function eo(t){return new this(t).asinh()}function to(t){return new this(t).atan()}function ro(t){return new this(t).atanh()}function no(t,e){t=new this(t),e=new this(e);var r,n=this.precision,o=this.rounding,i=n+4;return!t.s||!e.s?r=new this(NaN):!t.d&&!e.d?(r=ce(this,i,1).times(e.s>0?.25:.75),r.s=t.s):!e.d||t.isZero()?(r=e.s<0?ce(this,n,o):new this(0),r.s=t.s):!t.d||e.isZero()?(r=ce(this,i,1).times(.5),r.s=t.s):e.s<0?(this.precision=i,this.rounding=1,r=this.atan(z(t,e,i,1)),e=ce(this,i,1),this.precision=n,this.rounding=o,r=t.s<0?r.minus(e):r.plus(e)):r=this.atan(z(t,e,i,1)),r}function oo(t){return new this(t).cbrt()}function io(t){return L(t=new this(t),t.e+1,2)}function so(t,e,r){return new this(t).clamp(e,r)}function ao(t){if(!t||typeof t!="object")throw Error(pt+"Object expected");var e,r,n,o=t.defaults===!0,i=["precision",1,Se,"rounding",0,8,"toExpNeg",-Me,0,"toExpPos",0,Me,"maxE",0,Me,"minE",-Me,0,"modulo",0,9];for(e=0;e<i.length;e+=3)if(r=i[e],o&&(this[r]=Et[r]),(n=t[r])!==void 0)if(ne(n)===n&&n>=i[e+1]&&n<=i[e+2])this[r]=n;else throw Error(Ie+r+": "+n);if(r="crypto",o&&(this[r]=Et[r]),(n=t[r])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[r]=!0;else throw Error(Nr);else this[r]=!1;else throw Error(Ie+r+": "+n);return this}function uo(t){return new this(t).cos()}function co(t){return new this(t).cosh()}function qr(t){var e,r,n;function o(i){var s,a,c,u=this;if(!(u instanceof o))return new o(i);if(u.constructor=o,vr(i)){u.s=i.s,K?!i.d||i.e>o.maxE?(u.e=NaN,u.d=null):i.e<o.minE?(u.e=0,u.d=[0]):(u.e=i.e,u.d=i.d.slice()):(u.e=i.e,u.d=i.d?i.d.slice():i.d);return}if(c=typeof i,c==="number"){if(i===0){u.s=1/i<0?-1:1,u.e=0,u.d=[0];return}if(i<0?(i=-i,u.s=-1):u.s=1,i===~~i&&i<1e7){for(s=0,a=i;a>=10;a/=10)s++;K?s>o.maxE?(u.e=NaN,u.d=null):s<o.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[i]):(u.e=s,u.d=[i]);return}else if(i*0!==0){i||(u.s=NaN),u.e=NaN,u.d=null;return}return Ot(u,i.toString())}else if(c!=="string")throw Error(Ie+i);return(a=i.charCodeAt(0))===45?(i=i.slice(1),u.s=-1):(a===43&&(i=i.slice(1)),u.s=1),Er.test(i)?Ot(u,i):Zn(u,i)}if(o.prototype=h,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.EUCLID=9,o.config=o.set=ao,o.clone=qr,o.isDecimal=vr,o.abs=Qn,o.acos=Xn,o.acosh=Jn,o.add=Yn,o.asin=$n,o.asinh=eo,o.atan=to,o.atanh=ro,o.atan2=no,o.cbrt=oo,o.ceil=io,o.clamp=so,o.cos=uo,o.cosh=co,o.div=lo,o.exp=po,o.floor=fo,o.hypot=mo,o.ln=go,o.log=yo,o.log10=bo,o.log2=ho,o.max=wo,o.min=To,o.mod=xo,o.mul=Po,o.pow=ko,o.random=Ao,o.round=Io,o.sign=So,o.sin=Lo,o.sinh=Bo,o.sqrt=Ro,o.sub=Co,o.sum=Ko,o.tan=vo,o.tanh=Vo,o.trunc=Mo,t===void 0&&(t={}),t&&t.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)t.hasOwnProperty(r=n[e++])||(t[r]=this[r]);return o.config(t),o}function lo(t,e){return new this(t).div(e)}function po(t){return new this(t).exp()}function fo(t){return L(t=new this(t),t.e+1,3)}function mo(){var t,e,r=new this(0);for(K=!1,t=0;t<arguments.length;)if(e=new this(arguments[t++]),e.d)r.d&&(r=r.plus(e.times(e)));else{if(e.s)return K=!0,new this(1/0);r=e}return K=!0,r.sqrt()}function vr(t){return t instanceof Ue||t&&t.toStringTag===Fr||!1}function go(t){return new this(t).ln()}function yo(t,e){return new this(t).log(e)}function ho(t){return new this(t).log(2)}function bo(t){return new this(t).log(10)}function wo(){return Or(this,arguments,"lt")}function To(){return Or(this,arguments,"gt")}function xo(t,e){return new this(t).mod(e)}function Po(t,e){return new this(t).mul(e)}function ko(t,e){return new this(t).pow(e)}function Ao(t){var e,r,n,o,i=0,s=new this(1),a=[];if(t===void 0?t=this.precision:ie(t,1,Se),n=Math.ceil(t/C),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));i<n;)o=e[i],o>=429e7?e[i]=crypto.getRandomValues(new Uint32Array(1))[0]:a[i++]=o%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);i<n;)o=e[i]+(e[i+1]<<8)+(e[i+2]<<16)+((e[i+3]&127)<<24),o>=214e7?crypto.randomBytes(4).copy(e,i):(a.push(o%1e7),i+=4);i=n/4}else throw Error(Nr);else for(;i<n;)a[i++]=Math.random()*1e7|0;for(n=a[--i],t%=C,n&&t&&(o=ee(10,C-t),a[i]=(n/o|0)*o);a[i]===0;i--)a.pop();if(i<0)r=0,a=[0];else{for(r=-1;a[0]===0;r-=C)a.shift();for(n=1,o=a[0];o>=10;o/=10)n++;n<C&&(r-=C-n)}return s.e=r,s.d=a,s}function Io(t){return L(t=new this(t),t.e+1,this.rounding)}function So(t){return t=new this(t),t.d?t.d[0]?t.s:0*t.s:t.s||NaN}function Lo(t){return new this(t).sin()}function Bo(t){return new this(t).sinh()}function Ro(t){return new this(t).sqrt()}function Co(t,e){return new this(t).sub(e)}function Ko(){var t=0,e=arguments,r=new this(e[t]);for(K=!1;r.s&&++t<e.length;)r=r.plus(e[t]);return K=!0,L(r,this.precision,this.rounding)}function vo(t){return new this(t).tan()}function Vo(t){return new this(t).tanh()}function Mo(t){return L(t=new this(t),t.e+1,1)}h[Symbol.for("nodejs.util.inspect.custom")]=h.toString;h[Symbol.toStringTag]="Decimal";var Ue=h.constructor=qr(Et);ct=new Ue(ct);lt=new Ue(lt);var Ut=Ue;import Uo from"big.js";import ht from"bn.js";import No from"toformat";var Fo=No,qe=Fo;import yt from"big.js";import _o from"bn.js";import Do from"decimal.js-light";import Ge from"bn.js";var Gr=9007199254740991;function _(t){let e=Y("Raydium_parseBigNumberish");if(t instanceof Ge)return t;if(typeof t=="string"){if(t.match(/^-?[0-9]+$/))return new Ge(t);e.logWithError(`invalid BigNumberish string: ${t}`)}return typeof t=="number"?(t%1&&e.logWithError(`BigNumberish number underflow: ${t}`),(t>=Gr||t<=-Gr)&&e.logWithError(`BigNumberish number overflow: ${t}`),new Ge(String(t))):typeof t=="bigint"?new Ge(t.toString()):(e.error(`invalid BigNumberish value: ${t}`),new Ge(0))}var gt=Y("module/fraction"),qt=qe(yt),He=qe(Do),Oo={[0]:He.ROUND_DOWN,[1]:He.ROUND_HALF_UP,[2]:He.ROUND_UP},Wo={[0]:yt.roundDown,[1]:yt.roundHalfUp,[2]:yt.roundUp},H=class{numerator;denominator;constructor(e,r=new _o(1)){this.numerator=_(e),this.denominator=_(r)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new H(this.denominator,this.numerator)}add(e){let r=e instanceof H?e:new H(_(e));return this.denominator.eq(r.denominator)?new H(this.numerator.add(r.numerator),this.denominator):new H(this.numerator.mul(r.denominator).add(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}sub(e){let r=e instanceof H?e:new H(_(e));return this.denominator.eq(r.denominator)?new H(this.numerator.sub(r.numerator),this.denominator):new H(this.numerator.mul(r.denominator).sub(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}mul(e){let r=e instanceof H?e:new H(_(e));return new H(this.numerator.mul(r.numerator),this.denominator.mul(r.denominator))}div(e){let r=e instanceof H?e:new H(_(e));return new H(this.numerator.mul(r.denominator),this.denominator.mul(r.numerator))}toSignificant(e,r={groupSeparator:""},n=1){Number.isInteger(e)||gt.logWithError(`${e} is not an integer.`),e<=0&&gt.logWithError(`${e} is not positive.`),He.set({precision:e+1,rounding:Oo[n]});let o=new He(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),r)}toFixed(e,r={groupSeparator:""},n=1){return Number.isInteger(e)||gt.logWithError(`${e} is not an integer.`),e<0&&gt.logWithError(`${e} is negative.`),qt.DP=e,qt.RM=Wo[n]||1,new qt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,r)}isZero(){return this.numerator.isZero()}};var qo=Y("Raydium_amount"),Hr=qe(Uo);function Go(t,e){let r="0",n="0";if(t.includes(".")){let o=t.split(".");o.length===2?([r,n]=o,n=n.padEnd(e,"0")):qo.logWithError(`invalid number string, num: ${t}`)}else r=t;return[r,n.slice(0,e)||n]}var ye=class extends H{token;logger;constructor(e,r,n=!0,o){let i=new ht(0),s=Gt.pow(new ht(e.decimals));if(n)i=_(r);else{let a=new ht(0),c=new ht(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[u,d]=Go(r.toString(),e.decimals);a=_(u),c=_(d)}a=a.mul(s),i=a.add(c)}super(i,s),this.logger=Y(o||"TokenAmount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new ye(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new ye(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,r,n=0){return super.toSignificant(e,r,n)}toFixed(e=this.token.decimals,r,n=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,r,n)}toExact(e={groupSeparator:""}){return Hr.DP=this.token.decimals,new Hr(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};import{PublicKey as Ho}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as jr}from"@solana/spl-token";var Zr={chainId:101,address:Ho.default.toBase58(),programId:jr.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},oe={chainId:101,address:"So11111111111111111111111111111111111111112",programId:jr.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as zt}from"@solana/web3.js";import{PublicKey as X,SystemProgram as zr,SYSVAR_RENT_PUBKEY as jo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Zo}from"@solana/spl-token";function g({pubkey:t,isSigner:e=!1,isWritable:r=!0}){return{pubkey:t,isWritable:r,isSigner:e}}var Ht=[g({pubkey:Zo,isWritable:!1}),g({pubkey:zr.programId,isWritable:!1}),g({pubkey:jo,isWritable:!1})];function jt({publicKey:t,transformSol:e}){let r=Zt(t.toString());if(r instanceof X)return e&&r.equals(te)?me:r;if(e&&r.toString()===te.toBase58())return me;if(typeof r=="string"){if(r===X.default.toBase58())return X.default;try{return new X(r)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Zt(t){try{return new X(t)}catch{return t}}var $s=new X("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ea=new X("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),zo=new X("SysvarRent111111111111111111111111111111111"),ta=new X("SysvarC1ock11111111111111111111111111111111"),ra=new X("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Qo=new X("Sysvar1nstructions1111111111111111111111111"),na=zr.programId,oa=new X("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ia=new X("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),sa=new X("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),aa=new X("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ua=new X("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ca=new X("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),la=new X("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),da=new X("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),pa=new X("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),fa=new X("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ma=new X("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),me=new X("So11111111111111111111111111111111111111112"),te=X.default;function at(t){return jt({publicKey:t,transformSol:!0})}var Qt=class{symbol;name;decimals;isToken2022;mint;constructor({mint:e,decimals:r,symbol:n,name:o,skipMint:i=!1,isToken2022:s=!1}){if(e===te.toBase58()||e instanceof zt&&te.equals(e)){this.decimals=oe.decimals,this.symbol=oe.symbol,this.name=oe.name,this.mint=new zt(oe.address),this.isToken2022=!1;return}this.decimals=r,this.symbol=n||e.toString().substring(0,6),this.name=o||e.toString().substring(0,6),this.mint=i?zt.default:jt({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ce=Qt;st(Ce,"WSOL",new Qt({...oe,mint:oe.address}));var Xt=class{symbol;name;decimals;constructor({decimals:e,symbol:r="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=r,this.name=n}equals(e){return this===e}},bt=Xt;st(bt,"SOL",new Xt(Zr));import Xo from"bn.js";var Qr=new H(new Xo(100)),Fe=class extends H{toSignificant(e=5,r,n){return this.mul(Qr).toSignificant(e,r,n)}toFixed(e=2,r,n){return this.mul(Qr).toFixed(e,r,n)}};var Jo=Y("Raydium_price"),he=class extends H{baseToken;quoteToken;scalar;constructor(e){let{baseToken:r,quoteToken:n,numerator:o,denominator:i}=e;super(o,i),this.baseToken=r,this.quoteToken=n,this.scalar=new H(Jt(r.decimals),Jt(n.decimals))}get raw(){return new H(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new he({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&Jo.logWithError("mul token not equals");let r=super.mul(e);return new he({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(e=this.quoteToken.decimals,r,n){return this.adjusted.toSignificant(e,r,n)}toFixed(e=this.quoteToken.decimals,r,n){return this.adjusted.toFixed(e,r,n)}};import{PublicKey as Yo}from"@solana/web3.js";import $o from"bn.js";function Xr(t){return typeof t=="object"&&t!==null&&![Ce,ye,Yo,H,$o,he,Fe].some(e=>typeof e=="object"&&t instanceof e)}function be(t){return typeof t=="string"?Zt(t):Array.isArray(t)?t.map(e=>be(e)):Xr(t)?Object.fromEntries(Object.entries(t).map(([e,r])=>[e,be(r)])):t}var Yt=new we(0),cu=new we(1),lu=new we(2),du=new we(3),pu=new we(5),Gt=new we(10),fu=new we(100),mu=new we(1e3),gu=new we(1e4);function Jt(t){return Gt.pow(_(t))}function Nt(t,e=1,r=[]){let n=[...t];if(e<=0)return r;for(;n.length;)r.push(n.splice(0,e));return r}import{PublicKey as si}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ai}from"@solana/spl-token";import{ComputeBudgetProgram as Jr,Keypair as $r,PublicKey as ei,Transaction as en,TransactionMessage as ti,VersionedTransaction as tn}from"@solana/web3.js";var j={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip",NonceAccount:"NonceAccount"};import{TOKEN_PROGRAM_ID as ri}from"@solana/spl-token";var Yr=Y("Raydium_txUtil"),rn=1644;function wt(t){let e=[],r=[];return t.microLamports&&(e.push(Jr.setComputeUnitPrice({microLamports:t.microLamports})),r.push(j.SetComputeUnitPrice)),t.units&&(e.push(Jr.setComputeUnitLimit({units:t.units})),r.push(j.SetComputeUnitLimit)),{instructions:e,instructionTypes:r}}async function Ee(t,e){let r=e??"confirmed";return(await t.getLatestBlockhash?.({commitment:r}))?.blockhash}async function Tt(t,e){return t.getSignatureStatuses([e]),new Promise((r,n)=>{let o=setTimeout(n,6e4);t.onSignature(e,i=>{if(clearTimeout(o),!i.err){r("");return}n(Object.assign(i.err,{txId:e}))},"confirmed")})}function ni(t,e){t.length<1&&Yr.logWithError(`no instructions provided: ${t.toString()}`),e.length<1&&Yr.logWithError(`no signers provided:, ${e.toString()}`);let r=new en;r.recentBlockhash="11111111111111111111111111111111",r.feePayer=e[0],r.add(...t);try{return Buffer.from(r.serialize({verifySignatures:!1})).toString("base64").length<rn}catch{return!1}}function Ke(t,e){let[r,n]=ei.findProgramAddressSync(t,e);return{publicKey:r,nonce:n}}function je({instructions:t,payer:e,signers:r}){return ni(t,[e,...r])}function Ze({instructions:t,payer:e,lookupTableAddressAccount:r,recentBlockhash:n=$r.generate().publicKey.toString()}){let i=new ti({payerKey:e,recentBlockhash:n,instructions:t}).compileToV0Message(Object.values(r??{}));try{return Buffer.from(new tn(i).serialize()).toString("base64").length<rn}catch{return!1}}var oi=t=>Buffer.isBuffer(t)?t:t instanceof Uint8Array?Buffer.from(t.buffer,t.byteOffset,t.byteLength):Buffer.from(t),ii=t=>{let e=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof tn&&(e=oi(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ve(t){let e=[];return t.forEach(r=>{r instanceof en&&(r.recentBlockhash||(r.recentBlockhash=ri.toBase58()),r.feePayer||(r.feePayer=$r.generate().publicKey)),e.push(ii(r))}),console.log("simulate tx string:",e),e}function _e(t,e,r){return Ke([t.toBuffer(),(r??ai).toBuffer(),e.toBuffer()],new si("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as v}from"@solana/web3.js";var nn=new v("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),on=new v("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),sn=new v("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),ze=new v("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Fu=new v("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Eu=new v("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),_u=new v("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Du=new v("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Ou=new v("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Wu=new v("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Uu=new v("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),qu=new v("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Gu=new v("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Hu=new v("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),ju=new v("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Zu=new v("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),zu=new v("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Qu=new v("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Xu=new v("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Ju=new v("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Yu=new v("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),$u=new v("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),ui=new v("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),ci=new v("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),li=new v("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),ec=new v("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),di=new v("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),tc=new v("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),pi=new v("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),rc=new v("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),nc=new v("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),fi=new v("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),mi=new v("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var oc={SERUM_MARKET:v.default,OPENBOOK_MARKET:new v("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:v.default,FarmV3:new v("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new v("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new v("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new v("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new v("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new v("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new v("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new v("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new v("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:ui,CREATE_CPMM_POOL_AUTH:ci,CREATE_CPMM_POOL_FEE_ACC:li,FEE_DESTINATION_ID:new v("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:di,LCOK_CPMM_AUTH:pi,LAUNCHPAD_PROGRAM:fi,LAUNCHPAD_AUTH:mi};import ac from"bn.js";import{PublicKey as an,AddressLookupTableAccount as xt}from"@solana/web3.js";async function $t({connection:t,address:e}){let r=await Rr(t,[...new Set(e.map(o=>o.toString()))].map(o=>new an(o))),n={};for(let o=0;o<e.length;o++){let i=r[o],s=e[o];if(!i)continue;let a=new xt({key:s,state:xt.deserialize(i.data)});n[s.toString()]=a,Pt[s.toString()]=a}return n}var Pt={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new xt({key:new an("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:xt.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as De,sendAndConfirmTransaction as er,SystemProgram as yi,Transaction as Qe,TransactionMessage as Xe,VersionedTransaction as Je}from"@solana/web3.js";import hi from"axios";var kt=2e3,At=class{connection;owner;instructions=[];endInstructions=[];lookupTableAddress=[];signers=[];instructionTypes=[];endInstructionTypes=[];feePayer;cluster;signAllTransactions;blockhashCommitment;loopMultiTxStatus;constructor(e){this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){let e=(await hi.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:r}=e?.[15]??{};if(!!r)return{units:6e5,microLamports:Math.min(Math.ceil(r*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:r,instructionTypes:n}=wt(e);return this.instructions.unshift(...r),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){return e?(this.endInstructions.push(yi.transfer({fromPubkey:e.feePayer??this.feePayer,toPubkey:new De(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(j.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:r}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;r&&this.instructions.unshift(...r)}catch{r&&this.instructions.unshift(...r)}}addInstruction({instructions:e=[],endInstructions:r=[],signers:n=[],instructionTypes:o=[],endInstructionTypes:i=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...r),this.signers.push(...n),this.instructionTypes.push(...o),this.endInstructionTypes.push(...i),this.lookupTableAddress.push(...s.filter(a=>a!==De.default.toString())),this}async versionBuild({txVersion:e,extInfo:r},n){return e===0?await this.buildV0({...r||{}},n):this.build(r,n)}build(e,r){let n=new Qe;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,this.owner?.signer&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:n,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{let{recentBlockHash:i,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=o||{},u=i??r??await Ee(this.connection,this.blockhashCommitment);if(n.recentBlockhash=u,this.signers.length&&n.sign(...this.signers),ve([n]),this.owner?.isKeyPair)return{txId:a?await er(this.connection,n,this.signers.find(l=>l.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(n.serialize(),{skipPreflight:s}),signedTx:n};if(this.signAllTransactions){let d=await this.signAllTransactions([n]);if(this.signers.length)for(let l of d)try{l.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(d[0].serialize(),{skipPreflight:s}),signedTx:d[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:r=[],extInfo:n}=e,{transaction:o}=this.build(n),i=r.filter(u=>u.transaction.instructions.length>0),s=[o,...i.map(u=>u.transaction)],a=[this.signers,...i.map(u=>u.signers)],c=[...this.instructionTypes,...i.map(u=>u.instructionTypes).flat()];return this.owner?.signer&&a.forEach(u=>{u.some(d=>d.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async u=>{let{sequentially:d,onTxUpdate:l,skipTxCount:p=0,recentBlockHash:m,skipPreflight:f=!0}=u||{},y=m??await Ee(this.connection,this.blockhashCommitment);if(this.owner?.isKeyPair){if(d){let w=[],k=0;for(let T of s){if(++k,k<=p)continue;let b=await er(this.connection,T,this.signers.find(x=>x.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});w.push(b)}return{txIds:w,signedTxs:s}}return{txIds:await await Promise.all(s.map(async w=>(w.recentBlockhash=y,await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:f})))),signedTxs:s}}if(this.signAllTransactions){let w=s.map((T,b)=>(T.recentBlockhash=y,a[b].length&&T.sign(...a[b]),T));ve(w);let k=await this.signAllTransactions(w);if(d){let T=0,b=[],x=async()=>{if(!k[T])return;let I=await this.connection.sendRawTransaction(k[T].serialize(),{skipPreflight:f});b.push({txId:I,status:"sent",signedTx:k[T]}),l?.([...b]),T++;let A=!1,B=null,E=null,V=S=>{B!==null&&clearInterval(B),E!==null&&this.connection.removeSignatureListener(E);let R=b.findIndex(F=>F.txId===I);if(R>-1){if(b[R].status==="error"||b[R].status==="success")return;b[R].status=S.err?"error":"success"}l?.([...b]),S.err||x()};this.loopMultiTxStatus&&(B=setInterval(async()=>{if(A){clearInterval(B);return}try{let S=await this.connection.getTransaction(I,{commitment:"confirmed",maxSupportedTransactionVersion:0});S&&(A=!0,clearInterval(B),V({err:S.meta?.err||null}),console.log("tx status from getTransaction:",I))}catch(S){A=!0,clearInterval(B),console.error("getTransaction timeout:",S,I)}},kt)),E=this.connection.onSignature(I,S=>{if(A){this.connection.removeSignatureListener(E);return}A=!0,V(S)},"confirmed"),this.connection.getSignatureStatus(I)};return await x(),{txIds:b.map(I=>I.txId),signedTxs:k}}else{let T=[];for(let b=0;b<k.length;b+=1){let x=await this.connection.sendRawTransaction(k[b].serialize(),{skipPreflight:f});T.push(x)}return{txIds:T,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:r,extInfo:n}){return r===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e,r){let{lookupTableCache:n={},lookupTableAddress:o=[],forerunCreate:i,recentBlockhash:s,...a}=e||{},c={...this.cluster==="devnet"?{}:Pt,...n},u=Array.from(new Set([...o,...this.lookupTableAddress])),d=[];for(let f of u)c[f]===void 0&&d.push(new De(f));if(d.length>0){let f=await $t({connection:this.connection,address:d});for(let[y,w]of Object.entries(f))c[y]=w}let l=r??(i?De.default.toBase58():s??await Ee(this.connection,this.blockhashCommitment)),p=new Xe({payerKey:this.feePayer,recentBlockhash:l,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(c));this.owner?.signer&&!this.signers.some(f=>f.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let m=new Je(p);return m.sign(this.signers),{builder:this,transaction:m,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async f=>{let{skipPreflight:y=!0,sendAndConfirm:w,notSendToRpc:k}=f||{};if(ve([m]),this.owner?.isKeyPair){let T=await this.connection.sendTransaction(m,{skipPreflight:y});return w&&await Tt(this.connection,T),{txId:T,signedTx:m}}if(this.signAllTransactions){let T=await this.signAllTransactions([m]);if(this.signers.length)for(let b of T)try{b.sign(this.signers)}catch{}return{txId:k?"":await this.connection.sendTransaction(T[0],{skipPreflight:y}),signedTx:T[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(e){let{extraPreBuildData:r=[],buildProps:n}=e,{transaction:o}=await this.buildV0(n),i=r.filter(u=>u.builder.instructions.length>0),s=[o,...i.map(u=>u.transaction)],a=[this.signers,...i.map(u=>u.signers)],c=[...this.instructionTypes,...i.map(u=>u.instructionTypes).flat()];return this.owner?.signer&&a.forEach(u=>{u.some(d=>d.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(u,d)=>{u.sign(a[d])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async u=>{let{sequentially:d,onTxUpdate:l,recentBlockHash:p,skipPreflight:m=!0}=u||{};if(p&&s.forEach(f=>f.message.recentBlockhash=p),ve(s),this.owner?.isKeyPair){if(d){let f=[];for(let y of s){let w=await this.connection.sendTransaction(y,{skipPreflight:m});await Tt(this.connection,w),f.push(w)}return{txIds:f,signedTxs:s}}return{txIds:await Promise.all(s.map(async f=>await this.connection.sendTransaction(f,{skipPreflight:m}))),signedTxs:s}}if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(d){let y=0,w=[],k=async()=>{if(!f[y])return;let T=await this.connection.sendTransaction(f[y],{skipPreflight:m});w.push({txId:T,status:"sent",signedTx:f[y]}),l?.([...w]),y++;let b=!1,x=null,I=null,A=B=>{x!==null&&clearInterval(x),I!==null&&this.connection.removeSignatureListener(I);let E=w.findIndex(V=>V.txId===T);if(E>-1){if(w[E].status==="error"||w[E].status==="success")return;w[E].status=B.err?"error":"success"}l?.([...w]),B.err||k()};this.loopMultiTxStatus&&(x=setInterval(async()=>{if(b){clearInterval(x);return}try{let B=await this.connection.getTransaction(T,{commitment:"confirmed",maxSupportedTransactionVersion:0});B&&(b=!0,clearInterval(x),A({err:B.meta?.err||null}),console.log("tx status from getTransaction:",T))}catch(B){b=!0,clearInterval(x),console.error("getTransaction timeout:",B,T)}},kt)),I=this.connection.onSignature(T,B=>{if(b){this.connection.removeSignatureListener(I);return}b=!0,A(B)},"confirmed"),this.connection.getSignatureStatus(T)};return k(),{txIds:[],signedTxs:f}}else{let y=[];for(let w=0;w<f.length;w+=1){let k=await this.connection.sendTransaction(f[w],{skipPreflight:m});y.push(k)}return{txIds:y,signedTxs:f}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){let{splitIns:r=[],computeBudgetConfig:n,...o}=e||{},i=n?wt(n):{instructions:[],instructionTypes:[]},s=this.signers.reduce((l,p)=>({...l,[p.publicKey.toBase58()]:p}),{}),a=[],c=[],u=[],d=0;if(this.allInstructions.forEach(l=>{let p=[...u,l],m=n?[...i.instructions,...p]:p,y=[...new Set(p.map(w=>w.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(w=>new De(w));if(l!==r[d]&&u.length<12&&(je({instructions:m,payer:this.feePayer,signers:y})||je({instructions:p,payer:this.feePayer,signers:y})))u.push(l);else{if(u.length===0)throw Error("item ins too big");d+=l===r[d]?1:0,je({instructions:n?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:y})?a.push(new Qe().add(...i.instructions,...u)):a.push(new Qe().add(...u)),c.push(Array.from(new Set(u.map(w=>w.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(w=>s[w]).filter(w=>w!==void 0)),u=[l]}}),u.length>0){let p=[...new Set(u.map(m=>m.keys.filter(f=>f.isSigner).map(f=>f.pubkey.toString())).flat()).values()].map(m=>s[m]).filter(m=>m!==void 0);je({instructions:n?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:p.map(m=>m.publicKey)})?a.push(new Qe().add(...i.instructions,...u)):a.push(new Qe().add(...u)),c.push(p)}return a.forEach(l=>l.feePayer=this.feePayer),this.owner?.signer&&c.forEach(l=>{l.some(p=>p.publicKey.equals(this.owner.publicKey))||l.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async l=>{let{sequentially:p,onTxUpdate:m,skipTxCount:f=0,recentBlockHash:y,skipPreflight:w=!0}=l||{},k=y??await Ee(this.connection,this.blockhashCommitment);if(a.forEach(async(T,b)=>{T.recentBlockhash=k,c[b].length&&T.sign(...c[b])}),ve(a),this.owner?.isKeyPair){if(p){let T=0,b=[];for(let x of a){if(++T,T<=f){b.push("tx skipped");continue}let I=await er(this.connection,x,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});b.push(I)}return{txIds:b,signedTxs:a}}return{txIds:await Promise.all(a.map(async T=>await this.connection.sendRawTransaction(T.serialize(),{skipPreflight:w}))),signedTxs:a}}if(this.signAllTransactions){let T=await this.signAllTransactions(a.slice(f,a.length)),b=[...a.slice(0,f),...T];if(p){let x=0,I=[],A=async()=>{if(!b[x])return;x<f&&(I.push({txId:"",status:"success",signedTx:b[x]}),m?.([...I]),x++,A());let B=await this.connection.sendRawTransaction(b[x].serialize(),{skipPreflight:w});I.push({txId:B,status:"sent",signedTx:b[x]}),m?.([...I]),x++;let E=!1,V=null,S=null,R=F=>{V!==null&&clearInterval(V),S!==null&&this.connection.removeSignatureListener(S);let G=I.findIndex(D=>D.txId===B);if(G>-1){if(I[G].status==="error"||I[G].status==="success")return;I[G].status=F.err?"error":"success"}m?.([...I]),F.err||A()};this.loopMultiTxStatus&&(V=setInterval(async()=>{if(E){clearInterval(V);return}try{let F=await this.connection.getTransaction(B,{commitment:"confirmed",maxSupportedTransactionVersion:0});F&&(E=!0,clearInterval(V),R({err:F.meta?.err||null}),console.log("tx status from getTransaction:",B))}catch(F){E=!0,clearInterval(V),console.error("getTransaction timeout:",F,B)}},kt)),S=this.connection.onSignature(B,F=>{if(E){this.connection.removeSignatureListener(S);return}E=!0,R(F)},"confirmed"),this.connection.getSignatureStatus(B)};return await A(),{txIds:I.map(B=>B.txId),signedTxs:b}}else{let x=[];for(let I=0;I<b.length;I+=1){let A=await this.connection.sendRawTransaction(b[I].serialize(),{skipPreflight:w});x.push(A)}return{txIds:x,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(e){let{computeBudgetConfig:r,splitIns:n=[],lookupTableCache:o={},lookupTableAddress:i=[],...s}=e||{},a={...this.cluster==="devnet"?{}:Pt,...o},c=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let T of c)a[T]===void 0&&u.push(new De(T));let d=await $t({connection:this.connection,address:u});for(let[T,b]of Object.entries(d))a[T]=b;let l=r?wt(r):{instructions:[],instructionTypes:[]},p=await Ee(this.connection,this.blockhashCommitment),m=this.signers.reduce((T,b)=>({...T,[b.publicKey.toBase58()]:b}),{}),f=[],y=[],w=[],k=0;if(this.allInstructions.forEach(T=>{let b=[...w,T],x=r?[...l.instructions,...b]:b;if(T!==n[k]&&w.length<12&&(Ze({instructions:x,payer:this.feePayer,lookupTableAddressAccount:a})||Ze({instructions:b,payer:this.feePayer,lookupTableAddressAccount:a})))w.push(T);else{if(w.length===0)throw Error("item ins too big");k+=T===n[k]?1:0;let I={};for(let A of[...new Set(c)])a[A]!==void 0&&(I[A]=a[A]);if(r&&Ze({instructions:[...l.instructions,...w],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:p})){let A=new Xe({payerKey:this.feePayer,recentBlockhash:p,instructions:[...l.instructions,...w]}).compileToV0Message(Object.values(a));f.push(new Je(A))}else{let A=new Xe({payerKey:this.feePayer,recentBlockhash:p,instructions:[...w]}).compileToV0Message(Object.values(a));f.push(new Je(A))}y.push(Array.from(new Set(w.map(A=>A.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(A=>m[A]).filter(A=>A!==void 0)),w=[T]}}),w.length>0){let b=[...new Set(w.map(x=>x.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat()).values()].map(x=>m[x]).filter(x=>x!==void 0);if(r&&Ze({instructions:[...l.instructions,...w],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:p})){let x=new Xe({payerKey:this.feePayer,recentBlockhash:p,instructions:[...l.instructions,...w]}).compileToV0Message(Object.values(a));f.push(new Je(x))}else{let x=new Xe({payerKey:this.feePayer,recentBlockhash:p,instructions:[...w]}).compileToV0Message(Object.values(a));f.push(new Je(x))}y.push(b)}return this.owner?.signer&&y.forEach(T=>{T.some(b=>b.publicKey.equals(this.owner.publicKey))||T.push(this.owner.signer)}),f.forEach((T,b)=>{T.sign(y[b])}),{builder:this,transactions:f,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async T=>{let{sequentially:b,onTxUpdate:x,skipTxCount:I=0,recentBlockHash:A,skipPreflight:B=!0}=T||{};if(f.map(async(E,V)=>{y[V].length&&E.sign(y[V]),A&&(E.message.recentBlockhash=A)}),ve(f),this.owner?.isKeyPair){if(b){let E=0,V=[];for(let S of f){if(++E,E<=I){console.log("skip tx: ",E),V.push("tx skipped");continue}let R=await this.connection.sendTransaction(S,{skipPreflight:B});await Tt(this.connection,R),V.push(R)}return{txIds:V,signedTxs:f}}return{txIds:await Promise.all(f.map(async E=>await this.connection.sendTransaction(E,{skipPreflight:B}))),signedTxs:f}}if(this.signAllTransactions){let E=await this.signAllTransactions(f.slice(I,f.length)),V=[...f.slice(0,I),...E];if(b){let S=0,R=[],F=async()=>{if(!V[S])return;if(S<I){R.push({txId:"",status:"success",signedTx:V[S]}),x?.([...R]),S++,F();return}let G=await this.connection.sendTransaction(V[S],{skipPreflight:B});R.push({txId:G,status:"sent",signedTx:V[S]}),x?.([...R]),S++;let D=!1,q=null,O=null,ot=ae=>{q!==null&&clearInterval(q),O!==null&&this.connection.removeSignatureListener(O);let it=R.findIndex(Nn=>Nn.txId===G);if(it>-1){if(R[it].status==="error"||R[it].status==="success")return;R[it].status=ae.err?"error":"success"}x?.([...R]),ae.err||F()};this.loopMultiTxStatus&&(q=setInterval(async()=>{if(D){clearInterval(q);return}try{let ae=await this.connection.getTransaction(G,{commitment:"confirmed",maxSupportedTransactionVersion:0});ae&&(D=!0,clearInterval(q),ot({err:ae.meta?.err||null}),console.log("tx status from getTransaction:",G))}catch(ae){D=!0,clearInterval(q),console.error("getTransaction timeout:",ae,G)}},kt)),O=this.connection.onSignature(G,ae=>{if(D){this.connection.removeSignatureListener(O);return}D=!0,ot(ae)},"confirmed"),this.connection.getSignatureStatus(G)};return F(),{txIds:[],signedTxs:V}}else{let S=[];for(let R=0;R<V.length;R+=1){let F=await this.connection.sendTransaction(V[R],{skipPreflight:B});S.push(F)}return{txIds:S,signedTxs:V}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};import bi from"bn.js";var Sc=new bi(1e6);import{Keypair as vi,PublicKey as Vi}from"@solana/web3.js";import ld from"bn.js";import{TOKEN_PROGRAM_ID as Mi}from"@solana/spl-token";function wi(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function tr(t,...e){if(!wi(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function rr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function un(t,e){tr(t);let r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}var St=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),de=(t,e)=>t<<32-e|t>>>e;var Qc=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Ti(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function nr(t){return typeof t=="string"&&(t=Ti(t)),tr(t),t}var It=class{clone(){return this._cloneInto()}},Xc={}.toString;function cn(t){let e=n=>t().update(nr(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function xi(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),a=Number(r&i),c=n?4:0,u=n?0:4;t.setUint32(e+c,s,n),t.setUint32(e+u,a,n)}var ln=(t,e,r)=>t&e^~t&r,dn=(t,e,r)=>t&e^t&r^e&r,Lt=class extends It{constructor(e,r,n,o){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=St(this.buffer)}update(e){rr(this);let{view:r,buffer:n,blockLen:o}=this;e=nr(e);let i=e.length;for(let s=0;s<i;){let a=Math.min(o-this.pos,i-s);if(a===o){let c=St(e);for(;o<=i-s;s+=o)this.process(c,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){rr(this),un(e,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:i}=this,{pos:s}=this;r[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(n,0),s=0);for(let l=s;l<o;l++)r[l]=0;xi(n,o-8,BigInt(this.length*8),i),this.process(n,0);let a=St(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,d=this.get();if(u>d.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,d[l],i)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:i,destroyed:s,pos:a}=this;return e.length=o,e.pos=a,e.finished=i,e.destroyed=s,o%r&&e.buffer.set(n),e}};var Pi=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Le=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Be=new Uint32Array(64),or=class extends Lt{constructor(){super(64,32,8,!1),this.A=Le[0]|0,this.B=Le[1]|0,this.C=Le[2]|0,this.D=Le[3]|0,this.E=Le[4]|0,this.F=Le[5]|0,this.G=Le[6]|0,this.H=Le[7]|0}get(){let{A:e,B:r,C:n,D:o,E:i,F:s,G:a,H:c}=this;return[e,r,n,o,i,s,a,c]}set(e,r,n,o,i,s,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=a|0,this.H=c|0}process(e,r){for(let l=0;l<16;l++,r+=4)Be[l]=e.getUint32(r,!1);for(let l=16;l<64;l++){let p=Be[l-15],m=Be[l-2],f=de(p,7)^de(p,18)^p>>>3,y=de(m,17)^de(m,19)^m>>>10;Be[l]=y+Be[l-7]+f+Be[l-16]|0}let{A:n,B:o,C:i,D:s,E:a,F:c,G:u,H:d}=this;for(let l=0;l<64;l++){let p=de(a,6)^de(a,11)^de(a,25),m=d+p+ln(a,c,u)+Pi[l]+Be[l]|0,y=(de(n,2)^de(n,13)^de(n,22))+dn(n,o,i)|0;d=u,u=c,c=a,a=s+m|0,s=i,i=o,o=n,n=m+y|0}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,d=d+this.H|0,this.set(n,o,i,s,a,c,u,d)}roundClean(){Be.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var pn=cn(()=>new or);import{PublicKey as Ri}from"@solana/web3.js";import yn,{isBN as hn}from"bn.js";import{bits as il,BitStructure as sl,blob as ki,Blob as al,cstr as ul,f32 as cl,f32be as ll,f64 as dl,f64be as pl,greedy as fl,Layout as Ai,ns64 as ml,ns64be as gl,nu64 as yl,nu64be as hl,offset as bl,s16 as wl,s16be as Tl,s24 as xl,s24be as Pl,s32 as kl,s32be as Al,s40 as Il,s40be as Sl,s48 as Ll,s48be as Bl,s8 as Rl,seq as Ii,struct as Cl,Structure as Si,u16 as Kl,u16be as vl,u24 as Vl,u24be as Ml,u32 as Nl,u32be as Fl,u40 as El,u40be as _l,u48 as Dl,u48be as Ol,u8 as Li,UInt as Bi,union as Wl,Union as Ul,unionLayoutDiscriminator as ql,utf8 as Gl}from"@solana/buffer-layout";var ir=Ai,fn=Si;var sr=Bi;var mn=Li;var gn=Ii;var Ve=ki;var Oe=class extends ir{blob;signed;constructor(e,r,n){super(e,n),this.blob=Ve(e),this.signed=r}decode(e,r=0){let n=new yn(this.blob.decode(e,r),10,"le");return this.signed?n.fromTwos(this.span*8).clone():n}encode(e,r,n=0){return typeof e=="number"&&(e=new yn(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),r,n)}};function $(t){return new sr(1,t)}function Ye(t){return new sr(4,t)}function P(t){return new Oe(8,!1,t)}function Te(t){return new Oe(16,!1,t)}function bn(t){return new Oe(1,!0,t)}function Rt(t){return new Oe(8,!0,t)}var Bt=class extends ir{layout;decoder;encoder;constructor(e,r,n,o){super(e.span,o),this.layout=e,this.decoder=r,this.encoder=n}decode(e,r){return this.decoder(this.layout.decode(e,r))}encode(e,r,n){return this.layout.encode(this.encoder(e),r,n)}getSpan(e,r){return this.layout.getSpan(e,r)}};function W(t){return new Bt(Ve(32),e=>new Ri(e),e=>e.toBuffer(),t)}function Ct(t){return new Bt(mn(),Ci,Ki,t)}function Ci(t){if(t===0)return!1;if(t===1)return!0;throw new Error("Invalid bool: "+t)}function Ki(t){return t?1:0}var ar=class extends fn{decode(e,r){return super.decode(e,r)}};function Q(t,e,r){return new ar(t,e,r)}function J(t,e,r){let n,o=typeof e=="number"?e:hn(e)?e.toNumber():new Proxy(e,{get(i,s){if(!n){let a=Reflect.get(i,"count");n=hn(a)?a.toNumber():a,Reflect.set(i,"count",n)}return Reflect.get(i,s)},set(i,s,a){return s==="count"&&(n=a),Reflect.set(i,s,a)}});return gn(t,o,r)}var $e=Q([W("mint"),W("owner"),P("amount"),Ye("delegateOption"),W("delegate"),$("state"),Ye("isNativeOption"),P("isNative"),P("delegatedAmount"),Ye("closeAuthorityOption"),W("closeAuthority")]);var gd=Y("Raydium_Util");function Kt({fromPublicKey:t,programId:e=Mi,assignSeed:r}){let n=r?btoa(r).slice(0,32):vi.generate().publicKey.toBase58().slice(0,32);return{publicKey:Ni(t,n,e),seed:n}}function Ni(t,e,r){let n=Buffer.concat([t.toBuffer(),Buffer.from(e),r.toBuffer()]),o=pn(n);return new Vi(o)}import{PublicKey as Fi,SystemProgram as Ei}from"@solana/web3.js";import _i from"bn.js";import{createCloseAccountInstruction as Di,createInitializeAccountInstruction as Oi,createTransferInstruction as Sd,TOKEN_PROGRAM_ID as et}from"@solana/spl-token";function Wi(t){let{mint:e,tokenAccount:r,owner:n,programId:o=et}=t;return Oi(r,e,n,o)}function Ui(t){let{tokenAccount:e,payer:r,multiSigners:n=[],owner:o,programId:i=et}=t;return Di(e,r,o,n,i)}async function ur(t){let{connection:e,amount:r,commitment:n,payer:o,owner:i,skipCloseAccount:s}=t,a=await e.getMinimumBalanceForRentExemption($e.span,n),c=_(r).add(new _i(a)),u=Kt({fromPublicKey:o,programId:et});return{addresses:{newAccount:u.publicKey},signers:[],instructions:[Ei.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:u.seed,newAccountPubkey:u.publicKey,lamports:c.toNumber(),space:$e.span,programId:et}),Wi({mint:new Fi(oe.address),tokenAccount:u.publicKey,owner:i,programId:et})],instructionTypes:[j.CreateAccount,j.InitAccount],endInstructionTypes:s?[]:[j.CloseAccount],endInstructions:s?[]:[Ui({tokenAccount:u.publicKey,payer:o,owner:i})]}}var cr=(...t)=>t.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),tt=class{scope;disabled=!1;logger;constructor({scope:e,moduleName:r}){this.scope=e,this.logger=Y(r)}createTxBuilder(e){return this.scope.checkOwner(),new At({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(cr(e))}logInfo(...e){this.logger.info(cr(e))}logAndCreateError(...e){let r=cr(e);throw new Error(r)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as xn}from"@solana/web3.js";var lr=Q([$("instruction")]),dr=Q([$("instruction")]),qi=Q([P("rewardState"),P("rewardOpenTime"),P("rewardEndTime"),P("rewardLastUpdateTime"),P("totalReward"),P("totalRewardEmissioned"),P("rewardClaimed"),P("rewardPerSecond"),Te("accRewardPerShare"),W("rewardVault"),W("rewardMint"),W("rewardSender"),P("rewardType"),J(P(),15,"padding")]),Gi=Q([P("state"),P("nonce"),W("lpVault"),W("rewardVault"),W(),W(),P(),P(),P("totalReward"),Te("perShareReward"),P("lastSlot"),P("perSlotReward")]),Hi=Q([P("state"),P("nonce"),W("lpVault"),W("rewardVaultA"),P("totalRewardA"),Te("perShareRewardA"),P("perSlotRewardA"),$("option"),W("rewardVaultB"),Ve(7),P("totalRewardB"),Te("perShareRewardB"),P("perSlotRewardB"),P("lastSlot"),W()]),ji=Q([P(),P("state"),P("nonce"),P("validRewardTokenNum"),Te("rewardMultiplier"),P("rewardPeriodMax"),P("rewardPeriodMin"),P("rewardPeriodExtend"),W("lpMint"),W("lpVault"),J(qi,5,"rewardInfos"),W("creator"),W(),J(P(),32,"padding")]),Zi=new Proxy(Gi,{get(t,e,r){return e==="decode"?(...n)=>{let o=t.decode(...n);return{...o,version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]}}:Reflect.get(t,e,r)}}),zi=new Proxy(Hi,{get(t,e,r){return e==="decode"?(...n)=>{let o=t.decode(...n);return{...o,version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]}}:Reflect.get(t,e,r)}}),vt=new Proxy(ji,{get(t,e,r){return e==="decode"?(...n)=>{let o=t.decode(...n);return{...o,version:6,rewardInfos:o.rewardInfos.map(i=>({...i,rewardType:(Object.entries(Re).find(s=>String(s[1])===i.rewardType.toString())??["Standard SPL"])[0]}))}}:Reflect.get(t,e,r)}}),Qi=Q([P("isSet"),P("rewardPerSecond"),P("rewardOpenTime"),P("rewardEndTime"),P("rewardType")]),pr=Q([$("instruction"),P("nonce"),J(Qi,5,"rewardTimeInfo")]),fr=Q([$("instruction"),P("rewardReopenTime"),P("rewardEndTime"),P("rewardPerSecond")]),mr=Q([$("instruction"),P("isSet"),P("rewardPerSecond"),P("rewardOpenTime"),P("rewardEndTime"),P("rewardType")]),Wd=Q([P("state"),W("id"),W("owner"),P("deposited"),J(P(),1,"rewardDebts")]),gr=Q([P("state"),W("id"),W("owner"),P("deposited"),J(Te(),1,"rewardDebts"),P(""),P("voteLockedBalance"),J(P(),15)]),Ud=Q([P("state"),W("id"),W("owner"),P("deposited"),J(P(),2,"rewardDebts")]),wn=Q([P("state"),W("id"),W("owner"),P("deposited"),J(Te(),2,"rewardDebts"),J(P(),17)]),Tn=Q([P(),P("state"),W("id"),W("owner"),P("deposited"),J(Te(),5,"rewardDebts"),J(P(),16)]),se=Q([$("instruction"),P("amount")]),Xi=Q([W("mint"),W("grantAuthority"),P("baselineVoteWeightScaledFactor"),P("maxExtraLockupVoteWeightScaledFactor"),P("lockupSaturationSecs"),bn("digitShift"),J($(),7,"reserved1"),J(P(),7,"reserved2")]),Ji=Q([Ve(8),W("governanceProgramId"),W("realm"),W("realmGoverningTokenMint"),W("realmAuthority"),J($(),32,"reserved1"),J(Xi,4,"votingMints"),Rt("timeOffset"),$("bump"),J($(),7,"reserved2"),J(P(),11,"reserved3")]),Yi=Q([Rt("startTime"),Rt("endTime"),$("kind"),J($(),15,"reserved")]),$i=Q([J(Yi,1,"lockup"),P("amountDeposited_native"),P("amountInitiallyLockedNative"),Ct("isUsed"),Ct("allowClawback"),$("votingMintConfigIdx"),J($(),29,"reserved")]),es=Q([Ve(8),W("voterAuthority"),W("registrar"),J($i,32,"deposits"),$("voterBump"),$("voterWweightRecordBump"),J($(),94,"reserved")]);var Xd=Y("Raydium_farm_config"),Pn=new xn("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),kn=new xn("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var An={3:gr,5:wn,6:Tn},yr=t=>[3,4,5,6].indexOf(t)!==-1,hr=t=>{let{version:e,rewardInfos:r,rewardTokenAccountsPublicKeys:n}=t,o=`rewardInfo:${JSON.stringify(r)}, rewardAccount:${JSON.stringify(n)}`;return{3:()=>{if(r.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${o}`},5:()=>{if(r.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${o}`},6:()=>{if(!n.length||r.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${o}`}}[e]?.()},Re={"Standard SPL":0,"Option tokens":1},xe={[nn.toString()]:3,[on.toString()]:4,[sn.toString()]:5,[ze.toString()]:6};import{PublicKey as U,SystemProgram as Ln,SYSVAR_CLOCK_PUBKEY as nt,SYSVAR_RENT_PUBKEY as ns,TransactionInstruction as ue}from"@solana/web3.js";import Bn from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Rp,createAssociatedTokenAccountInstruction as Cp,TOKEN_PROGRAM_ID as Pe}from"@solana/spl-token";import ts from"bn.js";var rs=Y("Raydium.farm.util");function rt({programId:t,poolId:e,mint:r,type:n}){let{publicKey:o}=Ke([e.toBuffer(),r.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],t);return o}function fe({programId:t,poolId:e,owner:r,version:n}){let{publicKey:o}=Ke([e.toBuffer(),r.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],t);return o}var In=({programId:t,poolId:e})=>Ke([e.toBuffer()],t);function Sn(t){return{isSet:new ts(1),rewardPerSecond:_(t.perSecond),rewardOpenTime:_(t.openTime),rewardEndTime:_(t.endTime),rewardType:_(Re[t.rewardType])}}function br(t){return _(t.endTime).sub(_(t.openTime)).mul(_(t.perSecond))}function wr(t){let e=An[t];return e||rs.logWithError("invalid version",t),e}var os=Y("Raydium_farm_instruction"),Wp={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function Tr(t){let{version:e,id:r,ledger:n,programId:o,owner:i}=t,s={3:9,5:10}[e];s||os.logWithError(`invalid farm pool version: ${e}`);let a=Buffer.alloc(lr.span);lr.encode({instruction:s},a);let c=[g({pubkey:r}),g({pubkey:n}),g({pubkey:i,isWritable:!1}),g({pubkey:Ln.programId,isWritable:!1}),g({pubkey:ns,isWritable:!1})];return{instruction:new ue({programId:o,keys:c,data:a}),instructionType:j.FarmV3CreateLedger}}function Rn(t){let e=Buffer.alloc(pr.span);pr.encode({instruction:0,nonce:new Bn(t.nonce),rewardTimeInfo:t.rewardInfoConfig},e);let r=[...Ht,g({pubkey:t.farmId}),g({pubkey:t.farmAuthority,isWritable:!1}),g({pubkey:t.lpVault}),g({pubkey:t.lpMint,isWritable:!1}),g({pubkey:t.lockVault}),g({pubkey:t.lockMint,isWritable:!1}),g({pubkey:t.lockUserAccount??te}),g({pubkey:t.owner,isWritable:!1,isSigner:!0})];for(let n of t.rewardInfo)r.push(g({pubkey:n.rewardMint,isWritable:!1}),g({pubkey:n.rewardVault}),g({pubkey:n.userRewardToken}));return{instruction:new ue({programId:t.programId,keys:r,data:e}),instructionType:j.FarmV6Create}}function Cn(t){let e=Buffer.alloc(dr.span);dr.encode({instruction:5},e);let r=[g({pubkey:Pe,isWritable:!1}),g({pubkey:t.id}),g({pubkey:t.authority,isWritable:!1}),g({pubkey:t.lpVault,isWritable:!1}),g({pubkey:t.rewardVault}),g({pubkey:t.userRewardToken}),g({pubkey:t.owner,isWritable:!1,isSigner:!0})];return{instruction:new ue({programId:t.programId,keys:r,data:e}),instructionType:j.FarmV6CreatorWithdraw}}function xr({payer:t,rewardVault:e,userRewardTokenPub:r,farmKeys:n,rewardInfo:o}){let i=Buffer.alloc(fr.span);fr.encode({instruction:3,rewardReopenTime:_(o.openTime),rewardEndTime:_(o.endTime),rewardPerSecond:_(o.perSecond)},i);let s=[g({pubkey:Pe,isWritable:!1}),g({pubkey:n.id}),g({pubkey:n.lpVault,isWritable:!1}),g({pubkey:e}),g({pubkey:r}),g({pubkey:t,isWritable:!1,isSigner:!0})];return new ue({programId:n.programId,keys:s,data:i})}function Pr({payer:t,userRewardTokenPub:e,farmKeys:r,rewardVault:n,rewardInfo:o}){let i=Buffer.alloc(mr.span);mr.encode({instruction:4,isSet:new Bn(1),rewardPerSecond:_(o.perSecond),rewardOpenTime:_(o.openTime),rewardEndTime:_(o.endTime),rewardType:_(Re[o.rewardType])},i);let s=[...Ht,g({pubkey:r.id}),g({pubkey:r.authority,isWritable:!1}),g({pubkey:o.mint,isWritable:!1}),g({pubkey:n}),g({pubkey:e}),g({pubkey:t,isWritable:!1,isSigner:!0})];return new ue({programId:r.programId,keys:s,data:i})}function kr(t){let{farmInfo:e,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s}=t,[a,c]=[new U(e.programId),new U(e.id)],u=fe({programId:a,poolId:c,owner:i,version:6}),d=Buffer.alloc(se.span);se.encode({instruction:2,amount:_(s)},d);let l=[g({pubkey:Pe,isWritable:!1}),g({pubkey:c}),g({pubkey:new U(r.authority),isWritable:!1}),g({pubkey:new U(r.lpVault)}),g({pubkey:u}),g({pubkey:i,isWritable:!1,isSigner:!0}),g({pubkey:n})];for(let p=0;p<r.rewardInfos.length;p++)l.push(g({pubkey:new U(r.rewardInfos[p].vault)})),l.push(g({pubkey:o[p]}));return new ue({programId:a,keys:l,data:d})}function Ar(t){let{farmInfo:e,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=t,[c,u]=[new U(e.programId),new U(e.id)],d=fe({programId:c,poolId:u,owner:i,version:5}),l=Buffer.alloc(se.span);se.encode({instruction:12,amount:_(s)},l);let p=[g({pubkey:u}),g({pubkey:new U(r.authority),isWritable:!1}),g({pubkey:d}),g({pubkey:i,isWritable:!1,isSigner:!0}),g({pubkey:n}),g({pubkey:new U(r.lpVault)}),g({pubkey:o[0]}),g({pubkey:new U(r.rewardInfos[0].vault)}),g({pubkey:nt,isWritable:!1}),g({pubkey:Pe,isWritable:!1})];for(let m=1;m<r.rewardInfos.length;m++)p.push(g({pubkey:o[m]})),p.push(g({pubkey:new U(r.rewardInfos[m].vault)}));if(a)for(let m of a)p.push(g({pubkey:m}));return new ue({programId:c,keys:p,data:l})}function Kn(t){let{farmInfo:e,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=t,[c,u]=[new U(e.programId),new U(e.id)],d=Q([$("instruction"),P("amount")]),l=[g({pubkey:u}),g({pubkey:new U(r.authority),isWritable:!1}),g({pubkey:a[0]}),g({pubkey:i,isSigner:!0,isWritable:!1}),g({pubkey:n}),g({pubkey:new U(r.lpVault)}),g({pubkey:o[0]}),g({pubkey:new U(r.rewardInfos[0].vault)}),g({pubkey:nt,isWritable:!1}),g({pubkey:Pe,isWritable:!1}),g({pubkey:o[1]}),g({pubkey:new U(r.rewardInfos[1].vault)})],p=Buffer.alloc(d.span);return d.encode({instruction:2,amount:s},p),new ue({keys:l,programId:c,data:p})}function Ir(t){let{farmInfo:e,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=t,[c,u]=[new U(e.programId),new U(e.id)],d=fe({programId:c,poolId:u,owner:i,version:3}),l=Buffer.alloc(se.span);se.encode({instruction:11,amount:_(s)},l);let p=[g({pubkey:u}),g({pubkey:new U(r.authority),isWritable:!1}),g({pubkey:d}),g({pubkey:i,isWritable:!1,isSigner:!0}),g({pubkey:n}),g({pubkey:new U(r.lpVault)}),g({pubkey:o[0]}),g({pubkey:new U(r.rewardInfos[0].vault)}),g({pubkey:nt,isWritable:!1}),g({pubkey:Pe,isWritable:!1})];if(a)for(let m of a)p.push(g({pubkey:m}));return new ue({programId:c,keys:p,data:l})}function vn(t){let{farmInfo:e,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=t,[c,u]=[new U(e.programId),new U(e.id)],d=fe({programId:c,poolId:u,owner:i,version:3}),l=Buffer.alloc(se.span);se.encode({instruction:10,amount:_(s)},l);let p=[g({pubkey:u}),g({pubkey:new U(r.authority),isWritable:!1}),g({pubkey:d}),g({pubkey:i,isWritable:!1,isSigner:!0}),g({pubkey:n}),g({pubkey:new U(r.lpVault)}),g({pubkey:o[0]}),g({pubkey:new U(r.rewardInfos[0].vault)}),g({pubkey:nt,isWritable:!1}),g({pubkey:Pe,isWritable:!1})];if(a)for(let m of a)p.push(g({pubkey:m}));return new ue({programId:c,keys:p,data:l})}function Vn(t){let{farmInfo:e,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=t,[c,u]=[new U(e.programId),new U(e.id)],d=fe({programId:c,poolId:u,owner:i,version:5}),l=Buffer.alloc(se.span);se.encode({instruction:11,amount:_(s)},l);let p=[g({pubkey:u}),g({pubkey:new U(r.authority),isWritable:!1}),g({pubkey:d}),g({pubkey:i,isWritable:!1,isSigner:!0}),g({pubkey:n}),g({pubkey:new U(r.lpVault)}),g({pubkey:o[0]}),g({pubkey:new U(r.rewardInfos[0].vault)}),g({pubkey:nt,isWritable:!1}),g({pubkey:Pe,isWritable:!1})];for(let m=1;m<r.rewardInfos.length;m++)p.push(g({pubkey:o[m]})),p.push(g({pubkey:new U(r.rewardInfos[m].vault)}));if(a)for(let m of a)p.push(g({pubkey:m}));return new ue({programId:c,keys:p,data:l})}function Mn(t){let{farmInfo:e,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s}=t,[a,c]=[new U(e.programId),new U(e.id)],u=fe({programId:a,poolId:c,owner:i,version:6}),d=Buffer.alloc(se.span);se.encode({instruction:1,amount:_(s)},d);let l=[g({pubkey:Pe,isWritable:!1}),g({pubkey:Ln.programId,isWritable:!1}),g({pubkey:c}),g({pubkey:new U(r.authority),isWritable:!1}),g({pubkey:new U(r.lpVault)}),g({pubkey:u}),g({pubkey:i,isWritable:!1,isSigner:!0}),g({pubkey:n})];for(let p=0;p<r.rewardInfos.length;p++)l.push(g({pubkey:new U(r.rewardInfos[p].vault)})),l.push(g({pubkey:o[p]}));return new ue({programId:a,keys:l,data:d})}var Sr=class extends tt{async _getUserRewardInfo({payer:e,rewardInfo:r}){if(r.mint.equals(te)){let n=await ur({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:e,amount:br({...r,openTime:r.openTime.toString(),endTime:r.endTime.toString()})});return{rewardPubKey:n.addresses.newAccount,newInstruction:n}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:r.mint,associatedOnly:!1})}}async create({poolInfo:e,rewardInfos:r,payer:n,programId:o=ze,txVersion:i,feePayer:s}){this.checkDisabled(),this.scope.checkOwner();let c={lpMint:new Z(e.lpMint.address),lockInfo:{lockMint:Pn,lockVault:kn},version:6,rewardInfos:r,programId:o},u=this.createTxBuilder(s),d=n??this.scope.ownerPubKey,l=Kt({fromPublicKey:d,programId:c.programId}),p=await this.scope.connection.getMinimumBalanceForRentExemption(vt.span);u.addInstruction({instructions:[is.createAccountWithSeed({fromPubkey:d,basePubkey:d,seed:l.seed,newAccountPubkey:l.publicKey,lamports:p,space:vt.span,programId:c.programId})]});let{publicKey:m,nonce:f}=In({programId:new Z(c.programId),poolId:l.publicKey}),y=rt({programId:c.programId,poolId:l.publicKey,mint:c.lpMint,type:"lpVault"}),w=[],k=[];for(let A of c.rewardInfos){A.openTime>=A.endTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",A.openTime.toString()),isNaN(Re[A.rewardType])&&this.logAndCreateError("rewardType error",A.rewardType),Number(A.perSecond)<=0&&this.logAndCreateError("rewardPerSecond error",A.perSecond),w.push(Sn(A));let{rewardPubKey:B,newInstruction:E}=await this._getUserRewardInfo({rewardInfo:A,payer:d});E&&u.addInstruction(E),B||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let V=A.mint.equals(te)?new Z(oe.address):A.mint;k.push({rewardMint:V,rewardVault:rt({programId:c.programId,poolId:l.publicKey,mint:V,type:"rewardVault"}),userRewardToken:B})}let{account:T,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({mint:new Z(c.lockInfo.lockMint),owner:this.scope.ownerPubKey,skipCloseAccount:!1,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:!1});b&&u.addInstruction(b),T||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let{instruction:x,instructionType:I}=Rn({farmId:l.publicKey,owner:this.scope.ownerPubKey,farmAuthority:m,lpVault:y,lpMint:c.lpMint,lockVault:c.lockInfo.lockVault,lockMint:c.lockInfo.lockMint,lockUserAccount:T,programId:c.programId,rewardInfo:k,rewardInfoConfig:w,nonce:f});return u.addInstruction({instructions:[x],instructionTypes:[I]}).versionBuild({txVersion:i,extInfo:{farmId:l.publicKey,farmAuthority:m,lpVault:y,lockUserAccount:T,nonce:f}})}async restartReward({farmInfo:e,payer:r,newRewardInfo:n,txVersion:o,feePayer:i}){let s=xe[e.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=be((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),c={id:a.id,rewardInfos:e.rewardInfos,lpVault:a.lpVault,programId:a.programId};n.openTime>=n.endTime&&this.logAndCreateError("start time error","newRewardInfo",n);let u=r||this.scope.ownerPubKey,d=n.mint.equals(te)?new Z(oe.address):n.mint,l=c.rewardInfos.findIndex(k=>new Z(k.mint.address).equals(d)),p=a.rewardInfos[l];p||this.logAndCreateError("configuration does not exist","rewardMint",d);let m=p.vault??te,f=this.createTxBuilder(i),{rewardPubKey:y,newInstruction:w}=await this._getUserRewardInfo({rewardInfo:n,payer:u});return w&&f.addInstruction(w),y||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts),f.addInstruction({instructions:[xr({payer:this.scope.ownerPubKey,rewardVault:m,userRewardTokenPub:y,farmKeys:c,rewardInfo:n})],instructionTypes:[j.FarmV6Restart]}).versionBuild({txVersion:o})}async restartRewards({farmInfo:e,payer:r,newRewardInfos:n,txVersion:o,feePayer:i}){let s=xe[e.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=be((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),c={id:a.id,rewardInfos:e.rewardInfos,lpVault:a.lpVault,programId:a.programId};n.forEach(l=>{l.openTime>=l.endTime&&this.logAndCreateError("start time error","newRewardInfo",l)});let u=r||this.scope.ownerPubKey,d=this.createTxBuilder(i);for(let l of n){let p=l.mint.equals(te)?new Z(oe.address):l.mint,m=c.rewardInfos.findIndex(b=>new Z(b.mint.address).equals(p)),f=a.rewardInfos[m];f||this.logAndCreateError("configuration does not exist","rewardMint",p);let y=f.vault??te,{rewardPubKey:w,newInstruction:k}=await this._getUserRewardInfo({rewardInfo:l,payer:u});k&&d.addInstruction(k),w||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let T=xr({payer:this.scope.ownerPubKey,rewardVault:y,userRewardTokenPub:w,farmKeys:c,rewardInfo:l});d.addInstruction({instructions:[T],instructionTypes:[j.FarmV6Restart]})}return d.versionBuild({txVersion:o})}async addNewRewardToken(e){let{txVersion:r,farmInfo:n,newRewardInfo:o,payer:i,feePayer:s}=e,a=xe[n.programId];a!==6&&this.logAndCreateError("invalid farm version ",a);let c=be((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),u=i??this.scope.ownerPubKey,d=this.createTxBuilder(s),l=o.mint.equals(te)?new Z(oe.address):o.mint,p=rt({programId:new Z(n.programId),poolId:new Z(n.id),mint:l,type:"rewardVault"}),{rewardPubKey:m,newInstruction:f}=await this._getUserRewardInfo({rewardInfo:o,payer:u});return f&&d.addInstruction(f),m||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts),o.mint=l,d.addInstruction({instructions:[Pr({payer:this.scope.ownerPubKey,userRewardTokenPub:m,farmKeys:c,rewardVault:p,rewardInfo:o})],instructionTypes:[j.FarmV6CreatorAddReward]}).versionBuild({txVersion:r})}async addNewRewardsToken(e){let{txVersion:r,farmInfo:n,newRewardInfos:o,payer:i,feePayer:s}=e,a=xe[n.programId];a!==6&&this.logAndCreateError("invalid farm version ",a);let c=be((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),u=i??this.scope.ownerPubKey,d=this.createTxBuilder(s);for(let l of o){let p=l.mint.equals(te)?new Z(oe.address):l.mint,m=rt({programId:new Z(n.programId),poolId:new Z(n.id),mint:p,type:"rewardVault"}),{rewardPubKey:f,newInstruction:y}=await this._getUserRewardInfo({rewardInfo:l,payer:u});y&&d.addInstruction(y),f||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let w=Pr({payer:this.scope.ownerPubKey,userRewardTokenPub:f,farmKeys:c,rewardVault:m,rewardInfo:{...l,mint:p}});d.addInstruction({instructions:[w],instructionTypes:[j.FarmV6CreatorAddReward]})}return d.versionBuild({txVersion:r})}async deposit(e){let{txVersion:r,farmInfo:n,amount:o,feePayer:i,useSOLBalance:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1,userAuxiliaryLedgers:u,computeBudgetConfig:d,txTipConfig:l}=e;this.scope.availability.addFarm===!1&&this.logAndCreateError("farm deposit feature disabled in your region");let{rewardInfos:p,programId:m}=n,f=xe[m];f===4&&this.logAndCreateError("V4 has suspended deposits:",n.programId),yr(f)||this.logAndCreateError("invalid farm program:",n.programId);let[y,w]=[new Z(n.programId),new Z(n.id)],k=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],T=fe({programId:y,poolId:w,owner:this.scope.ownerPubKey,version:f}),b=this.createTxBuilder(i);b.addCustomComputeBudget(d),b.addTipInstruction(l);let x={};for(let D of this.scope.account.tokenAccounts)if(a){let q=_e(this.scope.ownerPubKey,D.mint,D.programId).publicKey;D.publicKey&&q.equals(D.publicKey)&&(x[D.mint.toString()]=D.publicKey)}else x[D.mint.toString()]=D.publicKey;let I=k.lpMint,A=x[I.address];A||this.logAndCreateError("you don't have any lp","lp zero",x);let B=[];for(let D of p){let q=s&&D.mint.address===me.toString(),O=x[D.mint.address];if(!O){let{account:ot,instructionParams:ae}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:D.mint.programId,mint:new Z(D.mint.address),notUseTokenAccount:q,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!q,associatedOnly:q?!1:a,checkCreateATAOwner:c});O=ot,ae&&b.addInstruction(ae)}x[D.mint.address]=O,B.push(O)}let E,V=await this.scope.connection.getAccountInfo(T);if(V&&(E=wr(f).decode(V.data)),n.programId!==ze.toString()&&!E){let{instruction:D,instructionType:q}=Tr({id:w,programId:y,version:f,ledger:T,owner:this.scope.ownerPubKey});b.addInstruction({instructions:[D],instructionTypes:[q]})}let S=hr({version:f,rewardInfos:p,rewardTokenAccountsPublicKeys:B});S&&this.logAndCreateError(S);let R={amount:_(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:k,lpAccount:A,rewardAccounts:B,userAuxiliaryLedgers:u?.map(D=>new Z(D))},F=f===6?Mn(R):f===5?Vn(R):vn(R),G={3:j.FarmV3Deposit,5:j.FarmV5Deposit,6:j.FarmV6Deposit};return b.addInstruction({instructions:[F],instructionTypes:[G[f]]}).versionBuild({txVersion:r})}async withdraw(e){let{txVersion:r,farmInfo:n,amount:o,deposited:i,useSOLBalance:s,feePayer:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,userAuxiliaryLedgers:d,computeBudgetConfig:l,txTipConfig:p}=e,{rewardInfos:m}=n;this.scope.availability.removeFarm===!1&&this.logAndCreateError("farm withdraw feature disabled in your region");let f=xe[n.programId];yr(f)||this.logAndCreateError("invalid farm program:",n.programId);let y=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],w=this.createTxBuilder(a);w.addCustomComputeBudget(l),w.addTipInstruction(p);let k={};for(let S of this.scope.account.tokenAccounts)if(c){let R=_e(this.scope.ownerPubKey,S.mint).publicKey;S.publicKey&&R.equals(S.publicKey)&&(k[S.mint.toString()]=S.publicKey)}else k[S.mint.toString()]=S.publicKey;if(f!==4){let S=fe({programId:new Z(n.programId),poolId:new Z(n.id),owner:this.scope.ownerPubKey,version:f}),R=await this.scope.connection.getAccountInfo(S);if(R)wr(f).decode(R.data).deposited.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else if(f!==6){let{instruction:F,instructionType:G}=Tr({id:new Z(y.id),programId:new Z(y.programId),version:f,ledger:S,owner:this.scope.ownerPubKey});w.addInstruction({instructions:[F],instructionTypes:[G]})}}i&&i.isZero()&&!(d||[]).length&&this.logAndCreateError("no deposited lp",{farmId:n.id});let T=y.lpMint.address,b=s&&T===me.toString(),x=k[T.toString()];if(!x){let{account:S,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:y.lpMint.programId,mint:new Z(T),notUseTokenAccount:b,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:b?!1:c,checkCreateATAOwner:u});x=S,R&&w.addInstruction(R)}k[T.toString()]=x;let I=[];for(let S of m){let R=s&&S.mint.address===me.toString(),F=k[S.mint.address];if(!F){let{account:G,instructionParams:D}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:S.mint.programId,mint:new Z(S.mint.address),notUseTokenAccount:R,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!R,associatedOnly:R?!1:c,checkCreateATAOwner:u});F=G,D&&w.addInstruction(D)}k[S.mint.address]=F,I.push(F)}let A=hr({version:f,rewardInfos:m,rewardTokenAccountsPublicKeys:I});A&&this.logAndCreateError(A);let B={amount:_(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:y,lpAccount:x,rewardAccounts:I,userAuxiliaryLedgers:d?.map(S=>new Z(S))},E=f===6?kr(B):f===5?Ar(B):f===4?Kn(B):Ir(B),V={3:j.FarmV3Withdraw,4:j.FarmV4Withdraw,5:j.FarmV5Withdraw,6:j.FarmV6Withdraw};return w.addInstruction({instructions:[E],instructionTypes:[V[f]]}).versionBuild({txVersion:r})}async withdrawFarmReward({farmInfo:e,withdrawMint:r,txVersion:n,computeBudgetConfig:o,txTipConfig:i,feePayer:s}){this.scope.checkOwner();let a=be((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),c=xe[e.programId];c!==6&&this.logAndCreateError("invalid farm version",c);let u=a.rewardInfos.find(y=>at(y.mint.address).equals(at(r)));u||this.logAndCreateError("withdraw mint error","rewardInfos",e);let d=u?.vault??te,l=this.createTxBuilder(s),p;if(r.equals(te)||r.equals(Z.default)){let y=await ur({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:br({...u,openTime:u.openTime,endTime:u.endTime,perSecond:new Ut(u.perSecond).mul(10**u.mint.decimals).toString()})});p=y.addresses.newAccount,l.addInstruction(y)}else{let y=await this.scope.account.getCreatedTokenAccount({mint:r});y===null?(p=await this.scope.account.getAssociatedTokenAccount(r),l.addInstruction({instructions:[ss(this.scope.ownerPubKey,p,this.scope.ownerPubKey,r)],instructionTypes:[j.CreateATA]})):p=y}let{instruction:m,instructionType:f}=Cn({programId:a.programId,id:a.id,authority:a.authority,lpVault:a.lpVault,rewardVault:d,userRewardToken:p,owner:this.scope.ownerPubKey});return l.addCustomComputeBudget(o),l.addTipInstruction(i),l.addInstruction({instructions:[m],instructionTypes:[f]}).versionBuild({txVersion:n})}async harvestAllRewards(e){let{farmInfoList:r,useSOLBalance:n,feePayer:o,associatedOnly:i=!0,checkCreateATAOwner:s=!1,userAuxiliaryLedgers:a,txVersion:c,computeBudgetConfig:u}=e,d=this.createTxBuilder(o),l={};for(let f of this.scope.account.tokenAccounts)if(i){let y=_e(this.scope.ownerPubKey,f.mint).publicKey;f.publicKey&&y.equals(f.publicKey)&&(l[f.mint.toString()]=f.publicKey)}else l[f.mint.toString()]=f.publicKey;let m=(await this.scope.api.fetchFarmKeysById({ids:Object.values(r).map(f=>f.id).join(",")})).reduce((f,y)=>({...f,[y.id]:y}),{});for(let f of Object.values(r)){let{programId:y,lpMint:w,rewardInfos:k,id:T}=f,b=xe[y],x=w.address,I=n&&x===me.toString(),A=l[x];if(!A){let{account:F,instructionParams:G}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:w.programId,mint:new Z(x),notUseTokenAccount:I,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:I?!1:i,checkCreateATAOwner:s});A=F,G&&d.addInstruction(G)}l[x.toString()]=A;let B=[];for(let F of k){let G=n&&F.mint.address===me.toString(),D=l[F.mint.address];if(!D){let{account:q,instructionParams:O}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:F.mint.programId,mint:new Z(F.mint.address),notUseTokenAccount:G,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!G,associatedOnly:G?!1:i,checkCreateATAOwner:s});D=q,O&&d.addInstruction(O)}l[F.mint.address]=D,B.push(D)}let E=m[T],V={amount:Yt,owner:this.scope.ownerPubKey,farmInfo:f,farmKeys:E,lpAccount:A,rewardAccounts:B,userAuxiliaryLedgers:a?.map(F=>new Z(F))},S=b===6?kr(V):b===5?Ar(V):Ir(V),R={3:j.FarmV3Withdraw,5:j.FarmV5Withdraw,6:j.FarmV6Withdraw};d.addInstruction({instructions:[S],instructionTypes:[R[b]]})}return c===1?d.sizeCheckBuild({computeBudgetConfig:u}):d.sizeCheckBuildV0({computeBudgetConfig:u})}};export{Sr as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=farm.mjs.map