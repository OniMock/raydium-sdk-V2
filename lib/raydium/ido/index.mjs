var gn=Object.defineProperty;var hn=(t,e,n)=>e in t?gn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Ee=(t,e,n)=>(hn(t,typeof e!="symbol"?e+"":e,n),n);import{PublicKey as Ne}from"@solana/web3.js";import mn from"bn.js";import{PublicKey as S}from"@solana/web3.js";var ri=new S("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),ii=new S("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),oi=new S("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),si=new S("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ai=new S("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ui=new S("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ci=new S("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),li=new S("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),fi=new S("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),pi=new S("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),mi=new S("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),di=new S("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),gi=new S("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),hi=new S("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),bi=new S("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),bn=new S("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),yn=new S("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),wn=new S("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Tn=new S("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),yi=new S("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),wi=new S("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Ti=new S("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),xn=new S("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Pn=new S("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),An=new S("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),xi=new S("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),kn=new S("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Pi=new S("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Sn=new S("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),Ai=new S("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),ki=new S("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),In=new S("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),Cn=new S("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW"),he={IDO_PROGRAM_ID_V1:bn,IDO_PROGRAM_ID_V2:yn,IDO_PROGRAM_ID_V3:wn,IDO_PROGRAM_ID_V4:Tn};var Si={SERUM_MARKET:S.default,OPENBOOK_MARKET:new S("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:S.default,FarmV3:new S("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new S("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new S("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new S("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new S("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new S("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new S("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new S("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new S("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:xn,CREATE_CPMM_POOL_AUTH:Pn,CREATE_CPMM_POOL_FEE_ACC:An,FEE_DESTINATION_ID:new S("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:kn,LCOK_CPMM_AUTH:Sn,LAUNCHPAD_PROGRAM:In,LAUNCHPAD_AUTH:Cn};import{PublicKey as K,SystemProgram as Lt,SYSVAR_RENT_PUBKEY as Bn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ln}from"@solana/spl-token";function et({pubkey:t,isSigner:e=!1,isWritable:n=!0}){return{pubkey:t,isWritable:n,isSigner:e}}var Ni=[et({pubkey:Ln,isWritable:!1}),et({pubkey:Lt.programId,isWritable:!1}),et({pubkey:Bn,isWritable:!1})];function Nt({publicKey:t,transformSol:e}){let n=tt(t.toString());if(n instanceof K)return e&&n.equals(be)?le:n;if(e&&n.toString()===be.toBase58())return le;if(typeof n=="string"){if(n===K.default.toBase58())return K.default;try{return new K(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function tt(t){try{return new K(t)}catch{return t}}var Mi=new K("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ei=new K("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Mt=new K("SysvarRent111111111111111111111111111111111"),nt=new K("SysvarC1ock11111111111111111111111111111111"),Di=new K("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ri=new K("Sysvar1nstructions1111111111111111111111111"),Et=Lt.programId,vi=new K("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Oi=new K("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),_i=new K("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ki=new K("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Fi=new K("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Vi=new K("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ui=new K("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Wi=new K("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),qi=new K("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Gi=new K("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ji=new K("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),le=new K("So11111111111111111111111111111111111111112"),be=K.default;import{PublicKey as zr}from"@solana/web3.js";import Qr from"bn.js";import jr from"big.js";import Je from"bn.js";import ne from"bn.js";var fe=9e15,se=1e9,rt="0123456789abcdef",Re="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",ve="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",it={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-fe,maxE:fe,crypto:!1},Ot,$,I=!0,_e="[DecimalError] ",oe=_e+"Invalid argument: ",_t=_e+"Precision limit exceeded",Kt=_e+"crypto unavailable",Ft="[object Decimal]",G=Math.floor,U=Math.pow,Nn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Mn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,En=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Vt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,J=1e7,A=7,Dn=9007199254740991,Rn=Re.length-1,ot=ve.length-1,m={toStringTag:Ft};m.absoluteValue=m.abs=function(){var t=new this.constructor(this);return t.s<0&&(t.s=1),P(t)};m.ceil=function(){return P(new this.constructor(this),this.e+1,2)};m.clampedTo=m.clamp=function(t,e){var n,r=this,i=r.constructor;if(t=new i(t),e=new i(e),!t.s||!e.s)return new i(NaN);if(t.gt(e))throw Error(oe+e);return n=r.cmp(t),n<0?t:r.cmp(e)>0?e:new i(r)};m.comparedTo=m.cmp=function(t){var e,n,r,i,o=this,s=o.d,u=(t=new o.constructor(t)).d,c=o.s,a=t.s;if(!s||!u)return!c||!a?NaN:c!==a?c:s===u?0:!s^c<0?1:-1;if(!s[0]||!u[0])return s[0]?c:u[0]?-a:0;if(c!==a)return c;if(o.e!==t.e)return o.e>t.e^c<0?1:-1;for(r=s.length,i=u.length,e=0,n=r<i?r:i;e<n;++e)if(s[e]!==u[e])return s[e]>u[e]^c<0?1:-1;return r===i?0:r>i^c<0?1:-1};m.cosine=m.cos=function(){var t,e,n=this,r=n.constructor;return n.d?n.d[0]?(t=r.precision,e=r.rounding,r.precision=t+Math.max(n.e,n.sd())+A,r.rounding=1,n=vn(r,jt(r,n)),r.precision=t,r.rounding=e,P($==2||$==3?n.neg():n,t,e,!0)):new r(1):new r(NaN)};m.cubeRoot=m.cbrt=function(){var t,e,n,r,i,o,s,u,c,a,l=this,f=l.constructor;if(!l.isFinite()||l.isZero())return new f(l);for(I=!1,o=l.s*U(l.s*l,1/3),!o||Math.abs(o)==1/0?(n=q(l.d),t=l.e,(o=(t-n.length+1)%3)&&(n+=o==1||o==-2?"0":"00"),o=U(n,1/3),t=G((t+1)/3)-(t%3==(t<0?-1:2)),o==1/0?n="5e"+t:(n=o.toExponential(),n=n.slice(0,n.indexOf("e")+1)+t),r=new f(n),r.s=l.s):r=new f(o.toString()),s=(t=f.precision)+3;;)if(u=r,c=u.times(u).times(u),a=c.plus(l),r=_(a.plus(l).times(u),a.plus(c),s+2,1),q(u.d).slice(0,s)===(n=q(r.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!i&&n=="4999"){if(!i&&(P(u,t+1,0),u.times(u).times(u).eq(l))){r=u;break}s+=4,i=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(P(r,t+1,1),e=!r.times(r).times(r).eq(l));break}return I=!0,P(r,t,f.rounding,e)};m.decimalPlaces=m.dp=function(){var t,e=this.d,n=NaN;if(e){if(t=e.length-1,n=(t-G(this.e/A))*A,t=e[t],t)for(;t%10==0;t/=10)n--;n<0&&(n=0)}return n};m.dividedBy=m.div=function(t){return _(this,new this.constructor(t))};m.dividedToIntegerBy=m.divToInt=function(t){var e=this,n=e.constructor;return P(_(e,new n(t),0,1,1),n.precision,n.rounding)};m.equals=m.eq=function(t){return this.cmp(t)===0};m.floor=function(){return P(new this.constructor(this),this.e+1,3)};m.greaterThan=m.gt=function(t){return this.cmp(t)>0};m.greaterThanOrEqualTo=m.gte=function(t){var e=this.cmp(t);return e==1||e===0};m.hyperbolicCosine=m.cosh=function(){var t,e,n,r,i,o=this,s=o.constructor,u=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return u;n=s.precision,r=s.rounding,s.precision=n+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(t=Math.ceil(i/3),e=(1/Fe(4,t)).toString()):(t=16,e="2.3283064365386962890625e-10"),o=pe(s,1,o.times(e),new s(1),!0);for(var c,a=t,l=new s(8);a--;)c=o.times(o),o=u.minus(c.times(l.minus(c.times(l))));return P(o,s.precision=n,s.rounding=r,!0)};m.hyperbolicSine=m.sinh=function(){var t,e,n,r,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,n=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,r=i.d.length,r<3)i=pe(o,2,i,i,!0);else{t=1.4*Math.sqrt(r),t=t>16?16:t|0,i=i.times(1/Fe(5,t)),i=pe(o,2,i,i,!0);for(var s,u=new o(5),c=new o(16),a=new o(20);t--;)s=i.times(i),i=i.times(u.plus(s.times(c.times(s).plus(a))))}return o.precision=e,o.rounding=n,P(i,e,n,!0)};m.hyperbolicTangent=m.tanh=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+7,r.rounding=1,_(n.sinh(),n.cosh(),r.precision=t,r.rounding=e)):new r(n.s)};m.inverseCosine=m.acos=function(){var t,e=this,n=e.constructor,r=e.abs().cmp(1),i=n.precision,o=n.rounding;return r!==-1?r===0?e.isNeg()?Q(n,i,o):new n(0):new n(NaN):e.isZero()?Q(n,i+4,o).times(.5):(n.precision=i+6,n.rounding=1,e=e.asin(),t=Q(n,i+4,o).times(.5),n.precision=i,n.rounding=o,t.minus(e))};m.inverseHyperbolicCosine=m.acosh=function(){var t,e,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(t=r.precision,e=r.rounding,r.precision=t+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,I=!1,n=n.times(n).minus(1).sqrt().plus(n),I=!0,r.precision=t,r.rounding=e,n.ln()):new r(n)};m.inverseHyperbolicSine=m.asinh=function(){var t,e,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,I=!1,n=n.times(n).plus(1).sqrt().plus(n),I=!0,r.precision=t,r.rounding=e,n.ln())};m.inverseHyperbolicTangent=m.atanh=function(){var t,e,n,r,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(t=o.precision,e=o.rounding,r=i.sd(),Math.max(r,t)<2*-i.e-1?P(new o(i),t,e,!0):(o.precision=n=r-i.e,i=_(i.plus(1),new o(1).minus(i),n+t,1),o.precision=t+4,o.rounding=1,i=i.ln(),o.precision=t,o.rounding=e,i.times(.5))):new o(NaN)};m.inverseSine=m.asin=function(){var t,e,n,r,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),n=o.precision,r=o.rounding,e!==-1?e===0?(t=Q(o,n+4,r).times(.5),t.s=i.s,t):new o(NaN):(o.precision=n+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=n,o.rounding=r,i.times(2)))};m.inverseTangent=m.atan=function(){var t,e,n,r,i,o,s,u,c,a=this,l=a.constructor,f=l.precision,p=l.rounding;if(a.isFinite()){if(a.isZero())return new l(a);if(a.abs().eq(1)&&f+4<=ot)return s=Q(l,f+4,p).times(.25),s.s=a.s,s}else{if(!a.s)return new l(NaN);if(f+4<=ot)return s=Q(l,f+4,p).times(.5),s.s=a.s,s}for(l.precision=u=f+10,l.rounding=1,n=Math.min(28,u/A+2|0),t=n;t;--t)a=a.div(a.times(a).plus(1).sqrt().plus(1));for(I=!1,e=Math.ceil(u/A),r=1,c=a.times(a),s=new l(a),i=a;t!==-1;)if(i=i.times(c),o=s.minus(i.div(r+=2)),i=i.times(c),s=o.plus(i.div(r+=2)),s.d[e]!==void 0)for(t=e;s.d[t]===o.d[t]&&t--;);return n&&(s=s.times(2<<n-1)),I=!0,P(s,l.precision=f,l.rounding=p,!0)};m.isFinite=function(){return!!this.d};m.isInteger=m.isInt=function(){return!!this.d&&G(this.e/A)>this.d.length-2};m.isNaN=function(){return!this.s};m.isNegative=m.isNeg=function(){return this.s<0};m.isPositive=m.isPos=function(){return this.s>0};m.isZero=function(){return!!this.d&&this.d[0]===0};m.lessThan=m.lt=function(t){return this.cmp(t)<0};m.lessThanOrEqualTo=m.lte=function(t){return this.cmp(t)<1};m.logarithm=m.log=function(t){var e,n,r,i,o,s,u,c,a=this,l=a.constructor,f=l.precision,p=l.rounding,d=5;if(t==null)t=new l(10),e=!0;else{if(t=new l(t),n=t.d,t.s<0||!n||!n[0]||t.eq(1))return new l(NaN);e=t.eq(10)}if(n=a.d,a.s<0||!n||!n[0]||a.eq(1))return new l(n&&!n[0]?-1/0:a.s!=1?NaN:n?0:1/0);if(e)if(n.length>1)o=!0;else{for(i=n[0];i%10===0;)i/=10;o=i!==1}if(I=!1,u=f+d,s=ie(a,u),r=e?Oe(l,u+10):ie(t,u),c=_(s,r,u,1),ye(c.d,i=f,p))do if(u+=10,s=ie(a,u),r=e?Oe(l,u+10):ie(t,u),c=_(s,r,u,1),!o){+q(c.d).slice(i+1,i+15)+1==1e14&&(c=P(c,f+1,0));break}while(ye(c.d,i+=10,p));return I=!0,P(c,f,p)};m.minus=m.sub=function(t){var e,n,r,i,o,s,u,c,a,l,f,p,d=this,g=d.constructor;if(t=new g(t),!d.d||!t.d)return!d.s||!t.s?t=new g(NaN):d.d?t.s=-t.s:t=new g(t.d||d.s!==t.s?d:NaN),t;if(d.s!=t.s)return t.s=-t.s,d.plus(t);if(a=d.d,p=t.d,u=g.precision,c=g.rounding,!a[0]||!p[0]){if(p[0])t.s=-t.s;else if(a[0])t=new g(d);else return new g(c===3?-0:0);return I?P(t,u,c):t}if(n=G(t.e/A),l=G(d.e/A),a=a.slice(),o=l-n,o){for(f=o<0,f?(e=a,o=-o,s=p.length):(e=p,n=l,s=a.length),r=Math.max(Math.ceil(u/A),s)+2,o>r&&(o=r,e.length=1),e.reverse(),r=o;r--;)e.push(0);e.reverse()}else{for(r=a.length,s=p.length,f=r<s,f&&(s=r),r=0;r<s;r++)if(a[r]!=p[r]){f=a[r]<p[r];break}o=0}for(f&&(e=a,a=p,p=e,t.s=-t.s),s=a.length,r=p.length-s;r>0;--r)a[s++]=0;for(r=p.length;r>o;){if(a[--r]<p[r]){for(i=r;i&&a[--i]===0;)a[i]=J-1;--a[i],a[r]+=J}a[r]-=p[r]}for(;a[--s]===0;)a.pop();for(;a[0]===0;a.shift())--n;return a[0]?(t.d=a,t.e=Ke(a,n),I?P(t,u,c):t):new g(c===3?-0:0)};m.modulo=m.mod=function(t){var e,n=this,r=n.constructor;return t=new r(t),!n.d||!t.s||t.d&&!t.d[0]?new r(NaN):!t.d||n.d&&!n.d[0]?P(new r(n),r.precision,r.rounding):(I=!1,r.modulo==9?(e=_(n,t.abs(),0,3,1),e.s*=t.s):e=_(n,t,0,r.modulo,1),e=e.times(t),I=!0,n.minus(e))};m.naturalExponential=m.exp=function(){return st(this)};m.naturalLogarithm=m.ln=function(){return ie(this)};m.negated=m.neg=function(){var t=new this.constructor(this);return t.s=-t.s,P(t)};m.plus=m.add=function(t){var e,n,r,i,o,s,u,c,a,l,f=this,p=f.constructor;if(t=new p(t),!f.d||!t.d)return!f.s||!t.s?t=new p(NaN):f.d||(t=new p(t.d||f.s===t.s?f:NaN)),t;if(f.s!=t.s)return t.s=-t.s,f.minus(t);if(a=f.d,l=t.d,u=p.precision,c=p.rounding,!a[0]||!l[0])return l[0]||(t=new p(f)),I?P(t,u,c):t;if(o=G(f.e/A),r=G(t.e/A),a=a.slice(),i=o-r,i){for(i<0?(n=a,i=-i,s=l.length):(n=l,r=o,s=a.length),o=Math.ceil(u/A),s=o>s?o+1:s+1,i>s&&(i=s,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for(s=a.length,i=l.length,s-i<0&&(i=s,n=l,l=a,a=n),e=0;i;)e=(a[--i]=a[i]+l[i]+e)/J|0,a[i]%=J;for(e&&(a.unshift(e),++r),s=a.length;a[--s]==0;)a.pop();return t.d=a,t.e=Ke(a,r),I?P(t,u,c):t};m.precision=m.sd=function(t){var e,n=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(oe+t);return n.d?(e=Ut(n.d),t&&n.e+1>e&&(e=n.e+1)):e=NaN,e};m.round=function(){var t=this,e=t.constructor;return P(new e(t),t.e+1,e.rounding)};m.sine=m.sin=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+Math.max(n.e,n.sd())+A,r.rounding=1,n=_n(r,jt(r,n)),r.precision=t,r.rounding=e,P($>2?n.neg():n,t,e,!0)):new r(NaN)};m.squareRoot=m.sqrt=function(){var t,e,n,r,i,o,s=this,u=s.d,c=s.e,a=s.s,l=s.constructor;if(a!==1||!u||!u[0])return new l(!a||a<0&&(!u||u[0])?NaN:u?s:1/0);for(I=!1,a=Math.sqrt(+s),a==0||a==1/0?(e=q(u),(e.length+c)%2==0&&(e+="0"),a=Math.sqrt(e),c=G((c+1)/2)-(c<0||c%2),a==1/0?e="5e"+c:(e=a.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),r=new l(e)):r=new l(a.toString()),n=(c=l.precision)+3;;)if(o=r,r=o.plus(_(s,o,n+2,1)).times(.5),q(o.d).slice(0,n)===(e=q(r.d)).slice(0,n))if(e=e.slice(n-3,n+1),e=="9999"||!i&&e=="4999"){if(!i&&(P(o,c+1,0),o.times(o).eq(s))){r=o;break}n+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(P(r,c+1,1),t=!r.times(r).eq(s));break}return I=!0,P(r,c,l.rounding,t)};m.tangent=m.tan=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+10,r.rounding=1,n=n.sin(),n.s=1,n=_(n,new r(1).minus(n.times(n)).sqrt(),t+10,0),r.precision=t,r.rounding=e,P($==2||$==4?n.neg():n,t,e,!0)):new r(NaN)};m.times=m.mul=function(t){var e,n,r,i,o,s,u,c,a,l=this,f=l.constructor,p=l.d,d=(t=new f(t)).d;if(t.s*=l.s,!p||!p[0]||!d||!d[0])return new f(!t.s||p&&!p[0]&&!d||d&&!d[0]&&!p?NaN:!p||!d?t.s/0:t.s*0);for(n=G(l.e/A)+G(t.e/A),c=p.length,a=d.length,c<a&&(o=p,p=d,d=o,s=c,c=a,a=s),o=[],s=c+a,r=s;r--;)o.push(0);for(r=a;--r>=0;){for(e=0,i=c+r;i>r;)u=o[i]+d[r]*p[i-r-1]+e,o[i--]=u%J|0,e=u/J|0;o[i]=(o[i]+e)%J|0}for(;!o[--s];)o.pop();return e?++n:o.shift(),t.d=o,t.e=Ke(o,n),I?P(t,f.precision,f.rounding):t};m.toBinary=function(t,e){return ut(this,2,t,e)};m.toDecimalPlaces=m.toDP=function(t,e){var n=this,r=n.constructor;return n=new r(n),t===void 0?n:(H(t,0,se),e===void 0?e=r.rounding:H(e,0,8),P(n,t+n.e+1,e))};m.toExponential=function(t,e){var n,r=this,i=r.constructor;return t===void 0?n=X(r,!0):(H(t,0,se),e===void 0?e=i.rounding:H(e,0,8),r=P(new i(r),t+1,e),n=X(r,!0,t+1)),r.isNeg()&&!r.isZero()?"-"+n:n};m.toFixed=function(t,e){var n,r,i=this,o=i.constructor;return t===void 0?n=X(i):(H(t,0,se),e===void 0?e=o.rounding:H(e,0,8),r=P(new o(i),t+i.e+1,e),n=X(r,!1,t+r.e+1)),i.isNeg()&&!i.isZero()?"-"+n:n};m.toFraction=function(t){var e,n,r,i,o,s,u,c,a,l,f,p,d=this,g=d.d,b=d.constructor;if(!g)return new b(d);if(a=n=new b(1),r=c=new b(0),e=new b(r),o=e.e=Ut(g)-d.e-1,s=o%A,e.d[0]=U(10,s<0?A+s:s),t==null)t=o>0?e:a;else{if(u=new b(t),!u.isInt()||u.lt(a))throw Error(oe+u);t=u.gt(e)?o>0?e:a:u}for(I=!1,u=new b(q(g)),l=b.precision,b.precision=o=g.length*A*2;f=_(u,e,0,1,1),i=n.plus(f.times(r)),i.cmp(t)!=1;)n=r,r=i,i=a,a=c.plus(f.times(i)),c=i,i=e,e=u.minus(f.times(i)),u=i;return i=_(t.minus(n),r,0,1,1),c=c.plus(i.times(a)),n=n.plus(i.times(r)),c.s=a.s=d.s,p=_(a,r,o,1).minus(d).abs().cmp(_(c,n,o,1).minus(d).abs())<1?[a,r]:[c,n],b.precision=l,I=!0,p};m.toHexadecimal=m.toHex=function(t,e){return ut(this,16,t,e)};m.toNearest=function(t,e){var n=this,r=n.constructor;if(n=new r(n),t==null){if(!n.d)return n;t=new r(1),e=r.rounding}else{if(t=new r(t),e===void 0?e=r.rounding:H(e,0,8),!n.d)return t.s?n:t;if(!t.d)return t.s&&(t.s=n.s),t}return t.d[0]?(I=!1,n=_(n,t,0,e,1).times(t),I=!0,P(n)):(t.s=n.s,n=t),n};m.toNumber=function(){return+this};m.toOctal=function(t,e){return ut(this,8,t,e)};m.toPower=m.pow=function(t){var e,n,r,i,o,s,u=this,c=u.constructor,a=+(t=new c(t));if(!u.d||!t.d||!u.d[0]||!t.d[0])return new c(U(+u,a));if(u=new c(u),u.eq(1))return u;if(r=c.precision,o=c.rounding,t.eq(1))return P(u,r,o);if(e=G(t.e/A),e>=t.d.length-1&&(n=a<0?-a:a)<=Dn)return i=Wt(c,u,n,r),t.s<0?new c(1).div(i):P(i,r,o);if(s=u.s,s<0){if(e<t.d.length-1)return new c(NaN);if((t.d[e]&1)==0&&(s=1),u.e==0&&u.d[0]==1&&u.d.length==1)return u.s=s,u}return n=U(+u,a),e=n==0||!isFinite(n)?G(a*(Math.log("0."+q(u.d))/Math.LN10+u.e+1)):new c(n+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(I=!1,c.rounding=u.s=1,n=Math.min(12,(e+"").length),i=st(t.times(ie(u,r+n)),r),i.d&&(i=P(i,r+5,1),ye(i.d,r,o)&&(e=r+10,i=P(st(t.times(ie(u,e+n)),e),e+5,1),+q(i.d).slice(r+1,r+15)+1==1e14&&(i=P(i,r+1,0)))),i.s=s,I=!0,c.rounding=o,P(i,r,o))};m.toPrecision=function(t,e){var n,r=this,i=r.constructor;return t===void 0?n=X(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):(H(t,1,se),e===void 0?e=i.rounding:H(e,0,8),r=P(new i(r),t,e),n=X(r,t<=r.e||r.e<=i.toExpNeg,t)),r.isNeg()&&!r.isZero()?"-"+n:n};m.toSignificantDigits=m.toSD=function(t,e){var n=this,r=n.constructor;return t===void 0?(t=r.precision,e=r.rounding):(H(t,1,se),e===void 0?e=r.rounding:H(e,0,8)),P(new r(n),t,e)};m.toString=function(){var t=this,e=t.constructor,n=X(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()&&!t.isZero()?"-"+n:n};m.truncated=m.trunc=function(){return P(new this.constructor(this),this.e+1,1)};m.valueOf=m.toJSON=function(){var t=this,e=t.constructor,n=X(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()?"-"+n:n};function q(t){var e,n,r,i=t.length-1,o="",s=t[0];if(i>0){for(o+=s,e=1;e<i;e++)r=t[e]+"",n=A-r.length,n&&(o+=re(n)),o+=r;s=t[e],r=s+"",n=A-r.length,n&&(o+=re(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function H(t,e,n){if(t!==~~t||t<e||t>n)throw Error(oe+t)}function ye(t,e,n,r){var i,o,s,u;for(o=t[0];o>=10;o/=10)--e;return--e<0?(e+=A,i=0):(i=Math.ceil((e+1)/A),e%=A),o=U(10,A-e),u=t[i]%o|0,r==null?e<3?(e==0?u=u/100|0:e==1&&(u=u/10|0),s=n<4&&u==99999||n>3&&u==49999||u==5e4||u==0):s=(n<4&&u+1==o||n>3&&u+1==o/2)&&(t[i+1]/o/100|0)==U(10,e-2)-1||(u==o/2||u==0)&&(t[i+1]/o/100|0)==0:e<4?(e==0?u=u/1e3|0:e==1?u=u/100|0:e==2&&(u=u/10|0),s=(r||n<4)&&u==9999||!r&&n>3&&u==4999):s=((r||n<4)&&u+1==o||!r&&n>3&&u+1==o/2)&&(t[i+1]/o/1e3|0)==U(10,e-3)-1,s}function De(t,e,n){for(var r,i=[0],o,s=0,u=t.length;s<u;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=rt.indexOf(t.charAt(s++)),r=0;r<i.length;r++)i[r]>n-1&&(i[r+1]===void 0&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}function vn(t,e){var n,r,i;if(e.isZero())return e;r=e.d.length,r<32?(n=Math.ceil(r/3),i=(1/Fe(4,n)).toString()):(n=16,i="2.3283064365386962890625e-10"),t.precision+=n,e=pe(t,1,e.times(i),new t(1));for(var o=n;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return t.precision-=n,e}var _=function(){function t(r,i,o){var s,u=0,c=r.length;for(r=r.slice();c--;)s=r[c]*i+u,r[c]=s%o|0,u=s/o|0;return u&&r.unshift(u),r}function e(r,i,o,s){var u,c;if(o!=s)c=o>s?1:-1;else for(u=c=0;u<o;u++)if(r[u]!=i[u]){c=r[u]>i[u]?1:-1;break}return c}function n(r,i,o,s){for(var u=0;o--;)r[o]-=u,u=r[o]<i[o]?1:0,r[o]=u*s+r[o]-i[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,o,s,u,c){var a,l,f,p,d,g,b,y,T,w,h,x,k,C,B,D,E,R,L,V,W=r.constructor,z=r.s==i.s?1:-1,F=r.d,v=i.d;if(!F||!F[0]||!v||!v[0])return new W(!r.s||!i.s||(F?v&&F[0]==v[0]:!v)?NaN:F&&F[0]==0||!v?z*0:z/0);for(c?(d=1,l=r.e-i.e):(c=J,d=A,l=G(r.e/d)-G(i.e/d)),L=v.length,E=F.length,T=new W(z),w=T.d=[],f=0;v[f]==(F[f]||0);f++);if(v[f]>(F[f]||0)&&l--,o==null?(C=o=W.precision,s=W.rounding):u?C=o+(r.e-i.e)+1:C=o,C<0)w.push(1),g=!0;else{if(C=C/d+2|0,f=0,L==1){for(p=0,v=v[0],C++;(f<E||p)&&C--;f++)B=p*c+(F[f]||0),w[f]=B/v|0,p=B%v|0;g=p||f<E}else{for(p=c/(v[0]+1)|0,p>1&&(v=t(v,p,c),F=t(F,p,c),L=v.length,E=F.length),D=L,h=F.slice(0,L),x=h.length;x<L;)h[x++]=0;V=v.slice(),V.unshift(0),R=v[0],v[1]>=c/2&&++R;do p=0,a=e(v,h,L,x),a<0?(k=h[0],L!=x&&(k=k*c+(h[1]||0)),p=k/R|0,p>1?(p>=c&&(p=c-1),b=t(v,p,c),y=b.length,x=h.length,a=e(b,h,y,x),a==1&&(p--,n(b,L<y?V:v,y,c))):(p==0&&(a=p=1),b=v.slice()),y=b.length,y<x&&b.unshift(0),n(h,b,x,c),a==-1&&(x=h.length,a=e(v,h,L,x),a<1&&(p++,n(h,L<x?V:v,x,c))),x=h.length):a===0&&(p++,h=[0]),w[f++]=p,a&&h[0]?h[x++]=F[D]||0:(h=[F[D]],x=1);while((D++<E||h[0]!==void 0)&&C--);g=h[0]!==void 0}w[0]||w.shift()}if(d==1)T.e=l,Ot=g;else{for(f=1,p=w[0];p>=10;p/=10)f++;T.e=f+l*d-1,P(T,u?o+T.e+1:o,s,g)}return T}}();function P(t,e,n,r){var i,o,s,u,c,a,l,f,p,d=t.constructor;e:if(e!=null){if(f=t.d,!f)return t;for(i=1,u=f[0];u>=10;u/=10)i++;if(o=e-i,o<0)o+=A,s=e,l=f[p=0],c=l/U(10,i-s-1)%10|0;else if(p=Math.ceil((o+1)/A),u=f.length,p>=u)if(r){for(;u++<=p;)f.push(0);l=c=0,i=1,o%=A,s=o-A+1}else break e;else{for(l=u=f[p],i=1;u>=10;u/=10)i++;o%=A,s=o-A+i,c=s<0?0:l/U(10,i-s-1)%10|0}if(r=r||e<0||f[p+1]!==void 0||(s<0?l:l%U(10,i-s-1)),a=n<4?(c||r)&&(n==0||n==(t.s<0?3:2)):c>5||c==5&&(n==4||r||n==6&&(o>0?s>0?l/U(10,i-s):0:f[p-1])%10&1||n==(t.s<0?8:7)),e<1||!f[0])return f.length=0,a?(e-=t.e+1,f[0]=U(10,(A-e%A)%A),t.e=-e||0):f[0]=t.e=0,t;if(o==0?(f.length=p,u=1,p--):(f.length=p+1,u=U(10,A-o),f[p]=s>0?(l/U(10,i-s)%U(10,s)|0)*u:0),a)for(;;)if(p==0){for(o=1,s=f[0];s>=10;s/=10)o++;for(s=f[0]+=u,u=1;s>=10;s/=10)u++;o!=u&&(t.e++,f[0]==J&&(f[0]=1));break}else{if(f[p]+=u,f[p]!=J)break;f[p--]=0,u=1}for(o=f.length;f[--o]===0;)f.pop()}return I&&(t.e>d.maxE?(t.d=null,t.e=NaN):t.e<d.minE&&(t.e=0,t.d=[0])),t}function X(t,e,n){if(!t.isFinite())return Gt(t);var r,i=t.e,o=q(t.d),s=o.length;return e?(n&&(r=n-s)>0?o=o.charAt(0)+"."+o.slice(1)+re(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(t.e<0?"e":"e+")+t.e):i<0?(o="0."+re(-i-1)+o,n&&(r=n-s)>0&&(o+=re(r))):i>=s?(o+=re(i+1-s),n&&(r=n-i-1)>0&&(o=o+"."+re(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),n&&(r=n-s)>0&&(i+1===s&&(o+="."),o+=re(r))),o}function Ke(t,e){var n=t[0];for(e*=A;n>=10;n/=10)e++;return e}function Oe(t,e,n){if(e>Rn)throw I=!0,n&&(t.precision=n),Error(_t);return P(new t(Re),e,1,!0)}function Q(t,e,n){if(e>ot)throw Error(_t);return P(new t(ve),e,n,!0)}function Ut(t){var e=t.length-1,n=e*A+1;if(e=t[e],e){for(;e%10==0;e/=10)n--;for(e=t[0];e>=10;e/=10)n++}return n}function re(t){for(var e="";t--;)e+="0";return e}function Wt(t,e,n,r){var i,o=new t(1),s=Math.ceil(r/A+4);for(I=!1;;){if(n%2&&(o=o.times(e),Rt(o.d,s)&&(i=!0)),n=G(n/2),n===0){n=o.d.length-1,i&&o.d[n]===0&&++o.d[n];break}e=e.times(e),Rt(e.d,s)}return I=!0,o}function Dt(t){return t.d[t.d.length-1]&1}function qt(t,e,n){for(var r,i=new t(e[0]),o=0;++o<e.length;)if(r=new t(e[o]),r.s)i[n](r)&&(i=r);else{i=r;break}return i}function st(t,e){var n,r,i,o,s,u,c,a=0,l=0,f=0,p=t.constructor,d=p.rounding,g=p.precision;if(!t.d||!t.d[0]||t.e>17)return new p(t.d?t.d[0]?t.s<0?0:1/0:1:t.s?t.s<0?0:t:0/0);for(e==null?(I=!1,c=g):c=e,u=new p(.03125);t.e>-2;)t=t.times(u),f+=5;for(r=Math.log(U(2,f))/Math.LN10*2+5|0,c+=r,n=o=s=new p(1),p.precision=c;;){if(o=P(o.times(t),c,1),n=n.times(++l),u=s.plus(_(o,n,c,1)),q(u.d).slice(0,c)===q(s.d).slice(0,c)){for(i=f;i--;)s=P(s.times(s),c,1);if(e==null)if(a<3&&ye(s.d,c-r,d,a))p.precision=c+=10,n=o=u=new p(1),l=0,a++;else return P(s,p.precision=g,d,I=!0);else return p.precision=g,s}s=u}}function ie(t,e){var n,r,i,o,s,u,c,a,l,f,p,d=1,g=10,b=t,y=b.d,T=b.constructor,w=T.rounding,h=T.precision;if(b.s<0||!y||!y[0]||!b.e&&y[0]==1&&y.length==1)return new T(y&&!y[0]?-1/0:b.s!=1?NaN:y?0:b);if(e==null?(I=!1,l=h):l=e,T.precision=l+=g,n=q(y),r=n.charAt(0),Math.abs(o=b.e)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)b=b.times(t),n=q(b.d),r=n.charAt(0),d++;o=b.e,r>1?(b=new T("0."+n),o++):b=new T(r+"."+n.slice(1))}else return a=Oe(T,l+2,h).times(o+""),b=ie(new T(r+"."+n.slice(1)),l-g).plus(a),T.precision=h,e==null?P(b,h,w,I=!0):b;for(f=b,c=s=b=_(b.minus(1),b.plus(1),l,1),p=P(b.times(b),l,1),i=3;;){if(s=P(s.times(p),l,1),a=c.plus(_(s,new T(i),l,1)),q(a.d).slice(0,l)===q(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Oe(T,l+2,h).times(o+""))),c=_(c,new T(d),l,1),e==null)if(ye(c.d,l-g,w,u))T.precision=l+=g,a=s=b=_(f.minus(1),f.plus(1),l,1),p=P(b.times(b),l,1),i=u=1;else return P(c,T.precision=h,w,I=!0);else return T.precision=h,c;c=a,i+=2}}function Gt(t){return String(t.s*t.s/0)}function at(t,e){var n,r,i;for((n=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(n<0&&(n=r),n+=+e.slice(r+1),e=e.substring(0,r)):n<0&&(n=e.length),r=0;e.charCodeAt(r)===48;r++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(r,i),e){if(i-=r,t.e=n=n-r-1,t.d=[],r=(n+1)%A,n<0&&(r+=A),r<i){for(r&&t.d.push(+e.slice(0,r)),i-=A;r<i;)t.d.push(+e.slice(r,r+=A));e=e.slice(r),r=A-e.length}else r-=i;for(;r--;)e+="0";t.d.push(+e),I&&(t.e>t.constructor.maxE?(t.d=null,t.e=NaN):t.e<t.constructor.minE&&(t.e=0,t.d=[0]))}else t.e=0,t.d=[0];return t}function On(t,e){var n,r,i,o,s,u,c,a,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Vt.test(e))return at(t,e)}else if(e==="Infinity"||e==="NaN")return+e||(t.s=NaN),t.e=NaN,t.d=null,t;if(Mn.test(e))n=16,e=e.toLowerCase();else if(Nn.test(e))n=2;else if(En.test(e))n=8;else throw Error(oe+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,r=t.constructor,s&&(e=e.replace(".",""),u=e.length,o=u-o,i=Wt(r,new r(n),o,o*2)),a=De(e,n,J),l=a.length-1,o=l;a[o]===0;--o)a.pop();return o<0?new r(t.s*0):(t.e=Ke(a,l),t.d=a,I=!1,s&&(t=_(t,i,u*4)),c&&(t=t.times(Math.abs(c)<54?U(2,c):Ve.pow(2,c))),I=!0,t)}function _n(t,e){var n,r=e.d.length;if(r<3)return e.isZero()?e:pe(t,2,e,e);n=1.4*Math.sqrt(r),n=n>16?16:n|0,e=e.times(1/Fe(5,n)),e=pe(t,2,e,e);for(var i,o=new t(5),s=new t(16),u=new t(20);n--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(u))));return e}function pe(t,e,n,r,i){var o,s,u,c,a=1,l=t.precision,f=Math.ceil(l/A);for(I=!1,c=n.times(n),u=new t(r);;){if(s=_(u.times(c),new t(e++*e++),l,1),u=i?r.plus(s):r.minus(s),r=_(s.times(c),new t(e++*e++),l,1),s=u.plus(r),s.d[f]!==void 0){for(o=f;s.d[o]===u.d[o]&&o--;);if(o==-1)break}o=u,u=r,r=s,s=o,a++}return I=!0,s.d.length=f+1,s}function Fe(t,e){for(var n=t;--e;)n*=t;return n}function jt(t,e){var n,r=e.s<0,i=Q(t,t.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return $=r?4:1,e;if(n=e.divToInt(i),n.isZero())$=r?3:2;else{if(e=e.minus(n.times(i)),e.lte(o))return $=Dt(n)?r?2:3:r?4:1,e;$=Dt(n)?r?1:4:r?3:2}return e.minus(i).abs()}function ut(t,e,n,r){var i,o,s,u,c,a,l,f,p,d=t.constructor,g=n!==void 0;if(g?(H(n,1,se),r===void 0?r=d.rounding:H(r,0,8)):(n=d.precision,r=d.rounding),!t.isFinite())l=Gt(t);else{for(l=X(t),s=l.indexOf("."),g?(i=2,e==16?n=n*4-3:e==8&&(n=n*3-2)):i=e,s>=0&&(l=l.replace(".",""),p=new d(1),p.e=l.length-s,p.d=De(X(p),10,i),p.e=p.d.length),f=De(l,10,i),o=c=f.length;f[--c]==0;)f.pop();if(!f[0])l=g?"0p+0":"0";else{if(s<0?o--:(t=new d(t),t.d=f,t.e=o,t=_(t,p,n,r,0,i),f=t.d,o=t.e,a=Ot),s=f[n],u=i/2,a=a||f[n+1]!==void 0,a=r<4?(s!==void 0||a)&&(r===0||r===(t.s<0?3:2)):s>u||s===u&&(r===4||a||r===6&&f[n-1]&1||r===(t.s<0?8:7)),f.length=n,a)for(;++f[--n]>i-1;)f[n]=0,n||(++o,f.unshift(1));for(c=f.length;!f[c-1];--c);for(s=0,l="";s<c;s++)l+=rt.charAt(f[s]);if(g){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(f=De(l,i,e),c=f.length;!f[c-1];--c);for(s=1,l="1.";s<c;s++)l+=rt.charAt(f[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return t.s<0?"-"+l:l}function Rt(t,e){if(t.length>e)return t.length=e,!0}function Kn(t){return new this(t).abs()}function Fn(t){return new this(t).acos()}function Vn(t){return new this(t).acosh()}function Un(t,e){return new this(t).plus(e)}function Wn(t){return new this(t).asin()}function qn(t){return new this(t).asinh()}function Gn(t){return new this(t).atan()}function jn(t){return new this(t).atanh()}function Hn(t,e){t=new this(t),e=new this(e);var n,r=this.precision,i=this.rounding,o=r+4;return!t.s||!e.s?n=new this(NaN):!t.d&&!e.d?(n=Q(this,o,1).times(e.s>0?.25:.75),n.s=t.s):!e.d||t.isZero()?(n=e.s<0?Q(this,r,i):new this(0),n.s=t.s):!t.d||e.isZero()?(n=Q(this,o,1).times(.5),n.s=t.s):e.s<0?(this.precision=o,this.rounding=1,n=this.atan(_(t,e,o,1)),e=Q(this,o,1),this.precision=r,this.rounding=i,n=t.s<0?n.minus(e):n.plus(e)):n=this.atan(_(t,e,o,1)),n}function Zn(t){return new this(t).cbrt()}function zn(t){return P(t=new this(t),t.e+1,2)}function Qn(t,e,n){return new this(t).clamp(e,n)}function Jn(t){if(!t||typeof t!="object")throw Error(_e+"Object expected");var e,n,r,i=t.defaults===!0,o=["precision",1,se,"rounding",0,8,"toExpNeg",-fe,0,"toExpPos",0,fe,"maxE",0,fe,"minE",-fe,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(n=o[e],i&&(this[n]=it[n]),(r=t[n])!==void 0)if(G(r)===r&&r>=o[e+1]&&r<=o[e+2])this[n]=r;else throw Error(oe+n+": "+r);if(n="crypto",i&&(this[n]=it[n]),(r=t[n])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(Kt);else this[n]=!1;else throw Error(oe+n+": "+r);return this}function Xn(t){return new this(t).cos()}function Yn(t){return new this(t).cosh()}function Ht(t){var e,n,r;function i(o){var s,u,c,a=this;if(!(a instanceof i))return new i(o);if(a.constructor=i,vt(o)){a.s=o.s,I?!o.d||o.e>i.maxE?(a.e=NaN,a.d=null):o.e<i.minE?(a.e=0,a.d=[0]):(a.e=o.e,a.d=o.d.slice()):(a.e=o.e,a.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){a.s=1/o<0?-1:1,a.e=0,a.d=[0];return}if(o<0?(o=-o,a.s=-1):a.s=1,o===~~o&&o<1e7){for(s=0,u=o;u>=10;u/=10)s++;I?s>i.maxE?(a.e=NaN,a.d=null):s<i.minE?(a.e=0,a.d=[0]):(a.e=s,a.d=[o]):(a.e=s,a.d=[o]);return}else if(o*0!==0){o||(a.s=NaN),a.e=NaN,a.d=null;return}return at(a,o.toString())}else if(c!=="string")throw Error(oe+o);return(u=o.charCodeAt(0))===45?(o=o.slice(1),a.s=-1):(u===43&&(o=o.slice(1)),a.s=1),Vt.test(o)?at(a,o):On(a,o)}if(i.prototype=m,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Jn,i.clone=Ht,i.isDecimal=vt,i.abs=Kn,i.acos=Fn,i.acosh=Vn,i.add=Un,i.asin=Wn,i.asinh=qn,i.atan=Gn,i.atanh=jn,i.atan2=Hn,i.cbrt=Zn,i.ceil=zn,i.clamp=Qn,i.cos=Xn,i.cosh=Yn,i.div=$n,i.exp=er,i.floor=tr,i.hypot=nr,i.ln=rr,i.log=ir,i.log10=sr,i.log2=or,i.max=ar,i.min=ur,i.mod=cr,i.mul=lr,i.pow=fr,i.random=pr,i.round=mr,i.sign=dr,i.sin=gr,i.sinh=hr,i.sqrt=br,i.sub=yr,i.sum=wr,i.tan=Tr,i.tanh=xr,i.trunc=Pr,t===void 0&&(t={}),t&&t.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<r.length;)t.hasOwnProperty(n=r[e++])||(t[n]=this[n]);return i.config(t),i}function $n(t,e){return new this(t).div(e)}function er(t){return new this(t).exp()}function tr(t){return P(t=new this(t),t.e+1,3)}function nr(){var t,e,n=new this(0);for(I=!1,t=0;t<arguments.length;)if(e=new this(arguments[t++]),e.d)n.d&&(n=n.plus(e.times(e)));else{if(e.s)return I=!0,new this(1/0);n=e}return I=!0,n.sqrt()}function vt(t){return t instanceof Ve||t&&t.toStringTag===Ft||!1}function rr(t){return new this(t).ln()}function ir(t,e){return new this(t).log(e)}function or(t){return new this(t).log(2)}function sr(t){return new this(t).log(10)}function ar(){return qt(this,arguments,"lt")}function ur(){return qt(this,arguments,"gt")}function cr(t,e){return new this(t).mod(e)}function lr(t,e){return new this(t).mul(e)}function fr(t,e){return new this(t).pow(e)}function pr(t){var e,n,r,i,o=0,s=new this(1),u=[];if(t===void 0?t=this.precision:H(t,1,se),r=Math.ceil(t/A),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(r));o<r;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:u[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(r*=4);o<r;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(u.push(i%1e7),o+=4);o=r/4}else throw Error(Kt);else for(;o<r;)u[o++]=Math.random()*1e7|0;for(r=u[--o],t%=A,r&&t&&(i=U(10,A-t),u[o]=(r/i|0)*i);u[o]===0;o--)u.pop();if(o<0)n=0,u=[0];else{for(n=-1;u[0]===0;n-=A)u.shift();for(r=1,i=u[0];i>=10;i/=10)r++;r<A&&(n-=A-r)}return s.e=n,s.d=u,s}function mr(t){return P(t=new this(t),t.e+1,this.rounding)}function dr(t){return t=new this(t),t.d?t.d[0]?t.s:0*t.s:t.s||NaN}function gr(t){return new this(t).sin()}function hr(t){return new this(t).sinh()}function br(t){return new this(t).sqrt()}function yr(t,e){return new this(t).sub(e)}function wr(){var t=0,e=arguments,n=new this(e[t]);for(I=!1;n.s&&++t<e.length;)n=n.plus(e[t]);return I=!0,P(n,this.precision,this.rounding)}function Tr(t){return new this(t).tan()}function xr(t){return new this(t).tanh()}function Pr(t){return P(t=new this(t),t.e+1,1)}m[Symbol.for("nodejs.util.inspect.custom")]=m.toString;m[Symbol.toStringTag]="Decimal";var Ve=m.constructor=Ht(it);Re=new Ve(Re);ve=new Ve(ve);import{PublicKey as Ar}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Zt}from"@solana/spl-token";var zt={chainId:101,address:Ar.default.toBase58(),programId:Zt.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ae={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Zt.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as ct}from"@solana/web3.js";var lt=class{symbol;name;decimals;isToken2022;mint;constructor({mint:e,decimals:n,symbol:r,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===be.toBase58()||e instanceof ct&&be.equals(e)){this.decimals=ae.decimals,this.symbol=ae.symbol,this.name=ae.name,this.mint=new ct(ae.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?ct.default:Nt({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},ue=lt;Ee(ue,"WSOL",new lt({...ae,mint:ae.address}));var ft=class{symbol;name;decimals;constructor({decimals:e,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=n,this.name=r}equals(e){return this===e}},Ue=ft;Ee(Ue,"SOL",new ft(zt));import qe from"big.js";import Lr from"bn.js";import Nr from"decimal.js-light";import{get as Qt,set as kr}from"lodash";var pt=class{logLevel;name;constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let n=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Jt={},Sr={};function j(t){let e=Qt(Jt,t);if(!e){let n=Qt(Sr,t);e=new pt({name:t,logLevel:n}),kr(Jt,t,e)}return e}import we from"bn.js";var Xt=9007199254740991;function Z(t){let e=j("Raydium_parseBigNumberish");if(t instanceof we)return t;if(typeof t=="string"){if(t.match(/^-?[0-9]+$/))return new we(t);e.logWithError(`invalid BigNumberish string: ${t}`)}return typeof t=="number"?(t%1&&e.logWithError(`BigNumberish number underflow: ${t}`),(t>=Xt||t<=-Xt)&&e.logWithError(`BigNumberish number overflow: ${t}`),new we(String(t))):typeof t=="bigint"?new we(t.toString()):(e.error(`invalid BigNumberish value: ${t}`),new we(0))}import Ir from"toformat";var Cr=Ir,Te=Cr;var We=j("module/fraction"),mt=Te(qe),xe=Te(Nr),Mr={[0]:xe.ROUND_DOWN,[1]:xe.ROUND_HALF_UP,[2]:xe.ROUND_UP},Er={[0]:qe.roundDown,[1]:qe.roundHalfUp,[2]:qe.roundUp},O=class{numerator;denominator;constructor(e,n=new Lr(1)){this.numerator=Z(e),this.denominator=Z(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new O(this.denominator,this.numerator)}add(e){let n=e instanceof O?e:new O(Z(e));return this.denominator.eq(n.denominator)?new O(this.numerator.add(n.numerator),this.denominator):new O(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(e){let n=e instanceof O?e:new O(Z(e));return this.denominator.eq(n.denominator)?new O(this.numerator.sub(n.numerator),this.denominator):new O(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(e){let n=e instanceof O?e:new O(Z(e));return new O(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(e){let n=e instanceof O?e:new O(Z(e));return new O(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(e,n={groupSeparator:""},r=1){Number.isInteger(e)||We.logWithError(`${e} is not an integer.`),e<=0&&We.logWithError(`${e} is not positive.`),xe.set({precision:e+1,rounding:Mr[r]});let i=new xe(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),n)}toFixed(e,n={groupSeparator:""},r=1){return Number.isInteger(e)||We.logWithError(`${e} is not an integer.`),e<0&&We.logWithError(`${e} is negative.`),mt.DP=e,mt.RM=Er[r]||1,new mt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,n)}isZero(){return this.numerator.isZero()}};import Dr from"bn.js";var Yt=new O(new Dr(100)),me=class extends O{toSignificant(e=5,n,r){return this.mul(Yt).toSignificant(e,n,r)}toFixed(e=2,n,r){return this.mul(Yt).toFixed(e,n,r)}};var Rr=j("Raydium_price"),ee=class extends O{baseToken;quoteToken;scalar;constructor(e){let{baseToken:n,quoteToken:r,numerator:i,denominator:o}=e;super(i,o),this.baseToken=n,this.quoteToken=r,this.scalar=new O(dt(n.decimals),dt(r.decimals))}get raw(){return new O(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new ee({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&Rr.logWithError("mul token not equals");let n=super.mul(e);return new ee({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(e=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(e,n,r)}toFixed(e=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(e,n,r)}};var vr=new ne(0),Zo=new ne(1),zo=new ne(2),Qo=new ne(3),Jo=new ne(5),gt=new ne(10),Xo=new ne(100),Yo=new ne(1e3),$o=new ne(1e4);function dt(t){return gt.pow(Z(t))}import{PublicKey as Or}from"@solana/web3.js";import{MINT_SIZE as ls,TOKEN_PROGRAM_ID as fs,getTransferFeeConfig as ps,unpackMint as ms}from"@solana/spl-token";var ht=j("Raydium_accountInfo_util");async function en(t,e,n){let{batchRequest:r,commitment:i="confirmed",chunkCount:o=100}={batchRequest:!1,...n},s=bt(e,o),u=new Array(s.length).fill([]);if(r){let c=s.map(f=>{let p=t._buildArgs([f.map(d=>d.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:p}}),a=bt(c,10);u=(await(await Promise.all(a.map(async f=>await t._rpcBatchRequest(f)))).flat()).map(f=>(f.error&&ht.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.error.message}`),f.result.value.map(p=>{if(p){let{data:d,executable:g,lamports:b,owner:y,rentEpoch:T}=p;return d.length!==2&&d[1]!=="base64"&&ht.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:g,lamports:b,owner:new Or(y),rentEpoch:T}}return null})))}else try{u=await Promise.all(s.map(c=>t.getMultipleAccountsInfo(c,i)))}catch(c){c instanceof Error&&ht.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return u.flat()}function bt(t,e=1,n=[]){let r=[...t];if(e<=0)return n;for(;r.length;)n.push(r.splice(0,e));return n}import{PublicKey as Es}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Rs}from"@solana/spl-token";import{ComputeBudgetProgram as tn,Keypair as rn,PublicKey as As,Transaction as on,TransactionMessage as _r,VersionedTransaction as sn}from"@solana/web3.js";var Pe={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip",NonceAccount:"NonceAccount"};import{TOKEN_PROGRAM_ID as Kr}from"@solana/spl-token";var nn=j("Raydium_txUtil"),an=1644;function Ge(t){let e=[],n=[];return t.microLamports&&(e.push(tn.setComputeUnitPrice({microLamports:t.microLamports})),n.push(Pe.SetComputeUnitPrice)),t.units&&(e.push(tn.setComputeUnitLimit({units:t.units})),n.push(Pe.SetComputeUnitLimit)),{instructions:e,instructionTypes:n}}async function de(t,e){let n=e??"confirmed";return(await t.getLatestBlockhash?.({commitment:n}))?.blockhash}async function je(t,e){return t.getSignatureStatuses([e]),new Promise((n,r)=>{let i=setTimeout(r,6e4);t.onSignature(e,o=>{if(clearTimeout(i),!o.err){n("");return}r(Object.assign(o.err,{txId:e}))},"confirmed")})}function Fr(t,e){t.length<1&&nn.logWithError(`no instructions provided: ${t.toString()}`),e.length<1&&nn.logWithError(`no signers provided:, ${e.toString()}`);let n=new on;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=e[0],n.add(...t);try{return Buffer.from(n.serialize({verifySignatures:!1})).toString("base64").length<an}catch{return!1}}function Ae({instructions:t,payer:e,signers:n}){return Fr(t,[e,...n])}function ke({instructions:t,payer:e,lookupTableAddressAccount:n,recentBlockhash:r=rn.generate().publicKey.toString()}){let o=new _r({payerKey:e,recentBlockhash:r,instructions:t}).compileToV0Message(Object.values(n??{}));try{return Buffer.from(new sn(o).serialize()).toString("base64").length<an}catch{return!1}}var Vr=t=>Buffer.isBuffer(t)?t:t instanceof Uint8Array?Buffer.from(t.buffer,t.byteOffset,t.byteLength):Buffer.from(t),Ur=t=>{let e=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof sn&&(e=Vr(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ce(t){let e=[];return t.forEach(n=>{n instanceof on&&(n.recentBlockhash||(n.recentBlockhash=Kr.toBase58()),n.feePayer||(n.feePayer=rn.generate().publicKey)),e.push(Ur(n))}),console.log("simulate tx string:",e),e}import Ks from"bn.js";import{PublicKey as un,AddressLookupTableAccount as He}from"@solana/web3.js";async function yt({connection:t,address:e}){let n=await en(t,[...new Set(e.map(i=>i.toString()))].map(i=>new un(i))),r={};for(let i=0;i<e.length;i++){let o=n[i],s=e[i];if(!o)continue;let u=new He({key:s,state:He.deserialize(o.data)});r[s.toString()]=u,Ze[s.toString()]=u}return r}var Ze={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new He({key:new un("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:He.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as ge,sendAndConfirmTransaction as wt,SystemProgram as Wr,Transaction as Se,TransactionMessage as Ie,VersionedTransaction as Ce}from"@solana/web3.js";import qr from"axios";var ze=2e3,Qe=class{connection;owner;instructions=[];endInstructions=[];lookupTableAddress=[];signers=[];instructionTypes=[];endInstructionTypes=[];feePayer;cluster;signAllTransactions;blockhashCommitment;loopMultiTxStatus;constructor(e){this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){let e=(await qr.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:n}=e?.[15]??{};if(!!n)return{units:6e5,microLamports:Math.min(Math.ceil(n*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:n,instructionTypes:r}=Ge(e);return this.instructions.unshift(...n),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){return e?(this.endInstructions.push(Wr.transfer({fromPubkey:e.feePayer??this.feePayer,toPubkey:new ge(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(Pe.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:n}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;n&&this.instructions.unshift(...n)}catch{n&&this.instructions.unshift(...n)}}addInstruction({instructions:e=[],endInstructions:n=[],signers:r=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...n),this.signers.push(...r),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(u=>u!==ge.default.toString())),this}async versionBuild({txVersion:e,extInfo:n},r){return e===0?await this.buildV0({...n||{}},r):this.build(n,r)}build(e,n){let r=new Se;return this.allInstructions.length&&r.add(...this.allInstructions),r.feePayer=this.feePayer,this.owner?.signer&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:r,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:u,notSendToRpc:c}=i||{},a=o??n??await de(this.connection,this.blockhashCommitment);if(r.recentBlockhash=a,this.signers.length&&r.sign(...this.signers),ce([r]),this.owner?.isKeyPair)return{txId:u?await wt(this.connection,r,this.signers.find(f=>f.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(r.serialize(),{skipPreflight:s}),signedTx:r};if(this.signAllTransactions){let l=await this.signAllTransactions([r]);if(this.signers.length)for(let f of l)try{f.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:n=[],extInfo:r}=e,{transaction:i}=this.build(r),o=n.filter(a=>a.transaction.instructions.length>0),s=[i,...o.map(a=>a.transaction)],u=[this.signers,...o.map(a=>a.signers)],c=[...this.instructionTypes,...o.map(a=>a.instructionTypes).flat()];return this.owner?.signer&&u.forEach(a=>{a.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:u,instructionTypes:c,execute:async a=>{let{sequentially:l,onTxUpdate:f,skipTxCount:p=0,recentBlockHash:d,skipPreflight:g=!0}=a||{},b=d??await de(this.connection,this.blockhashCommitment);if(this.owner?.isKeyPair){if(l){let y=[],T=0;for(let w of s){if(++T,T<=p)continue;let h=await wt(this.connection,w,this.signers.find(x=>x.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});y.push(h)}return{txIds:y,signedTxs:s}}return{txIds:await await Promise.all(s.map(async y=>(y.recentBlockhash=b,await this.connection.sendRawTransaction(y.serialize(),{skipPreflight:g})))),signedTxs:s}}if(this.signAllTransactions){let y=s.map((w,h)=>(w.recentBlockhash=b,u[h].length&&w.sign(...u[h]),w));ce(y);let T=await this.signAllTransactions(y);if(l){let w=0,h=[],x=async()=>{if(!T[w])return;let k=await this.connection.sendRawTransaction(T[w].serialize(),{skipPreflight:g});h.push({txId:k,status:"sent",signedTx:T[w]}),f?.([...h]),w++;let C=!1,B=null,D=null,E=R=>{B!==null&&clearInterval(B),D!==null&&this.connection.removeSignatureListener(D);let L=h.findIndex(V=>V.txId===k);if(L>-1){if(h[L].status==="error"||h[L].status==="success")return;h[L].status=R.err?"error":"success"}f?.([...h]),R.err||x()};this.loopMultiTxStatus&&(B=setInterval(async()=>{if(C){clearInterval(B);return}try{let R=await this.connection.getTransaction(k,{commitment:"confirmed",maxSupportedTransactionVersion:0});R&&(C=!0,clearInterval(B),E({err:R.meta?.err||null}),console.log("tx status from getTransaction:",k))}catch(R){C=!0,clearInterval(B),console.error("getTransaction timeout:",R,k)}},ze)),D=this.connection.onSignature(k,R=>{if(C){this.connection.removeSignatureListener(D);return}C=!0,E(R)},"confirmed"),this.connection.getSignatureStatus(k)};return await x(),{txIds:h.map(k=>k.txId),signedTxs:T}}else{let w=[];for(let h=0;h<T.length;h+=1){let x=await this.connection.sendRawTransaction(T[h].serialize(),{skipPreflight:g});w.push(x)}return{txIds:w,signedTxs:T}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:n,extInfo:r}){return n===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e,n){let{lookupTableCache:r={},lookupTableAddress:i=[],forerunCreate:o,recentBlockhash:s,...u}=e||{},c={...this.cluster==="devnet"?{}:Ze,...r},a=Array.from(new Set([...i,...this.lookupTableAddress])),l=[];for(let g of a)c[g]===void 0&&l.push(new ge(g));if(l.length>0){let g=await yt({connection:this.connection,address:l});for(let[b,y]of Object.entries(g))c[b]=y}let f=n??(o?ge.default.toBase58():s??await de(this.connection,this.blockhashCommitment)),p=new Ie({payerKey:this.feePayer,recentBlockhash:f,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(c));this.owner?.signer&&!this.signers.some(g=>g.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let d=new Ce(p);return d.sign(this.signers),{builder:this,transaction:d,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async g=>{let{skipPreflight:b=!0,sendAndConfirm:y,notSendToRpc:T}=g||{};if(ce([d]),this.owner?.isKeyPair){let w=await this.connection.sendTransaction(d,{skipPreflight:b});return y&&await je(this.connection,w),{txId:w,signedTx:d}}if(this.signAllTransactions){let w=await this.signAllTransactions([d]);if(this.signers.length)for(let h of w)try{h.sign(this.signers)}catch{}return{txId:T?"":await this.connection.sendTransaction(w[0],{skipPreflight:b}),signedTx:w[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:u||{}}}async buildV0MultiTx(e){let{extraPreBuildData:n=[],buildProps:r}=e,{transaction:i}=await this.buildV0(r),o=n.filter(a=>a.builder.instructions.length>0),s=[i,...o.map(a=>a.transaction)],u=[this.signers,...o.map(a=>a.signers)],c=[...this.instructionTypes,...o.map(a=>a.instructionTypes).flat()];return this.owner?.signer&&u.forEach(a=>{a.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(a,l)=>{a.sign(u[l])}),{builder:this,transactions:s,signers:u,instructionTypes:c,buildProps:r,execute:async a=>{let{sequentially:l,onTxUpdate:f,recentBlockHash:p,skipPreflight:d=!0}=a||{};if(p&&s.forEach(g=>g.message.recentBlockhash=p),ce(s),this.owner?.isKeyPair){if(l){let g=[];for(let b of s){let y=await this.connection.sendTransaction(b,{skipPreflight:d});await je(this.connection,y),g.push(y)}return{txIds:g,signedTxs:s}}return{txIds:await Promise.all(s.map(async g=>await this.connection.sendTransaction(g,{skipPreflight:d}))),signedTxs:s}}if(this.signAllTransactions){let g=await this.signAllTransactions(s);if(l){let b=0,y=[],T=async()=>{if(!g[b])return;let w=await this.connection.sendTransaction(g[b],{skipPreflight:d});y.push({txId:w,status:"sent",signedTx:g[b]}),f?.([...y]),b++;let h=!1,x=null,k=null,C=B=>{x!==null&&clearInterval(x),k!==null&&this.connection.removeSignatureListener(k);let D=y.findIndex(E=>E.txId===w);if(D>-1){if(y[D].status==="error"||y[D].status==="success")return;y[D].status=B.err?"error":"success"}f?.([...y]),B.err||T()};this.loopMultiTxStatus&&(x=setInterval(async()=>{if(h){clearInterval(x);return}try{let B=await this.connection.getTransaction(w,{commitment:"confirmed",maxSupportedTransactionVersion:0});B&&(h=!0,clearInterval(x),C({err:B.meta?.err||null}),console.log("tx status from getTransaction:",w))}catch(B){h=!0,clearInterval(x),console.error("getTransaction timeout:",B,w)}},ze)),k=this.connection.onSignature(w,B=>{if(h){this.connection.removeSignatureListener(k);return}h=!0,C(B)},"confirmed"),this.connection.getSignatureStatus(w)};return T(),{txIds:[],signedTxs:g}}else{let b=[];for(let y=0;y<g.length;y+=1){let T=await this.connection.sendTransaction(g[y],{skipPreflight:d});b.push(T)}return{txIds:b,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){let{splitIns:n=[],computeBudgetConfig:r,...i}=e||{},o=r?Ge(r):{instructions:[],instructionTypes:[]},s=this.signers.reduce((f,p)=>({...f,[p.publicKey.toBase58()]:p}),{}),u=[],c=[],a=[],l=0;if(this.allInstructions.forEach(f=>{let p=[...a,f],d=r?[...o.instructions,...p]:p,b=[...new Set(p.map(y=>y.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(y=>new ge(y));if(f!==n[l]&&a.length<12&&(Ae({instructions:d,payer:this.feePayer,signers:b})||Ae({instructions:p,payer:this.feePayer,signers:b})))a.push(f);else{if(a.length===0)throw Error("item ins too big");l+=f===n[l]?1:0,Ae({instructions:r?[...o.instructions,...a]:[...a],payer:this.feePayer,signers:b})?u.push(new Se().add(...o.instructions,...a)):u.push(new Se().add(...a)),c.push(Array.from(new Set(a.map(y=>y.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat())).map(y=>s[y]).filter(y=>y!==void 0)),a=[f]}}),a.length>0){let p=[...new Set(a.map(d=>d.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(d=>s[d]).filter(d=>d!==void 0);Ae({instructions:r?[...o.instructions,...a]:[...a],payer:this.feePayer,signers:p.map(d=>d.publicKey)})?u.push(new Se().add(...o.instructions,...a)):u.push(new Se().add(...a)),c.push(p)}return u.forEach(f=>f.feePayer=this.feePayer),this.owner?.signer&&c.forEach(f=>{f.some(p=>p.publicKey.equals(this.owner.publicKey))||f.push(this.owner.signer)}),{builder:this,transactions:u,signers:c,instructionTypes:this.instructionTypes,execute:async f=>{let{sequentially:p,onTxUpdate:d,skipTxCount:g=0,recentBlockHash:b,skipPreflight:y=!0}=f||{},T=b??await de(this.connection,this.blockhashCommitment);if(u.forEach(async(w,h)=>{w.recentBlockhash=T,c[h].length&&w.sign(...c[h])}),ce(u),this.owner?.isKeyPair){if(p){let w=0,h=[];for(let x of u){if(++w,w<=g){h.push("tx skipped");continue}let k=await wt(this.connection,x,this.signers.find(C=>C.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});h.push(k)}return{txIds:h,signedTxs:u}}return{txIds:await Promise.all(u.map(async w=>await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:y}))),signedTxs:u}}if(this.signAllTransactions){let w=await this.signAllTransactions(u.slice(g,u.length)),h=[...u.slice(0,g),...w];if(p){let x=0,k=[],C=async()=>{if(!h[x])return;x<g&&(k.push({txId:"",status:"success",signedTx:h[x]}),d?.([...k]),x++,C());let B=await this.connection.sendRawTransaction(h[x].serialize(),{skipPreflight:y});k.push({txId:B,status:"sent",signedTx:h[x]}),d?.([...k]),x++;let D=!1,E=null,R=null,L=V=>{E!==null&&clearInterval(E),R!==null&&this.connection.removeSignatureListener(R);let W=k.findIndex(z=>z.txId===B);if(W>-1){if(k[W].status==="error"||k[W].status==="success")return;k[W].status=V.err?"error":"success"}d?.([...k]),V.err||C()};this.loopMultiTxStatus&&(E=setInterval(async()=>{if(D){clearInterval(E);return}try{let V=await this.connection.getTransaction(B,{commitment:"confirmed",maxSupportedTransactionVersion:0});V&&(D=!0,clearInterval(E),L({err:V.meta?.err||null}),console.log("tx status from getTransaction:",B))}catch(V){D=!0,clearInterval(E),console.error("getTransaction timeout:",V,B)}},ze)),R=this.connection.onSignature(B,V=>{if(D){this.connection.removeSignatureListener(R);return}D=!0,L(V)},"confirmed"),this.connection.getSignatureStatus(B)};return await C(),{txIds:k.map(B=>B.txId),signedTxs:h}}else{let x=[];for(let k=0;k<h.length;k+=1){let C=await this.connection.sendRawTransaction(h[k].serialize(),{skipPreflight:y});x.push(C)}return{txIds:x,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(e){let{computeBudgetConfig:n,splitIns:r=[],lookupTableCache:i={},lookupTableAddress:o=[],...s}=e||{},u={...this.cluster==="devnet"?{}:Ze,...i},c=Array.from(new Set([...this.lookupTableAddress,...o])),a=[];for(let w of c)u[w]===void 0&&a.push(new ge(w));let l=await yt({connection:this.connection,address:a});for(let[w,h]of Object.entries(l))u[w]=h;let f=n?Ge(n):{instructions:[],instructionTypes:[]},p=await de(this.connection,this.blockhashCommitment),d=this.signers.reduce((w,h)=>({...w,[h.publicKey.toBase58()]:h}),{}),g=[],b=[],y=[],T=0;if(this.allInstructions.forEach(w=>{let h=[...y,w],x=n?[...f.instructions,...h]:h;if(w!==r[T]&&y.length<12&&(ke({instructions:x,payer:this.feePayer,lookupTableAddressAccount:u})||ke({instructions:h,payer:this.feePayer,lookupTableAddressAccount:u})))y.push(w);else{if(y.length===0)throw Error("item ins too big");T+=w===r[T]?1:0;let k={};for(let C of[...new Set(c)])u[C]!==void 0&&(k[C]=u[C]);if(n&&ke({instructions:[...f.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:u,recentBlockhash:p})){let C=new Ie({payerKey:this.feePayer,recentBlockhash:p,instructions:[...f.instructions,...y]}).compileToV0Message(Object.values(u));g.push(new Ce(C))}else{let C=new Ie({payerKey:this.feePayer,recentBlockhash:p,instructions:[...y]}).compileToV0Message(Object.values(u));g.push(new Ce(C))}b.push(Array.from(new Set(y.map(C=>C.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(C=>d[C]).filter(C=>C!==void 0)),y=[w]}}),y.length>0){let h=[...new Set(y.map(x=>x.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(x=>d[x]).filter(x=>x!==void 0);if(n&&ke({instructions:[...f.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:u,recentBlockhash:p})){let x=new Ie({payerKey:this.feePayer,recentBlockhash:p,instructions:[...f.instructions,...y]}).compileToV0Message(Object.values(u));g.push(new Ce(x))}else{let x=new Ie({payerKey:this.feePayer,recentBlockhash:p,instructions:[...y]}).compileToV0Message(Object.values(u));g.push(new Ce(x))}b.push(h)}return this.owner?.signer&&b.forEach(w=>{w.some(h=>h.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),g.forEach((w,h)=>{w.sign(b[h])}),{builder:this,transactions:g,buildProps:e,signers:b,instructionTypes:this.instructionTypes,execute:async w=>{let{sequentially:h,onTxUpdate:x,skipTxCount:k=0,recentBlockHash:C,skipPreflight:B=!0}=w||{};if(g.map(async(D,E)=>{b[E].length&&D.sign(b[E]),C&&(D.message.recentBlockhash=C)}),ce(g),this.owner?.isKeyPair){if(h){let D=0,E=[];for(let R of g){if(++D,D<=k){console.log("skip tx: ",D),E.push("tx skipped");continue}let L=await this.connection.sendTransaction(R,{skipPreflight:B});await je(this.connection,L),E.push(L)}return{txIds:E,signedTxs:g}}return{txIds:await Promise.all(g.map(async D=>await this.connection.sendTransaction(D,{skipPreflight:B}))),signedTxs:g}}if(this.signAllTransactions){let D=await this.signAllTransactions(g.slice(k,g.length)),E=[...g.slice(0,k),...D];if(h){let R=0,L=[],V=async()=>{if(!E[R])return;if(R<k){L.push({txId:"",status:"success",signedTx:E[R]}),x?.([...L]),R++,V();return}let W=await this.connection.sendTransaction(E[R],{skipPreflight:B});L.push({txId:W,status:"sent",signedTx:E[R]}),x?.([...L]),R++;let z=!1,F=null,v=null,Bt=Y=>{F!==null&&clearInterval(F),v!==null&&this.connection.removeSignatureListener(v);let Me=L.findIndex(dn=>dn.txId===W);if(Me>-1){if(L[Me].status==="error"||L[Me].status==="success")return;L[Me].status=Y.err?"error":"success"}x?.([...L]),Y.err||V()};this.loopMultiTxStatus&&(F=setInterval(async()=>{if(z){clearInterval(F);return}try{let Y=await this.connection.getTransaction(W,{commitment:"confirmed",maxSupportedTransactionVersion:0});Y&&(z=!0,clearInterval(F),Bt({err:Y.meta?.err||null}),console.log("tx status from getTransaction:",W))}catch(Y){z=!0,clearInterval(F),console.error("getTransaction timeout:",Y,W)}},ze)),v=this.connection.onSignature(W,Y=>{if(z){this.connection.removeSignatureListener(v);return}z=!0,Bt(Y)},"confirmed"),this.connection.getSignatureStatus(W)};return V(),{txIds:[],signedTxs:E}}else{let R=[];for(let L=0;L<E.length;L+=1){let V=await this.connection.sendTransaction(E[L],{skipPreflight:B});R.push(V)}return{txIds:R,signedTxs:E}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};import Gr from"bn.js";var ia=new Gr(1e6);var Hr=j("Raydium_amount"),cn=Te(jr);function Zr(t,e){let n="0",r="0";if(t.includes(".")){let i=t.split(".");i.length===2?([n,r]=i,r=r.padEnd(e,"0")):Hr.logWithError(`invalid number string, num: ${t}`)}else n=t;return[n,r.slice(0,e)||r]}var te=class extends O{token;logger;constructor(e,n,r=!0,i){let o=new Je(0),s=gt.pow(new Je(e.decimals));if(r)o=Z(n);else{let u=new Je(0),c=new Je(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[a,l]=Zr(n.toString(),e.decimals);u=Z(a),c=Z(l)}u=u.mul(s),o=u.add(c)}super(o,s),this.logger=j(i||"TokenAmount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new te(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new te(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,n,r=0){return super.toSignificant(e,n,r)}toFixed(e=this.token.decimals,n,r=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,n,r)}toExact(e={groupSeparator:""}){return cn.DP=this.token.decimals,new cn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};function $t(t){return typeof t=="object"&&t!==null&&![ue,te,zr,O,Qr,ee,me].some(e=>typeof e=="object"&&t instanceof e)}function Xe(t){return typeof t=="string"?tt(t):Array.isArray(t)?t.map(e=>Xe(e)):$t(t)?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,Xe(n)])):t}var Tt=(...t)=>t.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Be=class{scope;disabled=!1;logger;constructor({scope:e,moduleName:n}){this.scope=e,this.logger=j(n)}createTxBuilder(e){return this.scope.checkOwner(),new Qe({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Tt(e))}logInfo(...e){this.logger.info(Tt(e))}logAndCreateError(...e){let n=Tt(e);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{SYSVAR_CLOCK_PUBKEY as $r,TransactionInstruction as St}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as It}from"@solana/spl-token";import{PublicKey as tc}from"@solana/web3.js";import rc,{isBN as ic}from"bn.js";import{bits as eu,BitStructure as tu,blob as nu,Blob as ru,cstr as iu,f32 as ou,f32be as su,f64 as au,f64be as uu,greedy as cu,Layout as lu,ns64 as fu,ns64be as pu,nu64 as Jr,nu64be as mu,offset as du,s16 as gu,s16be as hu,s24 as bu,s24be as yu,s32 as wu,s32be as Tu,s40 as xu,s40be as Pu,s48 as Au,s48be as ku,s8 as Su,seq as Iu,struct as Cu,Structure as Xr,u16 as Bu,u16be as Lu,u24 as Nu,u24be as Mu,u32 as Eu,u32be as Du,u40 as Ru,u40be as vu,u48 as Ou,u48be as _u,u8 as Ku,UInt as Yr,union as Fu,Union as Vu,unionLayoutDiscriminator as Uu,utf8 as Wu}from"@solana/buffer-layout";var ln=Xr;var fn=Yr;var pn=Jr;function Pt(t){return new fn(1,t)}var xt=class extends ln{decode(e,n){return super.decode(e,n)}};function At(t,e,n){return new xt(t,e,n)}var kt=At([Pt("instruction"),pn("amount")]),Le=At([Pt("instruction")]);function gc({programId:t,amount:e,instructionKeys:n}){let r=[{pubkey:Et,isSigner:!1,isWritable:!1},{pubkey:It,isSigner:!1,isWritable:!1},{pubkey:Mt,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},...Object.entries(n).map(([o,s])=>({pubkey:s,isSigner:o==="userOwner",isWritable:!["authority","userOwner","userIdoCheck","userStakeInfo"].includes(o)}))],i=Buffer.alloc(kt.span);return kt.encode({instruction:1,amount:Number(e)},i),new St({keys:r,programId:t,data:i})}function Ye({programId:t},e){let n=[{pubkey:It,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},...Object.entries(e).map(([i,o])=>({pubkey:o,isSigner:i==="userOwner",isWritable:!["authority","userOwner"].includes(i)}))],r=Buffer.alloc(Le.span);return Le.encode({instruction:2},r),new St({keys:n,programId:t,data:r})}function Ct(t){let{poolConfig:e,userKeys:n,side:r}=t,i=r==="base"?n.baseTokenAccount:n.quoteTokenAccount,o=r==="base"?e.baseVault:e.quoteVault,s=Buffer.alloc(Le.span);Le.encode({instruction:2},s);let u=[{pubkey:It,isWritable:!1,isSigner:!1},{pubkey:$r,isWritable:!1,isSigner:!1},{pubkey:e.id,isWritable:!0,isSigner:!1},{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:o,isWritable:!0,isSigner:!1},{pubkey:i,isWritable:!0,isSigner:!1},{pubkey:n.ledgerAccount,isWritable:!0,isSigner:!1},{pubkey:n.owner,isWritable:!1,isSigner:!0}];return new St({programId:e.programId,keys:u,data:s})}var ei={[he.IDO_PROGRAM_ID_V1.toString()]:1,[he.IDO_PROGRAM_ID_V2.toString()]:2,[he.IDO_PROGRAM_ID_V3.toString()]:3,[he.IDO_PROGRAM_ID_V4.toString()]:4},$e=class extends Be{async claim({ownerInfo:e,idoKeys:n,associatedOnly:r=!0,checkCreateATAOwner:i=!1,txVersion:o,feePayer:s}){let u=this.createTxBuilder(s),c=ei[n.programId];c||this.logAndCreateError("invalid version",c);let a=Xe(n),[l,f]=[!new mn(e.coin).isZero(),!new mn(e.pc).isZero()],p=a.projectInfo.mint.address.equals(le),{account:d,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:a.projectInfo.mint.programId,mint:a.projectInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!p,notUseTokenAccount:p,associatedOnly:p?!1:r,checkCreateATAOwner:i});!d&&l&&this.logAndCreateError("target token accounts not found","mint",n.projectInfo.mint.address),l&&g&&u.addInstruction(g);let b=a.buyInfo.mint.address.equals(le),{account:y,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:a.buyInfo.mint.programId,mint:a.buyInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!b,notUseTokenAccount:b,associatedOnly:b?!1:r,checkCreateATAOwner:i});if(!d&&f&&this.logAndCreateError("target token accounts not found","mint",n.projectInfo.mint.address),f&&T&&u.addInstruction(T),(!d||!y)&&this.logAndCreateError("target token accounts not found","mint",n.projectInfo.mint.address,n.buyInfo.mint.address),c===3)return u.addInstruction({instructions:[...l?[Ye({programId:a.programId},{idoId:a.id,authority:a.authority,poolTokenAccount:a.projectInfo.vault,userTokenAccount:d,userIdoInfo:new Ne(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[],...f?[Ye({programId:new Ne(n.programId)},{idoId:a.id,authority:a.authority,poolTokenAccount:a.buyInfo.vault,userTokenAccount:y,userIdoInfo:new Ne(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[]]}).versionBuild({txVersion:o});if(c<3)return!l&&!f&&this.logAndCreateError("no claimable rewards"),u.addInstruction({instructions:[Ye({programId:a.programId},{idoId:a.id,authority:a.authority,poolQuoteTokenAccount:a.buyInfo.vault,poolBaseTokenAccount:a.projectInfo.vault,userQuoteTokenAccount:y,userBaseTokenAccount:d,userIdoInfo:new Ne(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]}).versionBuild({txVersion:o});let w={poolConfig:{id:a.id,programId:a.programId,authority:a.authority,baseVault:a.projectInfo.vault,quoteVault:a.buyInfo.vault,baseToken:n.projectInfo.mint,quoteToken:n.buyInfo.mint},userKeys:{baseTokenAccount:d,quoteTokenAccount:y,ledgerAccount:new Ne(e.userIdoInfo),owner:this.scope.ownerPubKey}};return u.addInstruction({instructions:[...l?[Ct({...w,side:"base"})]:[],...f?[Ct({...w,side:"quote"})]:[]]}).versionBuild({txVersion:o})}};export{Le as claimLayout,$e as default,Ye as makeClaimInstruction,Ct as makeClaimInstructionV4,gc as makePurchaseInstruction,kt as purchaseLayout};
//# sourceMappingURL=index.mjs.map