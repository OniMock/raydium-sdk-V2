var Ji=Object.defineProperty;var $i=(n,e,t)=>e in n?Ji(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Ge=(n,e,t)=>($i(n,typeof e!="symbol"?e+"":e,t),t);import{get as Dn,set as er}from"lodash";var Jt=class{logLevel;name;constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(i=>typeof i=="object"?JSON.stringify(i):i).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Wn={},tr={};function ne(n){let e=Dn(Wn,n);if(!e){let t=Dn(tr,n);e=new Jt({name:n,logLevel:t}),er(Wn,n,e)}return e}import{PublicKey as je,sendAndConfirmTransaction as Pn,SystemProgram as Ro,Transaction as mt,TransactionMessage as dt,VersionedTransaction as pt}from"@solana/web3.js";import Mo from"axios";import{PublicKey as pi,AddressLookupTableAccount as Ot}from"@solana/web3.js";import{PublicKey as Lo}from"@solana/web3.js";import Ae from"bn.js";var Xe=9e15,Ne=1e9,$t="0123456789abcdef",ht="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Tt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",en={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Xe,maxE:Xe,crypto:!1},Un,Be,E=!0,xt="[DecimalError] ",Ke=xt+"Invalid argument: ",Gn=xt+"Precision limit exceeded",Xn=xt+"crypto unavailable",Hn="[object Decimal]",ie=Math.floor,$=Math.pow,nr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,ir=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,rr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,zn=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,me=1e7,R=7,or=9007199254740991,sr=ht.length-1,tn=Tt.length-1,P={toStringTag:Hn};P.absoluteValue=P.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),K(n)};P.ceil=function(){return K(new this.constructor(this),this.e+1,2)};P.clampedTo=P.clamp=function(n,e){var t,i=this,r=i.constructor;if(n=new r(n),e=new r(e),!n.s||!e.s)return new r(NaN);if(n.gt(e))throw Error(Ke+e);return t=i.cmp(n),t<0?n:i.cmp(e)>0?e:new r(i)};P.comparedTo=P.cmp=function(n){var e,t,i,r,o=this,s=o.d,a=(n=new o.constructor(n)).d,c=o.s,u=n.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==n.e)return o.e>n.e^c<0?1:-1;for(i=s.length,r=a.length,e=0,t=i<r?i:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return i===r?0:i>r^c<0?1:-1};P.cosine=P.cos=function(){var n,e,t=this,i=t.constructor;return t.d?t.d[0]?(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+R,i.rounding=1,t=ar(i,Jn(i,t)),i.precision=n,i.rounding=e,K(Be==2||Be==3?t.neg():t,n,e,!0)):new i(1):new i(NaN)};P.cubeRoot=P.cbrt=function(){var n,e,t,i,r,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(E=!1,o=l.s*$(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=ee(l.d),n=l.e,(o=(n-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=$(t,1/3),n=ie((n+1)/3)-(n%3==(n<0?-1:2)),o==1/0?t="5e"+n:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),i=new m(t),i.s=l.s):i=new m(o.toString()),s=(n=m.precision)+3;;)if(a=i,c=a.times(a).times(a),u=c.plus(l),i=z(u.plus(l).times(a),u.plus(c),s+2,1),ee(a.d).slice(0,s)===(t=ee(i.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(K(a,n+1,0),a.times(a).times(a).eq(l))){i=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(K(i,n+1,1),e=!i.times(i).times(i).eq(l));break}return E=!0,K(i,n,m.rounding,e)};P.decimalPlaces=P.dp=function(){var n,e=this.d,t=NaN;if(e){if(n=e.length-1,t=(n-ie(this.e/R))*R,n=e[n],n)for(;n%10==0;n/=10)t--;t<0&&(t=0)}return t};P.dividedBy=P.div=function(n){return z(this,new this.constructor(n))};P.dividedToIntegerBy=P.divToInt=function(n){var e=this,t=e.constructor;return K(z(e,new t(n),0,1,1),t.precision,t.rounding)};P.equals=P.eq=function(n){return this.cmp(n)===0};P.floor=function(){return K(new this.constructor(this),this.e+1,3)};P.greaterThan=P.gt=function(n){return this.cmp(n)>0};P.greaterThanOrEqualTo=P.gte=function(n){var e=this.cmp(n);return e==1||e===0};P.hyperbolicCosine=P.cosh=function(){var n,e,t,i,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,i=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(n=Math.ceil(r/3),e=(1/St(4,n)).toString()):(n=16,e="2.3283064365386962890625e-10"),o=He(s,1,o.times(e),new s(1),!0);for(var c,u=n,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return K(o,s.precision=t,s.rounding=i,!0)};P.hyperbolicSine=P.sinh=function(){var n,e,t,i,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,i=r.d.length,i<3)r=He(o,2,r,r,!0);else{n=1.4*Math.sqrt(i),n=n>16?16:n|0,r=r.times(1/St(5,n)),r=He(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);n--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,K(r,e,t,!0)};P.hyperbolicTangent=P.tanh=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+7,i.rounding=1,z(t.sinh(),t.cosh(),i.precision=n,i.rounding=e)):new i(t.s)};P.inverseCosine=P.acos=function(){var n,e=this,t=e.constructor,i=e.abs().cmp(1),r=t.precision,o=t.rounding;return i!==-1?i===0?e.isNeg()?le(t,r,o):new t(0):new t(NaN):e.isZero()?le(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),n=le(t,r+4,o).times(.5),t.precision=r,t.rounding=o,n.minus(e))};P.inverseHyperbolicCosine=P.acosh=function(){var n,e,t=this,i=t.constructor;return t.lte(1)?new i(t.eq(1)?0:NaN):t.isFinite()?(n=i.precision,e=i.rounding,i.precision=n+Math.max(Math.abs(t.e),t.sd())+4,i.rounding=1,E=!1,t=t.times(t).minus(1).sqrt().plus(t),E=!0,i.precision=n,i.rounding=e,t.ln()):new i(t)};P.inverseHyperbolicSine=P.asinh=function(){var n,e,t=this,i=t.constructor;return!t.isFinite()||t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+2*Math.max(Math.abs(t.e),t.sd())+6,i.rounding=1,E=!1,t=t.times(t).plus(1).sqrt().plus(t),E=!0,i.precision=n,i.rounding=e,t.ln())};P.inverseHyperbolicTangent=P.atanh=function(){var n,e,t,i,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(n=o.precision,e=o.rounding,i=r.sd(),Math.max(i,n)<2*-r.e-1?K(new o(r),n,e,!0):(o.precision=t=i-r.e,r=z(r.plus(1),new o(1).minus(r),t+n,1),o.precision=n+4,o.rounding=1,r=r.ln(),o.precision=n,o.rounding=e,r.times(.5))):new o(NaN)};P.inverseSine=P.asin=function(){var n,e,t,i,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,i=o.rounding,e!==-1?e===0?(n=le(o,t+4,i).times(.5),n.s=r.s,n):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=i,r.times(2)))};P.inverseTangent=P.atan=function(){var n,e,t,i,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=tn)return s=le(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=tn)return s=le(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/R+2|0),n=t;n;--n)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(E=!1,e=Math.ceil(a/R),i=1,c=u.times(u),s=new l(u),r=u;n!==-1;)if(r=r.times(c),o=s.minus(r.div(i+=2)),r=r.times(c),s=o.plus(r.div(i+=2)),s.d[e]!==void 0)for(n=e;s.d[n]===o.d[n]&&n--;);return t&&(s=s.times(2<<t-1)),E=!0,K(s,l.precision=m,l.rounding=d,!0)};P.isFinite=function(){return!!this.d};P.isInteger=P.isInt=function(){return!!this.d&&ie(this.e/R)>this.d.length-2};P.isNaN=function(){return!this.s};P.isNegative=P.isNeg=function(){return this.s<0};P.isPositive=P.isPos=function(){return this.s>0};P.isZero=function(){return!!this.d&&this.d[0]===0};P.lessThan=P.lt=function(n){return this.cmp(n)<0};P.lessThanOrEqualTo=P.lte=function(n){return this.cmp(n)<1};P.logarithm=P.log=function(n){var e,t,i,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,p=5;if(n==null)n=new l(10),e=!0;else{if(n=new l(n),t=n.d,n.s<0||!t||!t[0]||n.eq(1))return new l(NaN);e=n.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(E=!1,a=m+p,s=Ce(u,a),i=e?Bt(l,a+10):Ce(n,a),c=z(s,i,a,1),nt(c.d,r=m,d))do if(a+=10,s=Ce(u,a),i=e?Bt(l,a+10):Ce(n,a),c=z(s,i,a,1),!o){+ee(c.d).slice(r+1,r+15)+1==1e14&&(c=K(c,m+1,0));break}while(nt(c.d,r+=10,d));return E=!0,K(c,m,d)};P.minus=P.sub=function(n){var e,t,i,r,o,s,a,c,u,l,m,d,p=this,f=p.constructor;if(n=new f(n),!p.d||!n.d)return!p.s||!n.s?n=new f(NaN):p.d?n.s=-n.s:n=new f(n.d||p.s!==n.s?p:NaN),n;if(p.s!=n.s)return n.s=-n.s,p.plus(n);if(u=p.d,d=n.d,a=f.precision,c=f.rounding,!u[0]||!d[0]){if(d[0])n.s=-n.s;else if(u[0])n=new f(p);else return new f(c===3?-0:0);return E?K(n,a,c):n}if(t=ie(n.e/R),l=ie(p.e/R),u=u.slice(),o=l-t,o){for(m=o<0,m?(e=u,o=-o,s=d.length):(e=d,t=l,s=u.length),i=Math.max(Math.ceil(a/R),s)+2,o>i&&(o=i,e.length=1),e.reverse(),i=o;i--;)e.push(0);e.reverse()}else{for(i=u.length,s=d.length,m=i<s,m&&(s=i),i=0;i<s;i++)if(u[i]!=d[i]){m=u[i]<d[i];break}o=0}for(m&&(e=u,u=d,d=e,n.s=-n.s),s=u.length,i=d.length-s;i>0;--i)u[s++]=0;for(i=d.length;i>o;){if(u[--i]<d[i]){for(r=i;r&&u[--r]===0;)u[r]=me-1;--u[r],u[i]+=me}u[i]-=d[i]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(n.d=u,n.e=It(u,t),E?K(n,a,c):n):new f(c===3?-0:0)};P.modulo=P.mod=function(n){var e,t=this,i=t.constructor;return n=new i(n),!t.d||!n.s||n.d&&!n.d[0]?new i(NaN):!n.d||t.d&&!t.d[0]?K(new i(t),i.precision,i.rounding):(E=!1,i.modulo==9?(e=z(t,n.abs(),0,3,1),e.s*=n.s):e=z(t,n,0,i.modulo,1),e=e.times(n),E=!0,t.minus(e))};P.naturalExponential=P.exp=function(){return nn(this)};P.naturalLogarithm=P.ln=function(){return Ce(this)};P.negated=P.neg=function(){var n=new this.constructor(this);return n.s=-n.s,K(n)};P.plus=P.add=function(n){var e,t,i,r,o,s,a,c,u,l,m=this,d=m.constructor;if(n=new d(n),!m.d||!n.d)return!m.s||!n.s?n=new d(NaN):m.d||(n=new d(n.d||m.s===n.s?m:NaN)),n;if(m.s!=n.s)return n.s=-n.s,m.minus(n);if(u=m.d,l=n.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(n=new d(m)),E?K(n,a,c):n;if(o=ie(m.e/R),i=ie(n.e/R),u=u.slice(),r=o-i,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,i=o,s=u.length),o=Math.ceil(a/R),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/me|0,u[r]%=me;for(e&&(u.unshift(e),++i),s=u.length;u[--s]==0;)u.pop();return n.d=u,n.e=It(u,i),E?K(n,a,c):n};P.precision=P.sd=function(n){var e,t=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(Ke+n);return t.d?(e=Zn(t.d),n&&t.e+1>e&&(e=t.e+1)):e=NaN,e};P.round=function(){var n=this,e=n.constructor;return K(new e(n),n.e+1,e.rounding)};P.sine=P.sin=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+R,i.rounding=1,t=cr(i,Jn(i,t)),i.precision=n,i.rounding=e,K(Be>2?t.neg():t,n,e,!0)):new i(NaN)};P.squareRoot=P.sqrt=function(){var n,e,t,i,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(E=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=ee(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=ie((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),i=new l(e)):i=new l(u.toString()),t=(c=l.precision)+3;;)if(o=i,i=o.plus(z(s,o,t+2,1)).times(.5),ee(o.d).slice(0,t)===(e=ee(i.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(K(o,c+1,0),o.times(o).eq(s))){i=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(K(i,c+1,1),n=!i.times(i).eq(s));break}return E=!0,K(i,c,l.rounding,n)};P.tangent=P.tan=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+10,i.rounding=1,t=t.sin(),t.s=1,t=z(t,new i(1).minus(t.times(t)).sqrt(),n+10,0),i.precision=n,i.rounding=e,K(Be==2||Be==4?t.neg():t,n,e,!0)):new i(NaN)};P.times=P.mul=function(n){var e,t,i,r,o,s,a,c,u,l=this,m=l.constructor,d=l.d,p=(n=new m(n)).d;if(n.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!n.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?n.s/0:n.s*0);for(t=ie(l.e/R)+ie(n.e/R),c=d.length,u=p.length,c<u&&(o=d,d=p,p=o,s=c,c=u,u=s),o=[],s=c+u,i=s;i--;)o.push(0);for(i=u;--i>=0;){for(e=0,r=c+i;r>i;)a=o[r]+p[i]*d[r-i-1]+e,o[r--]=a%me|0,e=a/me|0;o[r]=(o[r]+e)%me|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),n.d=o,n.e=It(o,t),E?K(n,m.precision,m.rounding):n};P.toBinary=function(n,e){return on(this,2,n,e)};P.toDecimalPlaces=P.toDP=function(n,e){var t=this,i=t.constructor;return t=new i(t),n===void 0?t:(re(n,0,Ne),e===void 0?e=i.rounding:re(e,0,8),K(t,n+t.e+1,e))};P.toExponential=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=ye(i,!0):(re(n,0,Ne),e===void 0?e=r.rounding:re(e,0,8),i=K(new r(i),n+1,e),t=ye(i,!0,n+1)),i.isNeg()&&!i.isZero()?"-"+t:t};P.toFixed=function(n,e){var t,i,r=this,o=r.constructor;return n===void 0?t=ye(r):(re(n,0,Ne),e===void 0?e=o.rounding:re(e,0,8),i=K(new o(r),n+r.e+1,e),t=ye(i,!1,n+i.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};P.toFraction=function(n){var e,t,i,r,o,s,a,c,u,l,m,d,p=this,f=p.d,g=p.constructor;if(!f)return new g(p);if(u=t=new g(1),i=c=new g(0),e=new g(i),o=e.e=Zn(f)-p.e-1,s=o%R,e.d[0]=$(10,s<0?R+s:s),n==null)n=o>0?e:u;else{if(a=new g(n),!a.isInt()||a.lt(u))throw Error(Ke+a);n=a.gt(e)?o>0?e:u:a}for(E=!1,a=new g(ee(f)),l=g.precision,g.precision=o=f.length*R*2;m=z(a,e,0,1,1),r=t.plus(m.times(i)),r.cmp(n)!=1;)t=i,i=r,r=u,u=c.plus(m.times(r)),c=r,r=e,e=a.minus(m.times(r)),a=r;return r=z(n.minus(t),i,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(i)),c.s=u.s=p.s,d=z(u,i,o,1).minus(p).abs().cmp(z(c,t,o,1).minus(p).abs())<1?[u,i]:[c,t],g.precision=l,E=!0,d};P.toHexadecimal=P.toHex=function(n,e){return on(this,16,n,e)};P.toNearest=function(n,e){var t=this,i=t.constructor;if(t=new i(t),n==null){if(!t.d)return t;n=new i(1),e=i.rounding}else{if(n=new i(n),e===void 0?e=i.rounding:re(e,0,8),!t.d)return n.s?t:n;if(!n.d)return n.s&&(n.s=t.s),n}return n.d[0]?(E=!1,t=z(t,n,0,e,1).times(n),E=!0,K(t)):(n.s=t.s,t=n),t};P.toNumber=function(){return+this};P.toOctal=function(n,e){return on(this,8,n,e)};P.toPower=P.pow=function(n){var e,t,i,r,o,s,a=this,c=a.constructor,u=+(n=new c(n));if(!a.d||!n.d||!a.d[0]||!n.d[0])return new c($(+a,u));if(a=new c(a),a.eq(1))return a;if(i=c.precision,o=c.rounding,n.eq(1))return K(a,i,o);if(e=ie(n.e/R),e>=n.d.length-1&&(t=u<0?-u:u)<=or)return r=jn(c,a,t,i),n.s<0?new c(1).div(r):K(r,i,o);if(s=a.s,s<0){if(e<n.d.length-1)return new c(NaN);if((n.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=$(+a,u),e=t==0||!isFinite(t)?ie(u*(Math.log("0."+ee(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(E=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=nn(n.times(Ce(a,i+t)),i),r.d&&(r=K(r,i+5,1),nt(r.d,i,o)&&(e=i+10,r=K(nn(n.times(Ce(a,e+t)),e),e+5,1),+ee(r.d).slice(i+1,i+15)+1==1e14&&(r=K(r,i+1,0)))),r.s=s,E=!0,c.rounding=o,K(r,i,o))};P.toPrecision=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=ye(i,i.e<=r.toExpNeg||i.e>=r.toExpPos):(re(n,1,Ne),e===void 0?e=r.rounding:re(e,0,8),i=K(new r(i),n,e),t=ye(i,n<=i.e||i.e<=r.toExpNeg,n)),i.isNeg()&&!i.isZero()?"-"+t:t};P.toSignificantDigits=P.toSD=function(n,e){var t=this,i=t.constructor;return n===void 0?(n=i.precision,e=i.rounding):(re(n,1,Ne),e===void 0?e=i.rounding:re(e,0,8)),K(new i(t),n,e)};P.toString=function(){var n=this,e=n.constructor,t=ye(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()&&!n.isZero()?"-"+t:t};P.truncated=P.trunc=function(){return K(new this.constructor(this),this.e+1,1)};P.valueOf=P.toJSON=function(){var n=this,e=n.constructor,t=ye(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()?"-"+t:t};function ee(n){var e,t,i,r=n.length-1,o="",s=n[0];if(r>0){for(o+=s,e=1;e<r;e++)i=n[e]+"",t=R-i.length,t&&(o+=Se(t)),o+=i;s=n[e],i=s+"",t=R-i.length,t&&(o+=Se(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function re(n,e,t){if(n!==~~n||n<e||n>t)throw Error(Ke+n)}function nt(n,e,t,i){var r,o,s,a;for(o=n[0];o>=10;o/=10)--e;return--e<0?(e+=R,r=0):(r=Math.ceil((e+1)/R),e%=R),o=$(10,R-e),a=n[r]%o|0,i==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(n[r+1]/o/100|0)==$(10,e-2)-1||(a==o/2||a==0)&&(n[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(i||t<4)&&a==9999||!i&&t>3&&a==4999):s=((i||t<4)&&a+1==o||!i&&t>3&&a+1==o/2)&&(n[r+1]/o/1e3|0)==$(10,e-3)-1,s}function kt(n,e,t){for(var i,r=[0],o,s=0,a=n.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=$t.indexOf(n.charAt(s++)),i=0;i<r.length;i++)r[i]>t-1&&(r[i+1]===void 0&&(r[i+1]=0),r[i+1]+=r[i]/t|0,r[i]%=t)}return r.reverse()}function ar(n,e){var t,i,r;if(e.isZero())return e;i=e.d.length,i<32?(t=Math.ceil(i/3),r=(1/St(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),n.precision+=t,e=He(n,1,e.times(r),new n(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return n.precision-=t,e}var z=function(){function n(i,r,o){var s,a=0,c=i.length;for(i=i.slice();c--;)s=i[c]*r+a,i[c]=s%o|0,a=s/o|0;return a&&i.unshift(a),i}function e(i,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(i[a]!=r[a]){c=i[a]>r[a]?1:-1;break}return c}function t(i,r,o,s){for(var a=0;o--;)i[o]-=a,a=i[o]<r[o]?1:0,i[o]=a*s+i[o]-r[o];for(;!i[0]&&i.length>1;)i.shift()}return function(i,r,o,s,a,c){var u,l,m,d,p,f,g,w,k,y,b,h,T,B,x,L,F,N,v,I,D=i.constructor,Y=i.s==r.s?1:-1,V=i.d,U=r.d;if(!V||!V[0]||!U||!U[0])return new D(!i.s||!r.s||(V?U&&V[0]==U[0]:!U)?NaN:V&&V[0]==0||!U?Y*0:Y/0);for(c?(p=1,l=i.e-r.e):(c=me,p=R,l=ie(i.e/p)-ie(r.e/p)),v=U.length,F=V.length,k=new D(Y),y=k.d=[],m=0;U[m]==(V[m]||0);m++);if(U[m]>(V[m]||0)&&l--,o==null?(B=o=D.precision,s=D.rounding):a?B=o+(i.e-r.e)+1:B=o,B<0)y.push(1),f=!0;else{if(B=B/p+2|0,m=0,v==1){for(d=0,U=U[0],B++;(m<F||d)&&B--;m++)x=d*c+(V[m]||0),y[m]=x/U|0,d=x%U|0;f=d||m<F}else{for(d=c/(U[0]+1)|0,d>1&&(U=n(U,d,c),V=n(V,d,c),v=U.length,F=V.length),L=v,b=V.slice(0,v),h=b.length;h<v;)b[h++]=0;I=U.slice(),I.unshift(0),N=U[0],U[1]>=c/2&&++N;do d=0,u=e(U,b,v,h),u<0?(T=b[0],v!=h&&(T=T*c+(b[1]||0)),d=T/N|0,d>1?(d>=c&&(d=c-1),g=n(U,d,c),w=g.length,h=b.length,u=e(g,b,w,h),u==1&&(d--,t(g,v<w?I:U,w,c))):(d==0&&(u=d=1),g=U.slice()),w=g.length,w<h&&g.unshift(0),t(b,g,h,c),u==-1&&(h=b.length,u=e(U,b,v,h),u<1&&(d++,t(b,v<h?I:U,h,c))),h=b.length):u===0&&(d++,b=[0]),y[m++]=d,u&&b[0]?b[h++]=V[L]||0:(b=[V[L]],h=1);while((L++<F||b[0]!==void 0)&&B--);f=b[0]!==void 0}y[0]||y.shift()}if(p==1)k.e=l,Un=f;else{for(m=1,d=y[0];d>=10;d/=10)m++;k.e=m+l*p-1,K(k,a?o+k.e+1:o,s,f)}return k}}();function K(n,e,t,i){var r,o,s,a,c,u,l,m,d,p=n.constructor;e:if(e!=null){if(m=n.d,!m)return n;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=R,s=e,l=m[d=0],c=l/$(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/R),a=m.length,d>=a)if(i){for(;a++<=d;)m.push(0);l=c=0,r=1,o%=R,s=o-R+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=R,s=o-R+r,c=s<0?0:l/$(10,r-s-1)%10|0}if(i=i||e<0||m[d+1]!==void 0||(s<0?l:l%$(10,r-s-1)),u=t<4?(c||i)&&(t==0||t==(n.s<0?3:2)):c>5||c==5&&(t==4||i||t==6&&(o>0?s>0?l/$(10,r-s):0:m[d-1])%10&1||t==(n.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=n.e+1,m[0]=$(10,(R-e%R)%R),n.e=-e||0):m[0]=n.e=0,n;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=$(10,R-o),m[d]=s>0?(l/$(10,r-s)%$(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(n.e++,m[0]==me&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=me)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return E&&(n.e>p.maxE?(n.d=null,n.e=NaN):n.e<p.minE&&(n.e=0,n.d=[0])),n}function ye(n,e,t){if(!n.isFinite())return Yn(n);var i,r=n.e,o=ee(n.d),s=o.length;return e?(t&&(i=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Se(i):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(n.e<0?"e":"e+")+n.e):r<0?(o="0."+Se(-r-1)+o,t&&(i=t-s)>0&&(o+=Se(i))):r>=s?(o+=Se(r+1-s),t&&(i=t-r-1)>0&&(o=o+"."+Se(i))):((i=r+1)<s&&(o=o.slice(0,i)+"."+o.slice(i)),t&&(i=t-s)>0&&(r+1===s&&(o+="."),o+=Se(i))),o}function It(n,e){var t=n[0];for(e*=R;t>=10;t/=10)e++;return e}function Bt(n,e,t){if(e>sr)throw E=!0,t&&(n.precision=t),Error(Gn);return K(new n(ht),e,1,!0)}function le(n,e,t){if(e>tn)throw Error(Gn);return K(new n(Tt),e,t,!0)}function Zn(n){var e=n.length-1,t=e*R+1;if(e=n[e],e){for(;e%10==0;e/=10)t--;for(e=n[0];e>=10;e/=10)t++}return t}function Se(n){for(var e="";n--;)e+="0";return e}function jn(n,e,t,i){var r,o=new n(1),s=Math.ceil(i/R+4);for(E=!1;;){if(t%2&&(o=o.times(e),Vn(o.d,s)&&(r=!0)),t=ie(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Vn(e.d,s)}return E=!0,o}function _n(n){return n.d[n.d.length-1]&1}function Qn(n,e,t){for(var i,r=new n(e[0]),o=0;++o<e.length;)if(i=new n(e[o]),i.s)r[t](i)&&(r=i);else{r=i;break}return r}function nn(n,e){var t,i,r,o,s,a,c,u=0,l=0,m=0,d=n.constructor,p=d.rounding,f=d.precision;if(!n.d||!n.d[0]||n.e>17)return new d(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:0/0);for(e==null?(E=!1,c=f):c=e,a=new d(.03125);n.e>-2;)n=n.times(a),m+=5;for(i=Math.log($(2,m))/Math.LN10*2+5|0,c+=i,t=o=s=new d(1),d.precision=c;;){if(o=K(o.times(n),c,1),t=t.times(++l),a=s.plus(z(o,t,c,1)),ee(a.d).slice(0,c)===ee(s.d).slice(0,c)){for(r=m;r--;)s=K(s.times(s),c,1);if(e==null)if(u<3&&nt(s.d,c-i,p,u))d.precision=c+=10,t=o=a=new d(1),l=0,u++;else return K(s,d.precision=f,p,E=!0);else return d.precision=f,s}s=a}}function Ce(n,e){var t,i,r,o,s,a,c,u,l,m,d,p=1,f=10,g=n,w=g.d,k=g.constructor,y=k.rounding,b=k.precision;if(g.s<0||!w||!w[0]||!g.e&&w[0]==1&&w.length==1)return new k(w&&!w[0]?-1/0:g.s!=1?NaN:w?0:g);if(e==null?(E=!1,l=b):l=e,k.precision=l+=f,t=ee(w),i=t.charAt(0),Math.abs(o=g.e)<15e14){for(;i<7&&i!=1||i==1&&t.charAt(1)>3;)g=g.times(n),t=ee(g.d),i=t.charAt(0),p++;o=g.e,i>1?(g=new k("0."+t),o++):g=new k(i+"."+t.slice(1))}else return u=Bt(k,l+2,b).times(o+""),g=Ce(new k(i+"."+t.slice(1)),l-f).plus(u),k.precision=b,e==null?K(g,b,y,E=!0):g;for(m=g,c=s=g=z(g.minus(1),g.plus(1),l,1),d=K(g.times(g),l,1),r=3;;){if(s=K(s.times(d),l,1),u=c.plus(z(s,new k(r),l,1)),ee(u.d).slice(0,l)===ee(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Bt(k,l+2,b).times(o+""))),c=z(c,new k(p),l,1),e==null)if(nt(c.d,l-f,y,a))k.precision=l+=f,u=s=g=z(m.minus(1),m.plus(1),l,1),d=K(g.times(g),l,1),r=a=1;else return K(c,k.precision=b,y,E=!0);else return k.precision=b,c;c=u,r+=2}}function Yn(n){return String(n.s*n.s/0)}function rn(n,e){var t,i,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(t<0&&(t=i),t+=+e.slice(i+1),e=e.substring(0,i)):t<0&&(t=e.length),i=0;e.charCodeAt(i)===48;i++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(i,r),e){if(r-=i,n.e=t=t-i-1,n.d=[],i=(t+1)%R,t<0&&(i+=R),i<r){for(i&&n.d.push(+e.slice(0,i)),r-=R;i<r;)n.d.push(+e.slice(i,i+=R));e=e.slice(i),i=R-e.length}else i-=r;for(;i--;)e+="0";n.d.push(+e),E&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function ur(n,e){var t,i,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),zn.test(e))return rn(n,e)}else if(e==="Infinity"||e==="NaN")return+e||(n.s=NaN),n.e=NaN,n.d=null,n;if(ir.test(e))t=16,e=e.toLowerCase();else if(nr.test(e))t=2;else if(rr.test(e))t=8;else throw Error(Ke+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,i=n.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=jn(i,new i(t),o,o*2)),u=kt(e,t,me),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new i(n.s*0):(n.e=It(u,l),n.d=u,E=!1,s&&(n=z(n,r,a*4)),c&&(n=n.times(Math.abs(c)<54?$(2,c):it.pow(2,c))),E=!0,n)}function cr(n,e){var t,i=e.d.length;if(i<3)return e.isZero()?e:He(n,2,e,e);t=1.4*Math.sqrt(i),t=t>16?16:t|0,e=e.times(1/St(5,t)),e=He(n,2,e,e);for(var r,o=new n(5),s=new n(16),a=new n(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function He(n,e,t,i,r){var o,s,a,c,u=1,l=n.precision,m=Math.ceil(l/R);for(E=!1,c=t.times(t),a=new n(i);;){if(s=z(a.times(c),new n(e++*e++),l,1),a=r?i.plus(s):i.minus(s),i=z(s.times(c),new n(e++*e++),l,1),s=a.plus(i),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=i,i=s,s=o,u++}return E=!0,s.d.length=m+1,s}function St(n,e){for(var t=n;--e;)t*=n;return t}function Jn(n,e){var t,i=e.s<0,r=le(n,n.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Be=i?4:1,e;if(t=e.divToInt(r),t.isZero())Be=i?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Be=_n(t)?i?2:3:i?4:1,e;Be=_n(t)?i?1:4:i?3:2}return e.minus(r).abs()}function on(n,e,t,i){var r,o,s,a,c,u,l,m,d,p=n.constructor,f=t!==void 0;if(f?(re(t,1,Ne),i===void 0?i=p.rounding:re(i,0,8)):(t=p.precision,i=p.rounding),!n.isFinite())l=Yn(n);else{for(l=ye(n),s=l.indexOf("."),f?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=kt(ye(d),10,r),d.e=d.d.length),m=kt(l,10,r),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=f?"0p+0":"0";else{if(s<0?o--:(n=new p(n),n.d=m,n.e=o,n=z(n,d,t,i,0,r),m=n.d,o=n.e,u=Un),s=m[t],a=r/2,u=u||m[t+1]!==void 0,u=i<4?(s!==void 0||u)&&(i===0||i===(n.s<0?3:2)):s>a||s===a&&(i===4||u||i===6&&m[t-1]&1||i===(n.s<0?8:7)),m.length=t,u)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=$t.charAt(m[s]);if(f){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=kt(l,r,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=$t.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return n.s<0?"-"+l:l}function Vn(n,e){if(n.length>e)return n.length=e,!0}function lr(n){return new this(n).abs()}function mr(n){return new this(n).acos()}function dr(n){return new this(n).acosh()}function pr(n,e){return new this(n).plus(e)}function fr(n){return new this(n).asin()}function br(n){return new this(n).asinh()}function gr(n){return new this(n).atan()}function yr(n){return new this(n).atanh()}function Pr(n,e){n=new this(n),e=new this(e);var t,i=this.precision,r=this.rounding,o=i+4;return!n.s||!e.s?t=new this(NaN):!n.d&&!e.d?(t=le(this,o,1).times(e.s>0?.25:.75),t.s=n.s):!e.d||n.isZero()?(t=e.s<0?le(this,i,r):new this(0),t.s=n.s):!n.d||e.isZero()?(t=le(this,o,1).times(.5),t.s=n.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(z(n,e,o,1)),e=le(this,o,1),this.precision=i,this.rounding=r,t=n.s<0?t.minus(e):t.plus(e)):t=this.atan(z(n,e,o,1)),t}function Ar(n){return new this(n).cbrt()}function wr(n){return K(n=new this(n),n.e+1,2)}function kr(n,e,t){return new this(n).clamp(e,t)}function hr(n){if(!n||typeof n!="object")throw Error(xt+"Object expected");var e,t,i,r=n.defaults===!0,o=["precision",1,Ne,"rounding",0,8,"toExpNeg",-Xe,0,"toExpPos",0,Xe,"maxE",0,Xe,"minE",-Xe,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=en[t]),(i=n[t])!==void 0)if(ie(i)===i&&i>=o[e+1]&&i<=o[e+2])this[t]=i;else throw Error(Ke+t+": "+i);if(t="crypto",r&&(this[t]=en[t]),(i=n[t])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Xn);else this[t]=!1;else throw Error(Ke+t+": "+i);return this}function Tr(n){return new this(n).cos()}function Br(n){return new this(n).cosh()}function $n(n){var e,t,i;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,qn(o)){u.s=o.s,E?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;E?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return rn(u,o.toString())}else if(c!=="string")throw Error(Ke+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),zn.test(o)?rn(u,o):ur(u,o)}if(r.prototype=P,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=hr,r.clone=$n,r.isDecimal=qn,r.abs=lr,r.acos=mr,r.acosh=dr,r.add=pr,r.asin=fr,r.asinh=br,r.atan=gr,r.atanh=yr,r.atan2=Pr,r.cbrt=Ar,r.ceil=wr,r.clamp=kr,r.cos=Tr,r.cosh=Br,r.div=xr,r.exp=Ir,r.floor=Sr,r.hypot=Cr,r.ln=Kr,r.log=Nr,r.log10=Rr,r.log2=Lr,r.max=Mr,r.min=vr,r.mod=Fr,r.mul=Er,r.pow=Or,r.random=Dr,r.round=Wr,r.sign=_r,r.sin=Vr,r.sinh=qr,r.sqrt=Ur,r.sub=Gr,r.sum=Xr,r.tan=Hr,r.tanh=zr,r.trunc=Zr,n===void 0&&(n={}),n&&n.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<i.length;)n.hasOwnProperty(t=i[e++])||(n[t]=this[t]);return r.config(n),r}function xr(n,e){return new this(n).div(e)}function Ir(n){return new this(n).exp()}function Sr(n){return K(n=new this(n),n.e+1,3)}function Cr(){var n,e,t=new this(0);for(E=!1,n=0;n<arguments.length;)if(e=new this(arguments[n++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return E=!0,new this(1/0);t=e}return E=!0,t.sqrt()}function qn(n){return n instanceof it||n&&n.toStringTag===Hn||!1}function Kr(n){return new this(n).ln()}function Nr(n,e){return new this(n).log(e)}function Lr(n){return new this(n).log(2)}function Rr(n){return new this(n).log(10)}function Mr(){return Qn(this,arguments,"lt")}function vr(){return Qn(this,arguments,"gt")}function Fr(n,e){return new this(n).mod(e)}function Er(n,e){return new this(n).mul(e)}function Or(n,e){return new this(n).pow(e)}function Dr(n){var e,t,i,r,o=0,s=new this(1),a=[];if(n===void 0?n=this.precision:re(n,1,Ne),i=Math.ceil(n/R),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(i));o<i;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(i*=4);o<i;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=i/4}else throw Error(Xn);else for(;o<i;)a[o++]=Math.random()*1e7|0;for(i=a[--o],n%=R,i&&n&&(r=$(10,R-n),a[o]=(i/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=R)a.shift();for(i=1,r=a[0];r>=10;r/=10)i++;i<R&&(t-=R-i)}return s.e=t,s.d=a,s}function Wr(n){return K(n=new this(n),n.e+1,this.rounding)}function _r(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function Vr(n){return new this(n).sin()}function qr(n){return new this(n).sinh()}function Ur(n){return new this(n).sqrt()}function Gr(n,e){return new this(n).sub(e)}function Xr(){var n=0,e=arguments,t=new this(e[n]);for(E=!1;t.s&&++n<e.length;)t=t.plus(e[n]);return E=!0,K(t,this.precision,this.rounding)}function Hr(n){return new this(n).tan()}function zr(n){return new this(n).tanh()}function Zr(n){return K(n=new this(n),n.e+1,1)}P[Symbol.for("nodejs.util.inspect.custom")]=P.toString;P[Symbol.toStringTag]="Decimal";var it=P.constructor=$n(en);ht=new it(ht);Tt=new it(Tt);var W=it;import no from"big.js";import Fs from"bn.js";import jr from"toformat";var Qr=jr,rt=Qr;import Kt from"big.js";import Jr from"bn.js";import $r from"decimal.js-light";import ot from"bn.js";var ei=9007199254740991;function Pe(n){let e=ne("Raydium_parseBigNumberish");if(n instanceof ot)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new ot(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=ei||n<=-ei)&&e.logWithError(`BigNumberish number overflow: ${n}`),new ot(String(n))):typeof n=="bigint"?new ot(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new ot(0))}var Ct=ne("module/fraction"),sn=rt(Kt),st=rt($r),eo={[0]:st.ROUND_DOWN,[1]:st.ROUND_HALF_UP,[2]:st.ROUND_UP},to={[0]:Kt.roundDown,[1]:Kt.roundHalfUp,[2]:Kt.roundUp},Z=class{numerator;denominator;constructor(e,t=new Jr(1)){this.numerator=Pe(e),this.denominator=Pe(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new Z(this.denominator,this.numerator)}add(e){let t=e instanceof Z?e:new Z(Pe(e));return this.denominator.eq(t.denominator)?new Z(this.numerator.add(t.numerator),this.denominator):new Z(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof Z?e:new Z(Pe(e));return this.denominator.eq(t.denominator)?new Z(this.numerator.sub(t.numerator),this.denominator):new Z(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof Z?e:new Z(Pe(e));return new Z(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof Z?e:new Z(Pe(e));return new Z(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},i=1){Number.isInteger(e)||Ct.logWithError(`${e} is not an integer.`),e<=0&&Ct.logWithError(`${e} is not positive.`),st.set({precision:e+1,rounding:eo[i]});let r=new st(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},i=1){return Number.isInteger(e)||Ct.logWithError(`${e} is not an integer.`),e<0&&Ct.logWithError(`${e} is negative.`),sn.DP=e,sn.RM=to[i]||1,new sn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Gs=ne("Raydium_amount"),Xs=rt(no);import{PublicKey as ro}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ti}from"@solana/spl-token";var an={chainId:101,address:ro.default.toBase58(),programId:ti.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Le={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ti.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as ln}from"@solana/web3.js";import{PublicKey as j,SystemProgram as ni,SYSVAR_RENT_PUBKEY as oo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as so}from"@solana/spl-token";function un({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var $s=[un({pubkey:so,isWritable:!1}),un({pubkey:ni.programId,isWritable:!1}),un({pubkey:oo,isWritable:!1})];function ii({publicKey:n,transformSol:e}){let t=ri(n.toString());if(t instanceof j)return e&&t.equals(at)?Nt:t;if(e&&t.toString()===at.toBase58())return Nt;if(typeof t=="string"){if(t===j.default.toBase58())return j.default;try{return new j(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ri(n){try{return new j(n)}catch{return n}}var ao=new j("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),uo=new j("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),cn=new j("SysvarRent111111111111111111111111111111111"),ea=new j("SysvarC1ock11111111111111111111111111111111"),ze=new j("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ta=new j("Sysvar1nstructions1111111111111111111111111"),na=ni.programId,ia=new j("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ra=new j("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),oa=new j("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),sa=new j("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),aa=new j("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ua=new j("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ca=new j("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),la=new j("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),ma=new j("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),da=new j("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),pa=new j("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Nt=new j("So11111111111111111111111111111111111111112"),at=j.default;var mn=class{symbol;name;decimals;isToken2022;mint;constructor({mint:e,decimals:t,symbol:i,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===at.toBase58()||e instanceof ln&&at.equals(e)){this.decimals=Le.decimals,this.symbol=Le.symbol,this.name=Le.name,this.mint=new ln(Le.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=i||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?ln.default:ii({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Re=mn;Ge(Re,"WSOL",new mn({...Le,mint:Le.address}));var dn=class{symbol;name;decimals;constructor({decimals:e,symbol:t="UNKNOWN",name:i="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=i}equals(e){return this===e}},Lt=dn;Ge(Lt,"SOL",new dn(an));import co from"bn.js";var xa=new Z(new co(100));var La=ne("Raydium_price");import{PublicKey as Za}from"@solana/web3.js";import Qa from"bn.js";var lo=new Ae(0),fu=new Ae(1),bu=new Ae(2),gu=new Ae(3),yu=new Ae(5),io=new Ae(10),Pu=new Ae(100),Au=new Ae(1e3),wu=new Ae(1e4);function oi(n,e,t){return n.mul(e).add(t).sub(new Ae(1)).div(t)}function bn(n,e=1,t=[]){let i=[...n];if(e<=0)return t;for(;i.length;)t.push(i.splice(0,e));return t}import{PublicKey as Po}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ao}from"@solana/spl-token";import{ComputeBudgetProgram as si,Keypair as ui,PublicKey as mo,Transaction as ci,TransactionMessage as po,VersionedTransaction as li}from"@solana/web3.js";var Oe={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip",NonceAccount:"NonceAccount"};import{TOKEN_PROGRAM_ID as fo}from"@solana/spl-token";var ai=ne("Raydium_txUtil"),mi=1644;function Mt(n){let e=[],t=[];return n.microLamports&&(e.push(si.setComputeUnitPrice({microLamports:n.microLamports})),t.push(Oe.SetComputeUnitPrice)),n.units&&(e.push(si.setComputeUnitLimit({units:n.units})),t.push(Oe.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Ze(n,e){let t=e??"confirmed";return(await n.getLatestBlockhash?.({commitment:t}))?.blockhash}async function vt(n,e){return n.getSignatureStatuses([e]),new Promise((t,i)=>{let r=setTimeout(i,6e4);n.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}i(Object.assign(o.err,{txId:e}))},"confirmed")})}function bo(n,e){n.length<1&&ai.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&ai.logWithError(`no signers provided:, ${e.toString()}`);let t=new ci;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<mi}catch{return!1}}function de(n,e){let[t,i]=mo.findProgramAddressSync(n,e);return{publicKey:t,nonce:i}}function ut({instructions:n,payer:e,signers:t}){return bo(n,[e,...t])}function ct({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:i=ui.generate().publicKey.toString()}){let o=new po({payerKey:e,recentBlockhash:i,instructions:n}).compileToV0Message(Object.values(t??{}));try{return Buffer.from(new li(o).serialize()).toString("base64").length<mi}catch{return!1}}var go=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),yo=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof li&&(e=go(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function De(n){let e=[];return n.forEach(t=>{t instanceof ci&&(t.recentBlockhash||(t.recentBlockhash=fo.toBase58()),t.feePayer||(t.feePayer=ui.generate().publicKey)),e.push(yo(t))}),console.log("simulate tx string:",e),e}function Me(n,e,t){return de([n.toBuffer(),(t??Ao).toBuffer(),e.toBuffer()],new Po("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as O}from"@solana/web3.js";var Vu=new O("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),qu=new O("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Uu=new O("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Gu=new O("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Xu=new O("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Hu=new O("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),zu=new O("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Zu=new O("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ju=new O("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Qu=new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),wo=new O("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),ko=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ho=new O("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Yu=new O("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Ju=new O("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),$u=new O("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),ec=new O("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),tc=new O("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),nc=new O("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ic=new O("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),rc=new O("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),oc=new O("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),To=new O("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Bo=new O("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),xo=new O("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),sc=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Io=new O("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),ac=new O("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),So=new O("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),we=new O("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),uc=new O("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Co=new O("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),Ko=new O("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var cc={SERUM_MARKET:O.default,OPENBOOK_MARKET:new O("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:O.default,FarmV3:new O("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new O("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new O("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new O("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new O("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new O("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new O("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new O("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new O("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:To,CREATE_CPMM_POOL_AUTH:Bo,CREATE_CPMM_POOL_FEE_ACC:xo,FEE_DESTINATION_ID:new O("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:Io,LCOK_CPMM_AUTH:So,LAUNCHPAD_PROGRAM:Co,LAUNCHPAD_AUTH:Ko};import Ft from"bn.js";function Et(n,e){if(n.isZero())return new Ft(0);let t=n.div(e);return t.isZero()?new Ft(1):n.mod(e).gt(new Ft(0))?t.add(new Ft(1)):t}import No from"bn.js";var We=new No(1e6);import{MINT_SIZE as Vc,TOKEN_PROGRAM_ID as qc,getTransferFeeConfig as Uc,unpackMint as Gc}from"@solana/spl-token";var gn=ne("Raydium_accountInfo_util");async function lt(n,e,t){let{batchRequest:i,commitment:r="confirmed",chunkCount:o=100}={batchRequest:!1,...t},s=bn(e,o),a=new Array(s.length).fill([]);if(i){let c=s.map(m=>{let d=n._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=bn(c,10);a=(await(await Promise.all(u.map(async m=>await n._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&gn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:f,lamports:g,owner:w,rentEpoch:k}=d;return p.length!==2&&p[1]!=="base64"&&gn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:f,lamports:g,owner:new Lo(w),rentEpoch:k}}return null})))}else try{a=await Promise.all(s.map(c=>n.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&gn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function _e(n,e,t){let i=await lt(n,e.map(r=>r.pubkey),t);return e.map((r,o)=>({...r,accountInfo:i[o]}))}async function yn({connection:n,address:e}){let t=await lt(n,[...new Set(e.map(r=>r.toString()))].map(r=>new pi(r))),i={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new Ot({key:s,state:Ot.deserialize(o.data)});i[s.toString()]=a,Dt[s.toString()]=a}return i}var Dt={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Ot({key:new pi("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Ot.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};var Wt=2e3,_t=class{connection;owner;instructions=[];endInstructions=[];lookupTableAddress=[];signers=[];instructionTypes=[];endInstructionTypes=[];feePayer;cluster;signAllTransactions;blockhashCommitment;loopMultiTxStatus;constructor(e){this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){let e=(await Mo.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=e?.[15]??{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:i}=Mt(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...i),!0}return!1}addTipInstruction(e){return e?(this.endInstructions.push(Ro.transfer({fromPubkey:e.feePayer??this.feePayer,toPubkey:new je(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(Oe.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let i=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(i))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:i=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...i),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==je.default.toString())),this}async versionBuild({txVersion:e,extInfo:t},i){return e===0?await this.buildV0({...t||{}},i):this.build(t,i)}build(e,t){let i=new mt;return this.allInstructions.length&&i.add(...this.allInstructions),i.feePayer=this.feePayer,this.owner?.signer&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:i,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=r||{},u=o??t??await Ze(this.connection,this.blockhashCommitment);if(i.recentBlockhash=u,this.signers.length&&i.sign(...this.signers),De([i]),this.owner?.isKeyPair)return{txId:a?await Pn(this.connection,i,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(i.serialize(),{skipPreflight:s}),signedTx:i};if(this.signAllTransactions){let l=await this.signAllTransactions([i]);if(this.signers.length)for(let m of l)try{m.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:i}=e,{transaction:r}=this.build(i),o=t.filter(u=>u.transaction.instructions.length>0),s=[r,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return this.owner?.signer&&a.forEach(u=>{u.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async u=>{let{sequentially:l,onTxUpdate:m,skipTxCount:d=0,recentBlockHash:p,skipPreflight:f=!0}=u||{},g=p??await Ze(this.connection,this.blockhashCommitment);if(this.owner?.isKeyPair){if(l){let w=[],k=0;for(let y of s){if(++k,k<=d)continue;let b=await Pn(this.connection,y,this.signers.find(h=>h.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});w.push(b)}return{txIds:w,signedTxs:s}}return{txIds:await await Promise.all(s.map(async w=>(w.recentBlockhash=g,await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:f})))),signedTxs:s}}if(this.signAllTransactions){let w=s.map((y,b)=>(y.recentBlockhash=g,a[b].length&&y.sign(...a[b]),y));De(w);let k=await this.signAllTransactions(w);if(l){let y=0,b=[],h=async()=>{if(!k[y])return;let T=await this.connection.sendRawTransaction(k[y].serialize(),{skipPreflight:f});b.push({txId:T,status:"sent",signedTx:k[y]}),m?.([...b]),y++;let B=!1,x=null,L=null,F=N=>{x!==null&&clearInterval(x),L!==null&&this.connection.removeSignatureListener(L);let v=b.findIndex(I=>I.txId===T);if(v>-1){if(b[v].status==="error"||b[v].status==="success")return;b[v].status=N.err?"error":"success"}m?.([...b]),N.err||h()};this.loopMultiTxStatus&&(x=setInterval(async()=>{if(B){clearInterval(x);return}try{let N=await this.connection.getTransaction(T,{commitment:"confirmed",maxSupportedTransactionVersion:0});N&&(B=!0,clearInterval(x),F({err:N.meta?.err||null}),console.log("tx status from getTransaction:",T))}catch(N){B=!0,clearInterval(x),console.error("getTransaction timeout:",N,T)}},Wt)),L=this.connection.onSignature(T,N=>{if(B){this.connection.removeSignatureListener(L);return}B=!0,F(N)},"confirmed"),this.connection.getSignatureStatus(T)};return await h(),{txIds:b.map(T=>T.txId),signedTxs:k}}else{let y=[];for(let b=0;b<k.length;b+=1){let h=await this.connection.sendRawTransaction(k[b].serialize(),{skipPreflight:f});y.push(h)}return{txIds:y,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:i}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:i||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:i})}async buildV0(e,t){let{lookupTableCache:i={},lookupTableAddress:r=[],forerunCreate:o,recentBlockhash:s,...a}=e||{},c={...this.cluster==="devnet"?{}:Dt,...i},u=Array.from(new Set([...r,...this.lookupTableAddress])),l=[];for(let f of u)c[f]===void 0&&l.push(new je(f));if(l.length>0){let f=await yn({connection:this.connection,address:l});for(let[g,w]of Object.entries(f))c[g]=w}let m=t??(o?je.default.toBase58():s??await Ze(this.connection,this.blockhashCommitment)),d=new dt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(c));this.owner?.signer&&!this.signers.some(f=>f.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new pt(d);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async f=>{let{skipPreflight:g=!0,sendAndConfirm:w,notSendToRpc:k}=f||{};if(De([p]),this.owner?.isKeyPair){let y=await this.connection.sendTransaction(p,{skipPreflight:g});return w&&await vt(this.connection,y),{txId:y,signedTx:p}}if(this.signAllTransactions){let y=await this.signAllTransactions([p]);if(this.signers.length)for(let b of y)try{b.sign(this.signers)}catch{}return{txId:k?"":await this.connection.sendTransaction(y[0],{skipPreflight:g}),signedTx:y[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(e){let{extraPreBuildData:t=[],buildProps:i}=e,{transaction:r}=await this.buildV0(i),o=t.filter(u=>u.builder.instructions.length>0),s=[r,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return this.owner?.signer&&a.forEach(u=>{u.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(u,l)=>{u.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:i,execute:async u=>{let{sequentially:l,onTxUpdate:m,recentBlockHash:d,skipPreflight:p=!0}=u||{};if(d&&s.forEach(f=>f.message.recentBlockhash=d),De(s),this.owner?.isKeyPair){if(l){let f=[];for(let g of s){let w=await this.connection.sendTransaction(g,{skipPreflight:p});await vt(this.connection,w),f.push(w)}return{txIds:f,signedTxs:s}}return{txIds:await Promise.all(s.map(async f=>await this.connection.sendTransaction(f,{skipPreflight:p}))),signedTxs:s}}if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(l){let g=0,w=[],k=async()=>{if(!f[g])return;let y=await this.connection.sendTransaction(f[g],{skipPreflight:p});w.push({txId:y,status:"sent",signedTx:f[g]}),m?.([...w]),g++;let b=!1,h=null,T=null,B=x=>{h!==null&&clearInterval(h),T!==null&&this.connection.removeSignatureListener(T);let L=w.findIndex(F=>F.txId===y);if(L>-1){if(w[L].status==="error"||w[L].status==="success")return;w[L].status=x.err?"error":"success"}m?.([...w]),x.err||k()};this.loopMultiTxStatus&&(h=setInterval(async()=>{if(b){clearInterval(h);return}try{let x=await this.connection.getTransaction(y,{commitment:"confirmed",maxSupportedTransactionVersion:0});x&&(b=!0,clearInterval(h),B({err:x.meta?.err||null}),console.log("tx status from getTransaction:",y))}catch(x){b=!0,clearInterval(h),console.error("getTransaction timeout:",x,y)}},Wt)),T=this.connection.onSignature(y,x=>{if(b){this.connection.removeSignatureListener(T);return}b=!0,B(x)},"confirmed"),this.connection.getSignatureStatus(y)};return k(),{txIds:[],signedTxs:f}}else{let g=[];for(let w=0;w<f.length;w+=1){let k=await this.connection.sendTransaction(f[w],{skipPreflight:p});g.push(k)}return{txIds:g,signedTxs:f}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuild(e){let{splitIns:t=[],computeBudgetConfig:i,...r}=e||{},o=i?Mt(i):{instructions:[],instructionTypes:[]},s=this.signers.reduce((m,d)=>({...m,[d.publicKey.toBase58()]:d}),{}),a=[],c=[],u=[],l=0;if(this.allInstructions.forEach(m=>{let d=[...u,m],p=i?[...o.instructions,...d]:d,g=[...new Set(d.map(w=>w.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(w=>new je(w));if(m!==t[l]&&u.length<12&&(ut({instructions:p,payer:this.feePayer,signers:g})||ut({instructions:d,payer:this.feePayer,signers:g})))u.push(m);else{if(u.length===0)throw Error("item ins too big");l+=m===t[l]?1:0,ut({instructions:i?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:g})?a.push(new mt().add(...o.instructions,...u)):a.push(new mt().add(...u)),c.push(Array.from(new Set(u.map(w=>w.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(w=>s[w]).filter(w=>w!==void 0)),u=[m]}}),u.length>0){let d=[...new Set(u.map(p=>p.keys.filter(f=>f.isSigner).map(f=>f.pubkey.toString())).flat()).values()].map(p=>s[p]).filter(p=>p!==void 0);ut({instructions:i?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:d.map(p=>p.publicKey)})?a.push(new mt().add(...o.instructions,...u)):a.push(new mt().add(...u)),c.push(d)}return a.forEach(m=>m.feePayer=this.feePayer),this.owner?.signer&&c.forEach(m=>{m.some(d=>d.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async m=>{let{sequentially:d,onTxUpdate:p,skipTxCount:f=0,recentBlockHash:g,skipPreflight:w=!0}=m||{},k=g??await Ze(this.connection,this.blockhashCommitment);if(a.forEach(async(y,b)=>{y.recentBlockhash=k,c[b].length&&y.sign(...c[b])}),De(a),this.owner?.isKeyPair){if(d){let y=0,b=[];for(let h of a){if(++y,y<=f){b.push("tx skipped");continue}let T=await Pn(this.connection,h,this.signers.find(B=>B.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});b.push(T)}return{txIds:b,signedTxs:a}}return{txIds:await Promise.all(a.map(async y=>await this.connection.sendRawTransaction(y.serialize(),{skipPreflight:w}))),signedTxs:a}}if(this.signAllTransactions){let y=await this.signAllTransactions(a.slice(f,a.length)),b=[...a.slice(0,f),...y];if(d){let h=0,T=[],B=async()=>{if(!b[h])return;h<f&&(T.push({txId:"",status:"success",signedTx:b[h]}),p?.([...T]),h++,B());let x=await this.connection.sendRawTransaction(b[h].serialize(),{skipPreflight:w});T.push({txId:x,status:"sent",signedTx:b[h]}),p?.([...T]),h++;let L=!1,F=null,N=null,v=I=>{F!==null&&clearInterval(F),N!==null&&this.connection.removeSignatureListener(N);let D=T.findIndex(Y=>Y.txId===x);if(D>-1){if(T[D].status==="error"||T[D].status==="success")return;T[D].status=I.err?"error":"success"}p?.([...T]),I.err||B()};this.loopMultiTxStatus&&(F=setInterval(async()=>{if(L){clearInterval(F);return}try{let I=await this.connection.getTransaction(x,{commitment:"confirmed",maxSupportedTransactionVersion:0});I&&(L=!0,clearInterval(F),v({err:I.meta?.err||null}),console.log("tx status from getTransaction:",x))}catch(I){L=!0,clearInterval(F),console.error("getTransaction timeout:",I,x)}},Wt)),N=this.connection.onSignature(x,I=>{if(L){this.connection.removeSignatureListener(N);return}L=!0,v(I)},"confirmed"),this.connection.getSignatureStatus(x)};return await B(),{txIds:T.map(x=>x.txId),signedTxs:b}}else{let h=[];for(let T=0;T<b.length;T+=1){let B=await this.connection.sendRawTransaction(b[T].serialize(),{skipPreflight:w});h.push(B)}return{txIds:h,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(e){let{computeBudgetConfig:t,splitIns:i=[],lookupTableCache:r={},lookupTableAddress:o=[],...s}=e||{},a={...this.cluster==="devnet"?{}:Dt,...r},c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let y of c)a[y]===void 0&&u.push(new je(y));let l=await yn({connection:this.connection,address:u});for(let[y,b]of Object.entries(l))a[y]=b;let m=t?Mt(t):{instructions:[],instructionTypes:[]},d=await Ze(this.connection,this.blockhashCommitment),p=this.signers.reduce((y,b)=>({...y,[b.publicKey.toBase58()]:b}),{}),f=[],g=[],w=[],k=0;if(this.allInstructions.forEach(y=>{let b=[...w,y],h=t?[...m.instructions,...b]:b;if(y!==i[k]&&w.length<12&&(ct({instructions:h,payer:this.feePayer,lookupTableAddressAccount:a})||ct({instructions:b,payer:this.feePayer,lookupTableAddressAccount:a})))w.push(y);else{if(w.length===0)throw Error("item ins too big");k+=y===i[k]?1:0;let T={};for(let B of[...new Set(c)])a[B]!==void 0&&(T[B]=a[B]);if(t&&ct({instructions:[...m.instructions,...w],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let B=new dt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions,...w]}).compileToV0Message(Object.values(a));f.push(new pt(B))}else{let B=new dt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...w]}).compileToV0Message(Object.values(a));f.push(new pt(B))}g.push(Array.from(new Set(w.map(B=>B.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat())).map(B=>p[B]).filter(B=>B!==void 0)),w=[y]}}),w.length>0){let b=[...new Set(w.map(h=>h.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(h=>p[h]).filter(h=>h!==void 0);if(t&&ct({instructions:[...m.instructions,...w],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let h=new dt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions,...w]}).compileToV0Message(Object.values(a));f.push(new pt(h))}else{let h=new dt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...w]}).compileToV0Message(Object.values(a));f.push(new pt(h))}g.push(b)}return this.owner?.signer&&g.forEach(y=>{y.some(b=>b.publicKey.equals(this.owner.publicKey))||y.push(this.owner.signer)}),f.forEach((y,b)=>{y.sign(g[b])}),{builder:this,transactions:f,buildProps:e,signers:g,instructionTypes:this.instructionTypes,execute:async y=>{let{sequentially:b,onTxUpdate:h,skipTxCount:T=0,recentBlockHash:B,skipPreflight:x=!0}=y||{};if(f.map(async(L,F)=>{g[F].length&&L.sign(g[F]),B&&(L.message.recentBlockhash=B)}),De(f),this.owner?.isKeyPair){if(b){let L=0,F=[];for(let N of f){if(++L,L<=T){console.log("skip tx: ",L),F.push("tx skipped");continue}let v=await this.connection.sendTransaction(N,{skipPreflight:x});await vt(this.connection,v),F.push(v)}return{txIds:F,signedTxs:f}}return{txIds:await Promise.all(f.map(async L=>await this.connection.sendTransaction(L,{skipPreflight:x}))),signedTxs:f}}if(this.signAllTransactions){let L=await this.signAllTransactions(f.slice(T,f.length)),F=[...f.slice(0,T),...L];if(b){let N=0,v=[],I=async()=>{if(!F[N])return;if(N<T){v.push({txId:"",status:"success",signedTx:F[N]}),h?.([...v]),N++,I();return}let D=await this.connection.sendTransaction(F[N],{skipPreflight:x});v.push({txId:D,status:"sent",signedTx:F[N]}),h?.([...v]),N++;let Y=!1,V=null,U=null,be=J=>{V!==null&&clearInterval(V),U!==null&&this.connection.removeSignatureListener(U);let te=v.findIndex(X=>X.txId===D);if(te>-1){if(v[te].status==="error"||v[te].status==="success")return;v[te].status=J.err?"error":"success"}h?.([...v]),J.err||I()};this.loopMultiTxStatus&&(V=setInterval(async()=>{if(Y){clearInterval(V);return}try{let J=await this.connection.getTransaction(D,{commitment:"confirmed",maxSupportedTransactionVersion:0});J&&(Y=!0,clearInterval(V),be({err:J.meta?.err||null}),console.log("tx status from getTransaction:",D))}catch(J){Y=!0,clearInterval(V),console.error("getTransaction timeout:",J,D)}},Wt)),U=this.connection.onSignature(D,J=>{if(Y){this.connection.removeSignatureListener(U);return}Y=!0,be(J)},"confirmed"),this.connection.getSignatureStatus(D)};return I(),{txIds:[],signedTxs:F}}else{let N=[];for(let v=0;v<F.length;v+=1){let I=await this.connection.sendTransaction(F[v],{skipPreflight:x});N.push(I)}return{txIds:N,signedTxs:F}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};var An=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Qe=class{scope;disabled=!1;logger;constructor({scope:e,moduleName:t}){this.scope=e,this.logger=ne(t)}createTxBuilder(e){return this.scope.checkOwner(),new _t({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(An(e))}logInfo(...e){this.logger.info(An(e))}logAndCreateError(...e){let t=An(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Jp}from"@solana/web3.js";import ef from"bn.js";import{AccountLayout as of,TOKEN_2022_PROGRAM_ID as sf,TOKEN_PROGRAM_ID as af}from"@solana/spl-token";import{PublicKey as fl}from"@solana/web3.js";import{MintLayout as gl,TOKEN_PROGRAM_ID as Pl}from"@solana/spl-token";import{Keypair as hp,PublicKey as Tp,SystemProgram as xp,TransactionInstruction as Ip}from"@solana/web3.js";import Cp from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Lp,TOKEN_2022_PROGRAM_ID as Rp,TOKEN_PROGRAM_ID as Mp}from"@solana/spl-token";import{PublicKey as Go}from"@solana/web3.js";import wi,{isBN as ki}from"bn.js";import{bits as xl,BitStructure as Il,blob as vo,Blob as Sl,cstr as Cl,f32 as Kl,f32be as Nl,f64 as Ll,f64be as Rl,greedy as Ml,Layout as Fo,ns64 as vl,ns64be as Fl,nu64 as El,nu64be as Ol,offset as Eo,s16 as Dl,s16be as Wl,s24 as _l,s24be as Vl,s32 as Oo,s32be as ql,s40 as Ul,s40be as Gl,s48 as Xl,s48be as Hl,s8 as zl,seq as Do,struct as Zl,Structure as Wo,u16 as _o,u16be as jl,u24 as Ql,u24be as Yl,u32 as Vo,u32be as Jl,u40 as $l,u40be as em,u48 as tm,u48be as nm,u8 as qo,UInt as Uo,union as im,Union as rm,unionLayoutDiscriminator as om,utf8 as sm}from"@solana/buffer-layout";var wn=Fo,bi=Wo;var kn=Uo;var gi=qo,Ve=_o;var yi=Vo;var xe=Oo;var Pi=Do;var oe=vo;var Ai=Eo;var Ye=class extends wn{blob;signed;constructor(e,t,i){super(e,i),this.blob=oe(e),this.signed=t}decode(e,t=0){let i=new wi(this.blob.decode(e,t),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(e,t,i=0){return typeof e=="number"&&(e=new wi(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),t,i)}};function q(n){return new kn(1,n)}function $e(n){return new kn(4,n)}function A(n){return new Ye(8,!1,n)}function Q(n){return new Ye(16,!1,n)}function hi(n){return new Ye(8,!0,n)}function Ti(n){return new Ye(16,!0,n)}var Je=class extends wn{layout;decoder;encoder;constructor(e,t,i,r){super(e.span,r),this.layout=e,this.decoder=t,this.encoder=i}decode(e,t){return this.decoder(this.layout.decode(e,t))}encode(e,t,i){return this.layout.encode(this.encoder(e),t,i)}getSpan(e,t){return this.layout.getSpan(e,t)}};function M(n){return new Je(oe(32),e=>new Go(e),e=>e.toBuffer(),n)}function Tn(n){return new Je(gi(),Xo,Ho,n)}function Xo(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function Ho(n){return n?1:0}function zo(n){let e=yi("length"),t=_([e,oe(Ai(e,-e.span),"data")]);return new Je(t,({data:i})=>i,i=>({data:i}),n)}function pe(n){return new Je(zo(),e=>e.toString("utf-8"),e=>Buffer.from(e,"utf-8"),n)}var hn=class extends bi{decode(e,t){return super.decode(e,t)}};function _(n,e,t){return new hn(n,e,t)}function H(n,e,t){let i,r=typeof e=="number"?e:ki(e)?e.toNumber():new Proxy(e,{get(o,s){if(!i){let a=Reflect.get(o,"count");i=ki(a)?a.toNumber():a,Reflect.set(o,"count",i)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(i=a),Reflect.set(o,s,a)}});return Pi(n,r,t)}import tp from"bn.js";import ue from"bn.js";var Bn=new ue(0),Bi=new ue(1),xi=new ue(-1),fe=new ue(1).shln(64),Ii=new ue(1).shln(128),xn=fe.sub(Bi);var Zo=Ii.subn(1),et=-443636,ft=-et,In=new ue("4295048016"),Sn=new ue("79226673521066979257578248091"),Pm=new ue("4295048017"),Am=new ue("79226673521066979257578248090");var jo=new ue(10).pow(new ue(6));var wm=new ue("18446744073700000000");import Vd from"bn.js";var Im=Buffer.from("amm_config","utf8"),Sm=Buffer.from("pool","utf8"),Cm=Buffer.from("pool_vault","utf8"),Km=Buffer.from("pool_reward_vault","utf8"),Nm=Buffer.from("position","utf8"),Lm=Buffer.from("tick_array","utf8"),Rm=Buffer.from("operation","utf8"),Mm=Buffer.from("pool_tick_array_bitmap_extension","utf8"),vm=Buffer.from("observation","utf8");function Cn(n){return de([Buffer.from("metadata","utf8"),ze.toBuffer(),n.toBuffer()],ze)}var Fm=Buffer.from("locked_position","utf8");var Em=Buffer.from("support_mint","utf8");import{PublicKey as bd}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as yd}from"@solana/spl-token";import Ad from"bn.js";import Wm from"bn.js";var Ln=14;var Vt=60;var es=_([oe(8),q("bump"),Ve("index"),M(""),$e("protocolFeeRate"),$e("tradeFeeRate"),Ve("tickSpacing"),H(A(),8,"")]),ts=_([$e("blockTimestamp"),hi("tickCumulative"),H(A(),4)]),Ei=_([oe(8),Tn("initialized"),A("recentEpoch"),Ve("observationIndex"),M("poolId"),H(ts,100,"observations"),H(A(),4)]),ns=_([q("rewardState"),A("openTime"),A("endTime"),A("lastUpdateTime"),Q("emissionsPerSecondX64"),A("rewardTotalEmissioned"),A("rewardClaimed"),M("tokenMint"),M("tokenVault"),M("creator"),Q("rewardGrowthGlobalX64")]),Mi=_([oe(8),q("bump"),M("ammConfig"),M("creator"),M("mintA"),M("mintB"),M("vaultA"),M("vaultB"),M("observationId"),q("mintDecimalsA"),q("mintDecimalsB"),Ve("tickSpacing"),Q("liquidity"),Q("sqrtPriceX64"),xe("tickCurrent"),$e(),Q("feeGrowthGlobalX64A"),Q("feeGrowthGlobalX64B"),A("protocolFeesTokenA"),A("protocolFeesTokenB"),Q("swapInAmountTokenA"),Q("swapOutAmountTokenB"),Q("swapInAmountTokenB"),Q("swapOutAmountTokenA"),q("status"),H(q(),7,""),H(ns,3,"rewardInfos"),H(A(),16,"tickArrayBitmap"),A("totalFeesTokenA"),A("totalFeesClaimedTokenA"),A("totalFeesTokenB"),A("totalFeesClaimedTokenB"),A("fundFeesTokenA"),A("fundFeesTokenB"),A("startTime"),H(A(),15*4-3,"padding")]),is=_([Q("growthInsideLastX64"),A("rewardAmountOwed")]),vi=_([oe(8),q("bump"),M("nftMint"),M("poolId"),xe("tickLower"),xe("tickUpper"),Q("liquidity"),Q("feeGrowthInsideLastX64A"),Q("feeGrowthInsideLastX64B"),A("tokenFeesOwedA"),A("tokenFeesOwedB"),H(is,3,"rewardInfos"),H(A(),8,"")]),mp=_([oe(8),q("bump"),M("poolId"),xe("tickLowerIndex"),xe("tickUpperIndex"),Q("liquidity"),Q("feeGrowthInsideLastX64A"),Q("feeGrowthInsideLastX64B"),A("tokenFeesOwedA"),A("tokenFeesOwedB"),H(Q(),3,"rewardGrowthInside"),H(A(),8,"")]),rs=_([xe("tick"),Ti("liquidityNet"),Q("liquidityGross"),Q("feeGrowthOutsideX64A"),Q("feeGrowthOutsideX64B"),H(Q(),3,"rewardGrowthsOutsideX64"),H($e(),13,"")]),Ni=_([oe(8),M("poolId"),xe("startTickIndex"),H(rs,Vt,"ticks"),q("initializedTickCount"),H(q(),115,"")]),os=_([oe(329),H(M(),100,"whitelistMints")]),$o=_([oe(8),M("poolId"),H(H(A(),8),Ln,"positiveTickArrayBitmap"),H(H(A(),8),Ln,"negativeTickArrayBitmap")]),dp=_([A(),q("bump"),M("owner"),M("poolId"),M("positionId"),M("nftAccount"),H(A(),8)]),pp=_([oe(8),q("bump"),M("lockOwner"),M("poolId"),M("positionId"),M("nftAccount"),M("lockNftMint"),A("recentEpoch"),H(A(),8)]);Ei.span;var qp=ne("Raydium_Clmm");var cs=Buffer.from("vault_auth_seed","utf8"),Hf=Buffer.from("global_config","utf8"),ls=Buffer.from("pool","utf8"),ms=Buffer.from("pool_vault","utf8"),ds=Buffer.from("pool_vesting","utf8"),ps=Buffer.from("platform_config","utf8");function qe(n){return de([cs],n)}function qt(n,e,t){return de([ls,e.toBuffer(),t.toBuffer()],n)}function Rn(n,e,t){return de([ms,e.toBuffer(),t.toBuffer()],n)}function Ut(n){return de([Buffer.from("__event_authority","utf8")],n)}function Mn(n,e){return de([ps,e.toBuffer()],n)}function vn(n,e,t){return de([ds,e.toBuffer(),t.toBuffer()],n)}import{SystemProgram as yt,TransactionInstruction as ve}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Oi}from"@solana/spl-token";import Di from"bn.js";var Fe={initialize:Buffer.from([175,175,109,31,13,152,155,237]),buyExactIn:Buffer.from([250,234,13,123,213,156,19,236]),buyExactOut:Buffer.from([24,211,116,40,105,3,153,56]),sellExactIn:Buffer.from([149,39,222,155,211,124,152,26]),sellExactOut:Buffer.from([95,200,71,34,8,9,11,166]),createVestingAccount:Buffer.from([129,178,2,13,217,172,230,218]),claimVestedToken:Buffer.from([49,33,104,30,189,157,79,35]),createPlatformConfig:Buffer.from([176,90,196,175,253,113,220,20]),claimPlatformFee:Buffer.from([156,39,208,135,76,237,61,72]),updatePlaformConfig:Buffer.from([195,60,76,129,146,45,67,143])};function Wi(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,g,w,k,y,b,h,T){let B=_([q("decimals"),pe("name"),pe("symbol"),pe("uri")]),x=_([A("totalLockedAmount"),A("cliffPeriod"),A("unlockPeriod")]),L=_([q("index"),A("supply"),A("totalFundRaisingB"),q("migrateType")]),F=_([q("index"),A("supply"),A("totalSellA"),A("totalFundRaisingB"),q("migrateType")]),N=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:ze,isSigner:!1,isWritable:!1},{pubkey:yt.programId,isSigner:!1,isWritable:!1},{pubkey:cn,isSigner:!1,isWritable:!1},{pubkey:Ut(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}],v=Buffer.alloc(Buffer.from(g,"utf-8").length+Buffer.from(w,"utf-8").length+Buffer.from(k,"utf-8").length+4*3+1),I=Buffer.alloc(x.span),D=Buffer.alloc(y.type==="ConstantCurve"?F.span:L.span);return B.encode({decimals:f,name:g,symbol:w,uri:k},v),y.type==="ConstantCurve"?F.encode({index:0,...y,migrateType:y.migrateType==="amm"?0:1},D):y.type==="FixedCurve"?L.encode({index:1,...y,migrateType:y.migrateType==="amm"?0:1},D):y.type==="LinearCurve"&&L.encode({index:2,...y,migrateType:y.migrateType==="amm"?0:1},D),x.encode({totalLockedAmount:b,cliffPeriod:h,unlockPeriod:T},I),new ve({keys:N,programId:n,data:Buffer.from([...Fe.initialize,...v,...D,...I])})}function _i(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,g,w,k){let y=_([A("amountB"),A("minAmountA"),A("shareFeeRate")]),b=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:Ut(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}];k&&b.push({pubkey:k,isSigner:!1,isWritable:!0}),console.log({amountB:f.toString(),minAmountA:g.toString()});let h=Buffer.alloc(y.span);return y.encode({amountB:f,minAmountA:g,shareFeeRate:w??new Di(0)},h),new ve({keys:b,programId:n,data:Buffer.from([...Fe.buyExactIn,...h])})}function Vi(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,g,w,k){let y=_([A("amountA"),A("minAmountB"),A("shareFeeRate")]),b=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:Ut(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}];k&&b.push({pubkey:k,isSigner:!1,isWritable:!0});let h=Buffer.alloc(y.span);return y.encode({amountA:f,minAmountB:g,shareFeeRate:w??new Di(0)},h),new ve({keys:b,programId:n,data:Buffer.from([...Fe.sellExactIn,...h])})}function qi(n,e,t,i,r,o,s,a,c){let u=_([]),l=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:yt.programId,isSigner:!1,isWritable:!1},{pubkey:Oi,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);return u.encode({},m),new ve({keys:l,programId:n,data:Buffer.from([...Fe.claimVestedToken,...m])})}function Ui(n,e,t,i,r,o){let s=_([A("shareAmount")]),a=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:yt.programId,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);return s.encode({shareAmount:o},c),new ve({keys:a,programId:n,data:Buffer.from([...Fe.createVestingAccount,...c])})}function Fn(n,e,t,i,r,o,s,a,c){let u=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:yt.programId,isSigner:!1,isWritable:!0},{pubkey:Oi,isSigner:!1,isWritable:!0}];return new ve({keys:u,programId:n,data:Fe.claimPlatformFee})}function Gi(n,e,t,i,r,o,s,a,c,u,l){let m=_([A("platformScale"),A("creatorScale"),A("burnScale"),A("feeRate"),pe("name"),pe("web"),pe("img")]),d=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:yt.programId,isSigner:!1,isWritable:!1}],p=Buffer.alloc(8*4+Buffer.from(c,"utf-8").length+Buffer.from(u,"utf-8").length+Buffer.from(l,"utf-8").length+4*3);return m.encode({platformScale:s.platformScale,creatorScale:s.creatorScale,burnScale:s.burnScale,feeRate:a,name:c,web:u,img:l},p),new ve({keys:d,programId:n,data:Buffer.from([...Fe.createPlatformConfig,...p])})}function Xi(n,e,t,i){let r=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0}],o;if(i.type==="updateClaimFeeWallet"){let s=_([q("index"),M("value")]);o=Buffer.alloc(s.span),s.encode({index:0,value:i.value},o)}else if(i.type==="updateLockNftWallet"){let s=_([q("index"),M("value")]);o=Buffer.alloc(s.span),s.encode({index:1,value:i.value},o)}else if(i.type==="migrateCpLockNftScale"){let s=_([q("index"),A("platformScale"),A("creatorScale"),A("burnScale")]);o=Buffer.alloc(s.span),s.encode({index:2,...i.value},o)}else if(i.type==="updateFeeRate"){let s=_([q("index"),A("value")]);o=Buffer.alloc(s.span),s.encode({index:3,value:i.value},o)}else if(i.type==="updateImg"||i.type==="updateName"||i.type==="updateWeb"){let s=_([q("index"),pe("value")]);o=Buffer.alloc(Buffer.from(i.value,"utf-8").length+4+1*1),i.type==="updateName"?s.encode({index:4,value:i.value},o):i.type==="updateWeb"?s.encode({index:5,value:i.value},o):i.type==="updateImg"&&s.encode({index:6,value:i.value},o)}else if(i.type==="updateCpConfigId"){r.push({pubkey:i.value,isSigner:!1,isWritable:!1});let s=_([q("index")]);o=Buffer.alloc(s.span),s.encode({index:7},o)}else if(i.type==="updateAll"){console.log("Please note that this update will overwrite all data in the platform account with the new data."),r.push({pubkey:i.value.cpConfigId,isSigner:!1,isWritable:!1});let s=_([q("index"),M("platformClaimFeeWallet"),M("platformLockNftWallet"),A("platformScale"),A("creatorScale"),A("burnScale"),A("feeRate"),pe("name"),pe("web"),pe("img")]);o=Buffer.alloc(1+32+32+8*4+4*3+Buffer.from(i.value.name,"utf-8").length+Buffer.from(i.value.web,"utf-8").length+Buffer.from(i.value.img,"utf-8").length),s.encode({index:8,platformClaimFeeWallet:i.value.platformClaimFeeWallet,platformLockNftWallet:i.value.platformLockNftWallet,platformScale:i.value.migrateCpLockNftScale.platformScale,creatorScale:i.value.migrateCpLockNftScale.creatorScale,burnScale:i.value.migrateCpLockNftScale.burnScale,feeRate:i.value.feeRate,name:i.value.name,web:i.value.web,img:i.value.img},o)}else throw Error("updateInfo params type error");return new ve({keys:r,programId:n,data:Buffer.from([...Fe.updatePlaformConfig,...o])})}import{NATIVE_MINT as Zt,TOKEN_PROGRAM_ID as ae,createAssociatedTokenAccountIdempotentInstruction as wt}from"@solana/spl-token";import G from"bn.js";import{PublicKey as Zi}from"@solana/web3.js";var tt=_([A(),A("epoch"),q("curveType"),Ve("index"),A("migrateFee"),A("tradeFeeRate"),A("maxShareFeeRate"),A("minSupplyA"),A("maxLockRate"),A("minSellRateA"),A("minMigrateRateA"),A("minFundRaisingB"),M("mintB"),M("protocolFeeOwner"),M("migrateFeeOwner"),M("migrateToAmmWallet"),M("migrateToCpmmWallet"),H(A(),16)]),fs=_([A("totalLockedAmount"),A("cliffPeriod"),A("unlockPeriod"),A("startTime"),A("totalAllocatedShare")]),Ie=_([A(),A("epoch"),q("bump"),q("status"),q("mintDecimalsA"),q("mintDecimalsB"),q("migrateType"),A("supply"),A("totalSellA"),A("virtualA"),A("virtualB"),A("realA"),A("realB"),A("totalFundRaisingB"),A("protocolFee"),A("platformFee"),A("migrateFee"),fs.replicate("vestingSchedule"),M("configId"),M("platformId"),M("mintA"),M("mintB"),M("vaultA"),M("vaultB"),M("creator"),H(A(),8)]),rb=_([A(),A("epoch"),M("poolId"),M("beneficiary"),A("claimedAmount"),A("tokenShareAmount"),H(A(),8)]),Gt=_([A(),A("epoch"),M("platformClaimFeeWallet"),M("platformLockNftWallet"),A("platformScale"),A("creatorScale"),A("burnScale"),A("feeRate"),H(q(),64,"name"),H(q(),256,"web"),H(q(),256,"img"),M("cpConfigId"),H(q(),224)]);import ke from"bn.js";import Pt from"bn.js";var Ee=class{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){throw Error()}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){throw Error()}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){throw Error()}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){throw Error()}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){throw Error()}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){throw Error()}static buyExactIn({poolInfo:e,amount:t}){throw Error()}static buyExactOut({poolInfo:e,amount:t}){throw Error()}static sellExactIn({poolInfo:e,amount:t}){throw Error()}static sellExactOut({poolInfo:e,amount:t}){throw Error()}};var Xt=class extends Ee{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){return new W(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-i))}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){return new W(t.toString()).div(e.toString()).mul(10**(i-r))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){return new W(e.virtualB.add(e.realB).toString()).div(e.virtualA.sub(e.realA).toString()).mul(10**(t-i))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){return new W(r.sub(o).toString()).div(e.sub(t).sub(i).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){let r=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new W(e.virtualB.add(e.realB.add(o)).toString()).div(e.virtualA.sub(e.realA.add(r)).toString()).mul(10**(t-i))}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){if(e.lte(i))throw Error("supply need gt total sell");let s=e.sub(i).sub(r);if(s.lte(new Pt(0)))throw Error("supplyMinusSellLocked <= 0");let a=t.sub(o);if(a.lte(new Pt(0)))throw Error("tfMinusMf <= 0");let c=a.mul(i).mul(i).div(s),u=a.mul(i).div(s).sub(t);if(u.lt(new Pt(0)))throw Error("supply/totalSell/totalLockedAmount diff too high");let l=c.div(u),m=t.mul(t).div(u);if(l.lt(new Pt(0))||m.lt(new Pt(0)))throw Error("invalid input 0");return{a:l,b:m,c:i}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static getAmountOut({amountIn:e,inputReserve:t,outputReserve:i}){let r=e.mul(i),o=t.add(e);return r.div(o)}static getAmountIn({amountOut:e,inputReserve:t,outputReserve:i}){let r=t.mul(e),o=i.sub(e);return Et(r,o)}};import Hi from"bn.js";var Ht=class extends Ee{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){return new W(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-i))}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){return new W(t.toString()).div(e.toString()).mul(10**(i-r))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){return new W(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-i))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){return new W(r.sub(o).toString()).div(e.sub(t).sub(i).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){let r=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new W(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(r).toString()).mul(10**(t-i))}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){let s=e.sub(r);if(s.lte(new Hi(0)))throw Error("invalid input 1");let a=new Hi(2).mul(t).sub(o),u=t.mul(s).div(a);return{a:u,b:t,c:u}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualB,initOutput:e.virtualA})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualB,initOutput:e.virtualA})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualA,initOutput:e.virtualB})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualA,initOutput:e.virtualB})}static getAmountOut({amountIn:e,initInput:t,initOutput:i}){return i.mul(e).div(t)}static getAmountIn({amountOut:e,initInput:t,initOutput:i}){let r=t.mul(e);return Et(r,i)}};import se from"bn.js";import zi from"bn.js";var At=class{static _multipler(e){return new W(10).pow(e)}static getPrice({priceX64:e,decimalA:t,decimalB:i}){return new W(e.toString()).div(this._Q64).mul(this._multipler(t)).div(this._multipler(i))}static getPriceX64({price:e,decimalA:t,decimalB:i}){let r=e.mul(this._multipler(i)).div(this._multipler(t));return new zi(r.mul(this._Q64).toFixed(0))}};Ge(At,"_Q64",new W(new zi(1).shln(64).toString()));var zt=class extends Ee{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){return new W(0)}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){return new W(0)}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){return new W(e.virtualA.mul(e.realA).toString()).div(At._Q64).mul(10**(t-i))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){return new W(r.sub(o).toString()).div(e.sub(t).sub(i).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){let r=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new W(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(r).toString()).mul(10**(t-i))}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){let s=e.sub(r);if(s.lte(new se(0)))throw Error("supplyMinusLocked need gt 0");let a=t.mul(new se(3)).sub(o),u=t.mul(new se(2)).mul(s).div(a),l=u.mul(u),m=t.mul(new se(2)).mul(fe).div(l);if(!m.gt(new se(0)))throw Error("a need gt 0");if(!xn.gt(m))throw Error("a need lt u64 max");return{a:m,b:new se(0),c:u}}static buyExactIn({poolInfo:e,amount:t}){let i=e.realB.add(t),r=new se(2).mul(i).mul(fe).div(e.virtualA);return new se(new W(r.toString()).sqrt().toFixed(0)).sub(e.realA)}static buyExactOut({poolInfo:e,amount:t}){let i=e.realA.add(t),r=i.mul(i),{div:o,mod:s}=e.virtualA.mul(r).divmod(new se(2).mul(fe));return(s.isZero()?o:o.add(new se(1))).sub(e.realB)}static sellExactIn({poolInfo:e,amount:t}){let i=e.realA.sub(t),r=i.mul(i),{div:o,mod:s}=e.virtualA.mul(r).divmod(new se(2).mul(fe)),a=s.isZero()?o:o.add(new se(1));return e.realB.sub(a)}static sellExactOut({poolInfo:e,amount:t}){let i=e.realB.sub(t),r=new se(2).mul(i).mul(fe).div(e.virtualA),o=new se(new W(r.toString()).sqrt().toFixed(0));return e.realA.sub(o)}};var he=class{static getPoolCurvePointByPoolInfo({curveType:e,pointCount:t,poolInfo:i}){return this.getPoolCurvePointByInit({curveType:e,pointCount:t,supply:i.supply,totalFundRaising:i.totalFundRaisingB,totalSell:i.totalSellA,totalLockedAmount:i.vestingSchedule.totalLockedAmount,migrateFee:i.migrateFee,decimalA:i.mintDecimalsA,decimalB:i.mintDecimalsB})}static getPoolCurvePointByInit({curveType:e,pointCount:t,supply:i,totalFundRaising:r,totalSell:o,totalLockedAmount:s,migrateFee:a,decimalA:c,decimalB:u}){if(t<3)throw Error("point count < 3");let l=this.getCurve(e),m=l.getInitParam({supply:i,totalFundRaising:r,totalSell:o,totalLockedAmount:s,migrateFee:a}),d=l.getPoolInitPriceByInit({...m,decimalA:c,decimalB:u}),p=r.div(new ke(t-1)),f=new ke(0),g=[{price:d,totalSellSupply:0}],{a:w,b:k}=m,y=f,b=f;for(let h=1;h<t;h++){let T=h!==t-1?p:r.sub(b),B=this.buyExactIn({poolInfo:{virtualA:w,virtualB:k,realA:y,realB:b,totalFundRaisingB:r,totalSellA:o},amountB:T,protocolFeeRate:f,platformFeeRate:f,curveType:e,shareFeeRate:f});y=y.add(B.amountA),b=b.add(B.amountB);let x=this.getPrice({poolInfo:{virtualA:w,virtualB:k,realA:y,realB:b},decimalA:c,decimalB:u,curveType:e});g.push({price:x,totalSellSupply:new W(y.toString()).div(10**c).toNumber()})}return g}static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i,curveType:r}){return this.getCurve(r).getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i})}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r,curveType:o}){return this.getCurve(o).getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r})}static getPrice({poolInfo:e,curveType:t,decimalA:i,decimalB:r}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:i,decimalB:r})}static getEndPrice({poolInfo:e,curveType:t,decimalA:i,decimalB:r}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:i,decimalB:r})}static getPoolEndPriceReal({poolInfo:e,curveType:t,decimalA:i,decimalB:r}){return this.getCurve(t).getPoolEndPriceReal({poolInfo:e,decimalA:i,decimalB:r})}static checkParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,decimals:o,config:s,migrateType:a}){if(Number(o)!==6)throw Error("decimals = 6");if(e.mul(s.maxLockRate).div(We).lt(r))throw Error("total lock amount gte max lock amount");if(e.lt(s.minSupplyA.mul(new ke(10**o))))throw Error("supply lt min supply");let u=e.mul(s.minSellRateA).div(We);if(i.lt(u))throw Error("invalid input");if(t.lt(s.minFundRaisingB))throw Error("total fund raising lt min fund raising");let l=e.sub(i).sub(r),m=e.mul(s.minMigrateRateA).div(We);if(l.lt(m))throw Error("migrate lt min migrate amount");let d=e.sub(i).sub(r),p=new ke(new W(d.mul(t).toString()).sqrt().toFixed(0));if(a==="amm"){let f=new ke(10).pow(new ke(o));if(p.lte(f))throw Error("check migrate lp error")}else if(a==="cpmm"){let f=new ke(100);if(p.lte(f))throw Error("check migrate lp error")}else throw Error("migrate type error")}static buyExactIn({poolInfo:e,amountB:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s}){let a=i.add(s).add(r),c=this.calculateFee({amount:t,feeRate:a}),u=t.sub(c),l=this.getCurve(o),m=l.buyExactIn({poolInfo:e,amount:u}),d=e.totalSellA.sub(e.realA),p,f,g;if(m.gt(d)){p=d;let k=l.buyExactOut({poolInfo:e,amount:p});f=this.calculatePreFee({postFeeAmount:k,feeRate:a}),g=f.sub(k)}else p=m,f=t,g=c;let w=this.splitFee({totalFee:g,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s});return{amountA:p,amountB:f,splitFee:w}}static buyExactOut({poolInfo:e,amountA:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s}){let a=e.totalSellA.sub(e.realA),c=t;t.gt(a)&&(c=a);let l=this.getCurve(o).buyExactOut({poolInfo:e,amount:t}),m=i.add(s).add(r),d=this.calculatePreFee({postFeeAmount:l,feeRate:m}),p=d.sub(l),f=this.splitFee({totalFee:p,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s});return{amountA:c,amountB:d,splitFee:f}}static sellExactIn({poolInfo:e,amountA:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s}){let c=this.getCurve(o).sellExactIn({poolInfo:e,amount:t}),u=this.calculateFee({amount:c,feeRate:i.add(s).add(r)}),l=this.splitFee({totalFee:u,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s});return{amountA:t,amountB:c.sub(u),splitFee:l}}static sellExactOut({poolInfo:e,amountB:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s}){let a=i.add(s).add(r),c=this.calculatePreFee({postFeeAmount:t,feeRate:a});if(e.realB.lt(c))throw Error("Insufficient liquidity");let u=c.sub(t),m=he.getCurve(o).sellExactOut({poolInfo:e,amount:c});if(m.gt(e.realA))throw Error();let d=this.splitFee({totalFee:u,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s});return{amountA:m,amountB:t,splitFee:d}}static splitFee({totalFee:e,protocolFeeRate:t,platformFeeRate:i,shareFeeRate:r}){let o=t.add(i).add(r),s=o.isZero()?new ke(0):e.mul(i).div(o),a=o.isZero()?new ke(0):e.mul(r).div(o),c=e.sub(s).sub(a);return{platformFee:s,shareFee:a,protocolFee:c}}static calculateFee({amount:e,feeRate:t}){return oi(e,t,We)}static calculatePreFee({postFeeAmount:e,feeRate:t}){if(t.isZero())return e;let i=e.mul(We),r=We.sub(t);return i.add(r).sub(new ke(1)).div(r)}static getCurve(e){switch(e){case 0:return Xt;case 1:return Ht;case 2:return zt}throw Error("find curve error")}};var Ue={initPriceX64:new G("515752397214619"),supply:new G(1e15),totalSellA:new G(7931e11),totalFundRaisingB:new G(85e9),totalLockedAmount:new G("0"),cliffPeriod:new G("0"),unlockPeriod:new G("0"),decimals:6,virtualA:new G("1073471847374405"),virtualB:new G("30050573465"),realA:new G(0),realB:new G(0),protocolFee:new G(0),platformId:new Zi("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),vestingSchedule:{totalLockedAmount:new G(0),cliffPeriod:new G(0),unlockPeriod:new G(0),startTime:new G(0),totalAllocatedShare:new G(0)}},jt=new G(1e4),En=class extends Qe{constructor(e){super(e)}async createLaunchpad({programId:e=we,authProgramId:t,platformId:i=Ue.platformId,mintA:r,decimals:o=6,mintBDecimals:s=9,name:a,symbol:c,uri:u,migrateType:l,configId:m,configInfo:d,platformFeeRate:p,txVersion:f,computeBudgetConfig:g,txTipConfig:w,feePayer:k,buyAmount:y,minMintAAmount:b,slippage:h,associatedOnly:T=!0,checkCreateATAOwner:B=!1,extraSigners:x,...L}){let F=this.createTxBuilder(k);t=t??qe(e).publicKey;let N=d;if(!N&&m){let ge=await this.scope.connection.getAccountInfo(m);ge&&(N=tt.decode(ge.data))}N||this.logAndCreateError("config not found");let v=N.mintB,I=N.curveType,{publicKey:D}=qt(e,r,v),{publicKey:Y}=Rn(e,D,r),{publicKey:V}=Rn(e,D,v),{publicKey:U}=Cn(r);console.log(`create token: ${r.toBase58()}, mintB: ${v.toBase58()}, decimals A:${o}/B:${s}, config:${m.toBase58()}`),c.length>10&&this.logAndCreateError("Symbol length should shorter than 11"),u||this.logAndCreateError("uri should not empty"),y.lte(new G(0))&&this.logAndCreateError("buy amount should gt 0:",y.toString());let be=L?.supply??Ue.supply,J=L?.totalSellA??Ue.totalSellA,te=L?.totalFundRaisingB??Ue.totalFundRaisingB,X=L?.totalLockedAmount??new G(0),ce=p;if(!p){let ge=await this.scope.connection.getAccountInfo(i);ge||this.logAndCreateError("platform id not found:",i.toString()),ce=Gt.decode(ge.data).feeRate}let On=he.getCurve(N.curveType).getInitParam({supply:be,totalFundRaising:te,totalSell:J,totalLockedAmount:X,migrateFee:N.migrateFee}),Te={epoch:new G(896),bump:254,status:0,mintDecimalsA:o,mintDecimalsB:s,supply:be,totalSellA:J,mintA:new Zi(r),mintB:v,virtualA:On.a,virtualB:On.b,realA:Ue.realA,realB:Ue.realB,migrateFee:N.migrateFee,migrateType:l==="amm"?0:1,protocolFee:Ue.protocolFee,platformFee:ce,platformId:i,configId:m,vaultA:Y,vaultB:V,creator:this.scope.ownerPubKey,totalFundRaisingB:te,vestingSchedule:{totalLockedAmount:X,cliffPeriod:new G(0),unlockPeriod:new G(0),startTime:new G(0),totalAllocatedShare:new G(0)}},ji=he.getCurve(N.curveType),{c:Qi}=ji.getInitParam({supply:Te.supply,totalFundRaising:Te.totalFundRaisingB,totalLockedAmount:X,totalSell:N.curveType===0?Te.totalSellA:new G(0),migrateFee:N.migrateFee});try{he.checkParam({supply:Te.supply,totalFundRaising:Te.totalFundRaisingB,totalSell:Qi,totalLockedAmount:X,decimals:Te.mintDecimalsA,config:N,migrateType:l}),console.log("check init params success")}catch(ge){this.logAndCreateError(`check create mint params failed, ${ge.message}`)}F.addInstruction({instructions:[Wi(e,k??this.scope.ownerPubKey,this.scope.ownerPubKey,m,i,t,D,r,v,Y,V,U,ae,ae,o,a,c,u||"https://",{type:I===0?"ConstantCurve":I===1?"FixedCurve":I===2?"LinearCurve":"ConstantCurve",totalSellA:J,migrateType:l,supply:be,totalFundRaisingB:te},X,L?.cliffPeriod??new G(0),L?.unlockPeriod??new G(0))]});let Qt=new G(0),Yt;if(x?.length&&F.addInstruction({signers:x}),!L.createOnly){let{builder:ge,extInfo:Yi}=await this.buyToken({programId:e,authProgramId:t,mintA:r,mintB:v,poolInfo:Te,buyAmount:y,minMintAAmount:b,shareFeeRate:L.shareFeeRate,shareFeeReceiver:L.shareFeeReceiver,configInfo:N,platformFeeRate:ce,slippage:h,associatedOnly:T,checkCreateATAOwner:B});F.addInstruction({...ge.AllTxData}),Qt=Yi.outAmount,Yt=(this.scope.cluster==="devnet"||f===1)&&L.shareFeeReceiver?[ge.allInstructions[0]]:void 0}return F.addTipInstruction(w),f===0?F.sizeCheckBuildV0({computeBudgetConfig:g,outAmount:Qt,splitIns:Yt,address:{...Te,poolId:D}}):F.sizeCheckBuild({computeBudgetConfig:g,outAmount:Qt,splitIns:Yt,address:{...Te,poolId:D}})}async buyToken({programId:e=we,authProgramId:t,mintA:i,mintB:r=Zt,poolInfo:o,configInfo:s,platformFeeRate:a,txVersion:c,computeBudgetConfig:u,txTipConfig:l,feePayer:m,buyAmount:d,minMintAAmount:p,slippage:f,shareFeeRate:g=new G(0),shareFeeReceiver:w,associatedOnly:k=!0,checkCreateATAOwner:y=!1}){d.lte(new G(0))&&this.logAndCreateError("buy amount should gt 0:",d.toString());let b=this.createTxBuilder(m),{publicKey:h}=qt(e,i,r);t=t??qe(e).publicKey;let T=null,B=null,x=r.equals(Zt),{account:L,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({mint:i,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:k,checkCreateATAOwner:y});L&&(T=L),b.addInstruction(F||{}),T===void 0&&this.logAndCreateError(`cannot found mintA(${i.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let{account:N,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:x?{payer:this.scope.ownerPubKey,amount:d}:void 0,skipCloseAccount:!x,notUseTokenAccount:x,associatedOnly:x?!1:k,checkCreateATAOwner:y});N&&(B=N),b.addInstruction(v||{}),B===void 0&&this.logAndCreateError(`cannot found mintB(${r.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let I=o;if(!I){let X=await this.scope.connection.getAccountInfo(h,{commitment:"processed"});X||this.logAndCreateError("cannot found pool:",h.toBase58()),I=Ie.decode(X.data)}let D=s,Y=await _e(this.scope.connection,[D?void 0:I.configId,a?void 0:I.platformId].filter(Boolean).map(X=>({pubkey:X})));if(!D){let X=Y.find(ce=>ce.pubkey.equals(I.configId));(!X||!X.accountInfo)&&this.logAndCreateError("config not found: ",I.configId.toBase58()),D=tt.decode(X.accountInfo.data)}if(!a){let X=Y.find(ce=>ce.pubkey.equals(I.platformId));(!X||!X.accountInfo)&&this.logAndCreateError("platform info not found: ",I.configId.toBase58()),a=Gt.decode(X.accountInfo.data).feeRate}let V=he.buyExactIn({poolInfo:I,amountB:d,protocolFeeRate:D.tradeFeeRate,platformFeeRate:a,curveType:D.curveType,shareFeeRate:g}),U=new W(V.amountA.toString()),be=f?new W(jt.sub(f).toNumber()/jt.toNumber()).clampedTo(0,1):new W(1),J=p??(f?new G(U.mul(be).toFixed(0)):V.amountA);V.amountB.lt(d)&&console.log(`maximum ${i.toBase58()} amount can buy is ${V.amountA.toString()}, input ${r.toBase58()} amount: ${V.amountB.toString()}`);let te=w?Me(w,r,ae).publicKey:void 0;return te&&b.addInstruction({instructions:[wt(this.scope.ownerPubKey,te,w,r)]}),b.addInstruction({instructions:[_i(e,this.scope.ownerPubKey,t,I.configId,I.platformId,h,T,B,I.vaultA,I.vaultB,i,r,ae,ae,V.amountB.lt(d)?V.amountB:d,J,g,te)]}),b.addCustomComputeBudget(u),b.addTipInstruction(l),b.versionBuild({txVersion:c,extInfo:{outAmount:J}})}async sellToken({programId:e=we,authProgramId:t,mintA:i,mintB:r=Zt,poolInfo:o,configInfo:s,platformFeeRate:a,txVersion:c,computeBudgetConfig:u,txTipConfig:l,feePayer:m,sellAmount:d,minAmountB:p,slippage:f,shareFeeRate:g=new G(0),shareFeeReceiver:w,associatedOnly:k=!0,checkCreateATAOwner:y=!1}){t=t??qe(e).publicKey;let b=this.createTxBuilder(m);d.lte(new G(0))&&this.logAndCreateError("sell amount should be gt 0");let{publicKey:h}=qt(e,i,r),T=null,B=null,x=r.equals(Zt),{account:L,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({mint:i,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:k,checkCreateATAOwner:y});L&&(T=L),b.addInstruction(F||{}),T===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:N,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:x?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!x,notUseTokenAccount:x,associatedOnly:x?!1:k,checkCreateATAOwner:y});N&&(B=N),b.addInstruction(v||{}),B===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let I=o;if(!I){let X=await this.scope.connection.getAccountInfo(h,{commitment:"processed"});X||this.logAndCreateError("cannot found pool",h.toBase58()),I=Ie.decode(X.data)}let D=s,Y=await _e(this.scope.connection,[D?void 0:I.configId,a?void 0:I.platformId].filter(Boolean).map(X=>({pubkey:X})));if(!D){let X=Y.find(ce=>ce.pubkey.equals(I.configId));(!X||!X.accountInfo)&&this.logAndCreateError("config not found: ",I.configId.toBase58()),D=tt.decode(X.accountInfo.data)}if(!a){let X=Y.find(ce=>ce.pubkey.equals(I.platformId));(!X||!X.accountInfo)&&this.logAndCreateError("platform info not found: ",I.configId.toBase58()),a=Gt.decode(X.accountInfo.data).feeRate}let V=he.sellExactIn({poolInfo:I,amountA:d,protocolFeeRate:D.tradeFeeRate,platformFeeRate:a,curveType:D.curveType,shareFeeRate:g}),U=new W(V.amountB.toString()),be=f?new W(jt.sub(f).toNumber()/jt.toNumber()).clampedTo(0,1):new W(1),J=p??(f?new G(U.mul(be).toFixed(0)):V.amountB);J.lte(new G(0))&&this.logAndCreateError(`out ${r.toBase58()} amount should be gt 0`);let te=w?Me(w,r,ae).publicKey:void 0;return te&&b.addInstruction({instructions:[wt(this.scope.ownerPubKey,te,w,r)]}),b.addInstruction({instructions:[Vi(e,this.scope.ownerPubKey,t,I.configId,I.platformId,h,T,B,I.vaultA,I.vaultB,i,r,ae,ae,V.amountA.lt(d)?V.amountA:d,J,g,te)]}),b.addCustomComputeBudget(u),b.addTipInstruction(l),b.versionBuild({txVersion:c,extInfo:{outAmount:J}})}async createPlatformConfig({programId:e=we,platformAdmin:t,platformClaimFeeWallet:i,platformLockNftWallet:r,cpConfigId:o,migrateCpLockNftScale:s,feeRate:a,name:c,web:u,img:l,txVersion:m,computeBudgetConfig:d,txTipConfig:p,feePayer:f}){let g=this.createTxBuilder(f),{publicKey:w}=Mn(e,t);return g.addInstruction({instructions:[Gi(e,t,i,r,w,o,s,a,c,u,l)]}),g.addCustomComputeBudget(d),g.addTipInstruction(p),g.versionBuild({txVersion:m,extInfo:{platformId:w}})}async updatePlatformConfig({programId:e=we,platformAdmin:t,platformId:i,updateInfo:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),l=i??Mn(e,t).publicKey;return u.addInstruction({instructions:[Xi(e,t,l,r)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async claimPlatformFee({programId:e=we,authProgramId:t,platformId:i,poolId:r,platformClaimFeeWallet:o,mintB:s,vaultB:a,mintBProgram:c=ae,txVersion:u,computeBudgetConfig:l,txTipConfig:m,feePayer:d}){let p=this.createTxBuilder(d);t=t??qe(e).publicKey;let f=s,g=a;if(!f){let k=await this.scope.connection.getAccountInfo(r,{commitment:"processed"});k||this.logAndCreateError("cannot found pool:",r.toBase58());let y=Ie.decode(k.data),b=await this.scope.connection.getAccountInfo(y.configId,{commitment:"processed"});b||this.logAndCreateError("cannot found config:",y.configId.toBase58()),f=tt.decode(b.data).mintB,g=g??y.vaultB}(!f||!g)&&this.logAndCreateError("cannot found mint info, mintB: ",f.toBase58(),", vaultB: ",g?.toBase58()??"");let w=Me(this.scope.ownerPubKey,f,ae).publicKey;return p.addInstruction({instructions:[wt(this.scope.ownerPubKey,w,this.scope.ownerPubKey,f)]}),p.addInstruction({instructions:[Fn(e,o,t,r,i,g,w,f,c)]}),p.addCustomComputeBudget(l),p.addTipInstruction(m),p.versionBuild({txVersion:u})}async claimAllPlatformFee({programId:e=we,authProgramId:t,platformId:i,platformClaimFeeWallet:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c);return t=t??qe(e).publicKey,(await this.scope.connection.getProgramAccounts(e,{filters:[{dataSize:Ie.span},{memcmp:{offset:Ie.offsetOf("platformId"),bytes:i.toString()}}]})).forEach(m=>{let d=Ie.decode(m.account.data),p=Me(this.scope.ownerPubKey,d.mintB,ae).publicKey;u.addInstruction({instructions:[wt(this.scope.ownerPubKey,p,this.scope.ownerPubKey,d.mintB)]}),u.addInstruction({instructions:[Fn(e,r,t,m.pubkey,i,d.vaultB,p,d.mintB,ae)]})}),u.addTipInstruction(a),o===0?u.sizeCheckBuildV0({computeBudgetConfig:s}):u.sizeCheckBuild({computeBudgetConfig:s})}async createVesting({programId:e=we,poolId:t,beneficiary:i,shareAmount:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),l=vn(e,t,i).publicKey;return u.addInstruction({instructions:[Ui(e,this.scope.ownerPubKey,i,t,l,r)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async claimVesting({programId:e=we,poolId:t,poolInfo:i,txVersion:r,computeBudgetConfig:o,txTipConfig:s,feePayer:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1}){let l=this.createTxBuilder(a),m=qe(e).publicKey,d=vn(e,t,this.scope.ownerPubKey).publicKey,p=i;if(!p){let g=await this.scope.connection.getAccountInfo(t);g||this.logAndCreateError("pool not found"),p=Ie.decode(g.data)}let f=Me(this.scope.ownerPubKey,p.mintA,ae).publicKey;return l.addInstruction({instructions:[wt(this.scope.ownerPubKey,f,this.scope.ownerPubKey,p.mintA)]}),l.addInstruction({instructions:[qi(e,this.scope.ownerPubKey,m,t,d,f,p.vaultA,p.mintA,ae)]}),l.addCustomComputeBudget(o),l.addTipInstruction(s),l.versionBuild({txVersion:r})}async getRpcPoolInfo({poolId:e}){return(await this.getRpcPoolsInfo({poolIdList:[e]})).poolInfoMap[e.toBase58()]}async getRpcPoolsInfo({poolIdList:e,config:t}){let i=await _e(this.scope.connection,e.map(c=>({pubkey:c})),t),r={},o=[];for(let c=0;c<e.length;c++){let u=i[c];if(u===null||!u.accountInfo)throw Error("fetch pool info error: "+e[c].toBase58());let l=Ie.decode(u.accountInfo.data);r[e[c].toBase58()]={...l,poolId:u.accountInfo.owner},o.push(l.configId)}let s=await _e(this.scope.connection,o.map(c=>({pubkey:c})),t),a={};for(let c=0;c<o.length;c++){let u=s[c];if(u===null||!u.accountInfo)throw Error("fetch config info error: "+o[c].toBase58());let l=tt.decode(u.accountInfo.data);a[o[c].toBase58()]={...l,configId:u.accountInfo.owner}}return{poolInfoMap:Object.keys(r).reduce((c,u)=>({...c,[u]:{...r[u],configInfo:a[r[u].configId.toBase58()]}}),{})}}};export{Ue as LaunchpadPoolInitParam,En as default};
//# sourceMappingURL=launchpad.mjs.map