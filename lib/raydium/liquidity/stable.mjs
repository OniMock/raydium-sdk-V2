import{PublicKey as K}from"@solana/web3.js";import{PublicKey as Qe}from"@solana/web3.js";import I,{isBN as M}from"bn.js";import{bits as $,BitStructure as ee,blob as R,Blob as te,cstr as ne,f32 as re,f32be as oe,f64 as se,f64be as ue,greedy as ae,Layout as v,ns64 as ie,ns64be as ce,nu64 as pe,nu64be as ye,offset as me,s16 as de,s16be as le,s24 as be,s24be as fe,s32 as xe,s32be as Pe,s40 as ge,s40be as Le,s48 as he,s48be as Te,s8 as Se,seq as A,struct as Be,Structure as V,u16 as _e,u16be as we,u24 as Ee,u24be as Ue,u32 as Ie,u32be as Me,u40 as Ne,u40be as Ce,u48 as ke,u48be as De,u8 as Re,UInt as ve,union as Ae,Union as Ve,unionLayoutDiscriminator as Ke,utf8 as qe}from"@solana/buffer-layout";var _=v,w=V;var E=A;var U=R;var g=class extends _{blob;signed;constructor(n,o,s){super(n,s),this.blob=U(n),this.signed=o}decode(n,o=0){let s=new I(this.blob.decode(n,o),10,"le");return this.signed?s.fromTwos(this.span*8).clone():s}encode(n,o,s=0){return typeof n=="number"&&(n=new I(n)),this.signed&&(n=n.toTwos(this.span*8)),this.blob.encode(n.toArrayLike(Buffer,"le",this.span),o,s)}};function b(e){return new g(8,!1,e)}var L=class extends w{decode(n,o){return super.decode(n,o)}};function h(e,n,o){return new L(e,n,o)}function N(e,n,o){let s,u=typeof n=="number"?n:M(n)?n.toNumber():new Proxy(n,{get(a,t){if(!s){let r=Reflect.get(a,"count");s=M(r)?r.toNumber():r,Reflect.set(a,"count",s)}return Reflect.get(a,t)},set(a,t,r){return t==="count"&&(s=r),Reflect.set(a,t,r)}});return E(e,u,o)}var q=new K("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),P=5e4,X=h([b("x"),b("y"),b("price")]),Y=h([b("accountType"),b("status"),b("multiplier"),b("validDataCount"),N(X,P,"DataElement")]);function F(e,n){return[0,P-2]}function Z(e){return[0,P-2]}function j(e){return[0,P-2]}function z(e,n,o){let[s,u]=F(n,o),a=s,t=u,r=0,i=n*e.multiplier/o;for(;a<=t;){if(r=Math.floor((t+a)/2),r===0||r>=P-2)return[r,r,!1];let p=e.DataElement[r].x*e.multiplier/e.DataElement[r].y,c=e.DataElement[r-1].x*e.multiplier/e.DataElement[r-1].y,y=e.DataElement[r+1].x*e.multiplier/e.DataElement[r+1].y;if(i===p)return[r,r,!0];if(i===c)return[r-1,r-1,!0];if(i===y)return[r+1,r+1,!0];if(i<c)t=r-1;else{if(i>c&&i<p)return[r-1,r,!0];if(i>p&&i<y)return[r,r+1,!0];a=r+1}}return[r,r,!1]}function T(e,n,o){let[s,u,a]=z(e,n,o);if(!a)return 0;if(s===u){let t=e.DataElement[s].x;return n*e.multiplier/t}else{let t=e.DataElement[s].x,r=e.DataElement[s].y,i=e.DataElement[u].x,p=e.DataElement[u].y,c=o*(i*r-t*p),y=t*c,m=(i-t)*(n*r-t*o)*p,d=y+m;return n*e.multiplier*c/d}}function x(e,n,o){return n*e.multiplier/o}function k(e,n,o){return n*o/e.multiplier}function G(e,n){let[o,s]=Z(n),u=o,a=s,t=0,r=n;for(;u<a;){if(t=Math.floor((a+u)/2),t<=0||t>P-2)return[t,t,!1];let i=e.DataElement[t].x,p=e.DataElement[t-1].x,c=e.DataElement[t+1].x;if(r===i)return[t,t,!0];if(r===p)return[t-1,t-1,!0];if(r===c)return[t+1,t+1,!0];if(r<p)a=t-1;else{if(r>p&&r<i)return[t-1,t,!0];if(r>i&&r<c)return[t,t+1,!0];u=t+1}}return[t,t,!1]}function O(e,n){let[o,s]=j(n),u=o,a=s,t=0,r=n;for(;u<=a;){if(t=Math.floor((a+u)/2),t<=0||t>=P-2)return[t,t,!1];let i=e.DataElement[t].y,p=e.DataElement[t-1].y,c=e.DataElement[t+1].y;if(r===i)return[t,t,!0];if(r===p)return[t-1,t-1,!0];if(r===c)return[t+1,t+1,!0];if(r<c)u=t+1;else{if(r<p&&r>i)return[t-1,t,!0];if(r<i&&r>c)return[t,t+1,!0];a=t-1}}return[t,t,!1]}function D(e,n,o,s){let u=s?n+o:n-o,[a,t,r]=G(e,u);if(!r)return[0,0,!1,r];if(a===t)return[e.DataElement[t].price,e.DataElement[t].y,!1,r];{let i=e.DataElement[a].x,p=e.DataElement[t].x,c=e.DataElement[a].price,y=e.DataElement[t].price,m=e.DataElement[a].y,d=e.DataElement[t].y;if(n>=i&&n<=p)return s?[y,d,!0,r]:[c,m,!0,r];{let l,f;return s?(l=c+(y-c)*(n-i)/(p-i),f=m-(u-i)*e.multiplier/y):(l=c+(y-c)*(n-i)/(p-i),f=d+(p-u)*e.multiplier/c),[l,f,!1,r]}}}function H(e,n,o,s){let u=s?n-o:n+o,[a,t,r]=O(e,u);if(!r)return[0,0,!1,r];if(a===t)return[e.DataElement[t].price,e.DataElement[t].x,!1,r];{let i=e.DataElement[a].x,p=e.DataElement[t].x,c=e.DataElement[a].price,y=e.DataElement[t].price,m=e.DataElement[a].y,d=e.DataElement[t].y;if(n>=d&&n<=m)return s?[y,p,!0,r]:[c,i,!0,r];{let l,f;return s?(l=c+(y-c)*(m-n)/(m-d),f=i+y*(m-u)/e.multiplier):(l=c+(y-c)*(m-n)/(m-d),f=p-c*(u-d)/e.multiplier),[l,f,!1,r]}}}function J(e,n){let o=D(e,n,0,!1);return o[3]?o[0]:0}function st(e,n,o,s){let u=T(e,n,o),a=x(e,n,u),t=x(e,o,u),r=x(e,s,u),i=!0,[p,c,y,m]=D(e,a,r,i);if(!m)return 0;if(y)return s*e.multiplier/p;{let d=t-c;return k(e,d,u)}}function ut(e,n,o,s){let u=T(e,n,o),a=x(e,n,u),t=x(e,o,u),r=x(e,s,u),i=!1,[p,c,y,m]=H(e,t,r,i);if(!m)return 0;if(y)return s*p/e.multiplier;{let d=a-c;return k(e,d,u)}}function Q(e){let n=Y.decode(e);return{accountType:n.accountType.toNumber(),status:n.status.toNumber(),multiplier:n.multiplier.toNumber(),validDataCount:n.validDataCount.toNumber(),DataElement:n.DataElement.map(o=>({x:o.x.toNumber(),y:o.y.toNumber(),price:o.price.toNumber()}))}}function at(e,n,o,s){let u=J(e,x(e,n,T(e,n,o)))/e.multiplier;return s?u:1/u}var C=class{connection;_layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};constructor({connection:n}){this.connection=n}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(this._layoutData.validDataCount===0&&this.connection){let n=await this.connection.getAccountInfo(q);n&&(this._layoutData=Q(n?.data))}}};export{X as DataElement,q as MODEL_DATA_PUBKEY,C as StableLayout,Q as formatLayout,ut as getDxByDyBaseIn,st as getDyByDxBaseIn,at as getStablePrice,Y as modelDataInfoLayout};
//# sourceMappingURL=stable.mjs.map