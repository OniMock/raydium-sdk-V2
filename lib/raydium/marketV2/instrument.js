var F=Object.create;var d=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var v=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var D=(r,e)=>{for(var t in e)d(r,t,{get:e[t],enumerable:!0})},A=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let u of M(e))!N.call(r,u)&&u!==t&&d(r,u,{get:()=>e[u],enumerable:!(o=R(e,u))||o.enumerable});return r};var W=(r,e,t)=>(t=r!=null?F(v(r)):{},A(e||!r||!r.__esModule?d(t,"default",{value:r,enumerable:!0}):t,r)),E=r=>A(d({},"__esModule",{value:!0}),r);var O={};D(O,{initializeMarket:()=>U,makeCreateMarketInstruction:()=>k});module.exports=E(O);var a=require("@solana/web3.js"),y=require("@solana/spl-token");var i={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip",NonceAccount:"NonceAccount"};var _=require("@solana/web3.js"),m=W(require("bn.js"));var n=require("@solana/buffer-layout"),b=n.Layout,C=n.Structure;var g=n.UInt;var V=n.u16;var L=n.u32;var p=n.blob;var S=n.bits;var f=class extends b{blob;signed;constructor(e,t,o){super(e,o),this.blob=p(e),this.signed=t}decode(e,t=0){let o=new m.default(this.blob.decode(e,t),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(e,t,o=0){return typeof e=="number"&&(e=new m.default(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),t,o)}},P=class extends b{_lower;_upper;constructor(e){super(8,e),this._lower=S(L(),!1),this._upper=S(L(),!1)}addBoolean(e){this._lower.fields.length<32?this._lower.addBoolean(e):this._upper.addBoolean(e)}decode(e,t=0){let o=this._lower.decode(e,t),u=this._upper.decode(e,t+this._lower.span);return{...o,...u}}encode(e,t,o=0){return this._lower.encode(e,t,o)+this._upper.encode(e,t,o+this._lower.span)}};function q(r){return new g(1,r)}function K(r){return new g(4,r)}function s(r){return new f(8,!1,r)}var h=class extends b{layout;decoder;encoder;constructor(e,t,o,u){super(e.span,u),this.layout=e,this.decoder=t,this.encoder=o}decode(e,t){return this.decoder(this.layout.decode(e,t))}encode(e,t,o){return this.layout.encode(this.encoder(e),t,o)}getSpan(e,t){return this.layout.getSpan(e,t)}};function c(r){return new h(p(32),e=>new _.PublicKey(e),e=>e.toBuffer(),r)}var w=class extends C{decode(e,t){return super.decode(e,t)}};function x(r,e,t){return new w(r,e,t)}function Q(r="accountFlags"){let e=new P(r);return e.addBoolean("initialized"),e.addBoolean("market"),e.addBoolean("openOrders"),e.addBoolean("requestQueue"),e.addBoolean("eventQueue"),e.addBoolean("bids"),e.addBoolean("asks"),e}var T=x([p(5),Q("accountFlags"),c("ownAddress"),s("vaultSignerNonce"),c("baseMint"),c("quoteMint"),c("baseVault"),s("baseDepositsTotal"),s("baseFeesAccrued"),c("quoteVault"),s("quoteDepositsTotal"),s("quoteFeesAccrued"),s("quoteDustThreshold"),c("requestQueue"),c("eventQueue"),c("bids"),c("asks"),s("baseLotSize"),s("quoteLotSize"),s("feeRateBps"),s("referrerRebatesAccrued"),p(7)]);function U({programId:r,marketInfo:e}){let t=x([q("version"),K("instruction"),s("baseLotSize"),s("quoteLotSize"),V("feeRateBps"),s("vaultSignerNonce"),s("quoteDustThreshold")]),o=[{pubkey:e.id,isSigner:!1,isWritable:!0},{pubkey:e.requestQueue,isSigner:!1,isWritable:!0},{pubkey:e.eventQueue,isSigner:!1,isWritable:!0},{pubkey:e.bids,isSigner:!1,isWritable:!0},{pubkey:e.asks,isSigner:!1,isWritable:!0},{pubkey:e.baseVault,isSigner:!1,isWritable:!0},{pubkey:e.quoteVault,isSigner:!1,isWritable:!0},{pubkey:e.baseMint,isSigner:!1,isWritable:!1},{pubkey:e.quoteMint,isSigner:!1,isWritable:!1},{pubkey:e.authority?e.quoteMint:a.SYSVAR_RENT_PUBKEY,isSigner:!1,isWritable:!1}].concat(e.authority?{pubkey:e.authority,isSigner:!1,isWritable:!1}:[]).concat(e.authority&&e.pruneAuthority?{pubkey:e.pruneAuthority,isSigner:!1,isWritable:!1}:[]),u=Buffer.alloc(t.span);return t.encode({version:0,instruction:0,baseLotSize:e.baseLotSize,quoteLotSize:e.quoteLotSize,feeRateBps:e.feeRateBps,vaultSignerNonce:e.vaultSignerNonce,quoteDustThreshold:e.quoteDustThreshold},u),new a.TransactionInstruction({keys:o,programId:r,data:u})}async function k({connection:r,wallet:e,marketInfo:t}){let o=new a.Transaction,u=await r.getMinimumBalanceForRentExemption(165);o.add(a.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.baseVault.seed,newAccountPubkey:t.baseVault.publicKey,lamports:u,space:165,programId:y.TOKEN_PROGRAM_ID}),a.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.quoteVault.seed,newAccountPubkey:t.quoteVault.publicKey,lamports:u,space:165,programId:y.TOKEN_PROGRAM_ID}),(0,y.createInitializeAccountInstruction)(t.baseVault.publicKey,t.baseMint,t.vaultOwner),(0,y.createInitializeAccountInstruction)(t.quoteVault.publicKey,t.quoteMint,t.vaultOwner),a.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.id.seed,newAccountPubkey:t.id.publicKey,lamports:await r.getMinimumBalanceForRentExemption(T.span),space:T.span,programId:t.programId}));let B=new a.Transaction;return B.add(a.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.requestQueue.seed,newAccountPubkey:t.requestQueue.publicKey,lamports:t.lowestFeeMarket?6208320:await r.getMinimumBalanceForRentExemption(t.requestQueueSpace??5120+12),space:t.lowestFeeMarket?764:t.requestQueueSpace??5120+12,programId:t.programId}),a.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.eventQueue.seed,newAccountPubkey:t.eventQueue.publicKey,lamports:t.lowestFeeMarket?79594560:await r.getMinimumBalanceForRentExemption(t.eventQueueSpace??262144+12),space:t.lowestFeeMarket?11308:t.eventQueueSpace??262144+12,programId:t.programId}),a.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.bids.seed,newAccountPubkey:t.bids.publicKey,lamports:t.lowestFeeMarket?101977920:await r.getMinimumBalanceForRentExemption(t.orderbookQueueSpace??65536+12),space:t.lowestFeeMarket?14524:t.orderbookQueueSpace??65536+12,programId:t.programId}),a.SystemProgram.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.asks.seed,newAccountPubkey:t.asks.publicKey,lamports:t.lowestFeeMarket?101977920:await r.getMinimumBalanceForRentExemption(t.orderbookQueueSpace??65536+12),space:t.lowestFeeMarket?14524:t.orderbookQueueSpace??65536+12,programId:t.programId}),U({programId:t.programId,marketInfo:{id:t.id.publicKey,requestQueue:t.requestQueue.publicKey,eventQueue:t.eventQueue.publicKey,bids:t.bids.publicKey,asks:t.asks.publicKey,baseVault:t.baseVault.publicKey,quoteVault:t.quoteVault.publicKey,baseMint:t.baseMint,quoteMint:t.quoteMint,baseLotSize:t.baseLotSize,quoteLotSize:t.quoteLotSize,feeRateBps:t.feeRateBps,vaultSignerNonce:t.vaultSignerNonce,quoteDustThreshold:t.quoteDustThreshold}})),[{transaction:o,signer:[],instructionTypes:[i.CreateAccount,i.CreateAccount,i.InitAccount,i.InitAccount]},{transaction:B,signer:[],instructionTypes:[i.CreateAccount,i.CreateAccount,i.CreateAccount,i.CreateAccount,i.CreateAccount,i.InitMarket]}]}0&&(module.exports={initializeMarket,makeCreateMarketInstruction});
//# sourceMappingURL=instrument.js.map