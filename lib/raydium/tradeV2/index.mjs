var ar=Object.defineProperty;var ur=(i,e,t)=>e in i?ar(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var Dt=(i,e,t)=>(ur(i,typeof e!="symbol"?e+"":e,t),t);import{PublicKey as KP}from"@solana/web3.js";import{createTransferInstruction as NP,TOKEN_PROGRAM_ID as LP,TOKEN_2022_PROGRAM_ID as RP}from"@solana/spl-token";import Gs from"bn.js";var kt=9e15,ct=1e9,pn="0123456789abcdef",Gt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Ut="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",dn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-kt,maxE:kt,crypto:!1},ni,Ye,D=!0,zt="[DecimalError] ",ut=zt+"Invalid argument: ",ii=zt+"Precision limit exceeded",ri=zt+"crypto unavailable",oi="[object Decimal]",Se=Math.floor,Pe=Math.pow,cr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,lr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,mr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,si=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,qe=1e7,W=7,pr=9007199254740991,dr=Gt.length-1,fn=Ut.length-1,T={toStringTag:oi};T.absoluteValue=T.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),E(i)};T.ceil=function(){return E(new this.constructor(this),this.e+1,2)};T.clampedTo=T.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(ut+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};T.comparedTo=T.cmp=function(i){var e,t,n,r,o=this,a=o.d,s=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!a||!s)return!u||!c?NaN:u!==c?u:a===s?0:!a^u<0?1:-1;if(!a[0]||!s[0])return a[0]?u:s[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=a.length,r=s.length,e=0,t=n<r?n:r;e<t;++e)if(a[e]!==s[e])return a[e]>s[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};T.cosine=T.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+W,n.rounding=1,t=fr(n,mi(n,t)),n.precision=i,n.rounding=e,E(Ye==2||Ye==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};T.cubeRoot=T.cbrt=function(){var i,e,t,n,r,o,a,s,u,c,l=this,p=l.constructor;if(!l.isFinite()||l.isZero())return new p(l);for(D=!1,o=l.s*Pe(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=Ie(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=Pe(t,1/3),i=Se((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new p(t),n.s=l.s):n=new p(o.toString()),a=(i=p.precision)+3;;)if(s=n,u=s.times(s).times(s),c=u.plus(l),n=ne(c.plus(l).times(s),c.plus(u),a+2,1),Ie(s.d).slice(0,a)===(t=Ie(n.d)).slice(0,a))if(t=t.slice(a-3,a+1),t=="9999"||!r&&t=="4999"){if(!r&&(E(s,i+1,0),s.times(s).times(s).eq(l))){n=s;break}a+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(E(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return D=!0,E(n,i,p.rounding,e)};T.decimalPlaces=T.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-Se(this.e/W))*W,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};T.dividedBy=T.div=function(i){return ne(this,new this.constructor(i))};T.dividedToIntegerBy=T.divToInt=function(i){var e=this,t=e.constructor;return E(ne(e,new t(i),0,1,1),t.precision,t.rounding)};T.equals=T.eq=function(i){return this.cmp(i)===0};T.floor=function(){return E(new this.constructor(this),this.e+1,3)};T.greaterThan=T.gt=function(i){return this.cmp(i)>0};T.greaterThanOrEqualTo=T.gte=function(i){var e=this.cmp(i);return e==1||e===0};T.hyperbolicCosine=T.cosh=function(){var i,e,t,n,r,o=this,a=o.constructor,s=new a(1);if(!o.isFinite())return new a(o.s?1/0:NaN);if(o.isZero())return s;t=a.precision,n=a.rounding,a.precision=t+Math.max(o.e,o.sd())+4,a.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Ht(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=At(a,1,o.times(e),new a(1),!0);for(var u,c=i,l=new a(8);c--;)u=o.times(o),o=s.minus(u.times(l.minus(u.times(l))));return E(o,a.precision=t,a.rounding=n,!0)};T.hyperbolicSine=T.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=At(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Ht(5,i)),r=At(o,2,r,r,!0);for(var a,s=new o(5),u=new o(16),c=new o(20);i--;)a=r.times(r),r=r.times(s.plus(a.times(u.times(a).plus(c))))}return o.precision=e,o.rounding=t,E(r,e,t,!0)};T.hyperbolicTangent=T.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,ne(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};T.inverseCosine=T.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?De(t,r,o):new t(0):new t(NaN):e.isZero()?De(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=De(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};T.inverseHyperbolicCosine=T.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,D=!1,t=t.times(t).minus(1).sqrt().plus(t),D=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};T.inverseHyperbolicSine=T.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,D=!1,t=t.times(t).plus(1).sqrt().plus(t),D=!0,n.precision=i,n.rounding=e,t.ln())};T.inverseHyperbolicTangent=T.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?E(new o(r),i,e,!0):(o.precision=t=n-r.e,r=ne(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};T.inverseSine=T.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=De(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};T.inverseTangent=T.atan=function(){var i,e,t,n,r,o,a,s,u,c=this,l=c.constructor,p=l.precision,m=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&p+4<=fn)return a=De(l,p+4,m).times(.25),a.s=c.s,a}else{if(!c.s)return new l(NaN);if(p+4<=fn)return a=De(l,p+4,m).times(.5),a.s=c.s,a}for(l.precision=s=p+10,l.rounding=1,t=Math.min(28,s/W+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(D=!1,e=Math.ceil(s/W),n=1,u=c.times(c),a=new l(c),r=c;i!==-1;)if(r=r.times(u),o=a.minus(r.div(n+=2)),r=r.times(u),a=o.plus(r.div(n+=2)),a.d[e]!==void 0)for(i=e;a.d[i]===o.d[i]&&i--;);return t&&(a=a.times(2<<t-1)),D=!0,E(a,l.precision=p,l.rounding=m,!0)};T.isFinite=function(){return!!this.d};T.isInteger=T.isInt=function(){return!!this.d&&Se(this.e/W)>this.d.length-2};T.isNaN=function(){return!this.s};T.isNegative=T.isNeg=function(){return this.s<0};T.isPositive=T.isPos=function(){return this.s>0};T.isZero=function(){return!!this.d&&this.d[0]===0};T.lessThan=T.lt=function(i){return this.cmp(i)<0};T.lessThanOrEqualTo=T.lte=function(i){return this.cmp(i)<1};T.logarithm=T.log=function(i){var e,t,n,r,o,a,s,u,c=this,l=c.constructor,p=l.precision,m=l.rounding,d=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(D=!1,s=p+d,a=at(c,s),n=e?Xt(l,s+10):at(i,s),u=ne(a,n,s,1),It(u.d,r=p,m))do if(s+=10,a=at(c,s),n=e?Xt(l,s+10):at(i,s),u=ne(a,n,s,1),!o){+Ie(u.d).slice(r+1,r+15)+1==1e14&&(u=E(u,p+1,0));break}while(It(u.d,r+=10,m));return D=!0,E(u,p,m)};T.minus=T.sub=function(i){var e,t,n,r,o,a,s,u,c,l,p,m,d=this,y=d.constructor;if(i=new y(i),!d.d||!i.d)return!d.s||!i.s?i=new y(NaN):d.d?i.s=-i.s:i=new y(i.d||d.s!==i.s?d:NaN),i;if(d.s!=i.s)return i.s=-i.s,d.plus(i);if(c=d.d,m=i.d,s=y.precision,u=y.rounding,!c[0]||!m[0]){if(m[0])i.s=-i.s;else if(c[0])i=new y(d);else return new y(u===3?-0:0);return D?E(i,s,u):i}if(t=Se(i.e/W),l=Se(d.e/W),c=c.slice(),o=l-t,o){for(p=o<0,p?(e=c,o=-o,a=m.length):(e=m,t=l,a=c.length),n=Math.max(Math.ceil(s/W),a)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,a=m.length,p=n<a,p&&(a=n),n=0;n<a;n++)if(c[n]!=m[n]){p=c[n]<m[n];break}o=0}for(p&&(e=c,c=m,m=e,i.s=-i.s),a=c.length,n=m.length-a;n>0;--n)c[a++]=0;for(n=m.length;n>o;){if(c[--n]<m[n]){for(r=n;r&&c[--r]===0;)c[r]=qe-1;--c[r],c[n]+=qe}c[n]-=m[n]}for(;c[--a]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=Qt(c,t),D?E(i,s,u):i):new y(u===3?-0:0)};T.modulo=T.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?E(new n(t),n.precision,n.rounding):(D=!1,n.modulo==9?(e=ne(t,i.abs(),0,3,1),e.s*=i.s):e=ne(t,i,0,n.modulo,1),e=e.times(i),D=!0,t.minus(e))};T.naturalExponential=T.exp=function(){return bn(this)};T.naturalLogarithm=T.ln=function(){return at(this)};T.negated=T.neg=function(){var i=new this.constructor(this);return i.s=-i.s,E(i)};T.plus=T.add=function(i){var e,t,n,r,o,a,s,u,c,l,p=this,m=p.constructor;if(i=new m(i),!p.d||!i.d)return!p.s||!i.s?i=new m(NaN):p.d||(i=new m(i.d||p.s===i.s?p:NaN)),i;if(p.s!=i.s)return i.s=-i.s,p.minus(i);if(c=p.d,l=i.d,s=m.precision,u=m.rounding,!c[0]||!l[0])return l[0]||(i=new m(p)),D?E(i,s,u):i;if(o=Se(p.e/W),n=Se(i.e/W),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,a=l.length):(t=l,n=o,a=c.length),o=Math.ceil(s/W),a=o>a?o+1:a+1,r>a&&(r=a,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(a=c.length,r=l.length,a-r<0&&(r=a,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/qe|0,c[r]%=qe;for(e&&(c.unshift(e),++n),a=c.length;c[--a]==0;)c.pop();return i.d=c,i.e=Qt(c,n),D?E(i,s,u):i};T.precision=T.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(ut+i);return t.d?(e=ai(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};T.round=function(){var i=this,e=i.constructor;return E(new e(i),i.e+1,e.rounding)};T.sine=T.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+W,n.rounding=1,t=yr(n,mi(n,t)),n.precision=i,n.rounding=e,E(Ye>2?t.neg():t,i,e,!0)):new n(NaN)};T.squareRoot=T.sqrt=function(){var i,e,t,n,r,o,a=this,s=a.d,u=a.e,c=a.s,l=a.constructor;if(c!==1||!s||!s[0])return new l(!c||c<0&&(!s||s[0])?NaN:s?a:1/0);for(D=!1,c=Math.sqrt(+a),c==0||c==1/0?(e=Ie(s),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=Se((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(ne(a,o,t+2,1)).times(.5),Ie(o.d).slice(0,t)===(e=Ie(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(E(o,u+1,0),o.times(o).eq(a))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(E(n,u+1,1),i=!n.times(n).eq(a));break}return D=!0,E(n,u,l.rounding,i)};T.tangent=T.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=ne(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,E(Ye==2||Ye==4?t.neg():t,i,e,!0)):new n(NaN)};T.times=T.mul=function(i){var e,t,n,r,o,a,s,u,c,l=this,p=l.constructor,m=l.d,d=(i=new p(i)).d;if(i.s*=l.s,!m||!m[0]||!d||!d[0])return new p(!i.s||m&&!m[0]&&!d||d&&!d[0]&&!m?NaN:!m||!d?i.s/0:i.s*0);for(t=Se(l.e/W)+Se(i.e/W),u=m.length,c=d.length,u<c&&(o=m,m=d,d=o,a=u,u=c,c=a),o=[],a=u+c,n=a;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)s=o[r]+d[n]*m[r-n-1]+e,o[r--]=s%qe|0,e=s/qe|0;o[r]=(o[r]+e)%qe|0}for(;!o[--a];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Qt(o,t),D?E(i,p.precision,p.rounding):i};T.toBinary=function(i,e){return gn(this,2,i,e)};T.toDecimalPlaces=T.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Le(i,0,ct),e===void 0?e=n.rounding:Le(e,0,8),E(t,i+t.e+1,e))};T.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Xe(n,!0):(Le(i,0,ct),e===void 0?e=r.rounding:Le(e,0,8),n=E(new r(n),i+1,e),t=Xe(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};T.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Xe(r):(Le(i,0,ct),e===void 0?e=o.rounding:Le(e,0,8),n=E(new o(r),i+r.e+1,e),t=Xe(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};T.toFraction=function(i){var e,t,n,r,o,a,s,u,c,l,p,m,d=this,y=d.d,f=d.constructor;if(!y)return new f(d);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=ai(y)-d.e-1,a=o%W,e.d[0]=Pe(10,a<0?W+a:a),i==null)i=o>0?e:c;else{if(s=new f(i),!s.isInt()||s.lt(c))throw Error(ut+s);i=s.gt(e)?o>0?e:c:s}for(D=!1,s=new f(Ie(y)),l=f.precision,f.precision=o=y.length*W*2;p=ne(s,e,0,1,1),r=t.plus(p.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(p.times(r)),u=r,r=e,e=s.minus(p.times(r)),s=r;return r=ne(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=d.s,m=ne(c,n,o,1).minus(d).abs().cmp(ne(u,t,o,1).minus(d).abs())<1?[c,n]:[u,t],f.precision=l,D=!0,m};T.toHexadecimal=T.toHex=function(i,e){return gn(this,16,i,e)};T.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Le(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(D=!1,t=ne(t,i,0,e,1).times(i),D=!0,E(t)):(i.s=t.s,t=i),t};T.toNumber=function(){return+this};T.toOctal=function(i,e){return gn(this,8,i,e)};T.toPower=T.pow=function(i){var e,t,n,r,o,a,s=this,u=s.constructor,c=+(i=new u(i));if(!s.d||!i.d||!s.d[0]||!i.d[0])return new u(Pe(+s,c));if(s=new u(s),s.eq(1))return s;if(n=u.precision,o=u.rounding,i.eq(1))return E(s,n,o);if(e=Se(i.e/W),e>=i.d.length-1&&(t=c<0?-c:c)<=pr)return r=ui(u,s,t,n),i.s<0?new u(1).div(r):E(r,n,o);if(a=s.s,a<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(a=1),s.e==0&&s.d[0]==1&&s.d.length==1)return s.s=a,s}return t=Pe(+s,c),e=t==0||!isFinite(t)?Se(c*(Math.log("0."+Ie(s.d))/Math.LN10+s.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?a/0:0):(D=!1,u.rounding=s.s=1,t=Math.min(12,(e+"").length),r=bn(i.times(at(s,n+t)),n),r.d&&(r=E(r,n+5,1),It(r.d,n,o)&&(e=n+10,r=E(bn(i.times(at(s,e+t)),e),e+5,1),+Ie(r.d).slice(n+1,n+15)+1==1e14&&(r=E(r,n+1,0)))),r.s=a,D=!0,u.rounding=o,E(r,n,o))};T.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Xe(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Le(i,1,ct),e===void 0?e=r.rounding:Le(e,0,8),n=E(new r(n),i,e),t=Xe(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};T.toSignificantDigits=T.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Le(i,1,ct),e===void 0?e=n.rounding:Le(e,0,8)),E(new n(t),i,e)};T.toString=function(){var i=this,e=i.constructor,t=Xe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};T.truncated=T.trunc=function(){return E(new this.constructor(this),this.e+1,1)};T.valueOf=T.toJSON=function(){var i=this,e=i.constructor,t=Xe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function Ie(i){var e,t,n,r=i.length-1,o="",a=i[0];if(r>0){for(o+=a,e=1;e<r;e++)n=i[e]+"",t=W-n.length,t&&(o+=st(t)),o+=n;a=i[e],n=a+"",t=W-n.length,t&&(o+=st(t))}else if(a===0)return"0";for(;a%10===0;)a/=10;return o+a}function Le(i,e,t){if(i!==~~i||i<e||i>t)throw Error(ut+i)}function It(i,e,t,n){var r,o,a,s;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=W,r=0):(r=Math.ceil((e+1)/W),e%=W),o=Pe(10,W-e),s=i[r]%o|0,n==null?e<3?(e==0?s=s/100|0:e==1&&(s=s/10|0),a=t<4&&s==99999||t>3&&s==49999||s==5e4||s==0):a=(t<4&&s+1==o||t>3&&s+1==o/2)&&(i[r+1]/o/100|0)==Pe(10,e-2)-1||(s==o/2||s==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?s=s/1e3|0:e==1?s=s/100|0:e==2&&(s=s/10|0),a=(n||t<4)&&s==9999||!n&&t>3&&s==4999):a=((n||t<4)&&s+1==o||!n&&t>3&&s+1==o/2)&&(i[r+1]/o/1e3|0)==Pe(10,e-3)-1,a}function qt(i,e,t){for(var n,r=[0],o,a=0,s=i.length;a<s;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=pn.indexOf(i.charAt(a++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function fr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Ht(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=At(i,1,e.times(r),new i(1));for(var o=t;o--;){var a=e.times(e);e=a.times(a).minus(a).times(8).plus(1)}return i.precision-=t,e}var ne=function(){function i(n,r,o){var a,s=0,u=n.length;for(n=n.slice();u--;)a=n[u]*r+s,n[u]=a%o|0,s=a/o|0;return s&&n.unshift(s),n}function e(n,r,o,a){var s,u;if(o!=a)u=o>a?1:-1;else for(s=u=0;s<o;s++)if(n[s]!=r[s]){u=n[s]>r[s]?1:-1;break}return u}function t(n,r,o,a){for(var s=0;o--;)n[o]-=s,s=n[o]<r[o]?1:0,n[o]=s*a+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,a,s,u){var c,l,p,m,d,y,f,b,k,x,I,L,v,w,N,F,h,U,Q,ge,ie=n.constructor,we=n.s==r.s?1:-1,me=n.d,re=r.d;if(!me||!me[0]||!re||!re[0])return new ie(!n.s||!r.s||(me?re&&me[0]==re[0]:!re)?NaN:me&&me[0]==0||!re?we*0:we/0);for(u?(d=1,l=n.e-r.e):(u=qe,d=W,l=Se(n.e/d)-Se(r.e/d)),Q=re.length,h=me.length,k=new ie(we),x=k.d=[],p=0;re[p]==(me[p]||0);p++);if(re[p]>(me[p]||0)&&l--,o==null?(w=o=ie.precision,a=ie.rounding):s?w=o+(n.e-r.e)+1:w=o,w<0)x.push(1),y=!0;else{if(w=w/d+2|0,p=0,Q==1){for(m=0,re=re[0],w++;(p<h||m)&&w--;p++)N=m*u+(me[p]||0),x[p]=N/re|0,m=N%re|0;y=m||p<h}else{for(m=u/(re[0]+1)|0,m>1&&(re=i(re,m,u),me=i(me,m,u),Q=re.length,h=me.length),F=Q,I=me.slice(0,Q),L=I.length;L<Q;)I[L++]=0;ge=re.slice(),ge.unshift(0),U=re[0],re[1]>=u/2&&++U;do m=0,c=e(re,I,Q,L),c<0?(v=I[0],Q!=L&&(v=v*u+(I[1]||0)),m=v/U|0,m>1?(m>=u&&(m=u-1),f=i(re,m,u),b=f.length,L=I.length,c=e(f,I,b,L),c==1&&(m--,t(f,Q<b?ge:re,b,u))):(m==0&&(c=m=1),f=re.slice()),b=f.length,b<L&&f.unshift(0),t(I,f,L,u),c==-1&&(L=I.length,c=e(re,I,Q,L),c<1&&(m++,t(I,Q<L?ge:re,L,u))),L=I.length):c===0&&(m++,I=[0]),x[p++]=m,c&&I[0]?I[L++]=me[F]||0:(I=[me[F]],L=1);while((F++<h||I[0]!==void 0)&&w--);y=I[0]!==void 0}x[0]||x.shift()}if(d==1)k.e=l,ni=y;else{for(p=1,m=x[0];m>=10;m/=10)p++;k.e=p+l*d-1,E(k,s?o+k.e+1:o,a,y)}return k}}();function E(i,e,t,n){var r,o,a,s,u,c,l,p,m,d=i.constructor;e:if(e!=null){if(p=i.d,!p)return i;for(r=1,s=p[0];s>=10;s/=10)r++;if(o=e-r,o<0)o+=W,a=e,l=p[m=0],u=l/Pe(10,r-a-1)%10|0;else if(m=Math.ceil((o+1)/W),s=p.length,m>=s)if(n){for(;s++<=m;)p.push(0);l=u=0,r=1,o%=W,a=o-W+1}else break e;else{for(l=s=p[m],r=1;s>=10;s/=10)r++;o%=W,a=o-W+r,u=a<0?0:l/Pe(10,r-a-1)%10|0}if(n=n||e<0||p[m+1]!==void 0||(a<0?l:l%Pe(10,r-a-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?a>0?l/Pe(10,r-a):0:p[m-1])%10&1||t==(i.s<0?8:7)),e<1||!p[0])return p.length=0,c?(e-=i.e+1,p[0]=Pe(10,(W-e%W)%W),i.e=-e||0):p[0]=i.e=0,i;if(o==0?(p.length=m,s=1,m--):(p.length=m+1,s=Pe(10,W-o),p[m]=a>0?(l/Pe(10,r-a)%Pe(10,a)|0)*s:0),c)for(;;)if(m==0){for(o=1,a=p[0];a>=10;a/=10)o++;for(a=p[0]+=s,s=1;a>=10;a/=10)s++;o!=s&&(i.e++,p[0]==qe&&(p[0]=1));break}else{if(p[m]+=s,p[m]!=qe)break;p[m--]=0,s=1}for(o=p.length;p[--o]===0;)p.pop()}return D&&(i.e>d.maxE?(i.d=null,i.e=NaN):i.e<d.minE&&(i.e=0,i.d=[0])),i}function Xe(i,e,t){if(!i.isFinite())return li(i);var n,r=i.e,o=Ie(i.d),a=o.length;return e?(t&&(n=t-a)>0?o=o.charAt(0)+"."+o.slice(1)+st(n):a>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+st(-r-1)+o,t&&(n=t-a)>0&&(o+=st(n))):r>=a?(o+=st(r+1-a),t&&(n=t-r-1)>0&&(o=o+"."+st(n))):((n=r+1)<a&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-a)>0&&(r+1===a&&(o+="."),o+=st(n))),o}function Qt(i,e){var t=i[0];for(e*=W;t>=10;t/=10)e++;return e}function Xt(i,e,t){if(e>dr)throw D=!0,t&&(i.precision=t),Error(ii);return E(new i(Gt),e,1,!0)}function De(i,e,t){if(e>fn)throw Error(ii);return E(new i(Ut),e,t,!0)}function ai(i){var e=i.length-1,t=e*W+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function st(i){for(var e="";i--;)e+="0";return e}function ui(i,e,t,n){var r,o=new i(1),a=Math.ceil(n/W+4);for(D=!1;;){if(t%2&&(o=o.times(e),ei(o.d,a)&&(r=!0)),t=Se(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),ei(e.d,a)}return D=!0,o}function $n(i){return i.d[i.d.length-1]&1}function ci(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function bn(i,e){var t,n,r,o,a,s,u,c=0,l=0,p=0,m=i.constructor,d=m.rounding,y=m.precision;if(!i.d||!i.d[0]||i.e>17)return new m(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(D=!1,u=y):u=e,s=new m(.03125);i.e>-2;)i=i.times(s),p+=5;for(n=Math.log(Pe(2,p))/Math.LN10*2+5|0,u+=n,t=o=a=new m(1),m.precision=u;;){if(o=E(o.times(i),u,1),t=t.times(++l),s=a.plus(ne(o,t,u,1)),Ie(s.d).slice(0,u)===Ie(a.d).slice(0,u)){for(r=p;r--;)a=E(a.times(a),u,1);if(e==null)if(c<3&&It(a.d,u-n,d,c))m.precision=u+=10,t=o=s=new m(1),l=0,c++;else return E(a,m.precision=y,d,D=!0);else return m.precision=y,a}a=s}}function at(i,e){var t,n,r,o,a,s,u,c,l,p,m,d=1,y=10,f=i,b=f.d,k=f.constructor,x=k.rounding,I=k.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new k(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?(D=!1,l=I):l=e,k.precision=l+=y,t=Ie(b),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=Ie(f.d),n=t.charAt(0),d++;o=f.e,n>1?(f=new k("0."+t),o++):f=new k(n+"."+t.slice(1))}else return c=Xt(k,l+2,I).times(o+""),f=at(new k(n+"."+t.slice(1)),l-y).plus(c),k.precision=I,e==null?E(f,I,x,D=!0):f;for(p=f,u=a=f=ne(f.minus(1),f.plus(1),l,1),m=E(f.times(f),l,1),r=3;;){if(a=E(a.times(m),l,1),c=u.plus(ne(a,new k(r),l,1)),Ie(c.d).slice(0,l)===Ie(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Xt(k,l+2,I).times(o+""))),u=ne(u,new k(d),l,1),e==null)if(It(u.d,l-y,x,s))k.precision=l+=y,c=a=f=ne(p.minus(1),p.plus(1),l,1),m=E(f.times(f),l,1),r=s=1;else return E(u,k.precision=I,x,D=!0);else return k.precision=I,u;u=c,r+=2}}function li(i){return String(i.s*i.s/0)}function yn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%W,t<0&&(n+=W),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=W;n<r;)i.d.push(+e.slice(n,n+=W));e=e.slice(n),n=W-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),D&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function br(i,e){var t,n,r,o,a,s,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),si.test(e))return yn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(lr.test(e))t=16,e=e.toLowerCase();else if(cr.test(e))t=2;else if(mr.test(e))t=8;else throw Error(ut+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),a=o>=0,n=i.constructor,a&&(e=e.replace(".",""),s=e.length,o=s-o,r=ui(n,new n(t),o,o*2)),c=qt(e,t,qe),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=Qt(c,l),i.d=c,D=!1,a&&(i=ne(i,r,s*4)),u&&(i=i.times(Math.abs(u)<54?Pe(2,u):Bt.pow(2,u))),D=!0,i)}function yr(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:At(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Ht(5,t)),e=At(i,2,e,e);for(var r,o=new i(5),a=new i(16),s=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(a.times(r).minus(s))));return e}function At(i,e,t,n,r){var o,a,s,u,c=1,l=i.precision,p=Math.ceil(l/W);for(D=!1,u=t.times(t),s=new i(n);;){if(a=ne(s.times(u),new i(e++*e++),l,1),s=r?n.plus(a):n.minus(a),n=ne(a.times(u),new i(e++*e++),l,1),a=s.plus(n),a.d[p]!==void 0){for(o=p;a.d[o]===s.d[o]&&o--;);if(o==-1)break}o=s,s=n,n=a,a=o,c++}return D=!0,a.d.length=p+1,a}function Ht(i,e){for(var t=i;--e;)t*=i;return t}function mi(i,e){var t,n=e.s<0,r=De(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Ye=n?4:1,e;if(t=e.divToInt(r),t.isZero())Ye=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Ye=$n(t)?n?2:3:n?4:1,e;Ye=$n(t)?n?1:4:n?3:2}return e.minus(r).abs()}function gn(i,e,t,n){var r,o,a,s,u,c,l,p,m,d=i.constructor,y=t!==void 0;if(y?(Le(t,1,ct),n===void 0?n=d.rounding:Le(n,0,8)):(t=d.precision,n=d.rounding),!i.isFinite())l=li(i);else{for(l=Xe(i),a=l.indexOf("."),y?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,a>=0&&(l=l.replace(".",""),m=new d(1),m.e=l.length-a,m.d=qt(Xe(m),10,r),m.e=m.d.length),p=qt(l,10,r),o=u=p.length;p[--u]==0;)p.pop();if(!p[0])l=y?"0p+0":"0";else{if(a<0?o--:(i=new d(i),i.d=p,i.e=o,i=ne(i,m,t,n,0,r),p=i.d,o=i.e,c=ni),a=p[t],s=r/2,c=c||p[t+1]!==void 0,c=n<4?(a!==void 0||c)&&(n===0||n===(i.s<0?3:2)):a>s||a===s&&(n===4||c||n===6&&p[t-1]&1||n===(i.s<0?8:7)),p.length=t,c)for(;++p[--t]>r-1;)p[t]=0,t||(++o,p.unshift(1));for(u=p.length;!p[u-1];--u);for(a=0,l="";a<u;a++)l+=pn.charAt(p[a]);if(y){if(u>1)if(e==16||e==8){for(a=e==16?4:3,--u;u%a;u++)l+="0";for(p=qt(l,r,e),u=p.length;!p[u-1];--u);for(a=1,l="1.";a<u;a++)l+=pn.charAt(p[a])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function ei(i,e){if(i.length>e)return i.length=e,!0}function gr(i){return new this(i).abs()}function Pr(i){return new this(i).acos()}function kr(i){return new this(i).acosh()}function Ar(i,e){return new this(i).plus(e)}function wr(i){return new this(i).asin()}function Tr(i){return new this(i).asinh()}function hr(i){return new this(i).atan()}function Ir(i){return new this(i).atanh()}function Br(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=De(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?De(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=De(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ne(i,e,o,1)),e=De(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(ne(i,e,o,1)),t}function xr(i){return new this(i).cbrt()}function Sr(i){return E(i=new this(i),i.e+1,2)}function Kr(i,e,t){return new this(i).clamp(e,t)}function Cr(i){if(!i||typeof i!="object")throw Error(zt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,ct,"rounding",0,8,"toExpNeg",-kt,0,"toExpPos",0,kt,"maxE",0,kt,"minE",-kt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=dn[t]),(n=i[t])!==void 0)if(Se(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(ut+t+": "+n);if(t="crypto",r&&(this[t]=dn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(ri);else this[t]=!1;else throw Error(ut+t+": "+n);return this}function Nr(i){return new this(i).cos()}function Lr(i){return new this(i).cosh()}function pi(i){var e,t,n;function r(o){var a,s,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,ti(o)){c.s=o.s,D?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(a=0,s=o;s>=10;s/=10)a++;D?a>r.maxE?(c.e=NaN,c.d=null):a<r.minE?(c.e=0,c.d=[0]):(c.e=a,c.d=[o]):(c.e=a,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return yn(c,o.toString())}else if(u!=="string")throw Error(ut+o);return(s=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(s===43&&(o=o.slice(1)),c.s=1),si.test(o)?yn(c,o):br(c,o)}if(r.prototype=T,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Cr,r.clone=pi,r.isDecimal=ti,r.abs=gr,r.acos=Pr,r.acosh=kr,r.add=Ar,r.asin=wr,r.asinh=Tr,r.atan=hr,r.atanh=Ir,r.atan2=Br,r.cbrt=xr,r.ceil=Sr,r.clamp=Kr,r.cos=Nr,r.cosh=Lr,r.div=Rr,r.exp=Mr,r.floor=Or,r.hypot=vr,r.ln=Er,r.log=Fr,r.log10=Vr,r.log2=Wr,r.max=_r,r.min=Dr,r.mod=qr,r.mul=Gr,r.pow=Ur,r.random=Xr,r.round=zr,r.sign=Qr,r.sin=Hr,r.sinh=Zr,r.sqrt=jr,r.sub=Yr,r.sum=Jr,r.tan=$r,r.tanh=eo,r.trunc=to,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Rr(i,e){return new this(i).div(e)}function Mr(i){return new this(i).exp()}function Or(i){return E(i=new this(i),i.e+1,3)}function vr(){var i,e,t=new this(0);for(D=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return D=!0,new this(1/0);t=e}return D=!0,t.sqrt()}function ti(i){return i instanceof Bt||i&&i.toStringTag===oi||!1}function Er(i){return new this(i).ln()}function Fr(i,e){return new this(i).log(e)}function Wr(i){return new this(i).log(2)}function Vr(i){return new this(i).log(10)}function _r(){return ci(this,arguments,"lt")}function Dr(){return ci(this,arguments,"gt")}function qr(i,e){return new this(i).mod(e)}function Gr(i,e){return new this(i).mul(e)}function Ur(i,e){return new this(i).pow(e)}function Xr(i){var e,t,n,r,o=0,a=new this(1),s=[];if(i===void 0?i=this.precision:Le(i,1,ct),n=Math.ceil(i/W),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:s[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(s.push(r%1e7),o+=4);o=n/4}else throw Error(ri);else for(;o<n;)s[o++]=Math.random()*1e7|0;for(n=s[--o],i%=W,n&&i&&(r=Pe(10,W-i),s[o]=(n/r|0)*r);s[o]===0;o--)s.pop();if(o<0)t=0,s=[0];else{for(t=-1;s[0]===0;t-=W)s.shift();for(n=1,r=s[0];r>=10;r/=10)n++;n<W&&(t-=W-n)}return a.e=t,a.d=s,a}function zr(i){return E(i=new this(i),i.e+1,this.rounding)}function Qr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function Hr(i){return new this(i).sin()}function Zr(i){return new this(i).sinh()}function jr(i){return new this(i).sqrt()}function Yr(i,e){return new this(i).sub(e)}function Jr(){var i=0,e=arguments,t=new this(e[i]);for(D=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return D=!0,E(t,this.precision,this.rounding)}function $r(i){return new this(i).tan()}function eo(i){return new this(i).tanh()}function to(i){return E(i=new this(i),i.e+1,1)}T[Symbol.for("nodejs.util.inspect.custom")]=T.toString;T[Symbol.toStringTag]="Decimal";var Bt=T.constructor=pi(dn);Gt=new Bt(Gt);Ut=new Bt(Ut);var M=Bt;import{PublicKey as ro}from"@solana/web3.js";import{get as di,set as no}from"lodash";var Pn=class{logLevel;name;constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},fi={},io={};function oe(i){let e=di(fi,i);if(!e){let t=di(io,i);e=new Pn({name:i,logLevel:t}),no(fi,i,e)}return e}import{MINT_SIZE as ta,TOKEN_PROGRAM_ID as na,getTransferFeeConfig as ia,unpackMint as ra}from"@solana/spl-token";var kn=oe("Raydium_accountInfo_util");async function lt(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}={batchRequest:!1,...t},a=An(e,o),s=new Array(a.length).fill([]);if(n){let u=a.map(p=>{let m=i._buildArgs([p.map(d=>d.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:m}}),c=An(u,10);s=(await(await Promise.all(c.map(async p=>await i._rpcBatchRequest(p)))).flat()).map(p=>(p.error&&kn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${p.error.message}`),p.result.value.map(m=>{if(m){let{data:d,executable:y,lamports:f,owner:b,rentEpoch:k}=m;return d.length!==2&&d[1]!=="base64"&&kn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:y,lamports:f,owner:new ro(b),rentEpoch:k}}return null})))}else try{s=await Promise.all(a.map(u=>i.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&kn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return s.flat()}async function xt(i,e,t){let n=await lt(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>({...r,accountInfo:n[o]}))}import et from"bn.js";import po from"big.js";import Yt from"bn.js";import oo from"toformat";var so=oo,Kt=so;import jt from"big.js";import uo from"bn.js";import co from"decimal.js-light";import Ct from"bn.js";var bi=9007199254740991;function se(i){let e=oe("Raydium_parseBigNumberish");if(i instanceof Ct)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Ct(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=bi||i<=-bi)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Ct(String(i))):typeof i=="bigint"?new Ct(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Ct(0))}var Zt=oe("module/fraction"),wn=Kt(jt),Nt=Kt(co),lo={[0]:Nt.ROUND_DOWN,[1]:Nt.ROUND_HALF_UP,[2]:Nt.ROUND_UP},mo={[0]:jt.roundDown,[1]:jt.roundHalfUp,[2]:jt.roundUp},Y=class{numerator;denominator;constructor(e,t=new uo(1)){this.numerator=se(e),this.denominator=se(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new Y(this.denominator,this.numerator)}add(e){let t=e instanceof Y?e:new Y(se(e));return this.denominator.eq(t.denominator)?new Y(this.numerator.add(t.numerator),this.denominator):new Y(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof Y?e:new Y(se(e));return this.denominator.eq(t.denominator)?new Y(this.numerator.sub(t.numerator),this.denominator):new Y(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof Y?e:new Y(se(e));return new Y(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof Y?e:new Y(se(e));return new Y(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Zt.logWithError(`${e} is not an integer.`),e<=0&&Zt.logWithError(`${e} is not positive.`),Nt.set({precision:e+1,rounding:lo[n]});let r=new Nt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Zt.logWithError(`${e} is not an integer.`),e<0&&Zt.logWithError(`${e} is negative.`),wn.DP=e,wn.RM=mo[n]||1,new wn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var fo=oe("Raydium_amount"),yi=Kt(po);function bo(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):fo.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var ke=class extends Y{token;logger;constructor(e,t,n=!0,r){let o=new Yt(0),a=Tn.pow(new Yt(e.decimals));if(n)o=se(t);else{let s=new Yt(0),u=new Yt(0);if(typeof t=="string"||typeof t=="number"||typeof t=="bigint"){let[c,l]=bo(t.toString(),e.decimals);s=se(c),u=se(l)}s=s.mul(a),o=s.add(u)}super(o,a),this.logger=oe(r||"TokenAmount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new ke(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new ke(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,t,n=0){return super.toSignificant(e,t,n)}toFixed(e=this.token.decimals,t,n=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,t,n)}toExact(e={groupSeparator:""}){return yi.DP=this.token.decimals,new yi(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};import{PublicKey as yo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as gi}from"@solana/spl-token";var hn={chainId:101,address:yo.default.toBase58(),programId:gi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Je={chainId:101,address:"So11111111111111111111111111111111111111112",programId:gi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as xn}from"@solana/web3.js";import{PublicKey as ce,SystemProgram as Pi,SYSVAR_RENT_PUBKEY as go}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Po}from"@solana/spl-token";function g({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var Ea=[g({pubkey:Po,isWritable:!1}),g({pubkey:Pi.programId,isWritable:!1}),g({pubkey:go,isWritable:!1})];function In({publicKey:i,transformSol:e}){let t=Bn(i.toString());if(t instanceof ce)return e&&t.equals(Lt)?St:t;if(e&&t.toString()===Lt.toBase58())return St;if(typeof t=="string"){if(t===ce.default.toBase58())return ce.default;try{return new ce(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Bn(i){try{return new ce(i)}catch{return i}}var Jt=new ce("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),mt=new ce("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ze=new ce("SysvarRent111111111111111111111111111111111"),Fa=new ce("SysvarC1ock11111111111111111111111111111111"),pt=new ce("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Wa=new ce("Sysvar1nstructions1111111111111111111111111"),ko=Pi.programId,Va=new ce("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),_a=new ce("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Da=new ce("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),qa=new ce("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ga=new ce("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ua=new ce("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Xa=new ce("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),za=new ce("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Qa=new ce("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ha=new ce("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Za=new ce("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),St=new ce("So11111111111111111111111111111111111111112"),Lt=ce.default;function wt(i){return In({publicKey:i,transformSol:!0})}var Sn=class{symbol;name;decimals;isToken2022;mint;constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:a=!1}){if(e===Lt.toBase58()||e instanceof xn&&Lt.equals(e)){this.decimals=Je.decimals,this.symbol=Je.symbol,this.name=Je.name,this.mint=new xn(Je.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?xn.default:In({publicKey:e}),this.isToken2022=a}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ge=Sn;Dt(Ge,"WSOL",new Sn({...Je,mint:Je.address}));var Kn=class{symbol;name;decimals;constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},$t=Kn;Dt($t,"SOL",new Kn(hn));import Ao from"bn.js";var ki=new Y(new Ao(100)),$e=class extends Y{toSignificant(e=5,t,n){return this.mul(ki).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(ki).toFixed(e,t,n)}};var wo=oe("Raydium_price"),Me=class extends Y{baseToken;quoteToken;scalar;constructor(e){let{baseToken:t,quoteToken:n,numerator:r,denominator:o}=e;super(r,o),this.baseToken=t,this.quoteToken=n,this.scalar=new Y(Cn(t.decimals),Cn(n.decimals))}get raw(){return new Y(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Me({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&wo.logWithError("mul token not equals");let t=super.mul(e);return new Me({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:t.denominator,numerator:t.numerator})}toSignificant(e=this.quoteToken.decimals,t,n){return this.adjusted.toSignificant(e,t,n)}toFixed(e=this.quoteToken.decimals,t,n){return this.adjusted.toFixed(e,t,n)}};import{PublicKey as To}from"@solana/web3.js";import ho from"bn.js";function wi(i){return typeof i=="object"&&i!==null&&![Ge,ke,To,Y,ho,Me,$e].some(e=>typeof e=="object"&&i instanceof e)}function Oe(i){return typeof i=="string"?Bn(i):Array.isArray(i)?i.map(e=>Oe(e)):wi(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,Oe(t)])):i}var Ai=new et(0),Io=new et(1),Uu=new et(2),Xu=new et(3),zu=new et(5),Tn=new et(10),Qu=new et(100),Hu=new et(1e3),Zu=new et(1e4);function Cn(i){return Tn.pow(se(i))}function An(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as xo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as So}from"@solana/spl-token";import{ComputeBudgetProgram as ic,Keypair as sc,PublicKey as Bo,Transaction as uc,TransactionMessage as lc,VersionedTransaction as mc}from"@solana/web3.js";var $={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip",NonceAccount:"NonceAccount"};import{TOKEN_PROGRAM_ID as bc}from"@solana/spl-token";var yc=oe("Raydium_txUtil");function Be(i,e){let[t,n]=Bo.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function te(i,e,t){return Be([i.toBuffer(),(t??So).toBuffer(),e.toBuffer()],new xo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as q}from"@solana/web3.js";var Ko=new q("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),hc=new q("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Co=new q("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),No=new q("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Lo=new q("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Ro=new q("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Nn=new q("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Ti=new q("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Mo=new q("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),en=new q("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ln=new q("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),hi=new q("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ii=new q("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Oo=new q("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Ic=new q("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Bc=new q("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),xc=new q("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Sc=new q("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Kc=new q("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Rn=new q("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Bi=new q("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),vo=new q("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Eo=new q("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Fo=new q("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Wo=new q("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Vo=new q("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),_o=new q("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Do=new q("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),qo=new q("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),Go=new q("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Uo=new q("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Xo=new q("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),zo=new q("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var Ce={AMM_V4:Ti,AMM_STABLE:Mo,CLMM_PROGRAM_ID:Ln,CLMM_LOCK_PROGRAM_ID:hi,CLMM_LOCK_AUTH_ID:Ii,FARM_PROGRAM_ID_V3:Ko,FARM_PROGRAM_ID_V5:Co,FARM_PROGRAM_ID_V6:No,OPEN_BOOK_PROGRAM:Ro,SERUM_PROGRAM_ID_V3:Nn,UTIL1216:Lo,Router:Oo,CREATE_CPMM_POOL_PROGRAM:Rn,CREATE_CPMM_POOL_AUTH:Bi,CREATE_CPMM_POOL_FEE_ACC:vo,LOCK_CPMM_PROGRAM:Vo,LOCK_CPMM_AUTH:Do,LAUNCHPAD_PROGRAM:Go,LAUNCHPAD_AUTH:Uo},Cc={SERUM_MARKET:q.default,OPENBOOK_MARKET:new q("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:q.default,FarmV3:new q("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new q("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new q("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new q("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new q("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new q("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new q("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new q("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new q("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Eo,CREATE_CPMM_POOL_AUTH:Fo,CREATE_CPMM_POOL_FEE_ACC:Wo,FEE_DESTINATION_ID:new q("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:_o,LCOK_CPMM_AUTH:qo,LAUNCHPAD_PROGRAM:Xo,LAUNCHPAD_AUTH:zo};import Ue from"bn.js";var Rt=1e4;function fe(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r={...e,olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}},o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,a=new Ue(o.maximumFee.toString()),s=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Rt){let u=new Ue(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:s}}else{let u=tn(i.mul(new Ue(Rt)),new Ue(Rt-o.transferFeeBasisPoints)),c=new Ue(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,p=tn(l.mul(new Ue(o.transferFeeBasisPoints)),new Ue(Rt)),m=p.gt(a)?a:p;return{amount:l,fee:m,expirationTime:s}}else{let u=tn(i.mul(new Ue(o.transferFeeBasisPoints)),new Ue(Rt)),c=u.gt(a)?a:u;return{amount:i,fee:c,expirationTime:s}}}function tt(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function tn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new Ue(0))?t.add(new Ue(1)):t}import{PublicKey as Qo,AddressLookupTableAccount as xi}from"@solana/web3.js";var Ho={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new xi({key:new Qo("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:xi.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as Qc,sendAndConfirmTransaction as Hc,SystemProgram as Yc,Transaction as Jc,TransactionMessage as el,VersionedTransaction as tl}from"@solana/web3.js";import il from"axios";import Zo from"bn.js";var jo=new Zo(1e6);import{PublicKey as os}from"@solana/web3.js";import Li,{isBN as Ri}from"bn.js";import{bits as Ll,BitStructure as Rl,blob as Yo,Blob as Ml,cstr as Ol,f32 as vl,f32be as El,f64 as Fl,f64be as Wl,greedy as Vl,Layout as Jo,ns64 as _l,ns64be as Dl,nu64 as ql,nu64be as Gl,offset as Ul,s16 as Xl,s16be as zl,s24 as Ql,s24be as Hl,s32 as $o,s32be as Zl,s40 as jl,s40be as Yl,s48 as Jl,s48be as $l,s8 as em,seq as es,struct as tm,Structure as ts,u16 as ns,u16be as nm,u24 as im,u24be as rm,u32 as om,u32be as sm,u40 as am,u40be as um,u48 as cm,u48be as lm,u8 as is,UInt as rs,union as mm,Union as pm,unionLayoutDiscriminator as dm,utf8 as fm}from"@solana/buffer-layout";var Mn=Jo,Ki=ts;var On=rs;var Ci=is,ft=ns;var ae=$o;var Ni=es;var be=Yo;var Tt=class extends Mn{blob;signed;constructor(e,t,n){super(e,n),this.blob=be(e),this.signed=t}decode(e,t=0){let n=new Li(this.blob.decode(e,t),10,"le");return this.signed?n.fromTwos(this.span*8).clone():n}encode(e,t,n=0){return typeof e=="number"&&(e=new Li(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),t,n)}};function V(i){return new On(1,i)}function ve(i){return new On(4,i)}function P(i){return new Tt(8,!1,i)}function _(i){return new Tt(16,!1,i)}function Mi(i){return new Tt(8,!0,i)}function Oi(i){return new Tt(16,!0,i)}var nn=class extends Mn{layout;decoder;encoder;constructor(e,t,n,r){super(e.span,r),this.layout=e,this.decoder=t,this.encoder=n}decode(e,t){return this.decoder(this.layout.decode(e,t))}encode(e,t,n){return this.layout.encode(this.encoder(e),t,n)}getSpan(e,t){return this.layout.getSpan(e,t)}};function S(i){return new nn(be(32),e=>new os(e),e=>e.toBuffer(),i)}function Te(i){return new nn(Ci(),ss,as,i)}function ss(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function as(i){return i?1:0}var vn=class extends Ki{decode(e,t){return super.decode(e,t)}};function R(i,e,t){return new vn(i,e,t)}function H(i,e,t){let n,r=typeof e=="number"?e:Ri(e)?e.toNumber():new Proxy(e,{get(o,a){if(!n){let s=Reflect.get(o,"count");n=Ri(s)?s.toNumber():s,Reflect.set(o,"count",n)}return Reflect.get(o,a)},set(o,a,s){return a==="count"&&(n=s),Reflect.set(o,a,s)}});return Ni(i,r,t)}import{PublicKey as Nd}from"@solana/web3.js";import Rd from"bn.js";import{AccountLayout as Ed,TOKEN_2022_PROGRAM_ID as Fd,TOKEN_PROGRAM_ID as Wd}from"@solana/spl-token";import{PublicKey as Cm}from"@solana/web3.js";import{MintLayout as Lm,TOKEN_PROGRAM_ID as Mm}from"@solana/spl-token";import{Keypair as mn,PublicKey as B,SystemProgram as ot,TransactionInstruction as xe}from"@solana/web3.js";import Xn from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Wt,TOKEN_2022_PROGRAM_ID as de,TOKEN_PROGRAM_ID as ee}from"@solana/spl-token";import gs from"bn.js";import _e from"bn.js";var le=new _e(0),Ee=new _e(1),nt=new _e(-1),Fe=new _e(1).shln(64),rn=new _e(1).shln(128),En=Fe.sub(Ee),Mt=64,vi=rn.subn(1),Ke=-443636,Ne=-Ke,Qe=new _e("4295048016"),He=new _e("79226673521066979257578248091"),on=new _e("4295048017"),sn=new _e("79226673521066979257578248090"),Ei=16,Fi="59543866431248",Wi="184467440737095516",Vi="15793534762490258745",an=new _e(10).pow(new _e(6));var Xm=new _e("18446744073700000000");import z from"bn.js";function un(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Fn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Wn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Ot(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function _i(i,e){return Ot(i,e)?null:Fn(i,e)}function Di(i,e){return Ot(i,e)?null:Wn(i,e)}var Ym=Buffer.from("amm_config","utf8"),us=Buffer.from("pool","utf8"),cs=Buffer.from("pool_vault","utf8"),ls=Buffer.from("pool_reward_vault","utf8"),qi=Buffer.from("position","utf8"),ms=Buffer.from("tick_array","utf8"),ps=Buffer.from("operation","utf8"),ds=Buffer.from("pool_tick_array_bitmap_extension","utf8"),fs=Buffer.from("observation","utf8");function Gi(i,e,t,n){return Be([us,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Vn(i,e,t){return Be([cs,e.toBuffer(),t.toBuffer()],i)}function Ui(i,e,t){return Be([ls,e.toBuffer(),t.toBuffer()],i)}function J(i,e,t){return Be([ms,e.toBuffer(),un(t)],i)}function it(i,e,t,n){return Be([qi,e.toBuffer(),un(t),un(n)],i)}function Re(i,e){return Be([qi,e.toBuffer()],i)}function ht(i){return Be([Buffer.from("metadata","utf8"),pt.toBuffer(),i.toBuffer()],pt)}function cn(i){return Be([ps],i)}function ye(i,e){return Be([ds,e.toBuffer()],i)}function Xi(i,e){return Be([fs,e.toBuffer()],i)}var zi=Buffer.from("locked_position","utf8");function _n(i,e){return Be([zi,e.toBuffer()],i)}function Dn(i,e){return Be([zi,e.toBuffer()],i)}var Jm=Buffer.from("support_mint","utf8");import{PublicKey as We}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Qi}from"@solana/spl-token";import ue from"bn.js";import Ze from"bn.js";var vt=class{static getfeeGrowthInside(e,t,n){let r=new Ze(0),o=new Ze(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let a=new Ze(0),s=new Ze(0);e.tickCurrent<n.tick?(a=n.feeGrowthOutsideX64A,s=n.feeGrowthOutsideX64B):(a=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),s=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=X.wrappingSubU128(X.wrappingSubU128(e.feeGrowthGlobalX64A,r),a),c=X.wrappingSubU128(X.wrappingSubU128(e.feeGrowthGlobalX64B,o),s);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:a}=this.getfeeGrowthInside(e,n,r),s=X.mulDivFloor(X.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Fe),u=t.tokenFeesOwedA.add(s),c=X.mulDivFloor(X.wrappingSubU128(a,t.feeGrowthInsideLastX64B),t.liquidity,Fe),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:a}=this.getfeeGrowthInside(e,n,r),s=X.mulDivFloor(X.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Fe),u=t.tokenFeesOwedA.add(s),c=X.mulDivFloor(X.wrappingSubU128(a,t.feeGrowthInsideLastX64B),t.liquidity,Fe),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],a=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let s=0;s<a.length;s++){let u=a[s],c=t.rewardInfos[s],l=X.wrappingSubU128(u,c.growthInsideLastX64),p=X.mulDivFloor(l,t.liquidity,Fe),m=c.rewardAmountOwed.add(p);o.push(m)}return o}static GetPositionRewards(e,t,n,r){let o=[],a=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let s=0;s<a.length;s++){let u=a[s],c=t.rewardInfos[s],l=X.wrappingSubU128(u,c.growthInsideLastX64),p=X.mulDivFloor(l,t.liquidity,Fe),m=c.rewardAmountOwed.add(p);o.push(m)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let a=0;a<r.length;a++){let s=new Ze(0);t.liquidityGross.eqn(0)?s=r[a].rewardGrowthGlobalX64:e<t.tick?s=r[a].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[a]):s=t.rewardGrowthsOutsideX64[a];let u=new Ze(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[a]:u=r[a].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[a])),o.push(X.wrappingSubU128(X.wrappingSubU128(r[a].rewardGrowthGlobalX64,s),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let a=0;a<r.length;a++){let s=new Ze(0);t.liquidityGross.eqn(0)?s=r[a].rewardGrowthGlobalX64:e<t.tick?s=r[a].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[a]):s=t.rewardGrowthsOutsideX64[a];let u=new Ze(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[a]:u=r[a].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[a])),o.push(X.wrappingSubU128(X.wrappingSubU128(r[a].rewardGrowthGlobalX64,s),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:a}){let s=G.priceToSqrtPriceX64(new M(e.price),e.mintA.decimals,e.mintB.decimals),u=G.getSqrtPriceX64FromTick(t.tickLower),c=G.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,p=j.getAmountsFromLiquidity(s,u,c,n,o),[m,d]=[fe(p.amountA,e.mintA.extensions?.feeConfig,a,!0),fe(p.amountB,e.mintB.extensions?.feeConfig,a,!0)],[y,f]=[fe(new Ze(new M(p.amountA.toString()).mul(l).toFixed(0)),e.mintA.extensions?.feeConfig,a,!0),fe(new Ze(new M(p.amountB.toString()).mul(l).toFixed(0)),e.mintB.extensions?.feeConfig,a,!0)];return{liquidity:n,amountA:m,amountB:d,amountSlippageA:y,amountSlippageB:f,expirationTime:tt(m.expirationTime,d.expirationTime)}}};var bs=15,Z=class{static async getTickArrays(e,t,n,r,o,a,s){let u=[],c=O.getTickArrayStartIndexByTick(r,o),l=O.getInitializedTickArrayInRange(a,s,o,c,Math.floor(bs/2));for(let d=0;d<l.length;d++){let{publicKey:y}=J(t,n,l[d]);u.push(y)}let p=(await lt(e,u)).map(d=>d!==null?Et.decode(d.data):null),m={};for(let d=0;d<u.length;d++){let y=p[d];y!==null&&(m[y.startTickIndex]={...y,address:u[d]})}return m}static nextInitializedTick(e,t,n,r,o,a){let{initializedTick:s,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,a);for(;s==null||s.liquidityGross.lten(0);){if(c=O.getNextTickArrayStartIndex(c,o,a),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:p,tickArrayAddress:m,tickArrayStartTickIndex:d}=this.firstInitializedTickInOneArray(e,t,l,a);[s,u,c]=[p,m,d]}if(s==null)throw new Error("No invaild tickArray cache");return{nextTick:s,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let a=Math.floor(e/Z.tickCount(t)),s=n?O.searchLowBitFromStart(r,o,a-1,1,t):O.searchHightBitFromStart(r,o,a+1,1,t);return s.length>0?{isExist:!0,nextStartIndex:s[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let s=Ae-1;for(;s>=0;){let u=n.ticks[s];if(u.liquidityGross.gtn(0)){o=u;break}s=s-1}}else{let s=0;for(;s<Ae;){let u=n.ticks[s];if(u.liquidityGross.gtn(0)){o=u;break}s=s+1}}let{publicKey:a}=J(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:a,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,a){let s=O.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-s)/o),c=n[s];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:s};let l;if(a)for(;u>=0;){let m=c.ticks[u];if(m.liquidityGross.gtn(0)){l=m;break}u=u-1}else for(u=u+1;u<Ae;){let m=c.ticks[u];if(m.liquidityGross.gtn(0)){l=m;break}u=u+1}let{publicKey:p}=J(e,t,s);return{initializedTick:l,tickArrayAddress:p,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(O.checkIsOutOfBoundary(e)){if(e>Ne)return!1;let n=O.getTickArrayStartIndexByTick(Ke,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return Ae*e}};var qn=14,rt=class{static maxTickInTickarrayBitmap(e){return e*Ae*bt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!Z.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),a=r?t-Z.tickCount(n):t+Z.tickCount(n);if(a<-o||a>=o)return{isInit:!1,tickIndex:t};let s=n*Ae,u=a/s+512;a<0&&a%s!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),p=_i(1024,l);if(p!==null){let m=(c-p-512)*s;return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),p=Di(1024,l);if(p!==null){let m=(c+p-512)*s;return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:o-Z.tickCount(n)}}}},Ft=class{static getBitmapOffset(e,t){if(!Z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=rt.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=rt.maxTickInTickarrayBitmap(e),n=-t;if(Ne<=t)throw Error(`extensionTickBoundary check error: ${Ne}, ${t}`);if(n<=Ke)throw Error(`extensionTickBoundary check error: ${n}, ${Ke}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:O.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=Z.tickCount(t),a=n?e-o:e+o,{tickarrayBitmap:s}=this.getBitmap(a,t,r);return this.nextInitializedTickArrayInBitmap(s,a,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:a}=rt.getBitmapTickBoundary(t,n),s=this.tickArrayOffsetInBitmap(t,n);if(r){let u=O.mergeTickArrayBitmap(e).shln(bt-1-s),c=Ot(512,u)?null:Fn(512,u);if(c!==null){let l=t-c*Z.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=O.mergeTickArrayBitmap(e).shrn(s),c=Ot(512,u)?null:Wn(512,u);if(c!==null){let l=t+c*Z.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:a-Z.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%rt.maxTickInTickarrayBitmap(t),r=Math.floor(n/Z.tickCount(t));return e<0&&n!=0&&(r=bt-r),r}};var pe=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,a=!1){let s=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:l,nextAccountMeta:p}=this.getFirstInitializedTickArray(e,s);if(!c||l===void 0||!p)throw new Error("Invalid tick array");u.push(p);let{allTrade:m,amountCalculated:d,accounts:y,sqrtPriceX64:f,feeAmount:b}=yt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,a);return u.push(...y),{allTrade:m,expectedAmountOut:d.mul(nt),remainingAccounts:u,executionPrice:f,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let a=n.toBase58()===e.mintB.address,s=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,a);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,a);if(f.isExist){let{publicKey:b}=J(e.programId,e.id,f.nextStartIndex);s.push(b)}}catch{}s.push(l);let{amountCalculated:p,accounts:m,sqrtPriceX64:d,feeAmount:y}=yt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(nt),c,o);return s.push(...m),{expectedAmountIn:p,remainingAccounts:s,executionPrice:d,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=pe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Ft.checkTickArrayIsInit(Z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):O.checkTickArrayIsInitialized(O.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:s}=J(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:s}}let{isExist:o,nextStartIndex:a}=this.nextInitializedTickArrayStartIndex(e,Z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:s}=J(e.programId,e.id,a);return{isExist:!0,startIndex:a,nextAccountMeta:s}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/Z.tickCount(e.tickSpacing)),r=t?O.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):O.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=Z.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=rt.nextInitializedTickArrayStartIndex(O.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:a,tickIndex:s}=Ft.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(a)return{isExist:!0,nextStartIndex:s};if(t=s,t<Ke||t>Ne)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){let a=[];for(let s=0;s<o.length;s++){let u=o[s],c=t.rewardDefaultInfos[s]?.mint.programId??(await e.getAccountInfo(u.tokenMint))?.owner;if(c===void 0)throw Error("get new reward mint info error");let l={...u,perSecond:X.x64ToDecimal(u.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new We(c)};if(l.tokenMint.equals(We.default))continue;if(n<=l.openTime.toNumber()||r.eq(le)){a.push(l);continue}let p=new ue(Math.min(l.endTime.toNumber(),n)),m=p.sub(l.lastUpdateTime),d=X.mulDivFloor(m,l.emissionsPerSecondX64,r),y=l.rewardGrowthGlobalX64.add(d),f=X.mulDivFloor(m,l.emissionsPerSecondX64,Fe),b=l.rewardTotalEmissioned.add(f);a.push({...l,rewardGrowthGlobalX64:y,rewardTotalEmissioned:b,lastUpdateTime:p})}return a}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let a=O.getTickArrayStartIndexByTick(o,e);if(a>=n||a<r)return!0}return!1}static tickRange(e){let t=rt.maxTickInTickarrayBitmap(e),n=-t;return t>Ne&&(t=Z.getArrayStartIndex(Ne,e)+Z.tickCount(e)),n<Ke&&(n=Z.getArrayStartIndex(Ke,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!Z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/Z.tickCount(t)*bt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await xt(e,t.map(a=>({pubkey:a})),{batchRequest:n}),o={};for(let a of r)a.accountInfo!==null&&(o[a.pubkey.toString()]=Hi.decode(a.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=O.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=O.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let p of l){let{publicKey:m}=J(u.programId,u.id,p);o.push({pubkey:m}),r[m.toString()]=u.id}}let a=await xt(e,o,{batchRequest:n}),s={};for(let u of a){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;s[c.toString()]===void 0&&(s[c.toString()]={});let l=Et.decode(u.accountInfo.data);s[c.toString()][l.startTickIndex]={...l,address:u.pubkey}}return s}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){let a=[];for(let s=0;s<e.length;s++){let u=e[s];u!==null&&(a.find(c=>c.equals(u.state.programId))||a.push(u.state.programId))}if(n){let s=n.tokenAccounts.map(p=>p.accountInfo.mint),u=[];for(let p of s)for(let m of a)u.push(Re(m,p).publicKey);let c=await lt(t,u,{batchRequest:r}),l={};for(let p of c){if(p===null)continue;let m=Gn.decode(p.data),d=m.poolId.toString(),y=e.find(N=>N.state.id.toBase58()===d);if(y===void 0)continue;let f=y.state,b=O._getTickPriceLegacy({poolInfo:f,tick:m.tickLower,baseIn:!0}),k=O._getTickPriceLegacy({poolInfo:f,tick:m.tickUpper,baseIn:!0}),{amountA:x,amountB:I}=j.getAmountsFromLiquidity(f.sqrtPriceX64,b.tickSqrtPriceX64,k.tickSqrtPriceX64,m.liquidity,!1),L=1/(1-Math.sqrt(Math.sqrt(b.price.div(k.price).toNumber())));y.positionAccount=[...y.positionAccount??[],{poolId:m.poolId,nftMint:m.nftMint,priceLower:b.price,priceUpper:k.price,amountA:x,amountB:I,tickLower:m.tickLower,tickUpper:m.tickUpper,liquidity:m.liquidity,feeGrowthInsideLastX64A:m.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:m.feeGrowthInsideLastX64B,tokenFeesOwedA:m.tokenFeesOwedA,tokenFeesOwedB:m.tokenFeesOwedB,rewardInfos:m.rewardInfos.map(N=>({...N,pendingReward:new ue(0)})),leverage:L,tokenFeeAmountA:new ue(0),tokenFeeAmountB:new ue(0)}];let v=await O.getTickArrayAddressByTick(y.state.programId,m.poolId,m.tickLower,y.state.tickSpacing),w=await O.getTickArrayAddressByTick(y.state.programId,m.poolId,m.tickUpper,y.state.tickSpacing);l[`${y.state.programId.toString()}-${m.poolId.toString()}-${m.tickLower}`]=v,l[`${y.state.programId.toString()}-${m.poolId.toString()}-${m.tickUpper}`]=w}if(o){let p=Object.values(l),m=await lt(t,p,{batchRequest:r}),d={};for(let y=0;y<p.length;y++){let f=m[y];if(f===null)continue;let b=p[y].toString();d[b]=Et.decode(f.data)}for(let{state:y,positionAccount:f}of e)if(!!f)for(let b of f){let k=`${y.programId.toString()}-${y.id.toString()}-${b.tickLower}`,x=`${y.programId.toString()}-${y.id.toString()}-${b.tickUpper}`,I=d[l[k].toString()],L=d[l[x].toString()],v=I.ticks[O.getTickOffsetInArray(b.tickLower,y.tickSpacing)],w=L.ticks[O.getTickOffsetInArray(b.tickUpper,y.tickSpacing)],{tokenFeeAmountA:N,tokenFeeAmountB:F}=await vt.GetPositionFees(y,b,v,w),h=await vt.GetPositionRewards(y,b,v,w);b.tokenFeeAmountA=N.gte(new ue(0))?N:new ue(0),b.tokenFeeAmountB=F.gte(new ue(0))?F:new ue(0);for(let U=0;U<h.length;U++)b.rewardInfos[U].pendingReward=h[U].gte(new ue(0))?h[U]:new ue(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:a,priceLimit:s=new M(0),catchLiquidityInsufficient:u=!1}){let c,l=n.toBase58()===e.mintA.address,[p,m]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];s.equals(new M(0))?c=l?Qe.add(new ue(1)):He.sub(new ue(1)):c=G.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let d=fe(o,p,r,!1),{allTrade:y,expectedAmountOut:f,remainingAccounts:b,executionPrice:k,feeAmount:x}=pe.getOutputAmountAndRemainAccounts(e,t,n,d.amount.sub(d.fee??le),c,u),I=fe(f,m,r,!1),L=G.sqrtPriceX64ToPrice(k,e.mintA.decimals,e.mintB.decimals),v=l?L:new M(1).div(L),w=f.mul(new ue(Math.floor((1-a)*1e10))).div(new ue(1e10)),N=fe(w,m,r,!1),F=l?e.currentPrice:new M(1).div(e.currentPrice),h=new M(v).sub(F).abs(),U=F,Q=new $e(new M(h).mul(10**15).toFixed(0),new M(U).mul(10**15).toFixed(0));return{allTrade:y,realAmountIn:d,amountOut:I,minAmountOut:N,expirationTime:tt(d.expirationTime,I.expirationTime),currentPrice:e.currentPrice,executionPrice:v,priceImpact:Q,fee:x,remainingAccounts:b,executionPriceX64:k}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:a,catchLiquidityInsufficient:s=!1}){let u=r.address===e.mintB.address,[c,l]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[p,m]=[new Ge({...c,mint:c.address,isToken2022:c.programId===Qi.toBase58()}),new Ge({...l,mint:l.address,isToken2022:l.programId===Qi.toBase58()})],{allTrade:d,realAmountIn:y,amountOut:f,minAmountOut:b,expirationTime:k,currentPrice:x,executionPrice:I,priceImpact:L,fee:v,remainingAccounts:w,executionPriceX64:N}=pe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new We(c.address),amountIn:n,slippage:o,epochInfo:a,catchLiquidityInsufficient:s}),F={...y,amount:new ke(p,y.amount),fee:y.fee===void 0?void 0:new ke(p,y.fee)},h={...f,amount:new ke(m,f.amount),fee:f.fee===void 0?void 0:new ke(m,f.fee)},U={...b,amount:new ke(m,b.amount),fee:b.fee===void 0?void 0:new ke(m,b.fee)},Q=new Me({baseToken:p,denominator:new ue(10).pow(new ue(20+p.decimals)),quoteToken:m,numerator:x.mul(new M(10**(20+m.decimals))).toFixed(0)}),ge=new Me({baseToken:p,denominator:new ue(10).pow(new ue(20+p.decimals)),quoteToken:m,numerator:I.mul(new M(10**(20+m.decimals))).toFixed(0)}),ie=new ke(p,v);return{allTrade:d,realAmountIn:F,amountOut:h,minAmountOut:U,expirationTime:k,currentPrice:Q,executionPrice:ge,priceImpact:L,fee:ie,remainingAccounts:w,executionPriceX64:N}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:a,priceLimit:s=new M(0)}){let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;s.equals(new M(0))?l=u?He.sub(new ue(1)):Qe.add(new ue(1)):l=G.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let p=fe(o,c[n.toString()],r,!0),{expectedAmountIn:m,remainingAccounts:d,executionPrice:y,feeAmount:f}=pe.getInputAmountAndRemainAccounts(e,t,n,p.amount.sub(p.fee??le),l),b=u?e.mintB.address:e.mintA.address,k=fe(m,c[b],r,!1),x=G.sqrtPriceX64ToPrice(y,e.mintA.decimals,e.mintB.decimals),I=u?x:new M(1).div(x),L=m.mul(new ue(Math.floor((1+a)*1e10))).div(new ue(1e10)),v=fe(L,c[b],r,!0),w=u?e.currentPrice:new M(1).div(e.currentPrice),N=new M(I).sub(w).abs(),F=w,h=new $e(new M(N).mul(10**15).toFixed(0),new M(F).mul(10**15).toFixed(0));return{amountIn:k,maxAmountIn:v,realAmountOut:p,expirationTime:tt(k.expirationTime,p.expirationTime),currentPrice:e.currentPrice,executionPrice:I,priceImpact:h,fee:f,remainingAccounts:d}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){let o=e[t],a=O.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),s=O.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(a,o.priceMin),l=Math.min(s,o.priceMax)-u,p=s-a,m=o.priceMax-o.priceMin,d;return l<=0?d=0:p===l?d=m/l:m===l?d=l/p:d=l/m*(l/p),{feeApr:o.feeApr*d,rewardsApr:[(o.rewardApr[0]??0)*d,(o.rewardApr[1]??0)*d,(o.rewardApr[2]??0)*d],apr:o.apr*d}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:a,positionTickUpperIndex:s,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],p=r[wt(e.mintA.address).toString()],m=r[wt(e.mintB.address).toString()],d=e.mintA.decimals,y=e.mintB.decimals;if(!l||!p||!m)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=G.priceToSqrtPriceX64(new M(e.price),e.mintA.decimals,e.mintB.decimals),b=G.getSqrtPriceX64FromTick(a),k=G.getSqrtPriceX64FromTick(s),{amountSlippageA:x,amountSlippageB:I}=j.getAmountsFromLiquidityWithSlippage(f,b,k,t,!1,!1,0),{amountSlippageA:L,amountSlippageB:v}=j.getAmountsFromLiquidityWithSlippage(f,b,k,o,!1,!1,0),w=new M(x.toString()).div(new M(10).pow(d)).mul(p.value).add(new M(I.toString()).div(new M(10).pow(y)).mul(m.value)),N=new M(L.toString()).div(new M(10).pow(d)).mul(p.value).add(new M(v.toString()).div(new M(10).pow(y)).mul(m.value)),F=new M(1).div(w.add(N)),U=new M(l.volumeFee).mul(365).div(c).mul(F).mul(100).toNumber(),Q=3600*24*365,ge=e.rewardDefaultInfos.map(ie=>{let we=ie.mint.decimals,me=r[ie.mint.address];return u<(ie.startTime??0)||u>(ie.endTime??0)||!ie.perSecond||!me||we===void 0?0:new M(me.value).mul(new M(ie.perSecond).mul(Q)).div(new M(10).pow(we)).mul(F).mul(100).toNumber()});return{feeApr:U,rewardsApr:ge,apr:U+ge.reduce((ie,we)=>ie+we,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:a,add:s,epochInfo:u,amountHasFee:c}){let l=G.priceToSqrtPriceX64(new M(e.price),e.mintA.decimals,e.mintB.decimals),p=G.getSqrtPriceX64FromTick(n),m=G.getSqrtPriceX64FromTick(r),d=fe(o,e[t?"mintA":"mintB"].extensions?.feeConfig,u,!c),y=new ue(new M(d.amount.sub(d.fee??le).toString()).toFixed(0)),f;if(l.lte(p))f=t?j.getLiquidityFromTokenAmountA(p,m,y,!s):new ue(0);else if(l.lte(m)){let k=j.getLiquidityFromTokenAmountA(l,m,y,!s),x=j.getLiquidityFromTokenAmountB(p,l,y);f=t?k:x}else f=t?new ue(0):j.getLiquidityFromTokenAmountB(p,m,y);let b=await pe.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:f,slippage:a,add:s});return{liquidity:f,amountA:t?d:b.amountA,amountB:t?b.amountB:d,amountSlippageA:t?d:b.amountSlippageA,amountSlippageB:t?b.amountSlippageB:d,expirationTime:b.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:a,add:s}){let u=G.getSqrtPriceX64FromTick(n),c=G.getSqrtPriceX64FromTick(r),l=s?1+a:1-a,p=j.getAmountsFromLiquidity(G.priceToSqrtPriceX64(new M(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,s),[m,d]=[fe(p.amountA,t.mintA.extensions?.feeConfig,e,!0),fe(p.amountB,t.mintB.extensions?.feeConfig,e,!0)],[y,f]=[fe(p.amountA.muln(l),t.mintA.extensions?.feeConfig,e,!0),fe(p.amountB.muln(l),t.mintB.extensions?.feeConfig,e,!0)];return{liquidity:o,amountA:m,amountB:d,amountSlippageA:y,amountSlippageB:f,expirationTime:tt(m.expirationTime,d.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new We(u.id));(await lt(e,r)).forEach((u,c)=>{!u||(n[r[c].toBase58()]=ln.decode(u.data))});let a=t.map(u=>ye(new We(u.programId),new We(u.id)).publicKey),s=await pe.fetchExBitmaps({connection:e,exBitmapAddress:a,batchRequest:!1});return t.reduce((u,c)=>({...u,[c.id]:{...n[c.id],id:new We(c.id),version:6,programId:new We(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:{...c.config,id:new We(c.config.id),fundOwner:""},currentPrice:new M(c.price),exBitmapAccount:ye(new We(c.programId),new We(c.id)).publicKey,exBitmapInfo:s[ye(new We(c.programId),new We(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber(),rewardInfos:n[c.id].rewardInfos}}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var X=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(le)||(o=o.add(Ee)),o}static mulDivFloor(e,t,n){if(n.eq(le))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(le))throw new Error("division by 0");return e.mul(t).add(n.sub(Ee)).div(n)}static x64ToDecimal(e,t){return new M(e.toString()).div(M.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new z(e.mul(M.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(rn).sub(t).mod(rn)}};function he(i,e){return Un(i.mul(e),64,256)}function ys(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Un(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var G=class{static sqrtPriceX64ToPrice(e,t,n){return X.x64ToDecimal(e).pow(2).mul(M.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return X.decimalToX64(e.mul(M.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(le))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(le))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(le))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(le))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(le))return e;let o=t.shln(Mt);if(r){let a=o,s=o.add(n.mul(e));return s.gte(a)?X.mulDivCeil(a,e,s):X.mulDivRoundingUp(a,Ee,a.div(e).add(n))}else{let a=n.mul(e);if(!o.gt(a))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let s=o.sub(a);return X.mulDivCeil(o,e,s)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Mt);if(r)return e.add(o.div(t));{let a=X.mulDivRoundingUp(o,Ee,t);if(!e.gt(a))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(a)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ke||e>Ne)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new z("18445821805675395072"):new z("18446744073709551616");return(t&2)!=0&&(n=he(n,new z("18444899583751176192"))),(t&4)!=0&&(n=he(n,new z("18443055278223355904"))),(t&8)!=0&&(n=he(n,new z("18439367220385607680"))),(t&16)!=0&&(n=he(n,new z("18431993317065453568"))),(t&32)!=0&&(n=he(n,new z("18417254355718170624"))),(t&64)!=0&&(n=he(n,new z("18387811781193609216"))),(t&128)!=0&&(n=he(n,new z("18329067761203558400"))),(t&256)!=0&&(n=he(n,new z("18212142134806163456"))),(t&512)!=0&&(n=he(n,new z("17980523815641700352"))),(t&1024)!=0&&(n=he(n,new z("17526086738831433728"))),(t&2048)!=0&&(n=he(n,new z("16651378430235570176"))),(t&4096)!=0&&(n=he(n,new z("15030750278694412288"))),(t&8192)!=0&&(n=he(n,new z("12247334978884435968"))),(t&16384)!=0&&(n=he(n,new z("8131365268886854656"))),(t&32768)!=0&&(n=he(n,new z("3584323654725218816"))),(t&65536)!=0&&(n=he(n,new z("696457651848324352"))),(t&131072)!=0&&(n=he(n,new z("26294789957507116"))),(t&262144)!=0&&(n=he(n,new z("37481735321082"))),e>0&&(n=vi.div(n)),n}static getTickFromPrice(e,t,n){return G.getTickFromSqrtPriceX64(G.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(He)||e.lt(Qe))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new z(t-64),r=ys(n,32,128),o=new z("8000000000000000","hex"),a=0,s=new z(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new z(0))&&a<Ei;){u=u.mul(u);let y=u.shrn(127);u=u.shrn(63+y.toNumber()),s=s.add(o.mul(y)),o=o.shrn(1),a+=1}let c=s.shrn(32),p=r.add(c).mul(new z(Fi)),m=Un(p.sub(new z(Wi)),64,128).toNumber(),d=Un(p.add(new z(Vi)),64,128).toNumber();return m==d?m:G.getSqrtPriceX64FromTick(d).lte(e)?d:m}},gt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let a=G.getTickFromSqrtPriceX64(G.priceToSqrtPriceX64(e,n,r))/t;return a<0?a=Math.floor(a):a=Math.ceil(a),a*t}static roundPriceWithTickspacing(e,t,n,r){let o=gt.getTickWithPriceAndTickspacing(e,t,n,r),a=G.getSqrtPriceX64FromTick(o);return G.sqrtPriceX64ToPrice(a,n,r)}},j=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(le))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Mt),a=t.sub(e);return r?X.mulDivRoundingUp(X.mulDivCeil(o,a,t),Ee,e):X.mulDivFloor(o,a,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(le))throw new Error("sqrtPriceX64A must greater than 0");return r?X.mulDivCeil(n,t.sub(e),Fe):X.mulDivFloor(n,t.sub(e),Fe)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),a=t.sub(e),s=o.div(a);return r?X.mulDivRoundingUp(s,Ee,En):s.shrn(Mt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),X.mulDivFloor(n,En,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return j.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let a=j.getLiquidityFromTokenAmountA(e,n,r,!1),s=j.getLiquidityFromTokenAmountB(t,e,o);return a.lt(s)?a:s}else return j.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:j.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new z(0)};if(e.lt(n)){let a=j.getTokenAmountAFromLiquidity(e,n,r,o),s=j.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:a,amountB:s}}else return{amountA:new z(0),amountB:j.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,a,s){let{amountA:u,amountB:c}=j.getAmountsFromLiquidity(e,t,n,r,a),l=o?1+s:1-s,p=new z(new M(u.toString()).mul(l).toFixed(0)),m=new z(new M(c.toString()).mul(l).toFixed(0));return{amountSlippageA:p,amountSlippageB:m}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:a,epochInfo:s,amountAddFee:u}){let c=G.priceToSqrtPriceX64(new M(e.price),e.mintA.decimals,e.mintB.decimals),l=G.getSqrtPriceX64FromTick(t),p=G.getSqrtPriceX64FromTick(n),m=a?1+o:1-o,d=j.getAmountsFromLiquidity(c,l,p,r,a),[y,f]=[fe(d.amountA,e.mintA.extensions?.feeConfig,s,u),fe(d.amountB,e.mintB.extensions?.feeConfig,s,u)],[b,k]=[fe(new z(new M(d.amountA.toString()).mul(m).toFixed(0)),e.mintA.extensions?.feeConfig,s,u),fe(new z(new M(d.amountB.toString()).mul(m).toFixed(0)),e.mintB.extensions?.feeConfig,s,u)];return{liquidity:r,amountA:y,amountB:f,amountSlippageA:b,amountSlippageB:k,expirationTime:tt(y.expirationTime,f.expirationTime)}}},yt=class{static swapCompute(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f=!1){if(m.eq(le))throw new Error("amountSpecified must not be 0");if(y||(y=a?Qe.add(Ee):He.sub(Ee)),a){if(y.lt(Qe))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(p))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(He))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(p))throw new Error("sqrtPriceX64 must greater than current")}let b=m.gt(le),k={amountSpecifiedRemaining:m,amountCalculated:le,sqrtPriceX64:p,tick:c>d?Math.min(d+Z.tickCount(l)-1,c):d,accounts:[],liquidity:u,feeAmount:new z(0)},x=d,I=n[d],L=0,v=!a&&I.startTickIndex===k.tick;for(;!k.amountSpecifiedRemaining.eq(le)&&!k.sqrtPriceX64.eq(y);){L>10;let w={};w.sqrtPriceStartX64=k.sqrtPriceX64;let N=O.nextInitTick(I,k.tick,l,a,v),F=N||null,h=null;if(!F?.liquidityGross.gtn(0)){let Q=pe.nextInitializedTickArrayStartIndex({tickCurrent:k.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},x,a);if(!Q.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:k.amountSpecifiedRemaining,amountCalculated:k.amountCalculated,feeAmount:k.feeAmount,sqrtPriceX64:k.sqrtPriceX64,liquidity:k.liquidity,tickCurrent:k.tick,accounts:k.accounts};throw Error("swapCompute LiquidityInsufficient")}x=Q.nextStartIndex;let{publicKey:ge}=J(e,t,x);h=ge,I=n[x];try{F=O.firstInitializedTick(I,a)}catch{throw Error("not found next tick info")}}w.tickNext=F.tick,w.initialized=F.liquidityGross.gtn(0),d!==x&&h&&(k.accounts.push(h),d=x),w.tickNext<Ke?w.tickNext=Ke:w.tickNext>Ne&&(w.tickNext=Ne),w.sqrtPriceNextX64=G.getSqrtPriceX64FromTick(w.tickNext);let U;if(a&&w.sqrtPriceNextX64.lt(y)||!a&&w.sqrtPriceNextX64.gt(y)?U=y:U=w.sqrtPriceNextX64,[k.sqrtPriceX64,w.amountIn,w.amountOut,w.feeAmount]=yt.swapStepCompute(k.sqrtPriceX64,U,k.liquidity,k.amountSpecifiedRemaining,s,a),k.feeAmount=k.feeAmount.add(w.feeAmount),b?(k.amountSpecifiedRemaining=k.amountSpecifiedRemaining.sub(w.amountIn.add(w.feeAmount)),k.amountCalculated=k.amountCalculated.sub(w.amountOut)):(k.amountSpecifiedRemaining=k.amountSpecifiedRemaining.add(w.amountOut),k.amountCalculated=k.amountCalculated.add(w.amountIn.add(w.feeAmount))),k.sqrtPriceX64.eq(w.sqrtPriceNextX64)){if(w.initialized){let Q=F.liquidityNet;a&&(Q=Q.mul(nt)),k.liquidity=j.addDelta(k.liquidity,Q)}v=w.tickNext!=k.tick&&!a&&I.startTickIndex===w.tickNext,k.tick=a?w.tickNext-1:w.tickNext}else if(k.sqrtPriceX64!=w.sqrtPriceStartX64){let Q=G.getTickFromSqrtPriceX64(k.sqrtPriceX64);v=Q!=k.tick&&!a&&I.startTickIndex===Q,k.tick=Q}++L}try{let{nextStartIndex:w,isExist:N}=Z.nextInitializedTickArray(k.tick,l,a,r,o);N&&d!==w&&(k.accounts.push(J(e,t,w).publicKey),d=w)}catch{}return{allTrade:!0,amountSpecifiedRemaining:le,amountCalculated:k.amountCalculated,feeAmount:k.feeAmount,sqrtPriceX64:k.sqrtPriceX64,liquidity:k.liquidity,tickCurrent:k.tick,accounts:k.accounts}}static swapStepCompute(e,t,n,r,o,a){let s={sqrtPriceX64Next:new z(0),amountIn:new z(0),amountOut:new z(0),feeAmount:new z(0)},u=r.gte(le);if(u){let l=X.mulDivFloor(r,an.sub(new z(o.toString())),an);s.amountIn=a?j.getTokenAmountAFromLiquidity(t,e,n,!0):j.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=G.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?j.getTokenAmountBFromLiquidity(t,e,n,!1):j.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(nt).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=G.getNextSqrtPriceX64FromOutput(e,n,r.mul(nt),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=j.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=j.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:j.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:j.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(nt))&&(s.amountOut=r.mul(nt)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=X.mulDivCeil(s.amountIn,new z(o),an.sub(new z(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var Ae=60,bt=512,O=class{static getTickArrayAddressByTick(e,t,n,r){let o=O.getTickArrayStartIndexByTick(n,r),{publicKey:a}=J(e,t,o);return a}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=O.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=Ae)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=Z.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*Z.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*Ae,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*Ae,o=Math.floor(t/r)+512,a=Math.abs(o);return{isInitialized:e.testn(a),startIndex:(a-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*Ae:e+t*Ae}static mergeTickArrayBitmap(e){let t=new gs(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let a=Math.floor(r/(n*Ae));return[...O.searchLowBitFromStart(e,t,a-1,o,n),...O.searchHightBitFromStart(e,t,a,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return O.searchHightBitFromStart(e,t,-7680,bt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let a=[],s=O.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of s){let{publicKey:c}=J(e,t,u);a.push({tickArrayStartIndex:u,tickArrayAddress:c})}return a}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let a=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>O.mergeTickArrayBitmap(c)),s=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(a[c].testn(l)&&s.push(n),n--,s.length===r)break}let u=Z.tickCount(o);return s.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let a=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>O.mergeTickArrayBitmap(c)),s=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(a[c].testn(l)&&s.push(n),n++,s.length===r)break}let u=Z.tickCount(o);return s.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Ke||e>Ne}static nextInitTick(e,t,n,r,o){if(Z.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let s=Math.floor((t-e.startTickIndex)/n);if(r)for(;s>=0;){if(e.ticks[s].liquidityGross.gtn(0))return e.ticks[s];s=s-1}else for(o||(s=s+1);s<Ae;){if(e.ticks[s].liquidityGross.gtn(0))return e.ticks[s];s=s+1}return null}static firstInitializedTick(e,t){if(t){let n=Ae-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<Ae;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=G.getSqrtPriceX64FromTick(t),o=G.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new M(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new M(1).div(t),o=gt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),a=G.getSqrtPriceX64FromTick(o),s=G.sqrtPriceX64ToPrice(a,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:s}:{tick:o,price:new M(1).div(s)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=G.getSqrtPriceX64FromTick(t),o=G.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new M(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new M(1).div(t),o=gt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),a=G.getSqrtPriceX64FromTick(o),s=G.sqrtPriceX64ToPrice(a,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:s}:{tick:o,price:new M(1).div(s)}}};var Ps=R([be(8),V("bump"),ft("index"),S(""),ve("protocolFeeRate"),ve("tradeFeeRate"),ft("tickSpacing"),H(P(),8,"")]),ks=R([ve("blockTimestamp"),Mi("tickCumulative"),H(P(),4)]),Zi=R([be(8),Te("initialized"),P("recentEpoch"),ft("observationIndex"),S("poolId"),H(ks,100,"observations"),H(P(),4)]),As=R([V("rewardState"),P("openTime"),P("endTime"),P("lastUpdateTime"),_("emissionsPerSecondX64"),P("rewardTotalEmissioned"),P("rewardClaimed"),S("tokenMint"),S("tokenVault"),S("creator"),_("rewardGrowthGlobalX64")]),ln=R([be(8),V("bump"),S("ammConfig"),S("creator"),S("mintA"),S("mintB"),S("vaultA"),S("vaultB"),S("observationId"),V("mintDecimalsA"),V("mintDecimalsB"),ft("tickSpacing"),_("liquidity"),_("sqrtPriceX64"),ae("tickCurrent"),ve(),_("feeGrowthGlobalX64A"),_("feeGrowthGlobalX64B"),P("protocolFeesTokenA"),P("protocolFeesTokenB"),_("swapInAmountTokenA"),_("swapOutAmountTokenB"),_("swapInAmountTokenB"),_("swapOutAmountTokenA"),V("status"),H(V(),7,""),H(As,3,"rewardInfos"),H(P(),16,"tickArrayBitmap"),P("totalFeesTokenA"),P("totalFeesClaimedTokenA"),P("totalFeesTokenB"),P("totalFeesClaimedTokenB"),P("fundFeesTokenA"),P("fundFeesTokenB"),P("startTime"),H(P(),15*4-3,"padding")]),ws=R([_("growthInsideLastX64"),P("rewardAmountOwed")]),Gn=R([be(8),V("bump"),S("nftMint"),S("poolId"),ae("tickLower"),ae("tickUpper"),_("liquidity"),_("feeGrowthInsideLastX64A"),_("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),H(ws,3,"rewardInfos"),H(P(),8,"")]),sd=R([be(8),V("bump"),S("poolId"),ae("tickLowerIndex"),ae("tickUpperIndex"),_("liquidity"),_("feeGrowthInsideLastX64A"),_("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),H(_(),3,"rewardGrowthInside"),H(P(),8,"")]),Ts=R([ae("tick"),Oi("liquidityNet"),_("liquidityGross"),_("feeGrowthOutsideX64A"),_("feeGrowthOutsideX64B"),H(_(),3,"rewardGrowthsOutsideX64"),H(ve(),13,"")]),Et=R([be(8),S("poolId"),ae("startTickIndex"),H(Ts,Ae,"ticks"),V("initializedTickCount"),H(V(),115,"")]),hs=R([be(329),H(S(),100,"whitelistMints")]),Hi=R([be(8),S("poolId"),H(H(P(),8),qn,"positiveTickArrayBitmap"),H(H(P(),8),qn,"negativeTickArrayBitmap")]),ad=R([P(),V("bump"),S("owner"),S("poolId"),S("positionId"),S("nftAccount"),H(P(),8)]),ud=R([be(8),V("bump"),S("lockOwner"),S("poolId"),S("positionId"),S("nftAccount"),S("lockNftMint"),P("recentEpoch"),H(P(),8)]);Zi.span;var ji=oe("Raydium_Clmm"),Ve={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Yi=[188,37,179,131,82,150,84,73],Ji=[16,72,250,198,14,162,212,19],Pt=class{static createPoolInstruction(e,t,n,r,o,a,s,u,c,l,p,m,d,y){let f=R([_("sqrtPriceX64"),P("zero")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:ot.programId,isSigner:!1,isWritable:!1},{pubkey:ze,isSigner:!1,isWritable:!1},...y?.map(I=>({pubkey:I,isSigner:!1,isWritable:!1}))||[]],k=Buffer.alloc(f.span);f.encode({sqrtPriceX64:d,zero:le},k);let x=Buffer.from([...Ve.createPool,...k]);return new xe({keys:b,programId:e,data:x})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:a,initialPriceX64:s,extendMintAccount:u}=e,[c,l]=[new B(r.address),new B(o.address)],{publicKey:p}=Gi(t,a,c,l),{publicKey:m}=Xi(t,p),{publicKey:d}=Vn(t,p,c),{publicKey:y}=Vn(t,p,l),f=ye(t,p).publicKey,b=[this.createPoolInstruction(t,p,n,a,m,c,d,new B(r.programId||ee),l,y,new B(o.programId||ee),f,s,u)];return{signers:[],instructions:b,instructionTypes:[$.CreateAccount,$.ClmmCreatePool],address:{poolId:p,observationId:m,exBitmapAccount:f,mintAVault:d,mintBVault:y},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f,b,k,x,I,L,v,w,N,F,h,U){let Q=R([ae("tickLowerIndex"),ae("tickUpperIndex"),ae("tickArrayLowerStartIndex"),ae("tickArrayUpperStartIndex"),_("liquidity"),P("amountMaxA"),P("amountMaxB"),Te("withMetadata"),V("optionBaseFlag"),Te("baseFlag")]),ge=[...U?[{pubkey:U,isSigner:!1,isWritable:!0}]:[]],ie=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ze,isSigner:!1,isWritable:!1},{pubkey:ot.programId,isSigner:!1,isWritable:!1},{pubkey:ee,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...ge],we=Buffer.alloc(Q.span);Q.encode({tickLowerIndex:x,tickUpperIndex:I,tickArrayLowerStartIndex:L,tickArrayUpperStartIndex:v,liquidity:w,amountMaxA:N,amountMaxB:F,withMetadata:h==="create",baseFlag:!1,optionBaseFlag:0},we);let me=Buffer.from([...Ve.openPosition,...we]);return new xe({keys:ie,programId:e,data:me})}static openPositionFromLiquidityInstruction22(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f,b,k,x,I,L,v,w,N,F,h){let U=R([ae("tickLowerIndex"),ae("tickUpperIndex"),ae("tickArrayLowerStartIndex"),ae("tickArrayUpperStartIndex"),_("liquidity"),P("amountMaxA"),P("amountMaxB"),Te("withMetadata"),V("optionBaseFlag"),Te("baseFlag")]),Q=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],ge=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:ze,isSigner:!1,isWritable:!1},{pubkey:ot.programId,isSigner:!1,isWritable:!1},{pubkey:ee,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...Q],ie=Buffer.alloc(U.span);U.encode({tickLowerIndex:k,tickUpperIndex:x,tickArrayLowerStartIndex:I,tickArrayUpperStartIndex:L,liquidity:v,amountMaxA:w,amountMaxB:N,withMetadata:F==="create",baseFlag:!1,optionBaseFlag:0},ie);let we=Buffer.from([...Ve.openPositionWithTokenEx,...ie]);return new xe({keys:ge,programId:e,data:we})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:a,amountMaxA:s,amountMaxB:u,withMetadata:c,getEphemeralSigners:l,nft2022:p}){let m=[],[d,y]=[new B(e.programId),new B(e.id)],f;if(l)f=new B((await l(1))[0]);else{let h=mn.generate();m.push(h),f=h.publicKey}let b=O.getTickArrayStartIndexByTick(r,e.config.tickSpacing),k=O.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:x}=J(d,y,b),{publicKey:I}=J(d,y,k),{publicKey:L}=p?te(n.wallet,f,de):te(n.wallet,f,ee),{publicKey:v}=ht(f),{publicKey:w}=Re(d,f),{publicKey:N}=it(d,y,r,o),F=p?this.openPositionFromLiquidityInstruction22(d,n.feePayer,y,n.wallet,f,L,N,x,I,w,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),r,o,b,k,a,s,u,c,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,k])?ye(d,y).publicKey:void 0):this.openPositionFromLiquidityInstruction(d,n.feePayer,y,n.wallet,f,L,v,N,x,I,w,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),r,o,b,k,a,s,u,c,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,k])?ye(d,y).publicKey:void 0);return{signers:m,instructions:[F],instructionTypes:[$.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:f,tickArrayLower:x,tickArrayUpper:I,positionNftAccount:L,metadataAccount:v,personalPosition:w,protocolPosition:N}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:a,baseAmount:s,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l,nft2022:p}){let m=[],[d,y]=[new B(e.programId),new B(e.id)],f;if(l)f=new B((await l(1))[0]);else{let h=mn.generate();m.push(h),f=h.publicKey}let b=O.getTickArrayStartIndexByTick(r,e.config.tickSpacing),k=O.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:x}=J(d,y,b),{publicKey:I}=J(d,y,k),{publicKey:L}=p?te(n.wallet,f,de):te(n.wallet,f,ee),{publicKey:v}=ht(f),{publicKey:w}=Re(d,f),{publicKey:N}=it(d,y,r,o),F=p?this.openPositionFromBaseInstruction22(d,n.feePayer,y,n.wallet,f,L,N,x,I,w,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),r,o,b,k,c,a,s,u,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,k])?ye(d,y).publicKey:void 0):this.openPositionFromBaseInstruction(d,n.feePayer,y,n.wallet,f,L,v,N,x,I,w,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),r,o,b,k,c,a,s,u,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,k])?ye(d,y).publicKey:void 0);return{address:{nftMint:f,tickArrayLower:x,tickArrayUpper:I,positionNftAccount:L,metadataAccount:v,personalPosition:w,protocolPosition:N},instructions:[F],signers:m,instructionTypes:[$.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f,b,k,x,I,L,v,w,N,F,h,U){let Q=R([ae("tickLowerIndex"),ae("tickUpperIndex"),ae("tickArrayLowerStartIndex"),ae("tickArrayUpperStartIndex"),_("liquidity"),P("amountMaxA"),P("amountMaxB"),Te("withMetadata"),V("optionBaseFlag"),Te("baseFlag")]),ge=[...U?[{pubkey:U,isSigner:!1,isWritable:!0}]:[]],ie=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ze,isSigner:!1,isWritable:!1},{pubkey:ot.programId,isSigner:!1,isWritable:!1},{pubkey:ee,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...ge],we=Buffer.alloc(Q.span);Q.encode({tickLowerIndex:x,tickUpperIndex:I,tickArrayLowerStartIndex:L,tickArrayUpperStartIndex:v,liquidity:new Xn(0),amountMaxA:N==="MintA"?F:h,amountMaxB:N==="MintA"?h:F,withMetadata:w==="create",baseFlag:N==="MintA",optionBaseFlag:1},we);let me=Buffer.from([...Ve.openPosition,...we]);return new xe({keys:ie,programId:e,data:me})}static openPositionFromBaseInstruction22(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f,b,k,x,I,L,v,w,N,F,h){let U=R([ae("tickLowerIndex"),ae("tickUpperIndex"),ae("tickArrayLowerStartIndex"),ae("tickArrayUpperStartIndex"),_("liquidity"),P("amountMaxA"),P("amountMaxB"),Te("withMetadata"),V("optionBaseFlag"),Te("baseFlag")]),Q=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],ge=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:ze,isSigner:!1,isWritable:!1},{pubkey:ot.programId,isSigner:!1,isWritable:!1},{pubkey:ee,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...Q],ie=Buffer.alloc(U.span);U.encode({tickLowerIndex:k,tickUpperIndex:x,tickArrayLowerStartIndex:I,tickArrayUpperStartIndex:L,liquidity:new Xn(0),amountMaxA:w==="MintA"?N:F,amountMaxB:w==="MintA"?F:N,withMetadata:v==="create",baseFlag:w==="MintA",optionBaseFlag:1},ie);let we=Buffer.from([...Ve.openPositionWithTokenEx,...ie]);return new xe({keys:ge,programId:e,data:we})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:a,amountMaxA:s,amountMaxB:u,withMetadata:c,getEphemeralSigners:l,nft2022:p}){let m,d=[];if(l)m=new B((await l(1))[0]);else{let h=mn.generate();d.push(h),m=h.publicKey}let[y,f]=[new B(e.programId),new B(e.id)],b=O.getTickArrayStartIndexByTick(r,e.config.tickSpacing),k=O.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:x}=J(y,f,b),{publicKey:I}=J(y,f,k),{publicKey:L}=p?te(n.wallet,m,de):te(n.wallet,m,ee),{publicKey:v}=ht(m),{publicKey:w}=Re(y,m),{publicKey:N}=it(y,f,r,o),F=p?this.openPositionFromLiquidityInstruction22(y,n.wallet,f,n.wallet,m,L,N,x,I,w,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(t.mintA.address),new B(t.mintB.address),r,o,b,k,a,s,u,c,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,k])?ye(y,f).publicKey:void 0):this.openPositionFromLiquidityInstruction(y,n.wallet,f,n.wallet,m,L,v,N,x,I,w,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(t.mintA.address),new B(t.mintB.address),r,o,b,k,a,s,u,c,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,k])?ye(y,f).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:x,tickArrayUpper:I,positionNftAccount:L,metadataAccount:v,personalPosition:w,protocolPosition:N},instructions:[F],signers:d,instructionTypes:[$.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o,a){let s=R([]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:ot.programId,isSigner:!1,isWritable:!1},{pubkey:a?de:ee,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);s.encode({},c);let l=Buffer.from([...Ve.closePosition,...c]);return new xe({keys:u,programId:e,data:l})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r,nft2022:o}){let a=new B(e.programId),s=o?te(n.wallet,r.nftMint,de).publicKey:te(n.wallet,r.nftMint,ee).publicKey,{publicKey:u}=Re(a,r.nftMint),c=[];return c.push(this.closePositionInstruction(a,n.wallet,r.nftMint,s,u,o)),{address:{positionNftAccount:s,personalPosition:u},signers:[],instructions:c,instructionTypes:[$.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f,b,k,x){let I=R([_("liquidity"),P("amountMaxA"),P("amountMaxB"),V("optionBaseFlag"),Te("baseFlag")]),L=[...x?[{pubkey:x,isSigner:!1,isWritable:!0}]:[]],v=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:ee,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...L],w=Buffer.alloc(I.span);I.encode({liquidity:f,amountMaxA:b,amountMaxB:k,optionBaseFlag:0,baseFlag:!1},w);let N=Buffer.from([...Ve.increaseLiquidity,...w]);return new xe({keys:v,programId:e,data:N})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:a,amountMaxB:s,nft2022:u}){let[c,l]=[new B(e.programId),new B(e.id)],p=O.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=O.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=J(c,l,p),{publicKey:y}=J(c,l,m),{publicKey:f}=u?te(r.wallet,n.nftMint,de):te(r.wallet,n.nftMint,ee),{publicKey:b}=Re(c,n.nftMint),{publicKey:k}=it(c,l,n.tickLower,n.tickUpper),x=this.increasePositionFromLiquidityInstruction(c,r.wallet,f,b,l,k,d,y,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),o,a,s,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,m])?ye(c,l).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:y,positionNftAccount:f,personalPosition:b,protocolPosition:k},signers:[],instructions:[x],instructionTypes:[$.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:a,otherAmountMax:s,nft2022:u}){let[c,l]=[new B(e.programId),new B(e.id)],p=O.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=O.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=J(c,l,p),{publicKey:y}=J(c,l,m),{publicKey:f}=u?te(r.wallet,n.nftMint,de):te(r.wallet,n.nftMint,ee),{publicKey:b}=Re(c,n.nftMint),{publicKey:k}=it(c,l,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:y,positionNftAccount:f,personalPosition:b,protocolPosition:k},instructions:[this.increasePositionFromBaseInstruction(c,r.wallet,f,b,l,k,d,y,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),o,a,s,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,m])?ye(c,l).publicKey:void 0)],signers:[],instructionTypes:[$.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f,b,k,x){let I=R([_("liquidity"),P("amountMaxA"),P("amountMaxB"),V("optionBaseFlag"),Te("baseFlag")]),L=[...x?[{pubkey:x,isSigner:!1,isWritable:!0}]:[]],v=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:ee,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...L],w=Buffer.alloc(I.span);I.encode({liquidity:new Xn(0),amountMaxA:f==="MintA"?b:k,amountMaxB:f==="MintA"?k:b,baseFlag:f==="MintA",optionBaseFlag:1},w);let N=Buffer.from([...Ve.increaseLiquidity,...w]);return new xe({keys:v,programId:e,data:N})}static decreaseLiquidityInstruction(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f,b,k,x,I){let L=R([_("liquidity"),P("amountMinA"),P("amountMinB")]),v=[...I?[{pubkey:I,isSigner:!1,isWritable:!0}]:[],...f.map(h=>[{pubkey:h.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:h.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:h.rewardMint,isSigner:!1,isWritable:!1}]).flat()],w=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ee,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:Jt,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...v],N=Buffer.alloc(L.span);L.encode({liquidity:b,amountMinA:k,amountMinB:x},N);let F=Buffer.from([...Ve.decreaseLiquidity,...N]);return new xe({keys:w,programId:e,data:F})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:a,amountMinB:s,programId:u,nft2022:c}){let[l,p]=[new B(e.programId),new B(e.id)],m=O.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=O.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:y}=J(l,p,m),{publicKey:f}=J(l,p,d),{publicKey:b}=c?te(r.wallet,n.nftMint,de):te(r.wallet,n.nftMint,u),{publicKey:k}=Re(l,n.nftMint),{publicKey:x}=it(l,p,n.tickLower,n.tickUpper),I=[];for(let w=0;w<e.rewardDefaultInfos.length;w++)I.push({poolRewardVault:new B(t.rewardInfos[w].vault),ownerRewardVault:r.rewardAccounts[w],rewardMint:new B(e.rewardDefaultInfos[w].mint.address)});let L=[],v=this.decreaseLiquidityInstruction(l,r.wallet,b,k,p,x,y,f,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),I,o,a,s,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?ye(l,p).publicKey:void 0);return L.push(v),{address:{tickArrayLower:y,tickArrayUpper:f,positionNftAccount:b,personalPosition:k,protocolPosition:x},signers:[],instructions:L,instructionTypes:[$.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f,b,k){let x=R([P("amount"),P("otherAmountThreshold"),_("sqrtPriceLimitX64"),Te("isBaseInput")]),I=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[],...p.map(N=>({pubkey:N,isSigner:!1,isWritable:!0}))],L=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:ee,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:Jt,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...I],v=Buffer.alloc(x.span);x.encode({amount:d,otherAmountThreshold:y,sqrtPriceLimitX64:f,isBaseInput:b},v);let w=Buffer.from([...Ve.swap,...v]);return new xe({keys:L,programId:e,data:w})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:a,amountOutMin:s,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,p]=[new B(e.programId),new B(e.id)],[m,d]=[new B(t.vault.A),new B(t.vault.B)],[y,f]=[new B(e.mintA.address),new B(e.mintB.address)],b=e.mintA.address===o.toString(),k=[this.swapInstruction(l,r.wallet,p,new B(e.config.id),b?r.tokenAccountA:r.tokenAccountB,b?r.tokenAccountB:r.tokenAccountA,b?m:d,b?d:m,b?y:f,b?f:y,c,n,a,s,u,!0,ye(l,p).publicKey)];return{signers:[],instructions:k,instructionTypes:[$.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:a,amountInMax:s,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,p]=[new B(e.programId),new B(e.id)],[m,d]=[new B(t.vault.A),new B(t.vault.B)],[y,f]=[new B(e.mintA.address),new B(e.mintB.address)],b=e.mintA.address===o.toBase58(),k=[this.swapInstruction(l,r.wallet,p,new B(e.config.id),b?r.tokenAccountB:r.tokenAccountA,b?r.tokenAccountA:r.tokenAccountB,b?d:m,b?m:d,b?f:y,b?y:f,c,n,a,s,u,!1,ye(l,p).publicKey)];return{signers:[],instructions:k,instructionTypes:[$.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,a,s,u,c,l,p,m){let d=R([P("openTime"),P("endTime"),_("emissionsPerSecondX64")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ot.programId,isSigner:!1,isWritable:!1},{pubkey:ze,isSigner:!1,isWritable:!1}],f=Buffer.alloc(d.span);d.encode({openTime:se(l),endTime:se(p),emissionsPerSecondX64:m},f);let b=Buffer.from([...Ve.initReward,...f]);return new xe({keys:y,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,a]=[new B(e.programId),new B(e.id)],s=Ui(o,a,r.mint).publicKey,u=cn(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,a,u,new B(e.config.id),n.tokenAccount,r.programId,r.mint,s,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:s,operationId:u},signers:[],instructions:c,instructionTypes:[$.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,a,s,u,c,l,p,m){let d=R([V("rewardIndex"),_("emissionsPerSecondX64"),P("openTime"),P("endTime")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:ee,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(d.span);d.encode({rewardIndex:c,emissionsPerSecondX64:m,openTime:se(l),endTime:se(p)},f);let b=Buffer.from([...Ve.setRewardEmissions,...f]);return new xe({keys:y,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,a]=[new B(e.programId),new B(e.id)],s,u,c;for(let m=0;m<e.rewardDefaultInfos.length;m++)e.rewardDefaultInfos[m].mint.address===r.mint.toString()&&(s=m,u=new B(t.rewardInfos[m].vault),c=new B(t.rewardInfos[m].mint.address));(s===void 0||u===void 0)&&ji.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=cn(o).publicKey,p=[this.setRewardInstruction(o,n.wallet,a,l,new B(e.config.id),n.tokenAccount,u,c,s,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:p,instructionTypes:[$.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,a,s){let u=R([V("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:ee,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:Jt,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:s},l);let p=Buffer.from([...Ve.collectReward,...l]);return new xe({keys:c,programId:e,data:p})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,a]=[new B(e.programId),new B(e.id)],s,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(s=l,u=new B(t.rewardInfos[l].vault));(s===void 0||u===void 0)&&ji.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,a,n.tokenAccount,u,r,s)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[$.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:r,wallet:o,nftMint:a,nft2022:s,getEphemeralSigners:u}){let c=[],l;if(u)l=new B((await u(1))[0]);else{let k=mn.generate();c.push(k),l=k.publicKey}let p=s?te(o,a,de).publicKey:te(o,a,ee).publicKey,{publicKey:m}=Re(n,a),d=Dn(e,l).publicKey,y=te(o,l,ee).publicKey,f=ht(l).publicKey,b=Pt.lockPositionInstructionV2({programId:e,auth:t,payer:r,positionOwner:o,lockOwner:o,positionNftAccount:p,positionId:m,lockPositionId:d,lockNftMint:l,lockNftAccount:y,metadataAccount:f,withMetadata:!0,nft2022:s,positionNftMint:a,authPositionNftAccount:te(t,a,s?de:ee).publicKey,positionNftProgram:s?de:ee});return{address:{positionId:m,lockPositionId:d,lockNftAccount:y,lockNftMint:l,positionNftAccount:p,metadataAccount:f},instructions:[b],signers:c,instructionTypes:[$.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:r,lockOwner:o,positionNftAccount:a,positionId:s,positionNftMint:u,authPositionNftAccount:c,positionNftProgram:l,lockPositionId:p,lockNftMint:m,lockNftAccount:d,metadataAccount:y,withMetadata:f}){let b=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!0,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1},{pubkey:ze,isSigner:!1,isWritable:!1},{pubkey:ee,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:ot.programId,isSigner:!1,isWritable:!1}],k=R([Te("withMetadata")]),x=Buffer.alloc(k.span);k.encode({withMetadata:f},x);let I=Buffer.from([...Yi,...x]);return new xe({keys:b,programId:e,data:I})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:a}=te(r,o,ee),{publicKey:s}=Re(n,o),u=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:_n(e,s).publicKey,isSigner:!1,isWritable:!0},{pubkey:ee,isSigner:!1,isWritable:!1},{pubkey:ot.programId,isSigner:!1,isWritable:!1}];return new xe({keys:u,programId:e,data:Buffer.from(Yi)})}static harvestLockPositionInstruction(e){let[t,n]=[new B(e.poolKeys.programId),new B(e.poolKeys.id)],r=O.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=O.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:a}=J(t,n,r),{publicKey:s}=J(t,n,o),{publicKey:u}=te(e.owner,e.ownerPosition.nftMint,ee),{publicKey:c}=Re(t,e.ownerPosition.nftMint),{publicKey:l}=it(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),p=[];for(let y=0;y<e.poolKeys.rewardInfos.length;y++)p.push({poolRewardVault:new B(e.poolKeys.rewardInfos[y].vault),ownerRewardVault:e.ownerRewardAccounts[y],rewardMint:new B(e.poolKeys.rewardInfos[y].mint.address)});let m=[...p.map(y=>[{pubkey:y.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.rewardMint,isSigner:!1,isWritable:!1}]).flat()],d=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:_n(e.programId,c).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new B(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new B(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:ee,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:new B(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new B(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...m];return new xe({keys:d,programId:e.programId,data:Buffer.from(Ji)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:r,lockOwner:o,lockNftMint:a,lockNftAccount:s,positionNftAccount:u,positionId:c,poolId:l,protocolPosition:p,vaultA:m,vaultB:d,tickArrayLower:y,tickArrayUpper:f,userVaultA:b,userVaultB:k,mintA:x,mintB:I,rewardAccounts:L,exTickArrayBitmap:v}){let w=[...v?[{pubkey:v,isSigner:!1,isWritable:!0}]:[],...L.map(F=>[{pubkey:F.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:F.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:F.rewardMint,isSigner:!1,isWritable:!1}]).flat()],N=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:ee,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:x,isSigner:!1,isWritable:!1},{pubkey:I,isSigner:!1,isWritable:!1},...w];return new xe({keys:N,programId:e,data:Buffer.from(Ji)})}};var hf=R([be(8),V("bump"),Te("disableCreatePool"),ft("index"),P("tradeFeeRate"),P("protocolFeeRate"),P("fundFeeRate"),P("createPoolFee"),S("protocolOwner"),S("fundOwner"),H(P(),16)]),xs=R([be(8),S("configId"),S("poolCreator"),S("vaultA"),S("vaultB"),S("mintLp"),S("mintA"),S("mintB"),S("mintProgramA"),S("mintProgramB"),S("observationId"),V("bump"),V("status"),V("lpDecimals"),V("mintDecimalA"),V("mintDecimalB"),P("lpAmount"),P("protocolFeesMintA"),P("protocolFeesMintB"),P("fundFeesMintA"),P("fundFeesMintB"),P("openTime"),H(P(),32)]);import{PublicKey as Wf,TransactionInstruction as Ss,Keypair as _f,SystemProgram as Df}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Gf,TOKEN_2022_PROGRAM_ID as Uf,TOKEN_PROGRAM_ID as Xf}from"@solana/spl-token";var xf=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Sf=Buffer.from("amm_config","utf8"),Kf=Buffer.from("pool","utf8"),Cf=Buffer.from("pool_lp_mint","utf8"),Nf=Buffer.from("pool_vault","utf8"),Lf=Buffer.from("observation","utf8");var Rf=Buffer.from("locked_liquidity","utf8");var Yf=oe("Raydium_cpmm"),Ks={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function er(i,e,t,n,r,o,a,s,u,c,l,p,m,d,y,f){let b=R([P("amountIn"),P("amounOutMin")]),k=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0}],x=Buffer.alloc(b.span);return b.encode({amountIn:y,amounOutMin:f},x),new Ss({keys:k,programId:i,data:Buffer.from([...Ks.swapBaseInput,...x])})}import fb from"bn.js";import yb from"decimal.js-light";import Cs from"bn.js";var ib=new Cs(0);import tr from"bn.js";var Lb=new tr(25),Rb=new tr(1e4);var zn=R([V("instruction"),P("amountIn"),P("minAmountOut")]),Qn=R([V("instruction"),P("maxAmountIn"),P("amountOut")]),Eb=R([V("instruction"),V("nonce")]),Ns=R([V("instruction"),V("nonce"),P("startTime")]),nr=R([P("status"),P("nonce"),P("maxOrder"),P("depth"),P("baseDecimal"),P("quoteDecimal"),P("state"),P("resetFlag"),P("minSize"),P("volMaxCutRatio"),P("amountWaveRatio"),P("baseLotSize"),P("quoteLotSize"),P("minPriceMultiplier"),P("maxPriceMultiplier"),P("systemDecimalValue"),P("minSeparateNumerator"),P("minSeparateDenominator"),P("tradeFeeNumerator"),P("tradeFeeDenominator"),P("pnlNumerator"),P("pnlDenominator"),P("swapFeeNumerator"),P("swapFeeDenominator"),P("baseNeedTakePnl"),P("quoteNeedTakePnl"),P("quoteTotalPnl"),P("baseTotalPnl"),P("poolOpenTime"),P("punishPcAmount"),P("punishCoinAmount"),P("orderbookToInitTime"),_("swapBaseInAmount"),_("swapQuoteOutAmount"),P("swapBase2QuoteFee"),_("swapQuoteInAmount"),_("swapBaseOutAmount"),P("swapQuote2BaseFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("withdrawQueue"),S("lpVault"),S("owner"),P("lpReserve"),H(P(),3,"padding")]),Fb=R([P("accountType"),P("status"),P("nonce"),P("maxOrder"),P("depth"),P("baseDecimal"),P("quoteDecimal"),P("state"),P("resetFlag"),P("minSize"),P("volMaxCutRatio"),P("amountWaveRatio"),P("baseLotSize"),P("quoteLotSize"),P("minPriceMultiplier"),P("maxPriceMultiplier"),P("systemDecimalsValue"),P("abortTradeFactor"),P("priceTickMultiplier"),P("priceTick"),P("minSeparateNumerator"),P("minSeparateDenominator"),P("tradeFeeNumerator"),P("tradeFeeDenominator"),P("pnlNumerator"),P("pnlDenominator"),P("swapFeeNumerator"),P("swapFeeDenominator"),P("baseNeedTakePnl"),P("quoteNeedTakePnl"),P("quoteTotalPnl"),P("baseTotalPnl"),P("poolOpenTime"),P("punishPcAmount"),P("punishCoinAmount"),P("orderbookToInitTime"),_("swapBaseInAmount"),_("swapQuoteOutAmount"),_("swapQuoteInAmount"),_("swapBaseOutAmount"),P("swapQuote2BaseFee"),P("swapBase2QuoteFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("modelDataAccount"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("owner"),H(P(),64,"padding")]),Ls=R([V("instruction"),P("baseAmountIn"),P("quoteAmountIn"),P("fixedSide"),P("otherAmountMin")]),Rs=R([V("instruction"),P("lpAmount"),P("baseAmountMin"),P("quoteAmountMin")]);var Wb=R([P("fee")]);import{PublicKey as gg}from"@solana/web3.js";import kg from"bn.js";import{TOKEN_PROGRAM_ID as Tg}from"@solana/spl-token";import{PublicKey as zb,SystemProgram as Qb,SYSVAR_RENT_PUBKEY as Hb,TransactionInstruction as rr}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as jb,TOKEN_PROGRAM_ID as or}from"@solana/spl-token";import{PublicKey as Ms}from"@solana/web3.js";var Hn=new Ms("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Os=5e4,vs=R([P("x"),P("y"),P("price")]),Gb=R([P("accountType"),P("status"),P("multiplier"),P("validDataCount"),H(vs,Os,"DataElement")]);var ir=oe("Raydium_liquidity_instruction");function Es({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=Oe(i),a=Buffer.alloc(zn.span);zn.encode({instruction:9,amountIn:se(t),minAmountOut:se(n)},a);let s=[g({pubkey:or,isWritable:!1}),g({pubkey:o.id}),g({pubkey:o.authority,isWritable:!1}),g({pubkey:o.openOrders})];return r===4&&s.push(g({pubkey:o.targetOrders})),s.push(g({pubkey:o.vault.A}),g({pubkey:o.vault.B})),r===5&&s.push(g({pubkey:Hn})),s.push(g({pubkey:o.marketProgramId,isWritable:!1}),g({pubkey:o.marketId}),g({pubkey:o.marketBids}),g({pubkey:o.marketAsks}),g({pubkey:o.marketEventQueue}),g({pubkey:o.marketBaseVault}),g({pubkey:o.marketQuoteVault}),g({pubkey:o.marketAuthority,isWritable:!1}),g({pubkey:e.tokenAccountIn}),g({pubkey:e.tokenAccountOut}),g({pubkey:e.owner,isWritable:!1,isSigner:!0})),new rr({programId:o.programId,keys:s,data:a})}function Fs({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=Oe(i),a=Buffer.alloc(Qn.span);Qn.encode({instruction:11,maxAmountIn:se(t),amountOut:se(n)},a);let s=[g({pubkey:or,isWritable:!1}),g({pubkey:o.id}),g({pubkey:o.authority,isWritable:!1}),g({pubkey:o.openOrders}),g({pubkey:o.targetOrders}),g({pubkey:o.vault.A}),g({pubkey:o.vault.B})];return r===5&&s.push(g({pubkey:Hn})),s.push(g({pubkey:o.marketProgramId,isWritable:!1}),g({pubkey:o.marketId}),g({pubkey:o.marketBids}),g({pubkey:o.marketAsks}),g({pubkey:o.marketEventQueue}),g({pubkey:o.marketBaseVault}),g({pubkey:o.marketQuoteVault}),g({pubkey:o.marketAuthority,isWritable:!1}),g({pubkey:e.tokenAccountIn}),g({pubkey:e.tokenAccountOut}),g({pubkey:e.owner,isWritable:!1,isSigner:!0})),new rr({programId:o.programId,keys:s,data:a})}function sr(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:a}=i;if(t===4||t===5){let s={poolKeys:e,userKeys:n};if(a==="in")return Es({...s,amountIn:r,minAmountOut:o},t);if(a==="out")return Fs({...s,maxAmountIn:r,amountOut:o},t);ir.logWithError("invalid params","params",i)}throw ir.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import{PublicKey as uy}from"@solana/web3.js";var my=oe("Raydium_liquidity_serum");var Zn=R([S("mint"),S("owner"),P("amount"),ve("delegateOption"),S("delegate"),V("state"),ve("isNativeOption"),P("isNative"),P("delegatedAmount"),ve("closeAuthorityOption"),S("closeAuthority")]);import{Keypair as Py,PublicKey as ky}from"@solana/web3.js";import Ty from"bn.js";import{TOKEN_PROGRAM_ID as By}from"@solana/spl-token";var Sy=oe("Raydium_Util");import{PublicKey as My,SystemProgram as vy}from"@solana/web3.js";import Wy from"bn.js";import{createCloseAccountInstruction as qy,createInitializeAccountInstruction as Gy,createTransferInstruction as Uy,TOKEN_PROGRAM_ID as Xy}from"@solana/spl-token";var Ws=R([ve("mintAuthorityOption"),S("mintAuthority"),P("supply"),V("decimals"),V("isInitialized"),ve("freezeAuthorityOption"),S("freezeAuthority")]);var Vs={[Nn.toBase58()]:3};var _s=R([be(5),be(8),S("ownAddress"),P("vaultSignerNonce"),S("baseMint"),S("quoteMint"),S("baseVault"),P("baseDepositsTotal"),P("baseFeesAccrued"),S("quoteVault"),P("quoteDepositsTotal"),P("quoteFeesAccrued"),P("quoteDustThreshold"),S("requestQueue"),S("eventQueue"),S("bids"),S("asks"),P("baseLotSize"),P("quoteLotSize"),P("feeRateBps"),P("referrerRebatesAccrued"),be(7)]);import{PublicKey as Qg}from"@solana/web3.js";var Jg=oe("Serum");import{PublicKey as A,SystemProgram as Vt,TransactionInstruction as _t}from"@solana/web3.js";import je from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as jn,TOKEN_2022_PROGRAM_ID as Yn,TOKEN_PROGRAM_ID as dt}from"@solana/spl-token";function dP(i,e,t,n,r,o,a,s,u,c,l,p){let m=R([V("instruction"),P("amountIn"),P("amountOut")]),d=[{pubkey:Vt.programId,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:new A(t.programId),isSigner:!1,isWritable:!1},{pubkey:new A(t.id),isSigner:!1,isWritable:!0},{pubkey:new A(n.id),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=Oe(t);d.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...p.map(b=>({pubkey:b,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=Oe(t);d.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new A("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=Oe(t);d.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let y=Buffer.alloc(m.span);return m.encode({instruction:4,amountIn:c,amountOut:l},y),new _t({keys:d,programId:i,data:y})}function fP(i,e,t,n,r,o,a,s,u,c){let l=R([V("instruction")]),p=[{pubkey:Vt.programId,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:new A(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new A(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new A(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let d=Oe(n);p.push({pubkey:d.config.id,isSigner:!1,isWritable:!1},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.mintA.address.equals(u)?d.vault.A:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.mintA.address.equals(u)?d.vault.B:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0},...c.map(y=>({pubkey:y,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let d=Oe(n);p.push({pubkey:d.authority,isSigner:!1,isWritable:!1},{pubkey:d.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:new A("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:d.openOrders,isSigner:!1,isWritable:!0},{pubkey:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.marketId,isSigner:!1,isWritable:!0},{pubkey:d.marketBids,isSigner:!1,isWritable:!0},{pubkey:d.marketAsks,isSigner:!1,isWritable:!0},{pubkey:d.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0})}else{let d=Oe(n);p.push({pubkey:d.authority,isSigner:!1,isWritable:!1},{pubkey:d.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:d.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:d.openOrders,isSigner:!1,isWritable:!0},{pubkey:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.marketId,isSigner:!1,isWritable:!0},{pubkey:d.marketBids,isSigner:!1,isWritable:!0},{pubkey:d.marketAsks,isSigner:!1,isWritable:!0},{pubkey:d.marketEventQueue,isSigner:!1,isWritable:!0},...d.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:d.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:d.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0}])}let m=Buffer.alloc(l.span);return l.encode({instruction:5},m),new _t({keys:p,programId:i,data:m})}function Ds(i,e,t,n,r,o,a,s,u,c,l,p,m,d,y){let f=[],b=[g({pubkey:dt,isWritable:!1}),g({pubkey:Yn,isWritable:!1}),g({pubkey:jn,isWritable:!1}),g({pubkey:Vt.programId,isWritable:!1}),g({pubkey:e,isSigner:!0})];b.push(g({pubkey:t})),b.push(g({pubkey:r}));let k=[u,c],x=[l,p],I=[o,a,s];for(let w=0;w<k.length;w++){let N=k[w],F=I[w]===N.mintA.address;if(b.push(g({pubkey:new A(N.programId),isWritable:!1})),w===k.length-1?b.push(g({pubkey:r})):b.push(g({pubkey:n})),b.push(g({pubkey:new A(I[w])})),b.push(g({pubkey:new A(I[w+1])})),N.version===6){let h=x[w];b.push(g({pubkey:new A(h.config.id)})),b.push(g({pubkey:new A(h.id)})),b.push(g({pubkey:new A(F?h.vault.A:h.vault.B)})),b.push(g({pubkey:new A(F?h.vault.B:h.vault.A)})),b.push(g({pubkey:new A(N.observationId)})),b.push(g({pubkey:mt})),b.push(g({pubkey:ye(new A(N.programId),new A(N.id)).publicKey})),f.push(Jn(N.sqrtPriceX64.toString(),F));for(let U of y[w]??[])b.push(g({pubkey:new A(U)}))}else if(N.version===5){let h=x[w];b.push(g({pubkey:new A(h.id)})),b.push(g({pubkey:new A(h.authority),isWritable:!1})),b.push(g({pubkey:new A(h.marketProgramId)})),b.push(g({pubkey:new A(h.marketAuthority)})),b.push(g({pubkey:en,isWritable:!1})),b.push(g({pubkey:new A(h.openOrders)})),b.push(g({pubkey:new A(h.vault.A)})),b.push(g({pubkey:new A(h.vault.B)})),b.push(g({pubkey:new A(h.id)})),b.push(g({pubkey:new A(h.id)})),b.push(g({pubkey:new A(h.id)})),b.push(g({pubkey:new A(h.id)})),b.push(g({pubkey:new A(h.id)})),b.push(g({pubkey:new A(h.id)})),b.push(g({pubkey:new A(h.marketId)})),b.push(g({pubkey:new A(h.marketBids)})),b.push(g({pubkey:new A(h.marketAsks)})),b.push(g({pubkey:new A(h.marketEventQueue)})),b.push(g({pubkey:new A(h.marketBaseVault)})),b.push(g({pubkey:new A(h.marketQuoteVault)}))}else if(N.version===4){let h=x[w],U=N.status!==1;b.push(g({pubkey:new A(h.id)})),b.push(g({pubkey:new A(h.authority),isWritable:!1})),b.push(g({pubkey:new A(U?h.id:h.marketProgramId)})),b.push(g({pubkey:new A(U?h.id:h.marketAuthority)})),b.push(g({pubkey:new A(U?h.id:h.openOrders)})),b.push(g({pubkey:new A(h.vault.A)})),b.push(g({pubkey:new A(h.vault.B)})),b.push(g({pubkey:new A(U?h.id:h.marketId)})),b.push(g({pubkey:new A(U?h.id:h.marketBids)})),b.push(g({pubkey:new A(U?h.id:h.marketAsks)})),b.push(g({pubkey:new A(U?h.id:h.marketEventQueue)})),b.push(g({pubkey:new A(U?h.id:h.marketBaseVault)})),b.push(g({pubkey:new A(U?h.id:h.marketQuoteVault)}))}else if(N.version===7){let h=x[w];b.push(g({pubkey:new A(h.authority)})),b.push(g({pubkey:new A(h.config.id)})),b.push(g({pubkey:new A(h.id)})),b.push(g({pubkey:new A(F?h.vault.A:h.vault.B)})),b.push(g({pubkey:new A(F?h.vault.B:h.vault.A)})),b.push(g({pubkey:new A(N.observationId)}))}else throw Error("pool type error")}let L=R([V("insId"),P("amountIn"),P("amountOut"),H(_(),f.length,"clmmPriceLimit")]),v=Buffer.alloc(L.span);return L.encode({insId:0,amountIn:m,amountOut:d,clmmPriceLimit:f},v),new _t({keys:b,programId:i,data:v})}function Jn(i,e){if(i)if(e){let t=new je(i).div(new je(25));return t.gt(on)?t:on}else{let t=new je(i).mul(new je(25));return t.lt(sn)?t:sn}else return e?on:sn}function qs({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){if(n.routeType==="amm")if(n.poolInfo[0].version===6){let r=n.poolKey[0],o=Oe(r),a=t.equals(o.mintA.address)?Qe.add(Ee):He.sub(Ee);return Pt.makeSwapBaseInInstructions({poolInfo:r,poolKeys:r,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:o.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:o.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub(n.minAmountOut.fee?.raw??new je(0)),sqrtPriceLimitX64:a,remainingAccounts:n.remainingAccounts[0]??[]})}else if(n.poolInfo[0].version===7){let r=n.poolInfo[0],o=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[er(r.programId,e.wallet,r.authority,r.configId,r.id,e.sourceToken,e.destinationToken,o?r.vaultA:r.vaultB,o?r.vaultB:r.vaultA,o?r.mintProgramA:r.mintProgramB,o?r.mintProgramB:r.mintProgramA,new A(r[o?"mintA":"mintB"].address),new A(r[o?"mintB":"mintA"].address),r.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[o?$.CpmmSwapBaseIn:$.CpmmSwapBaseOut],address:{}}}else{let r=n.poolKey[0];return{signers:[],instructions:[sr({poolKeys:r,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub(n.minAmountOut.fee?.raw??new je(0)),fixedSide:"in"})],lookupTableAddress:r.lookupTableAccount?[r.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?$.AmmV5SwapBaseIn:$.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let r=n.poolInfo[0],o=n.poolInfo[1],a=n.poolKey[0],s=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[Ds(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),r,o,a,s,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub(n.minAmountOut.fee?.raw??new je(0)),n.remainingAccounts)],instructionTypes:[$.RouteSwap],lookupTableAddress:[a.lookupTableAccount,s.lookupTableAccount].filter(u=>u!==void 0),address:{}}}else throw Error("route type error")}function bP({programId:i,wallet:e,amount:t,inputAccount:n,outputAccount:r,routeInfo:o,poolKeys:a}){if(o.success===!1)throw Error("route info error");let s=[],u=[g({pubkey:dt,isWritable:!1}),g({pubkey:Yn,isWritable:!1}),g({pubkey:jn,isWritable:!1}),g({pubkey:Vt.programId,isWritable:!1}),g({pubkey:e,isSigner:!0})],c={[o.data.inputMint]:n,[o.data.outputMint]:r};u.push(g({pubkey:c[o.data.inputMint]})),u.push(g({pubkey:c[o.data.outputMint]}));for(let m=0;m<a.length;m++){let d=o.data.routePlan[m],y=a[m],f=d.inputMint===y.mintA.address;if(u.push(g({pubkey:new A(y.programId),isWritable:!1})),m===a.length-1)u.push(g({pubkey:c[d.outputMint]}));else{let b=d.outputMint;if(c[b]===void 0){let k=te(e,new A(b),y.programId===Ce.CLMM_PROGRAM_ID.toBase58()||y.programId===Ce.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(f?y.mintB.programId:y.mintA.programId):dt).publicKey;c[b]=k}u.push(g({pubkey:c[b]}))}if(u.push(g({pubkey:new A(d.inputMint)})),u.push(g({pubkey:new A(d.outputMint)})),y.programId===Ce.CLMM_PROGRAM_ID.toBase58()){let b=y;u.push(g({pubkey:new A(b.config.id)})),u.push(g({pubkey:new A(b.id)})),u.push(g({pubkey:new A(f?b.vault.A:b.vault.B)})),u.push(g({pubkey:new A(f?b.vault.B:b.vault.A)})),u.push(g({pubkey:new A(b.observationId)})),u.push(g({pubkey:mt,isWritable:!1})),u.push(g({pubkey:new A(b.exBitmapAccount)})),s.push(Jn(d.lastPoolPriceX64,f));for(let k of d.remainingAccounts??[])u.push(g({pubkey:new A(k)}))}else if(y.programId===Ce.AMM_STABLE.toBase58()){let b=y;u.push(g({pubkey:new A(b.id)})),u.push(g({pubkey:new A(b.authority),isWritable:!1})),u.push(g({pubkey:new A(b.marketProgramId),isWritable:!1})),u.push(g({pubkey:new A(b.marketAuthority),isWritable:!1})),u.push(g({pubkey:en,isWritable:!1})),u.push(g({pubkey:new A(b.openOrders)})),u.push(g({pubkey:new A(b.vault.A)})),u.push(g({pubkey:new A(b.vault.B)})),u.push(g({pubkey:new A(b.marketId)})),u.push(g({pubkey:new A(b.marketBids)})),u.push(g({pubkey:new A(b.marketAsks)})),u.push(g({pubkey:new A(b.marketEventQueue)})),u.push(g({pubkey:new A(b.marketBaseVault)})),u.push(g({pubkey:new A(b.marketQuoteVault)}))}else if(y.programId===Ce.AMM_V4.toBase58()){let b=y;u.push(g({pubkey:new A(b.id)})),u.push(g({pubkey:new A(b.authority),isWritable:!1})),u.push(g({pubkey:new A(b.id)})),u.push(g({pubkey:new A(b.id)})),u.push(g({pubkey:new A(b.id)})),u.push(g({pubkey:new A(b.vault.A)})),u.push(g({pubkey:new A(b.vault.B)})),u.push(g({pubkey:new A(b.id)})),u.push(g({pubkey:new A(b.id)})),u.push(g({pubkey:new A(b.id)})),u.push(g({pubkey:new A(b.id)})),u.push(g({pubkey:new A(b.id)})),u.push(g({pubkey:new A(b.id)}))}else if(y.programId===Ce.CREATE_CPMM_POOL_PROGRAM.toBase58()){let b=y;u.push(g({pubkey:new A(b.authority)})),u.push(g({pubkey:new A(b.config.id)})),u.push(g({pubkey:new A(b.id)})),u.push(g({pubkey:new A(f?b.vault.A:b.vault.B)})),u.push(g({pubkey:new A(f?b.vault.B:b.vault.A)})),u.push(g({pubkey:new A(b.observationId)}))}else throw Error("pool type error")}let l=R([V("insId"),P("amountIn"),P("amountOut"),H(_(),s.length,"clmmPriceLimit")]),p=Buffer.alloc(l.span);return l.encode({insId:0,amountIn:t,amountOut:new je(o.data.otherAmountThreshold),clmmPriceLimit:s},p),new _t({keys:u,programId:i,data:p})}function yP({programId:i,wallet:e,inputAccount:t,outputAccount:n,routeInfo:r,poolKeys:o}){if(r.success===!1)throw Error("route info error");let a=[],s=[g({pubkey:dt,isWritable:!1}),g({pubkey:Yn,isWritable:!1}),g({pubkey:jn,isWritable:!1}),g({pubkey:Vt.programId,isWritable:!1}),g({pubkey:e,isSigner:!0})],u={[r.data.inputMint]:t,[r.data.outputMint]:n};for(let p=o.length-1;p>=0;p--){let m=r.data.routePlan[p],d=o[p],y=m.inputMint===d.mintA.address;if(s.push(g({pubkey:new A(d.programId)})),p===0)s.push(g({pubkey:u[m.inputMint]}));else{let f=m.inputMint;if(u[f]===void 0){let b=te(e,new A(f),d.programId===Ce.CLMM_PROGRAM_ID.toBase58()||d.programId===Ce.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(y?d.mintA.programId:d.mintB.programId):dt).publicKey;u[f]=b}s.push(g({pubkey:u[f]}))}if(p===o.length-1)s.push(g({pubkey:u[m.outputMint]}));else{let f=m.outputMint;if(u[f]===void 0){let b=te(e,new A(f),d.programId===Ce.CLMM_PROGRAM_ID.toBase58()||d.programId===Ce.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(y?d.mintB.programId:d.mintA.programId):dt).publicKey;u[f]=b}s.push(g({pubkey:u[f]}))}if(s.push(g({pubkey:new A(m.inputMint)})),s.push(g({pubkey:new A(m.outputMint)})),d.programId===Ce.CLMM_PROGRAM_ID.toBase58()){let f=d;s.push(g({pubkey:new A(f.config.id)})),s.push(g({pubkey:new A(f.id)})),s.push(g({pubkey:new A(y?f.vault.A:f.vault.B)})),s.push(g({pubkey:new A(y?f.vault.B:f.vault.A)})),s.push(g({pubkey:new A(f.observationId)})),s.push(g({pubkey:mt,isWritable:!1})),s.push(g({pubkey:new A(f.exBitmapAccount)})),a.push(Jn(m.lastPoolPriceX64,y));for(let b of m.remainingAccounts??[])s.push(g({pubkey:new A(b)}))}else if(d.programId===Ce.AMM_STABLE.toBase58()){let f=d;s.push(g({pubkey:new A(f.id)})),s.push(g({pubkey:new A(f.authority),isWritable:!1})),s.push(g({pubkey:new A(f.marketProgramId),isWritable:!1})),s.push(g({pubkey:new A(f.marketAuthority),isWritable:!1})),s.push(g({pubkey:en,isWritable:!1})),s.push(g({pubkey:new A(f.openOrders)})),s.push(g({pubkey:new A(f.vault.A)})),s.push(g({pubkey:new A(f.vault.B)})),s.push(g({pubkey:new A(f.marketId)})),s.push(g({pubkey:new A(f.marketBids)})),s.push(g({pubkey:new A(f.marketAsks)})),s.push(g({pubkey:new A(f.marketEventQueue)})),s.push(g({pubkey:new A(f.marketBaseVault)})),s.push(g({pubkey:new A(f.marketQuoteVault)}))}else if(d.programId===Ce.AMM_V4.toBase58()){let f=d;s.push(g({pubkey:new A(f.id)})),s.push(g({pubkey:new A(f.authority),isWritable:!1})),s.push(g({pubkey:new A(f.id)})),s.push(g({pubkey:new A(f.id)})),s.push(g({pubkey:new A(f.id)})),s.push(g({pubkey:new A(f.vault.A)})),s.push(g({pubkey:new A(f.vault.B)})),s.push(g({pubkey:new A(f.id)})),s.push(g({pubkey:new A(f.id)})),s.push(g({pubkey:new A(f.id)})),s.push(g({pubkey:new A(f.id)})),s.push(g({pubkey:new A(f.id)})),s.push(g({pubkey:new A(f.id)}))}else if(d.programId===Ce.CREATE_CPMM_POOL_PROGRAM.toBase58()){let f=d;s.push(g({pubkey:new A(f.authority)})),s.push(g({pubkey:new A(f.config.id)})),s.push(g({pubkey:new A(f.id)})),s.push(g({pubkey:new A(y?f.vault.A:f.vault.B)})),s.push(g({pubkey:new A(y?f.vault.B:f.vault.A)})),s.push(g({pubkey:new A(f.observationId)}))}else throw Error("pool type error")}let c=R([V("insId"),P("amountIn"),P("amountOut"),H(_(),a.length,"clmmPriceLimit")]),l=Buffer.alloc(c.span);return c.encode({insId:1,amountIn:new je(r.data.otherAmountThreshold),amountOut:new je(r.data.outputAmount),clmmPriceLimit:a},l),new _t({keys:s,programId:i,data:l})}var ek=new Gs(0);export{qs as makeSwapInstruction,dP as route1Instruction,fP as route2Instruction,Ds as routeInstruction,bP as swapBaseInAutoAccount,yP as swapBaseOutAutoAccount};
//# sourceMappingURL=index.mjs.map