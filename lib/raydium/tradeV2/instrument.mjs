var er=Object.defineProperty;var tr=(i,e,t)=>e in i?er(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var Vt=(i,e,t)=>(tr(i,typeof e!="symbol"?e+"":e,t),t);import{PublicKey as w,SystemProgram as vt,TransactionInstruction as Ft}from"@solana/web3.js";import Ze from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Hn,TOKEN_2022_PROGRAM_ID as Qn,TOKEN_PROGRAM_ID as pt}from"@solana/spl-token";import{PublicKey as rr}from"@solana/web3.js";import{get as Zn,set as nr}from"lodash";var mn=class{logLevel;name;constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},jn={},ir={};function fe(i){let e=Zn(jn,i);if(!e){let t=Zn(ir,i);e=new mn({name:i,logLevel:t}),nr(jn,i,e)}return e}import{MINT_SIZE as qs,TOKEN_PROGRAM_ID as Gs,getTransferFeeConfig as Us,unpackMint as Xs}from"@solana/spl-token";var pn=fe("Raydium_accountInfo_util");async function it(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}={batchRequest:!1,...t},a=dn(e,o),s=new Array(a.length).fill([]);if(n){let u=a.map(p=>{let m=i._buildArgs([p.map(d=>d.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:m}}),c=dn(u,10);s=(await(await Promise.all(c.map(async p=>await i._rpcBatchRequest(p)))).flat()).map(p=>(p.error&&pn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${p.error.message}`),p.result.value.map(m=>{if(m){let{data:d,executable:y,lamports:f,owner:b,rentEpoch:P}=m;return d.length!==2&&d[1]!=="base64"&&pn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:y,lamports:f,owner:new rr(b),rentEpoch:P}}return null})))}else try{s=await Promise.all(a.map(u=>i.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&pn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return s.flat()}async function _t(i,e,t){let n=await it(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>({...r,accountInfo:n[o]}))}import Je from"bn.js";var kt=9e15,at=1e9,fn="0123456789abcdef",Gt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Ut="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",bn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-kt,maxE:kt,crypto:!1},ei,je,_=!0,Ht="[DecimalError] ",st=Ht+"Invalid argument: ",ti=Ht+"Precision limit exceeded",ni=Ht+"crypto unavailable",ii="[object Decimal]",Ie=Math.floor,ge=Math.pow,or=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,sr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,ar=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ri=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,De=1e7,F=7,ur=9007199254740991,cr=Gt.length-1,yn=Ut.length-1,h={toStringTag:ii};h.absoluteValue=h.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),E(i)};h.ceil=function(){return E(new this.constructor(this),this.e+1,2)};h.clampedTo=h.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(st+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};h.comparedTo=h.cmp=function(i){var e,t,n,r,o=this,a=o.d,s=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!a||!s)return!u||!c?NaN:u!==c?u:a===s?0:!a^u<0?1:-1;if(!a[0]||!s[0])return a[0]?u:s[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=a.length,r=s.length,e=0,t=n<r?n:r;e<t;++e)if(a[e]!==s[e])return a[e]>s[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};h.cosine=h.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+F,n.rounding=1,t=lr(n,ci(n,t)),n.precision=i,n.rounding=e,E(je==2||je==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};h.cubeRoot=h.cbrt=function(){var i,e,t,n,r,o,a,s,u,c,l=this,p=l.constructor;if(!l.isFinite()||l.isZero())return new p(l);for(_=!1,o=l.s*ge(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=Te(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ge(t,1/3),i=Ie((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new p(t),n.s=l.s):n=new p(o.toString()),a=(i=p.precision)+3;;)if(s=n,u=s.times(s).times(s),c=u.plus(l),n=ee(c.plus(l).times(s),c.plus(u),a+2,1),Te(s.d).slice(0,a)===(t=Te(n.d)).slice(0,a))if(t=t.slice(a-3,a+1),t=="9999"||!r&&t=="4999"){if(!r&&(E(s,i+1,0),s.times(s).times(s).eq(l))){n=s;break}a+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(E(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return _=!0,E(n,i,p.rounding,e)};h.decimalPlaces=h.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-Ie(this.e/F))*F,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};h.dividedBy=h.div=function(i){return ee(this,new this.constructor(i))};h.dividedToIntegerBy=h.divToInt=function(i){var e=this,t=e.constructor;return E(ee(e,new t(i),0,1,1),t.precision,t.rounding)};h.equals=h.eq=function(i){return this.cmp(i)===0};h.floor=function(){return E(new this.constructor(this),this.e+1,3)};h.greaterThan=h.gt=function(i){return this.cmp(i)>0};h.greaterThanOrEqualTo=h.gte=function(i){var e=this.cmp(i);return e==1||e===0};h.hyperbolicCosine=h.cosh=function(){var i,e,t,n,r,o=this,a=o.constructor,s=new a(1);if(!o.isFinite())return new a(o.s?1/0:NaN);if(o.isZero())return s;t=a.precision,n=a.rounding,a.precision=t+Math.max(o.e,o.sd())+4,a.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/zt(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=Pt(a,1,o.times(e),new a(1),!0);for(var u,c=i,l=new a(8);c--;)u=o.times(o),o=s.minus(u.times(l.minus(u.times(l))));return E(o,a.precision=t,a.rounding=n,!0)};h.hyperbolicSine=h.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=Pt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/zt(5,i)),r=Pt(o,2,r,r,!0);for(var a,s=new o(5),u=new o(16),c=new o(20);i--;)a=r.times(r),r=r.times(s.plus(a.times(u.times(a).plus(c))))}return o.precision=e,o.rounding=t,E(r,e,t,!0)};h.hyperbolicTangent=h.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,ee(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};h.inverseCosine=h.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?_e(t,r,o):new t(0):new t(NaN):e.isZero()?_e(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=_e(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};h.inverseHyperbolicCosine=h.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,_=!1,t=t.times(t).minus(1).sqrt().plus(t),_=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};h.inverseHyperbolicSine=h.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,_=!1,t=t.times(t).plus(1).sqrt().plus(t),_=!0,n.precision=i,n.rounding=e,t.ln())};h.inverseHyperbolicTangent=h.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?E(new o(r),i,e,!0):(o.precision=t=n-r.e,r=ee(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};h.inverseSine=h.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=_e(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};h.inverseTangent=h.atan=function(){var i,e,t,n,r,o,a,s,u,c=this,l=c.constructor,p=l.precision,m=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&p+4<=yn)return a=_e(l,p+4,m).times(.25),a.s=c.s,a}else{if(!c.s)return new l(NaN);if(p+4<=yn)return a=_e(l,p+4,m).times(.5),a.s=c.s,a}for(l.precision=s=p+10,l.rounding=1,t=Math.min(28,s/F+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(_=!1,e=Math.ceil(s/F),n=1,u=c.times(c),a=new l(c),r=c;i!==-1;)if(r=r.times(u),o=a.minus(r.div(n+=2)),r=r.times(u),a=o.plus(r.div(n+=2)),a.d[e]!==void 0)for(i=e;a.d[i]===o.d[i]&&i--;);return t&&(a=a.times(2<<t-1)),_=!0,E(a,l.precision=p,l.rounding=m,!0)};h.isFinite=function(){return!!this.d};h.isInteger=h.isInt=function(){return!!this.d&&Ie(this.e/F)>this.d.length-2};h.isNaN=function(){return!this.s};h.isNegative=h.isNeg=function(){return this.s<0};h.isPositive=h.isPos=function(){return this.s>0};h.isZero=function(){return!!this.d&&this.d[0]===0};h.lessThan=h.lt=function(i){return this.cmp(i)<0};h.lessThanOrEqualTo=h.lte=function(i){return this.cmp(i)<1};h.logarithm=h.log=function(i){var e,t,n,r,o,a,s,u,c=this,l=c.constructor,p=l.precision,m=l.rounding,d=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(_=!1,s=p+d,a=ot(c,s),n=e?Xt(l,s+10):ot(i,s),u=ee(a,n,s,1),Bt(u.d,r=p,m))do if(s+=10,a=ot(c,s),n=e?Xt(l,s+10):ot(i,s),u=ee(a,n,s,1),!o){+Te(u.d).slice(r+1,r+15)+1==1e14&&(u=E(u,p+1,0));break}while(Bt(u.d,r+=10,m));return _=!0,E(u,p,m)};h.minus=h.sub=function(i){var e,t,n,r,o,a,s,u,c,l,p,m,d=this,y=d.constructor;if(i=new y(i),!d.d||!i.d)return!d.s||!i.s?i=new y(NaN):d.d?i.s=-i.s:i=new y(i.d||d.s!==i.s?d:NaN),i;if(d.s!=i.s)return i.s=-i.s,d.plus(i);if(c=d.d,m=i.d,s=y.precision,u=y.rounding,!c[0]||!m[0]){if(m[0])i.s=-i.s;else if(c[0])i=new y(d);else return new y(u===3?-0:0);return _?E(i,s,u):i}if(t=Ie(i.e/F),l=Ie(d.e/F),c=c.slice(),o=l-t,o){for(p=o<0,p?(e=c,o=-o,a=m.length):(e=m,t=l,a=c.length),n=Math.max(Math.ceil(s/F),a)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,a=m.length,p=n<a,p&&(a=n),n=0;n<a;n++)if(c[n]!=m[n]){p=c[n]<m[n];break}o=0}for(p&&(e=c,c=m,m=e,i.s=-i.s),a=c.length,n=m.length-a;n>0;--n)c[a++]=0;for(n=m.length;n>o;){if(c[--n]<m[n]){for(r=n;r&&c[--r]===0;)c[r]=De-1;--c[r],c[n]+=De}c[n]-=m[n]}for(;c[--a]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=Qt(c,t),_?E(i,s,u):i):new y(u===3?-0:0)};h.modulo=h.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?E(new n(t),n.precision,n.rounding):(_=!1,n.modulo==9?(e=ee(t,i.abs(),0,3,1),e.s*=i.s):e=ee(t,i,0,n.modulo,1),e=e.times(i),_=!0,t.minus(e))};h.naturalExponential=h.exp=function(){return gn(this)};h.naturalLogarithm=h.ln=function(){return ot(this)};h.negated=h.neg=function(){var i=new this.constructor(this);return i.s=-i.s,E(i)};h.plus=h.add=function(i){var e,t,n,r,o,a,s,u,c,l,p=this,m=p.constructor;if(i=new m(i),!p.d||!i.d)return!p.s||!i.s?i=new m(NaN):p.d||(i=new m(i.d||p.s===i.s?p:NaN)),i;if(p.s!=i.s)return i.s=-i.s,p.minus(i);if(c=p.d,l=i.d,s=m.precision,u=m.rounding,!c[0]||!l[0])return l[0]||(i=new m(p)),_?E(i,s,u):i;if(o=Ie(p.e/F),n=Ie(i.e/F),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,a=l.length):(t=l,n=o,a=c.length),o=Math.ceil(s/F),a=o>a?o+1:a+1,r>a&&(r=a,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(a=c.length,r=l.length,a-r<0&&(r=a,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/De|0,c[r]%=De;for(e&&(c.unshift(e),++n),a=c.length;c[--a]==0;)c.pop();return i.d=c,i.e=Qt(c,n),_?E(i,s,u):i};h.precision=h.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(st+i);return t.d?(e=oi(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};h.round=function(){var i=this,e=i.constructor;return E(new e(i),i.e+1,e.rounding)};h.sine=h.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+F,n.rounding=1,t=pr(n,ci(n,t)),n.precision=i,n.rounding=e,E(je>2?t.neg():t,i,e,!0)):new n(NaN)};h.squareRoot=h.sqrt=function(){var i,e,t,n,r,o,a=this,s=a.d,u=a.e,c=a.s,l=a.constructor;if(c!==1||!s||!s[0])return new l(!c||c<0&&(!s||s[0])?NaN:s?a:1/0);for(_=!1,c=Math.sqrt(+a),c==0||c==1/0?(e=Te(s),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=Ie((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(ee(a,o,t+2,1)).times(.5),Te(o.d).slice(0,t)===(e=Te(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(E(o,u+1,0),o.times(o).eq(a))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(E(n,u+1,1),i=!n.times(n).eq(a));break}return _=!0,E(n,u,l.rounding,i)};h.tangent=h.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=ee(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,E(je==2||je==4?t.neg():t,i,e,!0)):new n(NaN)};h.times=h.mul=function(i){var e,t,n,r,o,a,s,u,c,l=this,p=l.constructor,m=l.d,d=(i=new p(i)).d;if(i.s*=l.s,!m||!m[0]||!d||!d[0])return new p(!i.s||m&&!m[0]&&!d||d&&!d[0]&&!m?NaN:!m||!d?i.s/0:i.s*0);for(t=Ie(l.e/F)+Ie(i.e/F),u=m.length,c=d.length,u<c&&(o=m,m=d,d=o,a=u,u=c,c=a),o=[],a=u+c,n=a;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)s=o[r]+d[n]*m[r-n-1]+e,o[r--]=s%De|0,e=s/De|0;o[r]=(o[r]+e)%De|0}for(;!o[--a];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Qt(o,t),_?E(i,p.precision,p.rounding):i};h.toBinary=function(i,e){return Pn(this,2,i,e)};h.toDecimalPlaces=h.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Le(i,0,at),e===void 0?e=n.rounding:Le(e,0,8),E(t,i+t.e+1,e))};h.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Ue(n,!0):(Le(i,0,at),e===void 0?e=r.rounding:Le(e,0,8),n=E(new r(n),i+1,e),t=Ue(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};h.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Ue(r):(Le(i,0,at),e===void 0?e=o.rounding:Le(e,0,8),n=E(new o(r),i+r.e+1,e),t=Ue(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};h.toFraction=function(i){var e,t,n,r,o,a,s,u,c,l,p,m,d=this,y=d.d,f=d.constructor;if(!y)return new f(d);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=oi(y)-d.e-1,a=o%F,e.d[0]=ge(10,a<0?F+a:a),i==null)i=o>0?e:c;else{if(s=new f(i),!s.isInt()||s.lt(c))throw Error(st+s);i=s.gt(e)?o>0?e:c:s}for(_=!1,s=new f(Te(y)),l=f.precision,f.precision=o=y.length*F*2;p=ee(s,e,0,1,1),r=t.plus(p.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(p.times(r)),u=r,r=e,e=s.minus(p.times(r)),s=r;return r=ee(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=d.s,m=ee(c,n,o,1).minus(d).abs().cmp(ee(u,t,o,1).minus(d).abs())<1?[c,n]:[u,t],f.precision=l,_=!0,m};h.toHexadecimal=h.toHex=function(i,e){return Pn(this,16,i,e)};h.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Le(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(_=!1,t=ee(t,i,0,e,1).times(i),_=!0,E(t)):(i.s=t.s,t=i),t};h.toNumber=function(){return+this};h.toOctal=function(i,e){return Pn(this,8,i,e)};h.toPower=h.pow=function(i){var e,t,n,r,o,a,s=this,u=s.constructor,c=+(i=new u(i));if(!s.d||!i.d||!s.d[0]||!i.d[0])return new u(ge(+s,c));if(s=new u(s),s.eq(1))return s;if(n=u.precision,o=u.rounding,i.eq(1))return E(s,n,o);if(e=Ie(i.e/F),e>=i.d.length-1&&(t=c<0?-c:c)<=ur)return r=si(u,s,t,n),i.s<0?new u(1).div(r):E(r,n,o);if(a=s.s,a<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(a=1),s.e==0&&s.d[0]==1&&s.d.length==1)return s.s=a,s}return t=ge(+s,c),e=t==0||!isFinite(t)?Ie(c*(Math.log("0."+Te(s.d))/Math.LN10+s.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?a/0:0):(_=!1,u.rounding=s.s=1,t=Math.min(12,(e+"").length),r=gn(i.times(ot(s,n+t)),n),r.d&&(r=E(r,n+5,1),Bt(r.d,n,o)&&(e=n+10,r=E(gn(i.times(ot(s,e+t)),e),e+5,1),+Te(r.d).slice(n+1,n+15)+1==1e14&&(r=E(r,n+1,0)))),r.s=a,_=!0,u.rounding=o,E(r,n,o))};h.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Ue(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Le(i,1,at),e===void 0?e=r.rounding:Le(e,0,8),n=E(new r(n),i,e),t=Ue(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};h.toSignificantDigits=h.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Le(i,1,at),e===void 0?e=n.rounding:Le(e,0,8)),E(new n(t),i,e)};h.toString=function(){var i=this,e=i.constructor,t=Ue(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};h.truncated=h.trunc=function(){return E(new this.constructor(this),this.e+1,1)};h.valueOf=h.toJSON=function(){var i=this,e=i.constructor,t=Ue(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function Te(i){var e,t,n,r=i.length-1,o="",a=i[0];if(r>0){for(o+=a,e=1;e<r;e++)n=i[e]+"",t=F-n.length,t&&(o+=rt(t)),o+=n;a=i[e],n=a+"",t=F-n.length,t&&(o+=rt(t))}else if(a===0)return"0";for(;a%10===0;)a/=10;return o+a}function Le(i,e,t){if(i!==~~i||i<e||i>t)throw Error(st+i)}function Bt(i,e,t,n){var r,o,a,s;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=F,r=0):(r=Math.ceil((e+1)/F),e%=F),o=ge(10,F-e),s=i[r]%o|0,n==null?e<3?(e==0?s=s/100|0:e==1&&(s=s/10|0),a=t<4&&s==99999||t>3&&s==49999||s==5e4||s==0):a=(t<4&&s+1==o||t>3&&s+1==o/2)&&(i[r+1]/o/100|0)==ge(10,e-2)-1||(s==o/2||s==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?s=s/1e3|0:e==1?s=s/100|0:e==2&&(s=s/10|0),a=(n||t<4)&&s==9999||!n&&t>3&&s==4999):a=((n||t<4)&&s+1==o||!n&&t>3&&s+1==o/2)&&(i[r+1]/o/1e3|0)==ge(10,e-3)-1,a}function qt(i,e,t){for(var n,r=[0],o,a=0,s=i.length;a<s;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=fn.indexOf(i.charAt(a++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function lr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/zt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=Pt(i,1,e.times(r),new i(1));for(var o=t;o--;){var a=e.times(e);e=a.times(a).minus(a).times(8).plus(1)}return i.precision-=t,e}var ee=function(){function i(n,r,o){var a,s=0,u=n.length;for(n=n.slice();u--;)a=n[u]*r+s,n[u]=a%o|0,s=a/o|0;return s&&n.unshift(s),n}function e(n,r,o,a){var s,u;if(o!=a)u=o>a?1:-1;else for(s=u=0;s<o;s++)if(n[s]!=r[s]){u=n[s]>r[s]?1:-1;break}return u}function t(n,r,o,a){for(var s=0;o--;)n[o]-=s,s=n[o]<r[o]?1:0,n[o]=s*a+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,a,s,u){var c,l,p,m,d,y,f,b,P,x,B,K,O,A,S,v,T,U,Q,ye,ie=n.constructor,Pe=n.s==r.s?1:-1,ce=n.d,re=r.d;if(!ce||!ce[0]||!re||!re[0])return new ie(!n.s||!r.s||(ce?re&&ce[0]==re[0]:!re)?NaN:ce&&ce[0]==0||!re?Pe*0:Pe/0);for(u?(d=1,l=n.e-r.e):(u=De,d=F,l=Ie(n.e/d)-Ie(r.e/d)),Q=re.length,T=ce.length,P=new ie(Pe),x=P.d=[],p=0;re[p]==(ce[p]||0);p++);if(re[p]>(ce[p]||0)&&l--,o==null?(A=o=ie.precision,a=ie.rounding):s?A=o+(n.e-r.e)+1:A=o,A<0)x.push(1),y=!0;else{if(A=A/d+2|0,p=0,Q==1){for(m=0,re=re[0],A++;(p<T||m)&&A--;p++)S=m*u+(ce[p]||0),x[p]=S/re|0,m=S%re|0;y=m||p<T}else{for(m=u/(re[0]+1)|0,m>1&&(re=i(re,m,u),ce=i(ce,m,u),Q=re.length,T=ce.length),v=Q,B=ce.slice(0,Q),K=B.length;K<Q;)B[K++]=0;ye=re.slice(),ye.unshift(0),U=re[0],re[1]>=u/2&&++U;do m=0,c=e(re,B,Q,K),c<0?(O=B[0],Q!=K&&(O=O*u+(B[1]||0)),m=O/U|0,m>1?(m>=u&&(m=u-1),f=i(re,m,u),b=f.length,K=B.length,c=e(f,B,b,K),c==1&&(m--,t(f,Q<b?ye:re,b,u))):(m==0&&(c=m=1),f=re.slice()),b=f.length,b<K&&f.unshift(0),t(B,f,K,u),c==-1&&(K=B.length,c=e(re,B,Q,K),c<1&&(m++,t(B,Q<K?ye:re,K,u))),K=B.length):c===0&&(m++,B=[0]),x[p++]=m,c&&B[0]?B[K++]=ce[v]||0:(B=[ce[v]],K=1);while((v++<T||B[0]!==void 0)&&A--);y=B[0]!==void 0}x[0]||x.shift()}if(d==1)P.e=l,ei=y;else{for(p=1,m=x[0];m>=10;m/=10)p++;P.e=p+l*d-1,E(P,s?o+P.e+1:o,a,y)}return P}}();function E(i,e,t,n){var r,o,a,s,u,c,l,p,m,d=i.constructor;e:if(e!=null){if(p=i.d,!p)return i;for(r=1,s=p[0];s>=10;s/=10)r++;if(o=e-r,o<0)o+=F,a=e,l=p[m=0],u=l/ge(10,r-a-1)%10|0;else if(m=Math.ceil((o+1)/F),s=p.length,m>=s)if(n){for(;s++<=m;)p.push(0);l=u=0,r=1,o%=F,a=o-F+1}else break e;else{for(l=s=p[m],r=1;s>=10;s/=10)r++;o%=F,a=o-F+r,u=a<0?0:l/ge(10,r-a-1)%10|0}if(n=n||e<0||p[m+1]!==void 0||(a<0?l:l%ge(10,r-a-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?a>0?l/ge(10,r-a):0:p[m-1])%10&1||t==(i.s<0?8:7)),e<1||!p[0])return p.length=0,c?(e-=i.e+1,p[0]=ge(10,(F-e%F)%F),i.e=-e||0):p[0]=i.e=0,i;if(o==0?(p.length=m,s=1,m--):(p.length=m+1,s=ge(10,F-o),p[m]=a>0?(l/ge(10,r-a)%ge(10,a)|0)*s:0),c)for(;;)if(m==0){for(o=1,a=p[0];a>=10;a/=10)o++;for(a=p[0]+=s,s=1;a>=10;a/=10)s++;o!=s&&(i.e++,p[0]==De&&(p[0]=1));break}else{if(p[m]+=s,p[m]!=De)break;p[m--]=0,s=1}for(o=p.length;p[--o]===0;)p.pop()}return _&&(i.e>d.maxE?(i.d=null,i.e=NaN):i.e<d.minE&&(i.e=0,i.d=[0])),i}function Ue(i,e,t){if(!i.isFinite())return ui(i);var n,r=i.e,o=Te(i.d),a=o.length;return e?(t&&(n=t-a)>0?o=o.charAt(0)+"."+o.slice(1)+rt(n):a>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+rt(-r-1)+o,t&&(n=t-a)>0&&(o+=rt(n))):r>=a?(o+=rt(r+1-a),t&&(n=t-r-1)>0&&(o=o+"."+rt(n))):((n=r+1)<a&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-a)>0&&(r+1===a&&(o+="."),o+=rt(n))),o}function Qt(i,e){var t=i[0];for(e*=F;t>=10;t/=10)e++;return e}function Xt(i,e,t){if(e>cr)throw _=!0,t&&(i.precision=t),Error(ti);return E(new i(Gt),e,1,!0)}function _e(i,e,t){if(e>yn)throw Error(ti);return E(new i(Ut),e,t,!0)}function oi(i){var e=i.length-1,t=e*F+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function rt(i){for(var e="";i--;)e+="0";return e}function si(i,e,t,n){var r,o=new i(1),a=Math.ceil(n/F+4);for(_=!1;;){if(t%2&&(o=o.times(e),Jn(o.d,a)&&(r=!0)),t=Ie(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Jn(e.d,a)}return _=!0,o}function Yn(i){return i.d[i.d.length-1]&1}function ai(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function gn(i,e){var t,n,r,o,a,s,u,c=0,l=0,p=0,m=i.constructor,d=m.rounding,y=m.precision;if(!i.d||!i.d[0]||i.e>17)return new m(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(_=!1,u=y):u=e,s=new m(.03125);i.e>-2;)i=i.times(s),p+=5;for(n=Math.log(ge(2,p))/Math.LN10*2+5|0,u+=n,t=o=a=new m(1),m.precision=u;;){if(o=E(o.times(i),u,1),t=t.times(++l),s=a.plus(ee(o,t,u,1)),Te(s.d).slice(0,u)===Te(a.d).slice(0,u)){for(r=p;r--;)a=E(a.times(a),u,1);if(e==null)if(c<3&&Bt(a.d,u-n,d,c))m.precision=u+=10,t=o=s=new m(1),l=0,c++;else return E(a,m.precision=y,d,_=!0);else return m.precision=y,a}a=s}}function ot(i,e){var t,n,r,o,a,s,u,c,l,p,m,d=1,y=10,f=i,b=f.d,P=f.constructor,x=P.rounding,B=P.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new P(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?(_=!1,l=B):l=e,P.precision=l+=y,t=Te(b),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=Te(f.d),n=t.charAt(0),d++;o=f.e,n>1?(f=new P("0."+t),o++):f=new P(n+"."+t.slice(1))}else return c=Xt(P,l+2,B).times(o+""),f=ot(new P(n+"."+t.slice(1)),l-y).plus(c),P.precision=B,e==null?E(f,B,x,_=!0):f;for(p=f,u=a=f=ee(f.minus(1),f.plus(1),l,1),m=E(f.times(f),l,1),r=3;;){if(a=E(a.times(m),l,1),c=u.plus(ee(a,new P(r),l,1)),Te(c.d).slice(0,l)===Te(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Xt(P,l+2,B).times(o+""))),u=ee(u,new P(d),l,1),e==null)if(Bt(u.d,l-y,x,s))P.precision=l+=y,c=a=f=ee(p.minus(1),p.plus(1),l,1),m=E(f.times(f),l,1),r=s=1;else return E(u,P.precision=B,x,_=!0);else return P.precision=B,u;u=c,r+=2}}function ui(i){return String(i.s*i.s/0)}function kn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%F,t<0&&(n+=F),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=F;n<r;)i.d.push(+e.slice(n,n+=F));e=e.slice(n),n=F-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),_&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function mr(i,e){var t,n,r,o,a,s,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),ri.test(e))return kn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(sr.test(e))t=16,e=e.toLowerCase();else if(or.test(e))t=2;else if(ar.test(e))t=8;else throw Error(st+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),a=o>=0,n=i.constructor,a&&(e=e.replace(".",""),s=e.length,o=s-o,r=si(n,new n(t),o,o*2)),c=qt(e,t,De),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=Qt(c,l),i.d=c,_=!1,a&&(i=ee(i,r,s*4)),u&&(i=i.times(Math.abs(u)<54?ge(2,u):It.pow(2,u))),_=!0,i)}function pr(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:Pt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/zt(5,t)),e=Pt(i,2,e,e);for(var r,o=new i(5),a=new i(16),s=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(a.times(r).minus(s))));return e}function Pt(i,e,t,n,r){var o,a,s,u,c=1,l=i.precision,p=Math.ceil(l/F);for(_=!1,u=t.times(t),s=new i(n);;){if(a=ee(s.times(u),new i(e++*e++),l,1),s=r?n.plus(a):n.minus(a),n=ee(a.times(u),new i(e++*e++),l,1),a=s.plus(n),a.d[p]!==void 0){for(o=p;a.d[o]===s.d[o]&&o--;);if(o==-1)break}o=s,s=n,n=a,a=o,c++}return _=!0,a.d.length=p+1,a}function zt(i,e){for(var t=i;--e;)t*=i;return t}function ci(i,e){var t,n=e.s<0,r=_e(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return je=n?4:1,e;if(t=e.divToInt(r),t.isZero())je=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return je=Yn(t)?n?2:3:n?4:1,e;je=Yn(t)?n?1:4:n?3:2}return e.minus(r).abs()}function Pn(i,e,t,n){var r,o,a,s,u,c,l,p,m,d=i.constructor,y=t!==void 0;if(y?(Le(t,1,at),n===void 0?n=d.rounding:Le(n,0,8)):(t=d.precision,n=d.rounding),!i.isFinite())l=ui(i);else{for(l=Ue(i),a=l.indexOf("."),y?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,a>=0&&(l=l.replace(".",""),m=new d(1),m.e=l.length-a,m.d=qt(Ue(m),10,r),m.e=m.d.length),p=qt(l,10,r),o=u=p.length;p[--u]==0;)p.pop();if(!p[0])l=y?"0p+0":"0";else{if(a<0?o--:(i=new d(i),i.d=p,i.e=o,i=ee(i,m,t,n,0,r),p=i.d,o=i.e,c=ei),a=p[t],s=r/2,c=c||p[t+1]!==void 0,c=n<4?(a!==void 0||c)&&(n===0||n===(i.s<0?3:2)):a>s||a===s&&(n===4||c||n===6&&p[t-1]&1||n===(i.s<0?8:7)),p.length=t,c)for(;++p[--t]>r-1;)p[t]=0,t||(++o,p.unshift(1));for(u=p.length;!p[u-1];--u);for(a=0,l="";a<u;a++)l+=fn.charAt(p[a]);if(y){if(u>1)if(e==16||e==8){for(a=e==16?4:3,--u;u%a;u++)l+="0";for(p=qt(l,r,e),u=p.length;!p[u-1];--u);for(a=1,l="1.";a<u;a++)l+=fn.charAt(p[a])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function Jn(i,e){if(i.length>e)return i.length=e,!0}function dr(i){return new this(i).abs()}function fr(i){return new this(i).acos()}function br(i){return new this(i).acosh()}function yr(i,e){return new this(i).plus(e)}function gr(i){return new this(i).asin()}function kr(i){return new this(i).asinh()}function Pr(i){return new this(i).atan()}function wr(i){return new this(i).atanh()}function Ar(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=_e(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?_e(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=_e(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ee(i,e,o,1)),e=_e(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(ee(i,e,o,1)),t}function hr(i){return new this(i).cbrt()}function Tr(i){return E(i=new this(i),i.e+1,2)}function Br(i,e,t){return new this(i).clamp(e,t)}function Ir(i){if(!i||typeof i!="object")throw Error(Ht+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,at,"rounding",0,8,"toExpNeg",-kt,0,"toExpPos",0,kt,"maxE",0,kt,"minE",-kt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=bn[t]),(n=i[t])!==void 0)if(Ie(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(st+t+": "+n);if(t="crypto",r&&(this[t]=bn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(ni);else this[t]=!1;else throw Error(st+t+": "+n);return this}function xr(i){return new this(i).cos()}function Sr(i){return new this(i).cosh()}function li(i){var e,t,n;function r(o){var a,s,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,$n(o)){c.s=o.s,_?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(a=0,s=o;s>=10;s/=10)a++;_?a>r.maxE?(c.e=NaN,c.d=null):a<r.minE?(c.e=0,c.d=[0]):(c.e=a,c.d=[o]):(c.e=a,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return kn(c,o.toString())}else if(u!=="string")throw Error(st+o);return(s=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(s===43&&(o=o.slice(1)),c.s=1),ri.test(o)?kn(c,o):mr(c,o)}if(r.prototype=h,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Ir,r.clone=li,r.isDecimal=$n,r.abs=dr,r.acos=fr,r.acosh=br,r.add=yr,r.asin=gr,r.asinh=kr,r.atan=Pr,r.atanh=wr,r.atan2=Ar,r.cbrt=hr,r.ceil=Tr,r.clamp=Br,r.cos=xr,r.cosh=Sr,r.div=Kr,r.exp=Cr,r.floor=Nr,r.hypot=Lr,r.ln=Mr,r.log=Rr,r.log10=Er,r.log2=Or,r.max=Wr,r.min=vr,r.mod=Fr,r.mul=Vr,r.pow=_r,r.random=Dr,r.round=qr,r.sign=Gr,r.sin=Ur,r.sinh=Xr,r.sqrt=Hr,r.sub=Qr,r.sum=zr,r.tan=Zr,r.tanh=jr,r.trunc=Yr,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Kr(i,e){return new this(i).div(e)}function Cr(i){return new this(i).exp()}function Nr(i){return E(i=new this(i),i.e+1,3)}function Lr(){var i,e,t=new this(0);for(_=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return _=!0,new this(1/0);t=e}return _=!0,t.sqrt()}function $n(i){return i instanceof It||i&&i.toStringTag===ii||!1}function Mr(i){return new this(i).ln()}function Rr(i,e){return new this(i).log(e)}function Or(i){return new this(i).log(2)}function Er(i){return new this(i).log(10)}function Wr(){return ai(this,arguments,"lt")}function vr(){return ai(this,arguments,"gt")}function Fr(i,e){return new this(i).mod(e)}function Vr(i,e){return new this(i).mul(e)}function _r(i,e){return new this(i).pow(e)}function Dr(i){var e,t,n,r,o=0,a=new this(1),s=[];if(i===void 0?i=this.precision:Le(i,1,at),n=Math.ceil(i/F),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:s[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(s.push(r%1e7),o+=4);o=n/4}else throw Error(ni);else for(;o<n;)s[o++]=Math.random()*1e7|0;for(n=s[--o],i%=F,n&&i&&(r=ge(10,F-i),s[o]=(n/r|0)*r);s[o]===0;o--)s.pop();if(o<0)t=0,s=[0];else{for(t=-1;s[0]===0;t-=F)s.shift();for(n=1,r=s[0];r>=10;r/=10)n++;n<F&&(t-=F-n)}return a.e=t,a.d=s,a}function qr(i){return E(i=new this(i),i.e+1,this.rounding)}function Gr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function Ur(i){return new this(i).sin()}function Xr(i){return new this(i).sinh()}function Hr(i){return new this(i).sqrt()}function Qr(i,e){return new this(i).sub(e)}function zr(){var i=0,e=arguments,t=new this(e[i]);for(_=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return _=!0,E(t,this.precision,this.rounding)}function Zr(i){return new this(i).tan()}function jr(i){return new this(i).tanh()}function Yr(i){return E(i=new this(i),i.e+1,1)}h[Symbol.for("nodejs.util.inspect.custom")]=h.toString;h[Symbol.toStringTag]="Decimal";var It=h.constructor=li(bn);Gt=new It(Gt);Ut=new It(Ut);var R=It;import oo from"big.js";import Yt from"bn.js";import Jr from"toformat";var $r=Jr,xt=$r;import jt from"big.js";import to from"bn.js";import no from"decimal.js-light";import St from"bn.js";var mi=9007199254740991;function le(i){let e=fe("Raydium_parseBigNumberish");if(i instanceof St)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new St(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=mi||i<=-mi)&&e.logWithError(`BigNumberish number overflow: ${i}`),new St(String(i))):typeof i=="bigint"?new St(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new St(0))}var Zt=fe("module/fraction"),wn=xt(jt),Kt=xt(no),io={[0]:Kt.ROUND_DOWN,[1]:Kt.ROUND_HALF_UP,[2]:Kt.ROUND_UP},ro={[0]:jt.roundDown,[1]:jt.roundHalfUp,[2]:jt.roundUp},Y=class{numerator;denominator;constructor(e,t=new to(1)){this.numerator=le(e),this.denominator=le(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new Y(this.denominator,this.numerator)}add(e){let t=e instanceof Y?e:new Y(le(e));return this.denominator.eq(t.denominator)?new Y(this.numerator.add(t.numerator),this.denominator):new Y(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof Y?e:new Y(le(e));return this.denominator.eq(t.denominator)?new Y(this.numerator.sub(t.numerator),this.denominator):new Y(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof Y?e:new Y(le(e));return new Y(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof Y?e:new Y(le(e));return new Y(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Zt.logWithError(`${e} is not an integer.`),e<=0&&Zt.logWithError(`${e} is not positive.`),Kt.set({precision:e+1,rounding:io[n]});let r=new Kt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Zt.logWithError(`${e} is not an integer.`),e<0&&Zt.logWithError(`${e} is negative.`),wn.DP=e,wn.RM=ro[n]||1,new wn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var so=fe("Raydium_amount"),pi=xt(oo);function ao(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):so.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var we=class extends Y{token;logger;constructor(e,t,n=!0,r){let o=new Yt(0),a=An.pow(new Yt(e.decimals));if(n)o=le(t);else{let s=new Yt(0),u=new Yt(0);if(typeof t=="string"||typeof t=="number"||typeof t=="bigint"){let[c,l]=ao(t.toString(),e.decimals);s=le(c),u=le(l)}s=s.mul(a),o=s.add(u)}super(o,a),this.logger=fe(r||"TokenAmount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new we(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new we(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,t,n=0){return super.toSignificant(e,t,n)}toFixed(e=this.token.decimals,t,n=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,t,n)}toExact(e={groupSeparator:""}){return pi.DP=this.token.decimals,new pi(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};import{PublicKey as uo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as di}from"@solana/spl-token";var hn={chainId:101,address:uo.default.toBase58(),programId:di.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ut={chainId:101,address:"So11111111111111111111111111111111111111112",programId:di.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as In}from"@solana/web3.js";import{PublicKey as ae,SystemProgram as fi,SYSVAR_RENT_PUBKEY as co}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as lo}from"@solana/spl-token";function g({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var Ba=[g({pubkey:lo,isWritable:!1}),g({pubkey:fi.programId,isWritable:!1}),g({pubkey:co,isWritable:!1})];function Tn({publicKey:i,transformSol:e}){let t=Bn(i.toString());if(t instanceof ae)return e&&t.equals(Ct)?Dt:t;if(e&&t.toString()===Ct.toBase58())return Dt;if(typeof t=="string"){if(t===ae.default.toBase58())return ae.default;try{return new ae(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Bn(i){try{return new ae(i)}catch{return i}}var Jt=new ae("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ct=new ae("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Xe=new ae("SysvarRent111111111111111111111111111111111"),Ia=new ae("SysvarC1ock11111111111111111111111111111111"),lt=new ae("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),xa=new ae("Sysvar1nstructions1111111111111111111111111"),mo=fi.programId,Sa=new ae("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ka=new ae("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ca=new ae("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Na=new ae("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),La=new ae("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ma=new ae("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ra=new ae("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Oa=new ae("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ea=new ae("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Wa=new ae("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),va=new ae("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Dt=new ae("So11111111111111111111111111111111111111112"),Ct=ae.default;function Tt(i){return Tn({publicKey:i,transformSol:!0})}var xn=class{symbol;name;decimals;isToken2022;mint;constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:a=!1}){if(e===Ct.toBase58()||e instanceof In&&Ct.equals(e)){this.decimals=ut.decimals,this.symbol=ut.symbol,this.name=ut.name,this.mint=new In(ut.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?In.default:Tn({publicKey:e}),this.isToken2022=a}equals(e){return this===e?!0:this.mint.equals(e.mint)}},qe=xn;Vt(qe,"WSOL",new xn({...ut,mint:ut.address}));var Sn=class{symbol;name;decimals;constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},$t=Sn;Vt($t,"SOL",new Sn(hn));import po from"bn.js";var bi=new Y(new po(100)),Ye=class extends Y{toSignificant(e=5,t,n){return this.mul(bi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(bi).toFixed(e,t,n)}};var fo=fe("Raydium_price"),Fe=class extends Y{baseToken;quoteToken;scalar;constructor(e){let{baseToken:t,quoteToken:n,numerator:r,denominator:o}=e;super(r,o),this.baseToken=t,this.quoteToken=n,this.scalar=new Y(Kn(t.decimals),Kn(n.decimals))}get raw(){return new Y(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Fe({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&fo.logWithError("mul token not equals");let t=super.mul(e);return new Fe({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:t.denominator,numerator:t.numerator})}toSignificant(e=this.quoteToken.decimals,t,n){return this.adjusted.toSignificant(e,t,n)}toFixed(e=this.quoteToken.decimals,t,n){return this.adjusted.toFixed(e,t,n)}};import{PublicKey as bo}from"@solana/web3.js";import yo from"bn.js";function gi(i){return typeof i=="object"&&i!==null&&![qe,we,bo,Y,yo,Fe,Ye].some(e=>typeof e=="object"&&i instanceof e)}function Re(i){return typeof i=="string"?Bn(i):Array.isArray(i)?i.map(e=>Re(e)):gi(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,Re(t)])):i}var yi=new Je(0),go=new Je(1),Mu=new Je(2),Ru=new Je(3),Ou=new Je(5),An=new Je(10),Eu=new Je(100),Wu=new Je(1e3),vu=new Je(1e4);function Kn(i){return An.pow(le(i))}function dn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Po}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as wo}from"@solana/spl-token";import{ComputeBudgetProgram as Xu,Keypair as zu,PublicKey as ko,Transaction as ju,TransactionMessage as Ju,VersionedTransaction as $u}from"@solana/web3.js";var te={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip",NonceAccount:"NonceAccount"};import{TOKEN_PROGRAM_ID as ic}from"@solana/spl-token";var rc=fe("Raydium_txUtil");function xe(i,e){let[t,n]=ko.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function ne(i,e,t){return xe([i.toBuffer(),(t??wo).toBuffer(),e.toBuffer()],new Po("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as D}from"@solana/web3.js";var Ao=new D("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),mc=new D("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),ho=new D("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),To=new D("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Bo=new D("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Io=new D("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),xo=new D("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),So=new D("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Ko=new D("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),en=new D("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ki=new D("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Pi=new D("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),wi=new D("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Co=new D("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),pc=new D("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),dc=new D("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),fc=new D("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),bc=new D("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),yc=new D("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Ai=new D("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),hi=new D("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),No=new D("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Lo=new D("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Mo=new D("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Ro=new D("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Oo=new D("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Eo=new D("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Wo=new D("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),vo=new D("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),Fo=new D("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Vo=new D("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),_o=new D("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),Do=new D("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var Ce={AMM_V4:So,AMM_STABLE:Ko,CLMM_PROGRAM_ID:ki,CLMM_LOCK_PROGRAM_ID:Pi,CLMM_LOCK_AUTH_ID:wi,FARM_PROGRAM_ID_V3:Ao,FARM_PROGRAM_ID_V5:ho,FARM_PROGRAM_ID_V6:To,OPEN_BOOK_PROGRAM:Io,SERUM_PROGRAM_ID_V3:xo,UTIL1216:Bo,Router:Co,CREATE_CPMM_POOL_PROGRAM:Ai,CREATE_CPMM_POOL_AUTH:hi,CREATE_CPMM_POOL_FEE_ACC:No,LOCK_CPMM_PROGRAM:Oo,LOCK_CPMM_AUTH:Wo,LAUNCHPAD_PROGRAM:Fo,LAUNCHPAD_AUTH:Vo},gc={SERUM_MARKET:D.default,OPENBOOK_MARKET:new D("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:D.default,FarmV3:new D("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new D("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new D("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new D("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new D("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new D("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new D("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new D("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new D("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Lo,CREATE_CPMM_POOL_AUTH:Mo,CREATE_CPMM_POOL_FEE_ACC:Ro,FEE_DESTINATION_ID:new D("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:Eo,LCOK_CPMM_AUTH:vo,LAUNCHPAD_PROGRAM:_o,LAUNCHPAD_AUTH:Do};import Ge from"bn.js";var Nt=1e4;function pe(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r={...e,olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}},o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,a=new Ge(o.maximumFee.toString()),s=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Nt){let u=new Ge(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:s}}else{let u=tn(i.mul(new Ge(Nt)),new Ge(Nt-o.transferFeeBasisPoints)),c=new Ge(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,p=tn(l.mul(new Ge(o.transferFeeBasisPoints)),new Ge(Nt)),m=p.gt(a)?a:p;return{amount:l,fee:m,expirationTime:s}}else{let u=tn(i.mul(new Ge(o.transferFeeBasisPoints)),new Ge(Nt)),c=u.gt(a)?a:u;return{amount:i,fee:c,expirationTime:s}}}function mt(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function tn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new Ge(0))?t.add(new Ge(1)):t}import{PublicKey as qo,AddressLookupTableAccount as Ti}from"@solana/web3.js";var Go={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Ti({key:new qo("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Ti.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as Ec,sendAndConfirmTransaction as Wc,SystemProgram as Vc,Transaction as _c,TransactionMessage as qc,VersionedTransaction as Gc}from"@solana/web3.js";import Xc from"axios";import Xo from"bn.js";var Ho=new Xo(1e6);import{PublicKey as ts}from"@solana/web3.js";import Si,{isBN as Ki}from"bn.js";import{bits as Pl,BitStructure as wl,blob as Qo,Blob as Al,cstr as hl,f32 as Tl,f32be as Bl,f64 as Il,f64be as xl,greedy as Sl,Layout as zo,ns64 as Kl,ns64be as Cl,nu64 as Nl,nu64be as Ll,offset as Ml,s16 as Rl,s16be as Ol,s24 as El,s24be as Wl,s32 as Zo,s32be as vl,s40 as Fl,s40be as Vl,s48 as _l,s48be as Dl,s8 as ql,seq as jo,struct as Gl,Structure as Yo,u16 as Jo,u16be as Ul,u24 as Xl,u24be as Hl,u32 as Ql,u32be as zl,u40 as Zl,u40be as jl,u48 as Yl,u48be as Jl,u8 as $o,UInt as es,union as $l,Union as em,unionLayoutDiscriminator as tm,utf8 as nm}from"@solana/buffer-layout";var Cn=zo,Bi=Yo;var Nn=es;var Ii=$o,dt=Jo;var oe=Zo;var xi=jo;var Se=Qo;var wt=class extends Cn{blob;signed;constructor(e,t,n){super(e,n),this.blob=Se(e),this.signed=t}decode(e,t=0){let n=new Si(this.blob.decode(e,t),10,"le");return this.signed?n.fromTwos(this.span*8).clone():n}encode(e,t,n=0){return typeof e=="number"&&(e=new Si(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),t,n)}};function q(i){return new Nn(1,i)}function At(i){return new Nn(4,i)}function k(i){return new wt(8,!1,i)}function V(i){return new wt(16,!1,i)}function Ci(i){return new wt(8,!0,i)}function Ni(i){return new wt(16,!0,i)}var nn=class extends Cn{layout;decoder;encoder;constructor(e,t,n,r){super(e.span,r),this.layout=e,this.decoder=t,this.encoder=n}decode(e,t){return this.decoder(this.layout.decode(e,t))}encode(e,t,n){return this.layout.encode(this.encoder(e),t,n)}getSpan(e,t){return this.layout.getSpan(e,t)}};function C(i){return new nn(Se(32),e=>new ts(e),e=>e.toBuffer(),i)}function Ae(i){return new nn(Ii(),ns,is,i)}function ns(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function is(i){return i?1:0}var Ln=class extends Bi{decode(e,t){return super.decode(e,t)}};function W(i,e,t){return new Ln(i,e,t)}function z(i,e,t){let n,r=typeof e=="number"?e:Ki(e)?e.toNumber():new Proxy(e,{get(o,a){if(!n){let s=Reflect.get(o,"count");n=Ki(s)?s.toNumber():s,Reflect.set(o,"count",n)}return Reflect.get(o,a)},set(o,a,s){return a==="count"&&(n=s),Reflect.set(o,a,s)}});return xi(i,r,t)}import{PublicKey as Ad}from"@solana/web3.js";import Td from"bn.js";import{AccountLayout as Sd,TOKEN_2022_PROGRAM_ID as Kd,TOKEN_PROGRAM_ID as Cd}from"@solana/spl-token";import{PublicKey as gm}from"@solana/web3.js";import{MintLayout as Pm,TOKEN_PROGRAM_ID as Am}from"@solana/spl-token";import{Keypair as ln,PublicKey as I,SystemProgram as nt,TransactionInstruction as Be}from"@solana/web3.js";import qn from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Wt,TOKEN_2022_PROGRAM_ID as me,TOKEN_PROGRAM_ID as $}from"@solana/spl-token";import ds from"bn.js";import Ve from"bn.js";var ue=new Ve(0),Oe=new Ve(1),$e=new Ve(-1),Ee=new Ve(1).shln(64),rn=new Ve(1).shln(128),Mn=Ee.sub(Oe),Lt=64,Li=rn.subn(1),Ke=-443636,Ne=-Ke,He=new Ve("4295048016"),Qe=new Ve("79226673521066979257578248091"),on=new Ve("4295048017"),sn=new Ve("79226673521066979257578248090"),Mi=16,Ri="59543866431248",Oi="184467440737095516",Ei="15793534762490258745",an=new Ve(10).pow(new Ve(6));var Rm=new Ve("18446744073700000000");import H from"bn.js";function un(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Rn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function On(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Mt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Wi(i,e){return Mt(i,e)?null:Rn(i,e)}function vi(i,e){return Mt(i,e)?null:On(i,e)}var Vm=Buffer.from("amm_config","utf8"),rs=Buffer.from("pool","utf8"),os=Buffer.from("pool_vault","utf8"),ss=Buffer.from("pool_reward_vault","utf8"),Fi=Buffer.from("position","utf8"),as=Buffer.from("tick_array","utf8"),us=Buffer.from("operation","utf8"),cs=Buffer.from("pool_tick_array_bitmap_extension","utf8"),ls=Buffer.from("observation","utf8");function Vi(i,e,t,n){return xe([rs,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function En(i,e,t){return xe([os,e.toBuffer(),t.toBuffer()],i)}function _i(i,e,t){return xe([ss,e.toBuffer(),t.toBuffer()],i)}function J(i,e,t){return xe([as,e.toBuffer(),un(t)],i)}function et(i,e,t,n){return xe([Fi,e.toBuffer(),un(t),un(n)],i)}function Me(i,e){return xe([Fi,e.toBuffer()],i)}function ht(i){return xe([Buffer.from("metadata","utf8"),lt.toBuffer(),i.toBuffer()],lt)}function cn(i){return xe([us],i)}function be(i,e){return xe([cs,e.toBuffer()],i)}function Di(i,e){return xe([ls,e.toBuffer()],i)}var qi=Buffer.from("locked_position","utf8");function Wn(i,e){return xe([qi,e.toBuffer()],i)}function vn(i,e){return xe([qi,e.toBuffer()],i)}var _m=Buffer.from("support_mint","utf8");import{PublicKey as We}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Gi}from"@solana/spl-token";import se from"bn.js";import ze from"bn.js";var Rt=class{static getfeeGrowthInside(e,t,n){let r=new ze(0),o=new ze(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let a=new ze(0),s=new ze(0);e.tickCurrent<n.tick?(a=n.feeGrowthOutsideX64A,s=n.feeGrowthOutsideX64B):(a=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),s=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=X.wrappingSubU128(X.wrappingSubU128(e.feeGrowthGlobalX64A,r),a),c=X.wrappingSubU128(X.wrappingSubU128(e.feeGrowthGlobalX64B,o),s);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:a}=this.getfeeGrowthInside(e,n,r),s=X.mulDivFloor(X.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ee),u=t.tokenFeesOwedA.add(s),c=X.mulDivFloor(X.wrappingSubU128(a,t.feeGrowthInsideLastX64B),t.liquidity,Ee),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:a}=this.getfeeGrowthInside(e,n,r),s=X.mulDivFloor(X.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ee),u=t.tokenFeesOwedA.add(s),c=X.mulDivFloor(X.wrappingSubU128(a,t.feeGrowthInsideLastX64B),t.liquidity,Ee),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],a=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let s=0;s<a.length;s++){let u=a[s],c=t.rewardInfos[s],l=X.wrappingSubU128(u,c.growthInsideLastX64),p=X.mulDivFloor(l,t.liquidity,Ee),m=c.rewardAmountOwed.add(p);o.push(m)}return o}static GetPositionRewards(e,t,n,r){let o=[],a=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let s=0;s<a.length;s++){let u=a[s],c=t.rewardInfos[s],l=X.wrappingSubU128(u,c.growthInsideLastX64),p=X.mulDivFloor(l,t.liquidity,Ee),m=c.rewardAmountOwed.add(p);o.push(m)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let a=0;a<r.length;a++){let s=new ze(0);t.liquidityGross.eqn(0)?s=r[a].rewardGrowthGlobalX64:e<t.tick?s=r[a].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[a]):s=t.rewardGrowthsOutsideX64[a];let u=new ze(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[a]:u=r[a].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[a])),o.push(X.wrappingSubU128(X.wrappingSubU128(r[a].rewardGrowthGlobalX64,s),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let a=0;a<r.length;a++){let s=new ze(0);t.liquidityGross.eqn(0)?s=r[a].rewardGrowthGlobalX64:e<t.tick?s=r[a].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[a]):s=t.rewardGrowthsOutsideX64[a];let u=new ze(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[a]:u=r[a].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[a])),o.push(X.wrappingSubU128(X.wrappingSubU128(r[a].rewardGrowthGlobalX64,s),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:a}){let s=G.priceToSqrtPriceX64(new R(e.price),e.mintA.decimals,e.mintB.decimals),u=G.getSqrtPriceX64FromTick(t.tickLower),c=G.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,p=j.getAmountsFromLiquidity(s,u,c,n,o),[m,d]=[pe(p.amountA,e.mintA.extensions?.feeConfig,a,!0),pe(p.amountB,e.mintB.extensions?.feeConfig,a,!0)],[y,f]=[pe(new ze(new R(p.amountA.toString()).mul(l).toFixed(0)),e.mintA.extensions?.feeConfig,a,!0),pe(new ze(new R(p.amountB.toString()).mul(l).toFixed(0)),e.mintB.extensions?.feeConfig,a,!0)];return{liquidity:n,amountA:m,amountB:d,amountSlippageA:y,amountSlippageB:f,expirationTime:mt(m.expirationTime,d.expirationTime)}}};var ms=15,Z=class{static async getTickArrays(e,t,n,r,o,a,s){let u=[],c=N.getTickArrayStartIndexByTick(r,o),l=N.getInitializedTickArrayInRange(a,s,o,c,Math.floor(ms/2));for(let d=0;d<l.length;d++){let{publicKey:y}=J(t,n,l[d]);u.push(y)}let p=(await it(e,u)).map(d=>d!==null?Ot.decode(d.data):null),m={};for(let d=0;d<u.length;d++){let y=p[d];y!==null&&(m[y.startTickIndex]={...y,address:u[d]})}return m}static nextInitializedTick(e,t,n,r,o,a){let{initializedTick:s,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,a);for(;s==null||s.liquidityGross.lten(0);){if(c=N.getNextTickArrayStartIndex(c,o,a),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:p,tickArrayAddress:m,tickArrayStartTickIndex:d}=this.firstInitializedTickInOneArray(e,t,l,a);[s,u,c]=[p,m,d]}if(s==null)throw new Error("No invaild tickArray cache");return{nextTick:s,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let a=Math.floor(e/Z.tickCount(t)),s=n?N.searchLowBitFromStart(r,o,a-1,1,t):N.searchHightBitFromStart(r,o,a+1,1,t);return s.length>0?{isExist:!0,nextStartIndex:s[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let s=ke-1;for(;s>=0;){let u=n.ticks[s];if(u.liquidityGross.gtn(0)){o=u;break}s=s-1}}else{let s=0;for(;s<ke;){let u=n.ticks[s];if(u.liquidityGross.gtn(0)){o=u;break}s=s+1}}let{publicKey:a}=J(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:a,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,a){let s=N.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-s)/o),c=n[s];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:s};let l;if(a)for(;u>=0;){let m=c.ticks[u];if(m.liquidityGross.gtn(0)){l=m;break}u=u-1}else for(u=u+1;u<ke;){let m=c.ticks[u];if(m.liquidityGross.gtn(0)){l=m;break}u=u+1}let{publicKey:p}=J(e,t,s);return{initializedTick:l,tickArrayAddress:p,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(N.checkIsOutOfBoundary(e)){if(e>Ne)return!1;let n=N.getTickArrayStartIndexByTick(Ke,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return ke*e}};var Fn=14,tt=class{static maxTickInTickarrayBitmap(e){return e*ke*ft}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!Z.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),a=r?t-Z.tickCount(n):t+Z.tickCount(n);if(a<-o||a>=o)return{isInit:!1,tickIndex:t};let s=n*ke,u=a/s+512;a<0&&a%s!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),p=Wi(1024,l);if(p!==null){let m=(c-p-512)*s;return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),p=vi(1024,l);if(p!==null){let m=(c+p-512)*s;return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:o-Z.tickCount(n)}}}},Et=class{static getBitmapOffset(e,t){if(!Z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=tt.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=tt.maxTickInTickarrayBitmap(e),n=-t;if(Ne<=t)throw Error(`extensionTickBoundary check error: ${Ne}, ${t}`);if(n<=Ke)throw Error(`extensionTickBoundary check error: ${n}, ${Ke}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:N.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=Z.tickCount(t),a=n?e-o:e+o,{tickarrayBitmap:s}=this.getBitmap(a,t,r);return this.nextInitializedTickArrayInBitmap(s,a,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:a}=tt.getBitmapTickBoundary(t,n),s=this.tickArrayOffsetInBitmap(t,n);if(r){let u=N.mergeTickArrayBitmap(e).shln(ft-1-s),c=Mt(512,u)?null:Rn(512,u);if(c!==null){let l=t-c*Z.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=N.mergeTickArrayBitmap(e).shrn(s),c=Mt(512,u)?null:On(512,u);if(c!==null){let l=t+c*Z.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:a-Z.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%tt.maxTickInTickarrayBitmap(t),r=Math.floor(n/Z.tickCount(t));return e<0&&n!=0&&(r=ft-r),r}};var de=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,a=!1){let s=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:l,nextAccountMeta:p}=this.getFirstInitializedTickArray(e,s);if(!c||l===void 0||!p)throw new Error("Invalid tick array");u.push(p);let{allTrade:m,amountCalculated:d,accounts:y,sqrtPriceX64:f,feeAmount:b}=bt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,a);return u.push(...y),{allTrade:m,expectedAmountOut:d.mul($e),remainingAccounts:u,executionPrice:f,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let a=n.toBase58()===e.mintB.address,s=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,a);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,a);if(f.isExist){let{publicKey:b}=J(e.programId,e.id,f.nextStartIndex);s.push(b)}}catch{}s.push(l);let{amountCalculated:p,accounts:m,sqrtPriceX64:d,feeAmount:y}=bt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul($e),c,o);return s.push(...m),{expectedAmountIn:p,remainingAccounts:s,executionPrice:d,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=de.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Et.checkTickArrayIsInit(Z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):N.checkTickArrayIsInitialized(N.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:s}=J(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:s}}let{isExist:o,nextStartIndex:a}=this.nextInitializedTickArrayStartIndex(e,Z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:s}=J(e.programId,e.id,a);return{isExist:!0,startIndex:a,nextAccountMeta:s}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/Z.tickCount(e.tickSpacing)),r=t?N.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):N.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=Z.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=tt.nextInitializedTickArrayStartIndex(N.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:a,tickIndex:s}=Et.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(a)return{isExist:!0,nextStartIndex:s};if(t=s,t<Ke||t>Ne)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){let a=[];for(let s=0;s<o.length;s++){let u=o[s],c=t.rewardDefaultInfos[s]?.mint.programId??(await e.getAccountInfo(u.tokenMint))?.owner;if(c===void 0)throw Error("get new reward mint info error");let l={...u,perSecond:X.x64ToDecimal(u.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new We(c)};if(l.tokenMint.equals(We.default))continue;if(n<=l.openTime.toNumber()||r.eq(ue)){a.push(l);continue}let p=new se(Math.min(l.endTime.toNumber(),n)),m=p.sub(l.lastUpdateTime),d=X.mulDivFloor(m,l.emissionsPerSecondX64,r),y=l.rewardGrowthGlobalX64.add(d),f=X.mulDivFloor(m,l.emissionsPerSecondX64,Ee),b=l.rewardTotalEmissioned.add(f);a.push({...l,rewardGrowthGlobalX64:y,rewardTotalEmissioned:b,lastUpdateTime:p})}return a}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let a=N.getTickArrayStartIndexByTick(o,e);if(a>=n||a<r)return!0}return!1}static tickRange(e){let t=tt.maxTickInTickarrayBitmap(e),n=-t;return t>Ne&&(t=Z.getArrayStartIndex(Ne,e)+Z.tickCount(e)),n<Ke&&(n=Z.getArrayStartIndex(Ke,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!Z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/Z.tickCount(t)*ft}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await _t(e,t.map(a=>({pubkey:a})),{batchRequest:n}),o={};for(let a of r)a.accountInfo!==null&&(o[a.pubkey.toString()]=Ui.decode(a.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=N.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=N.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let p of l){let{publicKey:m}=J(u.programId,u.id,p);o.push({pubkey:m}),r[m.toString()]=u.id}}let a=await _t(e,o,{batchRequest:n}),s={};for(let u of a){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;s[c.toString()]===void 0&&(s[c.toString()]={});let l=Ot.decode(u.accountInfo.data);s[c.toString()][l.startTickIndex]={...l,address:u.pubkey}}return s}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){let a=[];for(let s=0;s<e.length;s++){let u=e[s];u!==null&&(a.find(c=>c.equals(u.state.programId))||a.push(u.state.programId))}if(n){let s=n.tokenAccounts.map(p=>p.accountInfo.mint),u=[];for(let p of s)for(let m of a)u.push(Me(m,p).publicKey);let c=await it(t,u,{batchRequest:r}),l={};for(let p of c){if(p===null)continue;let m=_n.decode(p.data),d=m.poolId.toString(),y=e.find(S=>S.state.id.toBase58()===d);if(y===void 0)continue;let f=y.state,b=N._getTickPriceLegacy({poolInfo:f,tick:m.tickLower,baseIn:!0}),P=N._getTickPriceLegacy({poolInfo:f,tick:m.tickUpper,baseIn:!0}),{amountA:x,amountB:B}=j.getAmountsFromLiquidity(f.sqrtPriceX64,b.tickSqrtPriceX64,P.tickSqrtPriceX64,m.liquidity,!1),K=1/(1-Math.sqrt(Math.sqrt(b.price.div(P.price).toNumber())));y.positionAccount=[...y.positionAccount??[],{poolId:m.poolId,nftMint:m.nftMint,priceLower:b.price,priceUpper:P.price,amountA:x,amountB:B,tickLower:m.tickLower,tickUpper:m.tickUpper,liquidity:m.liquidity,feeGrowthInsideLastX64A:m.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:m.feeGrowthInsideLastX64B,tokenFeesOwedA:m.tokenFeesOwedA,tokenFeesOwedB:m.tokenFeesOwedB,rewardInfos:m.rewardInfos.map(S=>({...S,pendingReward:new se(0)})),leverage:K,tokenFeeAmountA:new se(0),tokenFeeAmountB:new se(0)}];let O=await N.getTickArrayAddressByTick(y.state.programId,m.poolId,m.tickLower,y.state.tickSpacing),A=await N.getTickArrayAddressByTick(y.state.programId,m.poolId,m.tickUpper,y.state.tickSpacing);l[`${y.state.programId.toString()}-${m.poolId.toString()}-${m.tickLower}`]=O,l[`${y.state.programId.toString()}-${m.poolId.toString()}-${m.tickUpper}`]=A}if(o){let p=Object.values(l),m=await it(t,p,{batchRequest:r}),d={};for(let y=0;y<p.length;y++){let f=m[y];if(f===null)continue;let b=p[y].toString();d[b]=Ot.decode(f.data)}for(let{state:y,positionAccount:f}of e)if(!!f)for(let b of f){let P=`${y.programId.toString()}-${y.id.toString()}-${b.tickLower}`,x=`${y.programId.toString()}-${y.id.toString()}-${b.tickUpper}`,B=d[l[P].toString()],K=d[l[x].toString()],O=B.ticks[N.getTickOffsetInArray(b.tickLower,y.tickSpacing)],A=K.ticks[N.getTickOffsetInArray(b.tickUpper,y.tickSpacing)],{tokenFeeAmountA:S,tokenFeeAmountB:v}=await Rt.GetPositionFees(y,b,O,A),T=await Rt.GetPositionRewards(y,b,O,A);b.tokenFeeAmountA=S.gte(new se(0))?S:new se(0),b.tokenFeeAmountB=v.gte(new se(0))?v:new se(0);for(let U=0;U<T.length;U++)b.rewardInfos[U].pendingReward=T[U].gte(new se(0))?T[U]:new se(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:a,priceLimit:s=new R(0),catchLiquidityInsufficient:u=!1}){let c,l=n.toBase58()===e.mintA.address,[p,m]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];s.equals(new R(0))?c=l?He.add(new se(1)):Qe.sub(new se(1)):c=G.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let d=pe(o,p,r,!1),{allTrade:y,expectedAmountOut:f,remainingAccounts:b,executionPrice:P,feeAmount:x}=de.getOutputAmountAndRemainAccounts(e,t,n,d.amount.sub(d.fee??ue),c,u),B=pe(f,m,r,!1),K=G.sqrtPriceX64ToPrice(P,e.mintA.decimals,e.mintB.decimals),O=l?K:new R(1).div(K),A=f.mul(new se(Math.floor((1-a)*1e10))).div(new se(1e10)),S=pe(A,m,r,!1),v=l?e.currentPrice:new R(1).div(e.currentPrice),T=new R(O).sub(v).abs(),U=v,Q=new Ye(new R(T).mul(10**15).toFixed(0),new R(U).mul(10**15).toFixed(0));return{allTrade:y,realAmountIn:d,amountOut:B,minAmountOut:S,expirationTime:mt(d.expirationTime,B.expirationTime),currentPrice:e.currentPrice,executionPrice:O,priceImpact:Q,fee:x,remainingAccounts:b,executionPriceX64:P}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:a,catchLiquidityInsufficient:s=!1}){let u=r.address===e.mintB.address,[c,l]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[p,m]=[new qe({...c,mint:c.address,isToken2022:c.programId===Gi.toBase58()}),new qe({...l,mint:l.address,isToken2022:l.programId===Gi.toBase58()})],{allTrade:d,realAmountIn:y,amountOut:f,minAmountOut:b,expirationTime:P,currentPrice:x,executionPrice:B,priceImpact:K,fee:O,remainingAccounts:A,executionPriceX64:S}=de.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new We(c.address),amountIn:n,slippage:o,epochInfo:a,catchLiquidityInsufficient:s}),v={...y,amount:new we(p,y.amount),fee:y.fee===void 0?void 0:new we(p,y.fee)},T={...f,amount:new we(m,f.amount),fee:f.fee===void 0?void 0:new we(m,f.fee)},U={...b,amount:new we(m,b.amount),fee:b.fee===void 0?void 0:new we(m,b.fee)},Q=new Fe({baseToken:p,denominator:new se(10).pow(new se(20+p.decimals)),quoteToken:m,numerator:x.mul(new R(10**(20+m.decimals))).toFixed(0)}),ye=new Fe({baseToken:p,denominator:new se(10).pow(new se(20+p.decimals)),quoteToken:m,numerator:B.mul(new R(10**(20+m.decimals))).toFixed(0)}),ie=new we(p,O);return{allTrade:d,realAmountIn:v,amountOut:T,minAmountOut:U,expirationTime:P,currentPrice:Q,executionPrice:ye,priceImpact:K,fee:ie,remainingAccounts:A,executionPriceX64:S}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:a,priceLimit:s=new R(0)}){let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;s.equals(new R(0))?l=u?Qe.sub(new se(1)):He.add(new se(1)):l=G.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let p=pe(o,c[n.toString()],r,!0),{expectedAmountIn:m,remainingAccounts:d,executionPrice:y,feeAmount:f}=de.getInputAmountAndRemainAccounts(e,t,n,p.amount.sub(p.fee??ue),l),b=u?e.mintB.address:e.mintA.address,P=pe(m,c[b],r,!1),x=G.sqrtPriceX64ToPrice(y,e.mintA.decimals,e.mintB.decimals),B=u?x:new R(1).div(x),K=m.mul(new se(Math.floor((1+a)*1e10))).div(new se(1e10)),O=pe(K,c[b],r,!0),A=u?e.currentPrice:new R(1).div(e.currentPrice),S=new R(B).sub(A).abs(),v=A,T=new Ye(new R(S).mul(10**15).toFixed(0),new R(v).mul(10**15).toFixed(0));return{amountIn:P,maxAmountIn:O,realAmountOut:p,expirationTime:mt(P.expirationTime,p.expirationTime),currentPrice:e.currentPrice,executionPrice:B,priceImpact:T,fee:f,remainingAccounts:d}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){let o=e[t],a=N.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),s=N.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(a,o.priceMin),l=Math.min(s,o.priceMax)-u,p=s-a,m=o.priceMax-o.priceMin,d;return l<=0?d=0:p===l?d=m/l:m===l?d=l/p:d=l/m*(l/p),{feeApr:o.feeApr*d,rewardsApr:[(o.rewardApr[0]??0)*d,(o.rewardApr[1]??0)*d,(o.rewardApr[2]??0)*d],apr:o.apr*d}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:a,positionTickUpperIndex:s,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],p=r[Tt(e.mintA.address).toString()],m=r[Tt(e.mintB.address).toString()],d=e.mintA.decimals,y=e.mintB.decimals;if(!l||!p||!m)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=G.priceToSqrtPriceX64(new R(e.price),e.mintA.decimals,e.mintB.decimals),b=G.getSqrtPriceX64FromTick(a),P=G.getSqrtPriceX64FromTick(s),{amountSlippageA:x,amountSlippageB:B}=j.getAmountsFromLiquidityWithSlippage(f,b,P,t,!1,!1,0),{amountSlippageA:K,amountSlippageB:O}=j.getAmountsFromLiquidityWithSlippage(f,b,P,o,!1,!1,0),A=new R(x.toString()).div(new R(10).pow(d)).mul(p.value).add(new R(B.toString()).div(new R(10).pow(y)).mul(m.value)),S=new R(K.toString()).div(new R(10).pow(d)).mul(p.value).add(new R(O.toString()).div(new R(10).pow(y)).mul(m.value)),v=new R(1).div(A.add(S)),U=new R(l.volumeFee).mul(365).div(c).mul(v).mul(100).toNumber(),Q=3600*24*365,ye=e.rewardDefaultInfos.map(ie=>{let Pe=ie.mint.decimals,ce=r[ie.mint.address];return u<(ie.startTime??0)||u>(ie.endTime??0)||!ie.perSecond||!ce||Pe===void 0?0:new R(ce.value).mul(new R(ie.perSecond).mul(Q)).div(new R(10).pow(Pe)).mul(v).mul(100).toNumber()});return{feeApr:U,rewardsApr:ye,apr:U+ye.reduce((ie,Pe)=>ie+Pe,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:a,add:s,epochInfo:u,amountHasFee:c}){let l=G.priceToSqrtPriceX64(new R(e.price),e.mintA.decimals,e.mintB.decimals),p=G.getSqrtPriceX64FromTick(n),m=G.getSqrtPriceX64FromTick(r),d=pe(o,e[t?"mintA":"mintB"].extensions?.feeConfig,u,!c),y=new se(new R(d.amount.sub(d.fee??ue).toString()).toFixed(0)),f;if(l.lte(p))f=t?j.getLiquidityFromTokenAmountA(p,m,y,!s):new se(0);else if(l.lte(m)){let P=j.getLiquidityFromTokenAmountA(l,m,y,!s),x=j.getLiquidityFromTokenAmountB(p,l,y);f=t?P:x}else f=t?new se(0):j.getLiquidityFromTokenAmountB(p,m,y);let b=await de.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:f,slippage:a,add:s});return{liquidity:f,amountA:t?d:b.amountA,amountB:t?b.amountB:d,amountSlippageA:t?d:b.amountSlippageA,amountSlippageB:t?b.amountSlippageB:d,expirationTime:b.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:a,add:s}){let u=G.getSqrtPriceX64FromTick(n),c=G.getSqrtPriceX64FromTick(r),l=s?1+a:1-a,p=j.getAmountsFromLiquidity(G.priceToSqrtPriceX64(new R(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,s),[m,d]=[pe(p.amountA,t.mintA.extensions?.feeConfig,e,!0),pe(p.amountB,t.mintB.extensions?.feeConfig,e,!0)],[y,f]=[pe(p.amountA.muln(l),t.mintA.extensions?.feeConfig,e,!0),pe(p.amountB.muln(l),t.mintB.extensions?.feeConfig,e,!0)];return{liquidity:o,amountA:m,amountB:d,amountSlippageA:y,amountSlippageB:f,expirationTime:mt(m.expirationTime,d.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new We(u.id));(await it(e,r)).forEach((u,c)=>{!u||(n[r[c].toBase58()]=Vn.decode(u.data))});let a=t.map(u=>be(new We(u.programId),new We(u.id)).publicKey),s=await de.fetchExBitmaps({connection:e,exBitmapAddress:a,batchRequest:!1});return t.reduce((u,c)=>({...u,[c.id]:{...n[c.id],id:new We(c.id),version:6,programId:new We(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:{...c.config,id:new We(c.config.id),fundOwner:""},currentPrice:new R(c.price),exBitmapAccount:be(new We(c.programId),new We(c.id)).publicKey,exBitmapInfo:s[be(new We(c.programId),new We(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber(),rewardInfos:n[c.id].rewardInfos}}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var X=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(ue)||(o=o.add(Oe)),o}static mulDivFloor(e,t,n){if(n.eq(ue))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ue))throw new Error("division by 0");return e.mul(t).add(n.sub(Oe)).div(n)}static x64ToDecimal(e,t){return new R(e.toString()).div(R.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new H(e.mul(R.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(rn).sub(t).mod(rn)}};function he(i,e){return Dn(i.mul(e),64,256)}function ps(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Dn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var G=class{static sqrtPriceX64ToPrice(e,t,n){return X.x64ToDecimal(e).pow(2).mul(R.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return X.decimalToX64(e.mul(R.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ue))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ue))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ue))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ue))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ue))return e;let o=t.shln(Lt);if(r){let a=o,s=o.add(n.mul(e));return s.gte(a)?X.mulDivCeil(a,e,s):X.mulDivRoundingUp(a,Oe,a.div(e).add(n))}else{let a=n.mul(e);if(!o.gt(a))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let s=o.sub(a);return X.mulDivCeil(o,e,s)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Lt);if(r)return e.add(o.div(t));{let a=X.mulDivRoundingUp(o,Oe,t);if(!e.gt(a))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(a)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ke||e>Ne)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new H("18445821805675395072"):new H("18446744073709551616");return(t&2)!=0&&(n=he(n,new H("18444899583751176192"))),(t&4)!=0&&(n=he(n,new H("18443055278223355904"))),(t&8)!=0&&(n=he(n,new H("18439367220385607680"))),(t&16)!=0&&(n=he(n,new H("18431993317065453568"))),(t&32)!=0&&(n=he(n,new H("18417254355718170624"))),(t&64)!=0&&(n=he(n,new H("18387811781193609216"))),(t&128)!=0&&(n=he(n,new H("18329067761203558400"))),(t&256)!=0&&(n=he(n,new H("18212142134806163456"))),(t&512)!=0&&(n=he(n,new H("17980523815641700352"))),(t&1024)!=0&&(n=he(n,new H("17526086738831433728"))),(t&2048)!=0&&(n=he(n,new H("16651378430235570176"))),(t&4096)!=0&&(n=he(n,new H("15030750278694412288"))),(t&8192)!=0&&(n=he(n,new H("12247334978884435968"))),(t&16384)!=0&&(n=he(n,new H("8131365268886854656"))),(t&32768)!=0&&(n=he(n,new H("3584323654725218816"))),(t&65536)!=0&&(n=he(n,new H("696457651848324352"))),(t&131072)!=0&&(n=he(n,new H("26294789957507116"))),(t&262144)!=0&&(n=he(n,new H("37481735321082"))),e>0&&(n=Li.div(n)),n}static getTickFromPrice(e,t,n){return G.getTickFromSqrtPriceX64(G.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Qe)||e.lt(He))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new H(t-64),r=ps(n,32,128),o=new H("8000000000000000","hex"),a=0,s=new H(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new H(0))&&a<Mi;){u=u.mul(u);let y=u.shrn(127);u=u.shrn(63+y.toNumber()),s=s.add(o.mul(y)),o=o.shrn(1),a+=1}let c=s.shrn(32),p=r.add(c).mul(new H(Ri)),m=Dn(p.sub(new H(Oi)),64,128).toNumber(),d=Dn(p.add(new H(Ei)),64,128).toNumber();return m==d?m:G.getSqrtPriceX64FromTick(d).lte(e)?d:m}},yt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let a=G.getTickFromSqrtPriceX64(G.priceToSqrtPriceX64(e,n,r))/t;return a<0?a=Math.floor(a):a=Math.ceil(a),a*t}static roundPriceWithTickspacing(e,t,n,r){let o=yt.getTickWithPriceAndTickspacing(e,t,n,r),a=G.getSqrtPriceX64FromTick(o);return G.sqrtPriceX64ToPrice(a,n,r)}},j=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ue))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Lt),a=t.sub(e);return r?X.mulDivRoundingUp(X.mulDivCeil(o,a,t),Oe,e):X.mulDivFloor(o,a,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ue))throw new Error("sqrtPriceX64A must greater than 0");return r?X.mulDivCeil(n,t.sub(e),Ee):X.mulDivFloor(n,t.sub(e),Ee)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),a=t.sub(e),s=o.div(a);return r?X.mulDivRoundingUp(s,Oe,Mn):s.shrn(Lt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),X.mulDivFloor(n,Mn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return j.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let a=j.getLiquidityFromTokenAmountA(e,n,r,!1),s=j.getLiquidityFromTokenAmountB(t,e,o);return a.lt(s)?a:s}else return j.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:j.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new H(0)};if(e.lt(n)){let a=j.getTokenAmountAFromLiquidity(e,n,r,o),s=j.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:a,amountB:s}}else return{amountA:new H(0),amountB:j.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,a,s){let{amountA:u,amountB:c}=j.getAmountsFromLiquidity(e,t,n,r,a),l=o?1+s:1-s,p=new H(new R(u.toString()).mul(l).toFixed(0)),m=new H(new R(c.toString()).mul(l).toFixed(0));return{amountSlippageA:p,amountSlippageB:m}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:a,epochInfo:s,amountAddFee:u}){let c=G.priceToSqrtPriceX64(new R(e.price),e.mintA.decimals,e.mintB.decimals),l=G.getSqrtPriceX64FromTick(t),p=G.getSqrtPriceX64FromTick(n),m=a?1+o:1-o,d=j.getAmountsFromLiquidity(c,l,p,r,a),[y,f]=[pe(d.amountA,e.mintA.extensions?.feeConfig,s,u),pe(d.amountB,e.mintB.extensions?.feeConfig,s,u)],[b,P]=[pe(new H(new R(d.amountA.toString()).mul(m).toFixed(0)),e.mintA.extensions?.feeConfig,s,u),pe(new H(new R(d.amountB.toString()).mul(m).toFixed(0)),e.mintB.extensions?.feeConfig,s,u)];return{liquidity:r,amountA:y,amountB:f,amountSlippageA:b,amountSlippageB:P,expirationTime:mt(y.expirationTime,f.expirationTime)}}},bt=class{static swapCompute(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f=!1){if(m.eq(ue))throw new Error("amountSpecified must not be 0");if(y||(y=a?He.add(Oe):Qe.sub(Oe)),a){if(y.lt(He))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(p))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(Qe))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(p))throw new Error("sqrtPriceX64 must greater than current")}let b=m.gt(ue),P={amountSpecifiedRemaining:m,amountCalculated:ue,sqrtPriceX64:p,tick:c>d?Math.min(d+Z.tickCount(l)-1,c):d,accounts:[],liquidity:u,feeAmount:new H(0)},x=d,B=n[d],K=0,O=!a&&B.startTickIndex===P.tick;for(;!P.amountSpecifiedRemaining.eq(ue)&&!P.sqrtPriceX64.eq(y);){K>10;let A={};A.sqrtPriceStartX64=P.sqrtPriceX64;let S=N.nextInitTick(B,P.tick,l,a,O),v=S||null,T=null;if(!v?.liquidityGross.gtn(0)){let Q=de.nextInitializedTickArrayStartIndex({tickCurrent:P.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},x,a);if(!Q.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:P.amountSpecifiedRemaining,amountCalculated:P.amountCalculated,feeAmount:P.feeAmount,sqrtPriceX64:P.sqrtPriceX64,liquidity:P.liquidity,tickCurrent:P.tick,accounts:P.accounts};throw Error("swapCompute LiquidityInsufficient")}x=Q.nextStartIndex;let{publicKey:ye}=J(e,t,x);T=ye,B=n[x];try{v=N.firstInitializedTick(B,a)}catch{throw Error("not found next tick info")}}A.tickNext=v.tick,A.initialized=v.liquidityGross.gtn(0),d!==x&&T&&(P.accounts.push(T),d=x),A.tickNext<Ke?A.tickNext=Ke:A.tickNext>Ne&&(A.tickNext=Ne),A.sqrtPriceNextX64=G.getSqrtPriceX64FromTick(A.tickNext);let U;if(a&&A.sqrtPriceNextX64.lt(y)||!a&&A.sqrtPriceNextX64.gt(y)?U=y:U=A.sqrtPriceNextX64,[P.sqrtPriceX64,A.amountIn,A.amountOut,A.feeAmount]=bt.swapStepCompute(P.sqrtPriceX64,U,P.liquidity,P.amountSpecifiedRemaining,s,a),P.feeAmount=P.feeAmount.add(A.feeAmount),b?(P.amountSpecifiedRemaining=P.amountSpecifiedRemaining.sub(A.amountIn.add(A.feeAmount)),P.amountCalculated=P.amountCalculated.sub(A.amountOut)):(P.amountSpecifiedRemaining=P.amountSpecifiedRemaining.add(A.amountOut),P.amountCalculated=P.amountCalculated.add(A.amountIn.add(A.feeAmount))),P.sqrtPriceX64.eq(A.sqrtPriceNextX64)){if(A.initialized){let Q=v.liquidityNet;a&&(Q=Q.mul($e)),P.liquidity=j.addDelta(P.liquidity,Q)}O=A.tickNext!=P.tick&&!a&&B.startTickIndex===A.tickNext,P.tick=a?A.tickNext-1:A.tickNext}else if(P.sqrtPriceX64!=A.sqrtPriceStartX64){let Q=G.getTickFromSqrtPriceX64(P.sqrtPriceX64);O=Q!=P.tick&&!a&&B.startTickIndex===Q,P.tick=Q}++K}try{let{nextStartIndex:A,isExist:S}=Z.nextInitializedTickArray(P.tick,l,a,r,o);S&&d!==A&&(P.accounts.push(J(e,t,A).publicKey),d=A)}catch{}return{allTrade:!0,amountSpecifiedRemaining:ue,amountCalculated:P.amountCalculated,feeAmount:P.feeAmount,sqrtPriceX64:P.sqrtPriceX64,liquidity:P.liquidity,tickCurrent:P.tick,accounts:P.accounts}}static swapStepCompute(e,t,n,r,o,a){let s={sqrtPriceX64Next:new H(0),amountIn:new H(0),amountOut:new H(0),feeAmount:new H(0)},u=r.gte(ue);if(u){let l=X.mulDivFloor(r,an.sub(new H(o.toString())),an);s.amountIn=a?j.getTokenAmountAFromLiquidity(t,e,n,!0):j.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=G.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?j.getTokenAmountBFromLiquidity(t,e,n,!1):j.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul($e).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=G.getNextSqrtPriceX64FromOutput(e,n,r.mul($e),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=j.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=j.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:j.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:j.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul($e))&&(s.amountOut=r.mul($e)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=X.mulDivCeil(s.amountIn,new H(o),an.sub(new H(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var ke=60,ft=512,N=class{static getTickArrayAddressByTick(e,t,n,r){let o=N.getTickArrayStartIndexByTick(n,r),{publicKey:a}=J(e,t,o);return a}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=N.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=ke)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=Z.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*Z.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*ke,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*ke,o=Math.floor(t/r)+512,a=Math.abs(o);return{isInitialized:e.testn(a),startIndex:(a-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*ke:e+t*ke}static mergeTickArrayBitmap(e){let t=new ds(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let a=Math.floor(r/(n*ke));return[...N.searchLowBitFromStart(e,t,a-1,o,n),...N.searchHightBitFromStart(e,t,a,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return N.searchHightBitFromStart(e,t,-7680,ft,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let a=[],s=N.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of s){let{publicKey:c}=J(e,t,u);a.push({tickArrayStartIndex:u,tickArrayAddress:c})}return a}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let a=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>N.mergeTickArrayBitmap(c)),s=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(a[c].testn(l)&&s.push(n),n--,s.length===r)break}let u=Z.tickCount(o);return s.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let a=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>N.mergeTickArrayBitmap(c)),s=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(a[c].testn(l)&&s.push(n),n++,s.length===r)break}let u=Z.tickCount(o);return s.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Ke||e>Ne}static nextInitTick(e,t,n,r,o){if(Z.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let s=Math.floor((t-e.startTickIndex)/n);if(r)for(;s>=0;){if(e.ticks[s].liquidityGross.gtn(0))return e.ticks[s];s=s-1}else for(o||(s=s+1);s<ke;){if(e.ticks[s].liquidityGross.gtn(0))return e.ticks[s];s=s+1}return null}static firstInitializedTick(e,t){if(t){let n=ke-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<ke;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=G.getSqrtPriceX64FromTick(t),o=G.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new R(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new R(1).div(t),o=yt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),a=G.getSqrtPriceX64FromTick(o),s=G.sqrtPriceX64ToPrice(a,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:s}:{tick:o,price:new R(1).div(s)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=G.getSqrtPriceX64FromTick(t),o=G.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new R(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new R(1).div(t),o=yt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),a=G.getSqrtPriceX64FromTick(o),s=G.sqrtPriceX64ToPrice(a,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:s}:{tick:o,price:new R(1).div(s)}}};var fs=W([Se(8),q("bump"),dt("index"),C(""),At("protocolFeeRate"),At("tradeFeeRate"),dt("tickSpacing"),z(k(),8,"")]),bs=W([At("blockTimestamp"),Ci("tickCumulative"),z(k(),4)]),Xi=W([Se(8),Ae("initialized"),k("recentEpoch"),dt("observationIndex"),C("poolId"),z(bs,100,"observations"),z(k(),4)]),ys=W([q("rewardState"),k("openTime"),k("endTime"),k("lastUpdateTime"),V("emissionsPerSecondX64"),k("rewardTotalEmissioned"),k("rewardClaimed"),C("tokenMint"),C("tokenVault"),C("creator"),V("rewardGrowthGlobalX64")]),Vn=W([Se(8),q("bump"),C("ammConfig"),C("creator"),C("mintA"),C("mintB"),C("vaultA"),C("vaultB"),C("observationId"),q("mintDecimalsA"),q("mintDecimalsB"),dt("tickSpacing"),V("liquidity"),V("sqrtPriceX64"),oe("tickCurrent"),At(),V("feeGrowthGlobalX64A"),V("feeGrowthGlobalX64B"),k("protocolFeesTokenA"),k("protocolFeesTokenB"),V("swapInAmountTokenA"),V("swapOutAmountTokenB"),V("swapInAmountTokenB"),V("swapOutAmountTokenA"),q("status"),z(q(),7,""),z(ys,3,"rewardInfos"),z(k(),16,"tickArrayBitmap"),k("totalFeesTokenA"),k("totalFeesClaimedTokenA"),k("totalFeesTokenB"),k("totalFeesClaimedTokenB"),k("fundFeesTokenA"),k("fundFeesTokenB"),k("startTime"),z(k(),15*4-3,"padding")]),gs=W([V("growthInsideLastX64"),k("rewardAmountOwed")]),_n=W([Se(8),q("bump"),C("nftMint"),C("poolId"),oe("tickLower"),oe("tickUpper"),V("liquidity"),V("feeGrowthInsideLastX64A"),V("feeGrowthInsideLastX64B"),k("tokenFeesOwedA"),k("tokenFeesOwedB"),z(gs,3,"rewardInfos"),z(k(),8,"")]),zp=W([Se(8),q("bump"),C("poolId"),oe("tickLowerIndex"),oe("tickUpperIndex"),V("liquidity"),V("feeGrowthInsideLastX64A"),V("feeGrowthInsideLastX64B"),k("tokenFeesOwedA"),k("tokenFeesOwedB"),z(V(),3,"rewardGrowthInside"),z(k(),8,"")]),ks=W([oe("tick"),Ni("liquidityNet"),V("liquidityGross"),V("feeGrowthOutsideX64A"),V("feeGrowthOutsideX64B"),z(V(),3,"rewardGrowthsOutsideX64"),z(At(),13,"")]),Ot=W([Se(8),C("poolId"),oe("startTickIndex"),z(ks,ke,"ticks"),q("initializedTickCount"),z(q(),115,"")]),Ps=W([Se(329),z(C(),100,"whitelistMints")]),Ui=W([Se(8),C("poolId"),z(z(k(),8),Fn,"positiveTickArrayBitmap"),z(z(k(),8),Fn,"negativeTickArrayBitmap")]),Zp=W([k(),q("bump"),C("owner"),C("poolId"),C("positionId"),C("nftAccount"),z(k(),8)]),jp=W([Se(8),q("bump"),C("lockOwner"),C("poolId"),C("positionId"),C("nftAccount"),C("lockNftMint"),k("recentEpoch"),z(k(),8)]);Xi.span;var Hi=fe("Raydium_Clmm"),ve={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Qi=[188,37,179,131,82,150,84,73],zi=[16,72,250,198,14,162,212,19],gt=class{static createPoolInstruction(e,t,n,r,o,a,s,u,c,l,p,m,d,y){let f=W([V("sqrtPriceX64"),k("zero")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:nt.programId,isSigner:!1,isWritable:!1},{pubkey:Xe,isSigner:!1,isWritable:!1},...y?.map(B=>({pubkey:B,isSigner:!1,isWritable:!1}))||[]],P=Buffer.alloc(f.span);f.encode({sqrtPriceX64:d,zero:ue},P);let x=Buffer.from([...ve.createPool,...P]);return new Be({keys:b,programId:e,data:x})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:a,initialPriceX64:s,extendMintAccount:u}=e,[c,l]=[new I(r.address),new I(o.address)],{publicKey:p}=Vi(t,a,c,l),{publicKey:m}=Di(t,p),{publicKey:d}=En(t,p,c),{publicKey:y}=En(t,p,l),f=be(t,p).publicKey,b=[this.createPoolInstruction(t,p,n,a,m,c,d,new I(r.programId||$),l,y,new I(o.programId||$),f,s,u)];return{signers:[],instructions:b,instructionTypes:[te.CreateAccount,te.ClmmCreatePool],address:{poolId:p,observationId:m,exBitmapAccount:f,mintAVault:d,mintBVault:y},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f,b,P,x,B,K,O,A,S,v,T,U){let Q=W([oe("tickLowerIndex"),oe("tickUpperIndex"),oe("tickArrayLowerStartIndex"),oe("tickArrayUpperStartIndex"),V("liquidity"),k("amountMaxA"),k("amountMaxB"),Ae("withMetadata"),q("optionBaseFlag"),Ae("baseFlag")]),ye=[...U?[{pubkey:U,isSigner:!1,isWritable:!0}]:[]],ie=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Xe,isSigner:!1,isWritable:!1},{pubkey:nt.programId,isSigner:!1,isWritable:!1},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},...ye],Pe=Buffer.alloc(Q.span);Q.encode({tickLowerIndex:x,tickUpperIndex:B,tickArrayLowerStartIndex:K,tickArrayUpperStartIndex:O,liquidity:A,amountMaxA:S,amountMaxB:v,withMetadata:T==="create",baseFlag:!1,optionBaseFlag:0},Pe);let ce=Buffer.from([...ve.openPosition,...Pe]);return new Be({keys:ie,programId:e,data:ce})}static openPositionFromLiquidityInstruction22(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f,b,P,x,B,K,O,A,S,v,T){let U=W([oe("tickLowerIndex"),oe("tickUpperIndex"),oe("tickArrayLowerStartIndex"),oe("tickArrayUpperStartIndex"),V("liquidity"),k("amountMaxA"),k("amountMaxB"),Ae("withMetadata"),q("optionBaseFlag"),Ae("baseFlag")]),Q=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],ye=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:Xe,isSigner:!1,isWritable:!1},{pubkey:nt.programId,isSigner:!1,isWritable:!1},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...Q],ie=Buffer.alloc(U.span);U.encode({tickLowerIndex:P,tickUpperIndex:x,tickArrayLowerStartIndex:B,tickArrayUpperStartIndex:K,liquidity:O,amountMaxA:A,amountMaxB:S,withMetadata:v==="create",baseFlag:!1,optionBaseFlag:0},ie);let Pe=Buffer.from([...ve.openPositionWithTokenEx,...ie]);return new Be({keys:ye,programId:e,data:Pe})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:a,amountMaxA:s,amountMaxB:u,withMetadata:c,getEphemeralSigners:l,nft2022:p}){let m=[],[d,y]=[new I(e.programId),new I(e.id)],f;if(l)f=new I((await l(1))[0]);else{let T=ln.generate();m.push(T),f=T.publicKey}let b=N.getTickArrayStartIndexByTick(r,e.config.tickSpacing),P=N.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:x}=J(d,y,b),{publicKey:B}=J(d,y,P),{publicKey:K}=p?ne(n.wallet,f,me):ne(n.wallet,f,$),{publicKey:O}=ht(f),{publicKey:A}=Me(d,f),{publicKey:S}=et(d,y,r,o),v=p?this.openPositionFromLiquidityInstruction22(d,n.feePayer,y,n.wallet,f,K,S,x,B,A,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,b,P,a,s,u,c,de.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,P])?be(d,y).publicKey:void 0):this.openPositionFromLiquidityInstruction(d,n.feePayer,y,n.wallet,f,K,O,S,x,B,A,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,b,P,a,s,u,c,de.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,P])?be(d,y).publicKey:void 0);return{signers:m,instructions:[v],instructionTypes:[te.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:f,tickArrayLower:x,tickArrayUpper:B,positionNftAccount:K,metadataAccount:O,personalPosition:A,protocolPosition:S}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:a,baseAmount:s,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l,nft2022:p}){let m=[],[d,y]=[new I(e.programId),new I(e.id)],f;if(l)f=new I((await l(1))[0]);else{let T=ln.generate();m.push(T),f=T.publicKey}let b=N.getTickArrayStartIndexByTick(r,e.config.tickSpacing),P=N.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:x}=J(d,y,b),{publicKey:B}=J(d,y,P),{publicKey:K}=p?ne(n.wallet,f,me):ne(n.wallet,f,$),{publicKey:O}=ht(f),{publicKey:A}=Me(d,f),{publicKey:S}=et(d,y,r,o),v=p?this.openPositionFromBaseInstruction22(d,n.feePayer,y,n.wallet,f,K,S,x,B,A,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,b,P,c,a,s,u,de.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,P])?be(d,y).publicKey:void 0):this.openPositionFromBaseInstruction(d,n.feePayer,y,n.wallet,f,K,O,S,x,B,A,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,b,P,c,a,s,u,de.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,P])?be(d,y).publicKey:void 0);return{address:{nftMint:f,tickArrayLower:x,tickArrayUpper:B,positionNftAccount:K,metadataAccount:O,personalPosition:A,protocolPosition:S},instructions:[v],signers:m,instructionTypes:[te.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f,b,P,x,B,K,O,A,S,v,T,U){let Q=W([oe("tickLowerIndex"),oe("tickUpperIndex"),oe("tickArrayLowerStartIndex"),oe("tickArrayUpperStartIndex"),V("liquidity"),k("amountMaxA"),k("amountMaxB"),Ae("withMetadata"),q("optionBaseFlag"),Ae("baseFlag")]),ye=[...U?[{pubkey:U,isSigner:!1,isWritable:!0}]:[]],ie=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Xe,isSigner:!1,isWritable:!1},{pubkey:nt.programId,isSigner:!1,isWritable:!1},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},...ye],Pe=Buffer.alloc(Q.span);Q.encode({tickLowerIndex:x,tickUpperIndex:B,tickArrayLowerStartIndex:K,tickArrayUpperStartIndex:O,liquidity:new qn(0),amountMaxA:S==="MintA"?v:T,amountMaxB:S==="MintA"?T:v,withMetadata:A==="create",baseFlag:S==="MintA",optionBaseFlag:1},Pe);let ce=Buffer.from([...ve.openPosition,...Pe]);return new Be({keys:ie,programId:e,data:ce})}static openPositionFromBaseInstruction22(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f,b,P,x,B,K,O,A,S,v,T){let U=W([oe("tickLowerIndex"),oe("tickUpperIndex"),oe("tickArrayLowerStartIndex"),oe("tickArrayUpperStartIndex"),V("liquidity"),k("amountMaxA"),k("amountMaxB"),Ae("withMetadata"),q("optionBaseFlag"),Ae("baseFlag")]),Q=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],ye=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:Xe,isSigner:!1,isWritable:!1},{pubkey:nt.programId,isSigner:!1,isWritable:!1},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...Q],ie=Buffer.alloc(U.span);U.encode({tickLowerIndex:P,tickUpperIndex:x,tickArrayLowerStartIndex:B,tickArrayUpperStartIndex:K,liquidity:new qn(0),amountMaxA:A==="MintA"?S:v,amountMaxB:A==="MintA"?v:S,withMetadata:O==="create",baseFlag:A==="MintA",optionBaseFlag:1},ie);let Pe=Buffer.from([...ve.openPositionWithTokenEx,...ie]);return new Be({keys:ye,programId:e,data:Pe})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:a,amountMaxA:s,amountMaxB:u,withMetadata:c,getEphemeralSigners:l,nft2022:p}){let m,d=[];if(l)m=new I((await l(1))[0]);else{let T=ln.generate();d.push(T),m=T.publicKey}let[y,f]=[new I(e.programId),new I(e.id)],b=N.getTickArrayStartIndexByTick(r,e.config.tickSpacing),P=N.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:x}=J(y,f,b),{publicKey:B}=J(y,f,P),{publicKey:K}=p?ne(n.wallet,m,me):ne(n.wallet,m,$),{publicKey:O}=ht(m),{publicKey:A}=Me(y,m),{publicKey:S}=et(y,f,r,o),v=p?this.openPositionFromLiquidityInstruction22(y,n.wallet,f,n.wallet,m,K,S,x,B,A,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(t.mintA.address),new I(t.mintB.address),r,o,b,P,a,s,u,c,de.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,P])?be(y,f).publicKey:void 0):this.openPositionFromLiquidityInstruction(y,n.wallet,f,n.wallet,m,K,O,S,x,B,A,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(t.mintA.address),new I(t.mintB.address),r,o,b,P,a,s,u,c,de.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,P])?be(y,f).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:x,tickArrayUpper:B,positionNftAccount:K,metadataAccount:O,personalPosition:A,protocolPosition:S},instructions:[v],signers:d,instructionTypes:[te.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o,a){let s=W([]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:nt.programId,isSigner:!1,isWritable:!1},{pubkey:a?me:$,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);s.encode({},c);let l=Buffer.from([...ve.closePosition,...c]);return new Be({keys:u,programId:e,data:l})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r,nft2022:o}){let a=new I(e.programId),s=o?ne(n.wallet,r.nftMint,me).publicKey:ne(n.wallet,r.nftMint,$).publicKey,{publicKey:u}=Me(a,r.nftMint),c=[];return c.push(this.closePositionInstruction(a,n.wallet,r.nftMint,s,u,o)),{address:{positionNftAccount:s,personalPosition:u},signers:[],instructions:c,instructionTypes:[te.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f,b,P,x){let B=W([V("liquidity"),k("amountMaxA"),k("amountMaxB"),q("optionBaseFlag"),Ae("baseFlag")]),K=[...x?[{pubkey:x,isSigner:!1,isWritable:!0}]:[]],O=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...K],A=Buffer.alloc(B.span);B.encode({liquidity:f,amountMaxA:b,amountMaxB:P,optionBaseFlag:0,baseFlag:!1},A);let S=Buffer.from([...ve.increaseLiquidity,...A]);return new Be({keys:O,programId:e,data:S})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:a,amountMaxB:s,nft2022:u}){let[c,l]=[new I(e.programId),new I(e.id)],p=N.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=N.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=J(c,l,p),{publicKey:y}=J(c,l,m),{publicKey:f}=u?ne(r.wallet,n.nftMint,me):ne(r.wallet,n.nftMint,$),{publicKey:b}=Me(c,n.nftMint),{publicKey:P}=et(c,l,n.tickLower,n.tickUpper),x=this.increasePositionFromLiquidityInstruction(c,r.wallet,f,b,l,P,d,y,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,a,s,de.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,m])?be(c,l).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:y,positionNftAccount:f,personalPosition:b,protocolPosition:P},signers:[],instructions:[x],instructionTypes:[te.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:a,otherAmountMax:s,nft2022:u}){let[c,l]=[new I(e.programId),new I(e.id)],p=N.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=N.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=J(c,l,p),{publicKey:y}=J(c,l,m),{publicKey:f}=u?ne(r.wallet,n.nftMint,me):ne(r.wallet,n.nftMint,$),{publicKey:b}=Me(c,n.nftMint),{publicKey:P}=et(c,l,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:y,positionNftAccount:f,personalPosition:b,protocolPosition:P},instructions:[this.increasePositionFromBaseInstruction(c,r.wallet,f,b,l,P,d,y,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,a,s,de.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,m])?be(c,l).publicKey:void 0)],signers:[],instructionTypes:[te.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f,b,P,x){let B=W([V("liquidity"),k("amountMaxA"),k("amountMaxB"),q("optionBaseFlag"),Ae("baseFlag")]),K=[...x?[{pubkey:x,isSigner:!1,isWritable:!0}]:[]],O=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...K],A=Buffer.alloc(B.span);B.encode({liquidity:new qn(0),amountMaxA:f==="MintA"?b:P,amountMaxB:f==="MintA"?P:b,baseFlag:f==="MintA",optionBaseFlag:1},A);let S=Buffer.from([...ve.increaseLiquidity,...A]);return new Be({keys:O,programId:e,data:S})}static decreaseLiquidityInstruction(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f,b,P,x,B){let K=W([V("liquidity"),k("amountMinA"),k("amountMinB")]),O=[...B?[{pubkey:B,isSigner:!1,isWritable:!0}]:[],...f.map(T=>[{pubkey:T.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:T.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:T.rewardMint,isSigner:!1,isWritable:!1}]).flat()],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:Jt,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...O],S=Buffer.alloc(K.span);K.encode({liquidity:b,amountMinA:P,amountMinB:x},S);let v=Buffer.from([...ve.decreaseLiquidity,...S]);return new Be({keys:A,programId:e,data:v})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:a,amountMinB:s,programId:u,nft2022:c}){let[l,p]=[new I(e.programId),new I(e.id)],m=N.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=N.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:y}=J(l,p,m),{publicKey:f}=J(l,p,d),{publicKey:b}=c?ne(r.wallet,n.nftMint,me):ne(r.wallet,n.nftMint,u),{publicKey:P}=Me(l,n.nftMint),{publicKey:x}=et(l,p,n.tickLower,n.tickUpper),B=[];for(let A=0;A<e.rewardDefaultInfos.length;A++)B.push({poolRewardVault:new I(t.rewardInfos[A].vault),ownerRewardVault:r.rewardAccounts[A],rewardMint:new I(e.rewardDefaultInfos[A].mint.address)});let K=[],O=this.decreaseLiquidityInstruction(l,r.wallet,b,P,p,x,y,f,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),B,o,a,s,de.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?be(l,p).publicKey:void 0);return K.push(O),{address:{tickArrayLower:y,tickArrayUpper:f,positionNftAccount:b,personalPosition:P,protocolPosition:x},signers:[],instructions:K,instructionTypes:[te.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,a,s,u,c,l,p,m,d,y,f,b,P){let x=W([k("amount"),k("otherAmountThreshold"),V("sqrtPriceLimitX64"),Ae("isBaseInput")]),B=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[],...p.map(S=>({pubkey:S,isSigner:!1,isWritable:!0}))],K=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:Jt,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...B],O=Buffer.alloc(x.span);x.encode({amount:d,otherAmountThreshold:y,sqrtPriceLimitX64:f,isBaseInput:b},O);let A=Buffer.from([...ve.swap,...O]);return new Be({keys:K,programId:e,data:A})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:a,amountOutMin:s,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,p]=[new I(e.programId),new I(e.id)],[m,d]=[new I(t.vault.A),new I(t.vault.B)],[y,f]=[new I(e.mintA.address),new I(e.mintB.address)],b=e.mintA.address===o.toString(),P=[this.swapInstruction(l,r.wallet,p,new I(e.config.id),b?r.tokenAccountA:r.tokenAccountB,b?r.tokenAccountB:r.tokenAccountA,b?m:d,b?d:m,b?y:f,b?f:y,c,n,a,s,u,!0,be(l,p).publicKey)];return{signers:[],instructions:P,instructionTypes:[te.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:a,amountInMax:s,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,p]=[new I(e.programId),new I(e.id)],[m,d]=[new I(t.vault.A),new I(t.vault.B)],[y,f]=[new I(e.mintA.address),new I(e.mintB.address)],b=e.mintA.address===o.toBase58(),P=[this.swapInstruction(l,r.wallet,p,new I(e.config.id),b?r.tokenAccountB:r.tokenAccountA,b?r.tokenAccountA:r.tokenAccountB,b?d:m,b?m:d,b?f:y,b?y:f,c,n,a,s,u,!1,be(l,p).publicKey)];return{signers:[],instructions:P,instructionTypes:[te.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,a,s,u,c,l,p,m){let d=W([k("openTime"),k("endTime"),V("emissionsPerSecondX64")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:nt.programId,isSigner:!1,isWritable:!1},{pubkey:Xe,isSigner:!1,isWritable:!1}],f=Buffer.alloc(d.span);d.encode({openTime:le(l),endTime:le(p),emissionsPerSecondX64:m},f);let b=Buffer.from([...ve.initReward,...f]);return new Be({keys:y,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,a]=[new I(e.programId),new I(e.id)],s=_i(o,a,r.mint).publicKey,u=cn(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,a,u,new I(e.config.id),n.tokenAccount,r.programId,r.mint,s,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:s,operationId:u},signers:[],instructions:c,instructionTypes:[te.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,a,s,u,c,l,p,m){let d=W([q("rewardIndex"),V("emissionsPerSecondX64"),k("openTime"),k("endTime")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(d.span);d.encode({rewardIndex:c,emissionsPerSecondX64:m,openTime:le(l),endTime:le(p)},f);let b=Buffer.from([...ve.setRewardEmissions,...f]);return new Be({keys:y,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,a]=[new I(e.programId),new I(e.id)],s,u,c;for(let m=0;m<e.rewardDefaultInfos.length;m++)e.rewardDefaultInfos[m].mint.address===r.mint.toString()&&(s=m,u=new I(t.rewardInfos[m].vault),c=new I(t.rewardInfos[m].mint.address));(s===void 0||u===void 0)&&Hi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=cn(o).publicKey,p=[this.setRewardInstruction(o,n.wallet,a,l,new I(e.config.id),n.tokenAccount,u,c,s,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:p,instructionTypes:[te.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,a,s){let u=W([q("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:Jt,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:s},l);let p=Buffer.from([...ve.collectReward,...l]);return new Be({keys:c,programId:e,data:p})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,a]=[new I(e.programId),new I(e.id)],s,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(s=l,u=new I(t.rewardInfos[l].vault));(s===void 0||u===void 0)&&Hi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,a,n.tokenAccount,u,r,s)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[te.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:r,wallet:o,nftMint:a,nft2022:s,getEphemeralSigners:u}){let c=[],l;if(u)l=new I((await u(1))[0]);else{let P=ln.generate();c.push(P),l=P.publicKey}let p=s?ne(o,a,me).publicKey:ne(o,a,$).publicKey,{publicKey:m}=Me(n,a),d=vn(e,l).publicKey,y=ne(o,l,$).publicKey,f=ht(l).publicKey,b=gt.lockPositionInstructionV2({programId:e,auth:t,payer:r,positionOwner:o,lockOwner:o,positionNftAccount:p,positionId:m,lockPositionId:d,lockNftMint:l,lockNftAccount:y,metadataAccount:f,withMetadata:!0,nft2022:s,positionNftMint:a,authPositionNftAccount:ne(t,a,s?me:$).publicKey,positionNftProgram:s?me:$});return{address:{positionId:m,lockPositionId:d,lockNftAccount:y,lockNftMint:l,positionNftAccount:p,metadataAccount:f},instructions:[b],signers:c,instructionTypes:[te.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:r,lockOwner:o,positionNftAccount:a,positionId:s,positionNftMint:u,authPositionNftAccount:c,positionNftProgram:l,lockPositionId:p,lockNftMint:m,lockNftAccount:d,metadataAccount:y,withMetadata:f}){let b=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!0,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1},{pubkey:Xe,isSigner:!1,isWritable:!1},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:nt.programId,isSigner:!1,isWritable:!1}],P=W([Ae("withMetadata")]),x=Buffer.alloc(P.span);P.encode({withMetadata:f},x);let B=Buffer.from([...Qi,...x]);return new Be({keys:b,programId:e,data:B})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:a}=ne(r,o,$),{publicKey:s}=Me(n,o),u=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:Wn(e,s).publicKey,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:nt.programId,isSigner:!1,isWritable:!1}];return new Be({keys:u,programId:e,data:Buffer.from(Qi)})}static harvestLockPositionInstruction(e){let[t,n]=[new I(e.poolKeys.programId),new I(e.poolKeys.id)],r=N.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=N.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:a}=J(t,n,r),{publicKey:s}=J(t,n,o),{publicKey:u}=ne(e.owner,e.ownerPosition.nftMint,$),{publicKey:c}=Me(t,e.ownerPosition.nftMint),{publicKey:l}=et(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),p=[];for(let y=0;y<e.poolKeys.rewardInfos.length;y++)p.push({poolRewardVault:new I(e.poolKeys.rewardInfos[y].vault),ownerRewardVault:e.ownerRewardAccounts[y],rewardMint:new I(e.poolKeys.rewardInfos[y].mint.address)});let m=[...p.map(y=>[{pubkey:y.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.rewardMint,isSigner:!1,isWritable:!1}]).flat()],d=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:Wn(e.programId,c).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new I(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new I(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:new I(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new I(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...m];return new Be({keys:d,programId:e.programId,data:Buffer.from(zi)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:r,lockOwner:o,lockNftMint:a,lockNftAccount:s,positionNftAccount:u,positionId:c,poolId:l,protocolPosition:p,vaultA:m,vaultB:d,tickArrayLower:y,tickArrayUpper:f,userVaultA:b,userVaultB:P,mintA:x,mintB:B,rewardAccounts:K,exTickArrayBitmap:O}){let A=[...O?[{pubkey:O,isSigner:!1,isWritable:!0}]:[],...K.map(v=>[{pubkey:v.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:v.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:v.rewardMint,isSigner:!1,isWritable:!1}]).flat()],S=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:P,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:x,isSigner:!1,isWritable:!1},{pubkey:B,isSigner:!1,isWritable:!1},...A];return new Be({keys:S,programId:e,data:Buffer.from(zi)})}};import{PublicKey as If,SystemProgram as xf,SYSVAR_RENT_PUBKEY as Sf,TransactionInstruction as ji}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Cf,TOKEN_PROGRAM_ID as Yi}from"@solana/spl-token";var Gn=W([q("instruction"),k("amountIn"),k("minAmountOut")]),Un=W([q("instruction"),k("maxAmountIn"),k("amountOut")]),ff=W([q("instruction"),q("nonce")]),ws=W([q("instruction"),q("nonce"),k("startTime")]),bf=W([k("status"),k("nonce"),k("maxOrder"),k("depth"),k("baseDecimal"),k("quoteDecimal"),k("state"),k("resetFlag"),k("minSize"),k("volMaxCutRatio"),k("amountWaveRatio"),k("baseLotSize"),k("quoteLotSize"),k("minPriceMultiplier"),k("maxPriceMultiplier"),k("systemDecimalValue"),k("minSeparateNumerator"),k("minSeparateDenominator"),k("tradeFeeNumerator"),k("tradeFeeDenominator"),k("pnlNumerator"),k("pnlDenominator"),k("swapFeeNumerator"),k("swapFeeDenominator"),k("baseNeedTakePnl"),k("quoteNeedTakePnl"),k("quoteTotalPnl"),k("baseTotalPnl"),k("poolOpenTime"),k("punishPcAmount"),k("punishCoinAmount"),k("orderbookToInitTime"),V("swapBaseInAmount"),V("swapQuoteOutAmount"),k("swapBase2QuoteFee"),V("swapQuoteInAmount"),V("swapBaseOutAmount"),k("swapQuote2BaseFee"),C("baseVault"),C("quoteVault"),C("baseMint"),C("quoteMint"),C("lpMint"),C("openOrders"),C("marketId"),C("marketProgramId"),C("targetOrders"),C("withdrawQueue"),C("lpVault"),C("owner"),k("lpReserve"),z(k(),3,"padding")]),yf=W([k("accountType"),k("status"),k("nonce"),k("maxOrder"),k("depth"),k("baseDecimal"),k("quoteDecimal"),k("state"),k("resetFlag"),k("minSize"),k("volMaxCutRatio"),k("amountWaveRatio"),k("baseLotSize"),k("quoteLotSize"),k("minPriceMultiplier"),k("maxPriceMultiplier"),k("systemDecimalsValue"),k("abortTradeFactor"),k("priceTickMultiplier"),k("priceTick"),k("minSeparateNumerator"),k("minSeparateDenominator"),k("tradeFeeNumerator"),k("tradeFeeDenominator"),k("pnlNumerator"),k("pnlDenominator"),k("swapFeeNumerator"),k("swapFeeDenominator"),k("baseNeedTakePnl"),k("quoteNeedTakePnl"),k("quoteTotalPnl"),k("baseTotalPnl"),k("poolOpenTime"),k("punishPcAmount"),k("punishCoinAmount"),k("orderbookToInitTime"),V("swapBaseInAmount"),V("swapQuoteOutAmount"),V("swapQuoteInAmount"),V("swapBaseOutAmount"),k("swapQuote2BaseFee"),k("swapBase2QuoteFee"),C("baseVault"),C("quoteVault"),C("baseMint"),C("quoteMint"),C("lpMint"),C("modelDataAccount"),C("openOrders"),C("marketId"),C("marketProgramId"),C("targetOrders"),C("owner"),z(k(),64,"padding")]),As=W([q("instruction"),k("baseAmountIn"),k("quoteAmountIn"),k("fixedSide"),k("otherAmountMin")]),hs=W([q("instruction"),k("lpAmount"),k("baseAmountMin"),k("quoteAmountMin")]);var gf=W([k("fee")]);import{PublicKey as Ts}from"@solana/web3.js";var Xn=new Ts("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Bs=5e4,Is=W([k("x"),k("y"),k("price")]),hf=W([k("accountType"),k("status"),k("multiplier"),k("validDataCount"),z(Is,Bs,"DataElement")]);var Zi=fe("Raydium_liquidity_instruction");function xs({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=Re(i),a=Buffer.alloc(Gn.span);Gn.encode({instruction:9,amountIn:le(t),minAmountOut:le(n)},a);let s=[g({pubkey:Yi,isWritable:!1}),g({pubkey:o.id}),g({pubkey:o.authority,isWritable:!1}),g({pubkey:o.openOrders})];return r===4&&s.push(g({pubkey:o.targetOrders})),s.push(g({pubkey:o.vault.A}),g({pubkey:o.vault.B})),r===5&&s.push(g({pubkey:Xn})),s.push(g({pubkey:o.marketProgramId,isWritable:!1}),g({pubkey:o.marketId}),g({pubkey:o.marketBids}),g({pubkey:o.marketAsks}),g({pubkey:o.marketEventQueue}),g({pubkey:o.marketBaseVault}),g({pubkey:o.marketQuoteVault}),g({pubkey:o.marketAuthority,isWritable:!1}),g({pubkey:e.tokenAccountIn}),g({pubkey:e.tokenAccountOut}),g({pubkey:e.owner,isWritable:!1,isSigner:!0})),new ji({programId:o.programId,keys:s,data:a})}function Ss({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=Re(i),a=Buffer.alloc(Un.span);Un.encode({instruction:11,maxAmountIn:le(t),amountOut:le(n)},a);let s=[g({pubkey:Yi,isWritable:!1}),g({pubkey:o.id}),g({pubkey:o.authority,isWritable:!1}),g({pubkey:o.openOrders}),g({pubkey:o.targetOrders}),g({pubkey:o.vault.A}),g({pubkey:o.vault.B})];return r===5&&s.push(g({pubkey:Xn})),s.push(g({pubkey:o.marketProgramId,isWritable:!1}),g({pubkey:o.marketId}),g({pubkey:o.marketBids}),g({pubkey:o.marketAsks}),g({pubkey:o.marketEventQueue}),g({pubkey:o.marketBaseVault}),g({pubkey:o.marketQuoteVault}),g({pubkey:o.marketAuthority,isWritable:!1}),g({pubkey:e.tokenAccountIn}),g({pubkey:e.tokenAccountOut}),g({pubkey:e.owner,isWritable:!1,isSigner:!0})),new ji({programId:o.programId,keys:s,data:a})}function Ji(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:a}=i;if(t===4||t===5){let s={poolKeys:e,userKeys:n};if(a==="in")return xs({...s,amountIn:r,minAmountOut:o},t);if(a==="out")return Ss({...s,maxAmountIn:r,amountOut:o},t);Zi.logWithError("invalid params","params",i)}throw Zi.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}var Df=W([Se(8),q("bump"),Ae("disableCreatePool"),dt("index"),k("tradeFeeRate"),k("protocolFeeRate"),k("fundFeeRate"),k("createPoolFee"),C("protocolOwner"),C("fundOwner"),z(k(),16)]),qf=W([Se(8),C("configId"),C("poolCreator"),C("vaultA"),C("vaultB"),C("mintLp"),C("mintA"),C("mintB"),C("mintProgramA"),C("mintProgramB"),C("observationId"),q("bump"),q("status"),q("lpDecimals"),q("mintDecimalA"),q("mintDecimalB"),k("lpAmount"),k("protocolFeesMintA"),k("protocolFeesMintB"),k("fundFeesMintA"),k("fundFeesMintB"),k("openTime"),z(k(),32)]);import{PublicKey as ib,TransactionInstruction as Ks,Keypair as ob,SystemProgram as sb}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as ub,TOKEN_2022_PROGRAM_ID as cb,TOKEN_PROGRAM_ID as lb}from"@solana/spl-token";var Xf=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Hf=Buffer.from("amm_config","utf8"),Qf=Buffer.from("pool","utf8"),zf=Buffer.from("pool_lp_mint","utf8"),Zf=Buffer.from("pool_vault","utf8"),jf=Buffer.from("observation","utf8");var Yf=Buffer.from("locked_liquidity","utf8");var yb=fe("Raydium_cpmm"),Cs={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function $i(i,e,t,n,r,o,a,s,u,c,l,p,m,d,y,f){let b=W([k("amountIn"),k("amounOutMin")]),P=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0}],x=Buffer.alloc(b.span);return b.encode({amountIn:y,amounOutMin:f},x),new Ks({keys:P,programId:i,data:Buffer.from([...Cs.swapBaseInput,...x])})}import Rb from"bn.js";import Eb from"decimal.js-light";import Ns from"bn.js";var hb=new Ns(0);function iy(i,e,t,n,r,o,a,s,u,c,l,p){let m=W([q("instruction"),k("amountIn"),k("amountOut")]),d=[{pubkey:vt.programId,isSigner:!1,isWritable:!1},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:new w(t.programId),isSigner:!1,isWritable:!1},{pubkey:new w(t.id),isSigner:!1,isWritable:!0},{pubkey:new w(n.id),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=Re(t);d.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...p.map(b=>({pubkey:b,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=Re(t);d.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new w("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=Re(t);d.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let y=Buffer.alloc(m.span);return m.encode({instruction:4,amountIn:c,amountOut:l},y),new Ft({keys:d,programId:i,data:y})}function ry(i,e,t,n,r,o,a,s,u,c){let l=W([q("instruction")]),p=[{pubkey:vt.programId,isSigner:!1,isWritable:!1},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:new w(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new w(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new w(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let d=Re(n);p.push({pubkey:d.config.id,isSigner:!1,isWritable:!1},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.mintA.address.equals(u)?d.vault.A:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.mintA.address.equals(u)?d.vault.B:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0},...c.map(y=>({pubkey:y,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let d=Re(n);p.push({pubkey:d.authority,isSigner:!1,isWritable:!1},{pubkey:d.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:new w("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:d.openOrders,isSigner:!1,isWritable:!0},{pubkey:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.marketId,isSigner:!1,isWritable:!0},{pubkey:d.marketBids,isSigner:!1,isWritable:!0},{pubkey:d.marketAsks,isSigner:!1,isWritable:!0},{pubkey:d.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0})}else{let d=Re(n);p.push({pubkey:d.authority,isSigner:!1,isWritable:!1},{pubkey:d.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:d.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:d.openOrders,isSigner:!1,isWritable:!0},{pubkey:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.marketId,isSigner:!1,isWritable:!0},{pubkey:d.marketBids,isSigner:!1,isWritable:!0},{pubkey:d.marketAsks,isSigner:!1,isWritable:!0},{pubkey:d.marketEventQueue,isSigner:!1,isWritable:!0},...d.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:d.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:d.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0}])}let m=Buffer.alloc(l.span);return l.encode({instruction:5},m),new Ft({keys:p,programId:i,data:m})}function Ls(i,e,t,n,r,o,a,s,u,c,l,p,m,d,y){let f=[],b=[g({pubkey:pt,isWritable:!1}),g({pubkey:Qn,isWritable:!1}),g({pubkey:Hn,isWritable:!1}),g({pubkey:vt.programId,isWritable:!1}),g({pubkey:e,isSigner:!0})];b.push(g({pubkey:t})),b.push(g({pubkey:r}));let P=[u,c],x=[l,p],B=[o,a,s];for(let A=0;A<P.length;A++){let S=P[A],v=B[A]===S.mintA.address;if(b.push(g({pubkey:new w(S.programId),isWritable:!1})),A===P.length-1?b.push(g({pubkey:r})):b.push(g({pubkey:n})),b.push(g({pubkey:new w(B[A])})),b.push(g({pubkey:new w(B[A+1])})),S.version===6){let T=x[A];b.push(g({pubkey:new w(T.config.id)})),b.push(g({pubkey:new w(T.id)})),b.push(g({pubkey:new w(v?T.vault.A:T.vault.B)})),b.push(g({pubkey:new w(v?T.vault.B:T.vault.A)})),b.push(g({pubkey:new w(S.observationId)})),b.push(g({pubkey:ct})),b.push(g({pubkey:be(new w(S.programId),new w(S.id)).publicKey})),f.push(zn(S.sqrtPriceX64.toString(),v));for(let U of y[A]??[])b.push(g({pubkey:new w(U)}))}else if(S.version===5){let T=x[A];b.push(g({pubkey:new w(T.id)})),b.push(g({pubkey:new w(T.authority),isWritable:!1})),b.push(g({pubkey:new w(T.marketProgramId)})),b.push(g({pubkey:new w(T.marketAuthority)})),b.push(g({pubkey:en,isWritable:!1})),b.push(g({pubkey:new w(T.openOrders)})),b.push(g({pubkey:new w(T.vault.A)})),b.push(g({pubkey:new w(T.vault.B)})),b.push(g({pubkey:new w(T.id)})),b.push(g({pubkey:new w(T.id)})),b.push(g({pubkey:new w(T.id)})),b.push(g({pubkey:new w(T.id)})),b.push(g({pubkey:new w(T.id)})),b.push(g({pubkey:new w(T.id)})),b.push(g({pubkey:new w(T.marketId)})),b.push(g({pubkey:new w(T.marketBids)})),b.push(g({pubkey:new w(T.marketAsks)})),b.push(g({pubkey:new w(T.marketEventQueue)})),b.push(g({pubkey:new w(T.marketBaseVault)})),b.push(g({pubkey:new w(T.marketQuoteVault)}))}else if(S.version===4){let T=x[A],U=S.status!==1;b.push(g({pubkey:new w(T.id)})),b.push(g({pubkey:new w(T.authority),isWritable:!1})),b.push(g({pubkey:new w(U?T.id:T.marketProgramId)})),b.push(g({pubkey:new w(U?T.id:T.marketAuthority)})),b.push(g({pubkey:new w(U?T.id:T.openOrders)})),b.push(g({pubkey:new w(T.vault.A)})),b.push(g({pubkey:new w(T.vault.B)})),b.push(g({pubkey:new w(U?T.id:T.marketId)})),b.push(g({pubkey:new w(U?T.id:T.marketBids)})),b.push(g({pubkey:new w(U?T.id:T.marketAsks)})),b.push(g({pubkey:new w(U?T.id:T.marketEventQueue)})),b.push(g({pubkey:new w(U?T.id:T.marketBaseVault)})),b.push(g({pubkey:new w(U?T.id:T.marketQuoteVault)}))}else if(S.version===7){let T=x[A];b.push(g({pubkey:new w(T.authority)})),b.push(g({pubkey:new w(T.config.id)})),b.push(g({pubkey:new w(T.id)})),b.push(g({pubkey:new w(v?T.vault.A:T.vault.B)})),b.push(g({pubkey:new w(v?T.vault.B:T.vault.A)})),b.push(g({pubkey:new w(S.observationId)}))}else throw Error("pool type error")}let K=W([q("insId"),k("amountIn"),k("amountOut"),z(V(),f.length,"clmmPriceLimit")]),O=Buffer.alloc(K.span);return K.encode({insId:0,amountIn:m,amountOut:d,clmmPriceLimit:f},O),new Ft({keys:b,programId:i,data:O})}function zn(i,e){if(i)if(e){let t=new Ze(i).div(new Ze(25));return t.gt(on)?t:on}else{let t=new Ze(i).mul(new Ze(25));return t.lt(sn)?t:sn}else return e?on:sn}function oy({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){if(n.routeType==="amm")if(n.poolInfo[0].version===6){let r=n.poolKey[0],o=Re(r),a=t.equals(o.mintA.address)?He.add(Oe):Qe.sub(Oe);return gt.makeSwapBaseInInstructions({poolInfo:r,poolKeys:r,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:o.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:o.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub(n.minAmountOut.fee?.raw??new Ze(0)),sqrtPriceLimitX64:a,remainingAccounts:n.remainingAccounts[0]??[]})}else if(n.poolInfo[0].version===7){let r=n.poolInfo[0],o=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[$i(r.programId,e.wallet,r.authority,r.configId,r.id,e.sourceToken,e.destinationToken,o?r.vaultA:r.vaultB,o?r.vaultB:r.vaultA,o?r.mintProgramA:r.mintProgramB,o?r.mintProgramB:r.mintProgramA,new w(r[o?"mintA":"mintB"].address),new w(r[o?"mintB":"mintA"].address),r.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[o?te.CpmmSwapBaseIn:te.CpmmSwapBaseOut],address:{}}}else{let r=n.poolKey[0];return{signers:[],instructions:[Ji({poolKeys:r,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub(n.minAmountOut.fee?.raw??new Ze(0)),fixedSide:"in"})],lookupTableAddress:r.lookupTableAccount?[r.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?te.AmmV5SwapBaseIn:te.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let r=n.poolInfo[0],o=n.poolInfo[1],a=n.poolKey[0],s=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[Ls(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),r,o,a,s,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub(n.minAmountOut.fee?.raw??new Ze(0)),n.remainingAccounts)],instructionTypes:[te.RouteSwap],lookupTableAddress:[a.lookupTableAccount,s.lookupTableAccount].filter(u=>u!==void 0),address:{}}}else throw Error("route type error")}function sy({programId:i,wallet:e,amount:t,inputAccount:n,outputAccount:r,routeInfo:o,poolKeys:a}){if(o.success===!1)throw Error("route info error");let s=[],u=[g({pubkey:pt,isWritable:!1}),g({pubkey:Qn,isWritable:!1}),g({pubkey:Hn,isWritable:!1}),g({pubkey:vt.programId,isWritable:!1}),g({pubkey:e,isSigner:!0})],c={[o.data.inputMint]:n,[o.data.outputMint]:r};u.push(g({pubkey:c[o.data.inputMint]})),u.push(g({pubkey:c[o.data.outputMint]}));for(let m=0;m<a.length;m++){let d=o.data.routePlan[m],y=a[m],f=d.inputMint===y.mintA.address;if(u.push(g({pubkey:new w(y.programId),isWritable:!1})),m===a.length-1)u.push(g({pubkey:c[d.outputMint]}));else{let b=d.outputMint;if(c[b]===void 0){let P=ne(e,new w(b),y.programId===Ce.CLMM_PROGRAM_ID.toBase58()||y.programId===Ce.CREATE_CPMM_POOL_PROGRAM.toBase58()?new w(f?y.mintB.programId:y.mintA.programId):pt).publicKey;c[b]=P}u.push(g({pubkey:c[b]}))}if(u.push(g({pubkey:new w(d.inputMint)})),u.push(g({pubkey:new w(d.outputMint)})),y.programId===Ce.CLMM_PROGRAM_ID.toBase58()){let b=y;u.push(g({pubkey:new w(b.config.id)})),u.push(g({pubkey:new w(b.id)})),u.push(g({pubkey:new w(f?b.vault.A:b.vault.B)})),u.push(g({pubkey:new w(f?b.vault.B:b.vault.A)})),u.push(g({pubkey:new w(b.observationId)})),u.push(g({pubkey:ct,isWritable:!1})),u.push(g({pubkey:new w(b.exBitmapAccount)})),s.push(zn(d.lastPoolPriceX64,f));for(let P of d.remainingAccounts??[])u.push(g({pubkey:new w(P)}))}else if(y.programId===Ce.AMM_STABLE.toBase58()){let b=y;u.push(g({pubkey:new w(b.id)})),u.push(g({pubkey:new w(b.authority),isWritable:!1})),u.push(g({pubkey:new w(b.marketProgramId),isWritable:!1})),u.push(g({pubkey:new w(b.marketAuthority),isWritable:!1})),u.push(g({pubkey:en,isWritable:!1})),u.push(g({pubkey:new w(b.openOrders)})),u.push(g({pubkey:new w(b.vault.A)})),u.push(g({pubkey:new w(b.vault.B)})),u.push(g({pubkey:new w(b.marketId)})),u.push(g({pubkey:new w(b.marketBids)})),u.push(g({pubkey:new w(b.marketAsks)})),u.push(g({pubkey:new w(b.marketEventQueue)})),u.push(g({pubkey:new w(b.marketBaseVault)})),u.push(g({pubkey:new w(b.marketQuoteVault)}))}else if(y.programId===Ce.AMM_V4.toBase58()){let b=y;u.push(g({pubkey:new w(b.id)})),u.push(g({pubkey:new w(b.authority),isWritable:!1})),u.push(g({pubkey:new w(b.id)})),u.push(g({pubkey:new w(b.id)})),u.push(g({pubkey:new w(b.id)})),u.push(g({pubkey:new w(b.vault.A)})),u.push(g({pubkey:new w(b.vault.B)})),u.push(g({pubkey:new w(b.id)})),u.push(g({pubkey:new w(b.id)})),u.push(g({pubkey:new w(b.id)})),u.push(g({pubkey:new w(b.id)})),u.push(g({pubkey:new w(b.id)})),u.push(g({pubkey:new w(b.id)}))}else if(y.programId===Ce.CREATE_CPMM_POOL_PROGRAM.toBase58()){let b=y;u.push(g({pubkey:new w(b.authority)})),u.push(g({pubkey:new w(b.config.id)})),u.push(g({pubkey:new w(b.id)})),u.push(g({pubkey:new w(f?b.vault.A:b.vault.B)})),u.push(g({pubkey:new w(f?b.vault.B:b.vault.A)})),u.push(g({pubkey:new w(b.observationId)}))}else throw Error("pool type error")}let l=W([q("insId"),k("amountIn"),k("amountOut"),z(V(),s.length,"clmmPriceLimit")]),p=Buffer.alloc(l.span);return l.encode({insId:0,amountIn:t,amountOut:new Ze(o.data.otherAmountThreshold),clmmPriceLimit:s},p),new Ft({keys:u,programId:i,data:p})}function ay({programId:i,wallet:e,inputAccount:t,outputAccount:n,routeInfo:r,poolKeys:o}){if(r.success===!1)throw Error("route info error");let a=[],s=[g({pubkey:pt,isWritable:!1}),g({pubkey:Qn,isWritable:!1}),g({pubkey:Hn,isWritable:!1}),g({pubkey:vt.programId,isWritable:!1}),g({pubkey:e,isSigner:!0})],u={[r.data.inputMint]:t,[r.data.outputMint]:n};for(let p=o.length-1;p>=0;p--){let m=r.data.routePlan[p],d=o[p],y=m.inputMint===d.mintA.address;if(s.push(g({pubkey:new w(d.programId)})),p===0)s.push(g({pubkey:u[m.inputMint]}));else{let f=m.inputMint;if(u[f]===void 0){let b=ne(e,new w(f),d.programId===Ce.CLMM_PROGRAM_ID.toBase58()||d.programId===Ce.CREATE_CPMM_POOL_PROGRAM.toBase58()?new w(y?d.mintA.programId:d.mintB.programId):pt).publicKey;u[f]=b}s.push(g({pubkey:u[f]}))}if(p===o.length-1)s.push(g({pubkey:u[m.outputMint]}));else{let f=m.outputMint;if(u[f]===void 0){let b=ne(e,new w(f),d.programId===Ce.CLMM_PROGRAM_ID.toBase58()||d.programId===Ce.CREATE_CPMM_POOL_PROGRAM.toBase58()?new w(y?d.mintB.programId:d.mintA.programId):pt).publicKey;u[f]=b}s.push(g({pubkey:u[f]}))}if(s.push(g({pubkey:new w(m.inputMint)})),s.push(g({pubkey:new w(m.outputMint)})),d.programId===Ce.CLMM_PROGRAM_ID.toBase58()){let f=d;s.push(g({pubkey:new w(f.config.id)})),s.push(g({pubkey:new w(f.id)})),s.push(g({pubkey:new w(y?f.vault.A:f.vault.B)})),s.push(g({pubkey:new w(y?f.vault.B:f.vault.A)})),s.push(g({pubkey:new w(f.observationId)})),s.push(g({pubkey:ct,isWritable:!1})),s.push(g({pubkey:new w(f.exBitmapAccount)})),a.push(zn(m.lastPoolPriceX64,y));for(let b of m.remainingAccounts??[])s.push(g({pubkey:new w(b)}))}else if(d.programId===Ce.AMM_STABLE.toBase58()){let f=d;s.push(g({pubkey:new w(f.id)})),s.push(g({pubkey:new w(f.authority),isWritable:!1})),s.push(g({pubkey:new w(f.marketProgramId),isWritable:!1})),s.push(g({pubkey:new w(f.marketAuthority),isWritable:!1})),s.push(g({pubkey:en,isWritable:!1})),s.push(g({pubkey:new w(f.openOrders)})),s.push(g({pubkey:new w(f.vault.A)})),s.push(g({pubkey:new w(f.vault.B)})),s.push(g({pubkey:new w(f.marketId)})),s.push(g({pubkey:new w(f.marketBids)})),s.push(g({pubkey:new w(f.marketAsks)})),s.push(g({pubkey:new w(f.marketEventQueue)})),s.push(g({pubkey:new w(f.marketBaseVault)})),s.push(g({pubkey:new w(f.marketQuoteVault)}))}else if(d.programId===Ce.AMM_V4.toBase58()){let f=d;s.push(g({pubkey:new w(f.id)})),s.push(g({pubkey:new w(f.authority),isWritable:!1})),s.push(g({pubkey:new w(f.id)})),s.push(g({pubkey:new w(f.id)})),s.push(g({pubkey:new w(f.id)})),s.push(g({pubkey:new w(f.vault.A)})),s.push(g({pubkey:new w(f.vault.B)})),s.push(g({pubkey:new w(f.id)})),s.push(g({pubkey:new w(f.id)})),s.push(g({pubkey:new w(f.id)})),s.push(g({pubkey:new w(f.id)})),s.push(g({pubkey:new w(f.id)})),s.push(g({pubkey:new w(f.id)}))}else if(d.programId===Ce.CREATE_CPMM_POOL_PROGRAM.toBase58()){let f=d;s.push(g({pubkey:new w(f.authority)})),s.push(g({pubkey:new w(f.config.id)})),s.push(g({pubkey:new w(f.id)})),s.push(g({pubkey:new w(y?f.vault.A:f.vault.B)})),s.push(g({pubkey:new w(y?f.vault.B:f.vault.A)})),s.push(g({pubkey:new w(f.observationId)}))}else throw Error("pool type error")}let c=W([q("insId"),k("amountIn"),k("amountOut"),z(V(),a.length,"clmmPriceLimit")]),l=Buffer.alloc(c.span);return c.encode({insId:1,amountIn:new Ze(r.data.otherAmountThreshold),amountOut:new Ze(r.data.outputAmount),clmmPriceLimit:a},l),new Ft({keys:s,programId:i,data:l})}export{oy as makeSwapInstruction,iy as route1Instruction,ry as route2Instruction,Ls as routeInstruction,sy as swapBaseInAutoAccount,ay as swapBaseOutAutoAccount};
//# sourceMappingURL=instrument.mjs.map