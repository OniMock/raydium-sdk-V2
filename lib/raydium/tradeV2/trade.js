var No=Object.create;var Ut=Object.defineProperty;var Lo=Object.getOwnPropertyDescriptor;var Ro=Object.getOwnPropertyNames;var Mo=Object.getPrototypeOf,Oo=Object.prototype.hasOwnProperty;var Eo=(i,e,t)=>e in i?Ut(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var vo=(i,e)=>{for(var t in e)Ut(i,t,{get:e[t],enumerable:!0})},Hi=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ro(e))!Oo.call(i,r)&&r!==t&&Ut(i,r,{get:()=>e[r],enumerable:!(n=Lo(e,r))||n.enumerable});return i};var ae=(i,e,t)=>(t=i!=null?No(Mo(i)):{},Hi(e||!i||!i.__esModule?Ut(t,"default",{value:i,enumerable:!0}):t,i)),_o=i=>Hi(Ut({},"__esModule",{value:!0}),i);var dn=(i,e,t)=>(Eo(i,typeof e!="symbol"?e+"":e,t),t);var za={};vo(za,{default:()=>Hn});module.exports=_o(za);var wt=require("@solana/web3.js"),oe=require("@solana/spl-token"),mn=ae(require("bn.js"));var Lt=9e15,ft=1e9,Qn="0123456789abcdef",bn="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",yn="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",jn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Lt,maxE:Lt,crypto:!1},Yi,rt,G=!0,Pn="[DecimalError] ",dt=Pn+"Invalid argument: ",Ji=Pn+"Precision limit exceeded",$i=Pn+"crypto unavailable",er="[object Decimal]",Ke=Math.floor,Te=Math.pow,Fo=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Wo=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Vo=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,tr=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ge=1e7,D=7,Do=9007199254740991,qo=bn.length-1,Zn=yn.length-1,S={toStringTag:er};S.absoluteValue=S.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),F(i)};S.ceil=function(){return F(new this.constructor(this),this.e+1,2)};S.clampedTo=S.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(dt+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};S.comparedTo=S.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,c=o.s,u=i.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==i.e)return o.e>i.e^c<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===r?0:n>r^c<0?1:-1};S.cosine=S.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+D,n.rounding=1,t=Uo(n,sr(n,t)),n.precision=i,n.rounding=e,F(rt==2||rt==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};S.cubeRoot=S.cbrt=function(){var i,e,t,n,r,o,s,a,c,u,l=this,p=l.constructor;if(!l.isFinite()||l.isZero())return new p(l);for(G=!1,o=l.s*Te(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=Se(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=Te(t,1/3),i=Ke((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new p(t),n.s=l.s):n=new p(o.toString()),s=(i=p.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=ce(u.plus(l).times(a),u.plus(c),s+2,1),Se(a.d).slice(0,s)===(t=Se(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(F(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(F(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return G=!0,F(n,i,p.rounding,e)};S.decimalPlaces=S.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-Ke(this.e/D))*D,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};S.dividedBy=S.div=function(i){return ce(this,new this.constructor(i))};S.dividedToIntegerBy=S.divToInt=function(i){var e=this,t=e.constructor;return F(ce(e,new t(i),0,1,1),t.precision,t.rounding)};S.equals=S.eq=function(i){return this.cmp(i)===0};S.floor=function(){return F(new this.constructor(this),this.e+1,3)};S.greaterThan=S.gt=function(i){return this.cmp(i)>0};S.greaterThanOrEqualTo=S.gte=function(i){var e=this.cmp(i);return e==1||e===0};S.hyperbolicCosine=S.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/An(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=Rt(s,1,o.times(e),new s(1),!0);for(var c,u=i,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return F(o,s.precision=t,s.rounding=n,!0)};S.hyperbolicSine=S.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=Rt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/An(5,i)),r=Rt(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,F(r,e,t,!0)};S.hyperbolicTangent=S.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,ce(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};S.inverseCosine=S.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Ue(t,r,o):new t(0):new t(NaN):e.isZero()?Ue(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Ue(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};S.inverseHyperbolicCosine=S.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,G=!1,t=t.times(t).minus(1).sqrt().plus(t),G=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};S.inverseHyperbolicSine=S.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,G=!1,t=t.times(t).plus(1).sqrt().plus(t),G=!0,n.precision=i,n.rounding=e,t.ln())};S.inverseHyperbolicTangent=S.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?F(new o(r),i,e,!0):(o.precision=t=n-r.e,r=ce(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};S.inverseSine=S.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Ue(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};S.inverseTangent=S.atan=function(){var i,e,t,n,r,o,s,a,c,u=this,l=u.constructor,p=l.precision,m=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&p+4<=Zn)return s=Ue(l,p+4,m).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(p+4<=Zn)return s=Ue(l,p+4,m).times(.5),s.s=u.s,s}for(l.precision=a=p+10,l.rounding=1,t=Math.min(28,a/D+2|0),i=t;i;--i)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(G=!1,e=Math.ceil(a/D),n=1,c=u.times(u),s=new l(u),r=u;i!==-1;)if(r=r.times(c),o=s.minus(r.div(n+=2)),r=r.times(c),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),G=!0,F(s,l.precision=p,l.rounding=m,!0)};S.isFinite=function(){return!!this.d};S.isInteger=S.isInt=function(){return!!this.d&&Ke(this.e/D)>this.d.length-2};S.isNaN=function(){return!this.s};S.isNegative=S.isNeg=function(){return this.s<0};S.isPositive=S.isPos=function(){return this.s>0};S.isZero=function(){return!!this.d&&this.d[0]===0};S.lessThan=S.lt=function(i){return this.cmp(i)<0};S.lessThanOrEqualTo=S.lte=function(i){return this.cmp(i)<1};S.logarithm=S.log=function(i){var e,t,n,r,o,s,a,c,u=this,l=u.constructor,p=l.precision,m=l.rounding,d=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(G=!1,a=p+d,s=pt(u,a),n=e?gn(l,a+10):pt(i,a),c=ce(s,n,a,1),Gt(c.d,r=p,m))do if(a+=10,s=pt(u,a),n=e?gn(l,a+10):pt(i,a),c=ce(s,n,a,1),!o){+Se(c.d).slice(r+1,r+15)+1==1e14&&(c=F(c,p+1,0));break}while(Gt(c.d,r+=10,m));return G=!0,F(c,p,m)};S.minus=S.sub=function(i){var e,t,n,r,o,s,a,c,u,l,p,m,d=this,f=d.constructor;if(i=new f(i),!d.d||!i.d)return!d.s||!i.s?i=new f(NaN):d.d?i.s=-i.s:i=new f(i.d||d.s!==i.s?d:NaN),i;if(d.s!=i.s)return i.s=-i.s,d.plus(i);if(u=d.d,m=i.d,a=f.precision,c=f.rounding,!u[0]||!m[0]){if(m[0])i.s=-i.s;else if(u[0])i=new f(d);else return new f(c===3?-0:0);return G?F(i,a,c):i}if(t=Ke(i.e/D),l=Ke(d.e/D),u=u.slice(),o=l-t,o){for(p=o<0,p?(e=u,o=-o,s=m.length):(e=m,t=l,s=u.length),n=Math.max(Math.ceil(a/D),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=m.length,p=n<s,p&&(s=n),n=0;n<s;n++)if(u[n]!=m[n]){p=u[n]<m[n];break}o=0}for(p&&(e=u,u=m,m=e,i.s=-i.s),s=u.length,n=m.length-s;n>0;--n)u[s++]=0;for(n=m.length;n>o;){if(u[--n]<m[n]){for(r=n;r&&u[--r]===0;)u[r]=Ge-1;--u[r],u[n]+=Ge}u[n]-=m[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(i.d=u,i.e=kn(u,t),G?F(i,a,c):i):new f(c===3?-0:0)};S.modulo=S.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?F(new n(t),n.precision,n.rounding):(G=!1,n.modulo==9?(e=ce(t,i.abs(),0,3,1),e.s*=i.s):e=ce(t,i,0,n.modulo,1),e=e.times(i),G=!0,t.minus(e))};S.naturalExponential=S.exp=function(){return Yn(this)};S.naturalLogarithm=S.ln=function(){return pt(this)};S.negated=S.neg=function(){var i=new this.constructor(this);return i.s=-i.s,F(i)};S.plus=S.add=function(i){var e,t,n,r,o,s,a,c,u,l,p=this,m=p.constructor;if(i=new m(i),!p.d||!i.d)return!p.s||!i.s?i=new m(NaN):p.d||(i=new m(i.d||p.s===i.s?p:NaN)),i;if(p.s!=i.s)return i.s=-i.s,p.minus(i);if(u=p.d,l=i.d,a=m.precision,c=m.rounding,!u[0]||!l[0])return l[0]||(i=new m(p)),G?F(i,a,c):i;if(o=Ke(p.e/D),n=Ke(i.e/D),u=u.slice(),r=o-n,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,n=o,s=u.length),o=Math.ceil(a/D),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/Ge|0,u[r]%=Ge;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return i.d=u,i.e=kn(u,n),G?F(i,a,c):i};S.precision=S.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(dt+i);return t.d?(e=nr(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};S.round=function(){var i=this,e=i.constructor;return F(new e(i),i.e+1,e.rounding)};S.sine=S.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+D,n.rounding=1,t=Xo(n,sr(n,t)),n.precision=i,n.rounding=e,F(rt>2?t.neg():t,i,e,!0)):new n(NaN)};S.squareRoot=S.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(G=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=Se(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=Ke((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new l(e)):n=new l(u.toString()),t=(c=l.precision)+3;;)if(o=n,n=o.plus(ce(s,o,t+2,1)).times(.5),Se(o.d).slice(0,t)===(e=Se(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(F(o,c+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(F(n,c+1,1),i=!n.times(n).eq(s));break}return G=!0,F(n,c,l.rounding,i)};S.tangent=S.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=ce(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,F(rt==2||rt==4?t.neg():t,i,e,!0)):new n(NaN)};S.times=S.mul=function(i){var e,t,n,r,o,s,a,c,u,l=this,p=l.constructor,m=l.d,d=(i=new p(i)).d;if(i.s*=l.s,!m||!m[0]||!d||!d[0])return new p(!i.s||m&&!m[0]&&!d||d&&!d[0]&&!m?NaN:!m||!d?i.s/0:i.s*0);for(t=Ke(l.e/D)+Ke(i.e/D),c=m.length,u=d.length,c<u&&(o=m,m=d,d=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(e=0,r=c+n;r>n;)a=o[r]+d[n]*m[r-n-1]+e,o[r--]=a%Ge|0,e=a/Ge|0;o[r]=(o[r]+e)%Ge|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=kn(o,t),G?F(i,p.precision,p.rounding):i};S.toBinary=function(i,e){return $n(this,2,i,e)};S.toDecimalPlaces=S.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Re(i,0,ft),e===void 0?e=n.rounding:Re(e,0,8),F(t,i+t.e+1,e))};S.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Ze(n,!0):(Re(i,0,ft),e===void 0?e=r.rounding:Re(e,0,8),n=F(new r(n),i+1,e),t=Ze(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};S.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Ze(r):(Re(i,0,ft),e===void 0?e=o.rounding:Re(e,0,8),n=F(new o(r),i+r.e+1,e),t=Ze(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};S.toFraction=function(i){var e,t,n,r,o,s,a,c,u,l,p,m,d=this,f=d.d,b=d.constructor;if(!f)return new b(d);if(u=t=new b(1),n=c=new b(0),e=new b(n),o=e.e=nr(f)-d.e-1,s=o%D,e.d[0]=Te(10,s<0?D+s:s),i==null)i=o>0?e:u;else{if(a=new b(i),!a.isInt()||a.lt(u))throw Error(dt+a);i=a.gt(e)?o>0?e:u:a}for(G=!1,a=new b(Se(f)),l=b.precision,b.precision=o=f.length*D*2;p=ce(a,e,0,1,1),r=t.plus(p.times(n)),r.cmp(i)!=1;)t=n,n=r,r=u,u=c.plus(p.times(r)),c=r,r=e,e=a.minus(p.times(r)),a=r;return r=ce(i.minus(t),n,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(n)),c.s=u.s=d.s,m=ce(u,n,o,1).minus(d).abs().cmp(ce(c,t,o,1).minus(d).abs())<1?[u,n]:[c,t],b.precision=l,G=!0,m};S.toHexadecimal=S.toHex=function(i,e){return $n(this,16,i,e)};S.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Re(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(G=!1,t=ce(t,i,0,e,1).times(i),G=!0,F(t)):(i.s=t.s,t=i),t};S.toNumber=function(){return+this};S.toOctal=function(i,e){return $n(this,8,i,e)};S.toPower=S.pow=function(i){var e,t,n,r,o,s,a=this,c=a.constructor,u=+(i=new c(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new c(Te(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,i.eq(1))return F(a,n,o);if(e=Ke(i.e/D),e>=i.d.length-1&&(t=u<0?-u:u)<=Do)return r=ir(c,a,t,n),i.s<0?new c(1).div(r):F(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new c(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=Te(+a,u),e=t==0||!isFinite(t)?Ke(u*(Math.log("0."+Se(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(G=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=Yn(i.times(pt(a,n+t)),n),r.d&&(r=F(r,n+5,1),Gt(r.d,n,o)&&(e=n+10,r=F(Yn(i.times(pt(a,e+t)),e),e+5,1),+Se(r.d).slice(n+1,n+15)+1==1e14&&(r=F(r,n+1,0)))),r.s=s,G=!0,c.rounding=o,F(r,n,o))};S.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Ze(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Re(i,1,ft),e===void 0?e=r.rounding:Re(e,0,8),n=F(new r(n),i,e),t=Ze(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};S.toSignificantDigits=S.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Re(i,1,ft),e===void 0?e=n.rounding:Re(e,0,8)),F(new n(t),i,e)};S.toString=function(){var i=this,e=i.constructor,t=Ze(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};S.truncated=S.trunc=function(){return F(new this.constructor(this),this.e+1,1)};S.valueOf=S.toJSON=function(){var i=this,e=i.constructor,t=Ze(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function Se(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=D-n.length,t&&(o+=mt(t)),o+=n;s=i[e],n=s+"",t=D-n.length,t&&(o+=mt(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Re(i,e,t){if(i!==~~i||i<e||i>t)throw Error(dt+i)}function Gt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=D,r=0):(r=Math.ceil((e+1)/D),e%=D),o=Te(10,D-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==Te(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==Te(10,e-3)-1,s}function fn(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=Qn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function Uo(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/An(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=Rt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var ce=function(){function i(n,r,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*r+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=r[a]){c=n[a]>r[a]?1:-1;break}return c}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,c){var u,l,p,m,d,f,b,y,g,A,w,h,x,k,B,L,T,R,O,Y,j=n.constructor,pe=n.s==r.s?1:-1,se=n.d,te=r.d;if(!se||!se[0]||!te||!te[0])return new j(!n.s||!r.s||(se?te&&se[0]==te[0]:!te)?NaN:se&&se[0]==0||!te?pe*0:pe/0);for(c?(d=1,l=n.e-r.e):(c=Ge,d=D,l=Ke(n.e/d)-Ke(r.e/d)),O=te.length,T=se.length,g=new j(pe),A=g.d=[],p=0;te[p]==(se[p]||0);p++);if(te[p]>(se[p]||0)&&l--,o==null?(k=o=j.precision,s=j.rounding):a?k=o+(n.e-r.e)+1:k=o,k<0)A.push(1),f=!0;else{if(k=k/d+2|0,p=0,O==1){for(m=0,te=te[0],k++;(p<T||m)&&k--;p++)B=m*c+(se[p]||0),A[p]=B/te|0,m=B%te|0;f=m||p<T}else{for(m=c/(te[0]+1)|0,m>1&&(te=i(te,m,c),se=i(se,m,c),O=te.length,T=se.length),L=O,w=se.slice(0,O),h=w.length;h<O;)w[h++]=0;Y=te.slice(),Y.unshift(0),R=te[0],te[1]>=c/2&&++R;do m=0,u=e(te,w,O,h),u<0?(x=w[0],O!=h&&(x=x*c+(w[1]||0)),m=x/R|0,m>1?(m>=c&&(m=c-1),b=i(te,m,c),y=b.length,h=w.length,u=e(b,w,y,h),u==1&&(m--,t(b,O<y?Y:te,y,c))):(m==0&&(u=m=1),b=te.slice()),y=b.length,y<h&&b.unshift(0),t(w,b,h,c),u==-1&&(h=w.length,u=e(te,w,O,h),u<1&&(m++,t(w,O<h?Y:te,h,c))),h=w.length):u===0&&(m++,w=[0]),A[p++]=m,u&&w[0]?w[h++]=se[L]||0:(w=[se[L]],h=1);while((L++<T||w[0]!==void 0)&&k--);f=w[0]!==void 0}A[0]||A.shift()}if(d==1)g.e=l,Yi=f;else{for(p=1,m=A[0];m>=10;m/=10)p++;g.e=p+l*d-1,F(g,a?o+g.e+1:o,s,f)}return g}}();function F(i,e,t,n){var r,o,s,a,c,u,l,p,m,d=i.constructor;e:if(e!=null){if(p=i.d,!p)return i;for(r=1,a=p[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=D,s=e,l=p[m=0],c=l/Te(10,r-s-1)%10|0;else if(m=Math.ceil((o+1)/D),a=p.length,m>=a)if(n){for(;a++<=m;)p.push(0);l=c=0,r=1,o%=D,s=o-D+1}else break e;else{for(l=a=p[m],r=1;a>=10;a/=10)r++;o%=D,s=o-D+r,c=s<0?0:l/Te(10,r-s-1)%10|0}if(n=n||e<0||p[m+1]!==void 0||(s<0?l:l%Te(10,r-s-1)),u=t<4?(c||n)&&(t==0||t==(i.s<0?3:2)):c>5||c==5&&(t==4||n||t==6&&(o>0?s>0?l/Te(10,r-s):0:p[m-1])%10&1||t==(i.s<0?8:7)),e<1||!p[0])return p.length=0,u?(e-=i.e+1,p[0]=Te(10,(D-e%D)%D),i.e=-e||0):p[0]=i.e=0,i;if(o==0?(p.length=m,a=1,m--):(p.length=m+1,a=Te(10,D-o),p[m]=s>0?(l/Te(10,r-s)%Te(10,s)|0)*a:0),u)for(;;)if(m==0){for(o=1,s=p[0];s>=10;s/=10)o++;for(s=p[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,p[0]==Ge&&(p[0]=1));break}else{if(p[m]+=a,p[m]!=Ge)break;p[m--]=0,a=1}for(o=p.length;p[--o]===0;)p.pop()}return G&&(i.e>d.maxE?(i.d=null,i.e=NaN):i.e<d.minE&&(i.e=0,i.d=[0])),i}function Ze(i,e,t){if(!i.isFinite())return or(i);var n,r=i.e,o=Se(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+mt(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+mt(-r-1)+o,t&&(n=t-s)>0&&(o+=mt(n))):r>=s?(o+=mt(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+mt(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=mt(n))),o}function kn(i,e){var t=i[0];for(e*=D;t>=10;t/=10)e++;return e}function gn(i,e,t){if(e>qo)throw G=!0,t&&(i.precision=t),Error(Ji);return F(new i(bn),e,1,!0)}function Ue(i,e,t){if(e>Zn)throw Error(Ji);return F(new i(yn),e,t,!0)}function nr(i){var e=i.length-1,t=e*D+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function mt(i){for(var e="";i--;)e+="0";return e}function ir(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/D+4);for(G=!1;;){if(t%2&&(o=o.times(e),ji(o.d,s)&&(r=!0)),t=Ke(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),ji(e.d,s)}return G=!0,o}function Qi(i){return i.d[i.d.length-1]&1}function rr(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function Yn(i,e){var t,n,r,o,s,a,c,u=0,l=0,p=0,m=i.constructor,d=m.rounding,f=m.precision;if(!i.d||!i.d[0]||i.e>17)return new m(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(G=!1,c=f):c=e,a=new m(.03125);i.e>-2;)i=i.times(a),p+=5;for(n=Math.log(Te(2,p))/Math.LN10*2+5|0,c+=n,t=o=s=new m(1),m.precision=c;;){if(o=F(o.times(i),c,1),t=t.times(++l),a=s.plus(ce(o,t,c,1)),Se(a.d).slice(0,c)===Se(s.d).slice(0,c)){for(r=p;r--;)s=F(s.times(s),c,1);if(e==null)if(u<3&&Gt(s.d,c-n,d,u))m.precision=c+=10,t=o=a=new m(1),l=0,u++;else return F(s,m.precision=f,d,G=!0);else return m.precision=f,s}s=a}}function pt(i,e){var t,n,r,o,s,a,c,u,l,p,m,d=1,f=10,b=i,y=b.d,g=b.constructor,A=g.rounding,w=g.precision;if(b.s<0||!y||!y[0]||!b.e&&y[0]==1&&y.length==1)return new g(y&&!y[0]?-1/0:b.s!=1?NaN:y?0:b);if(e==null?(G=!1,l=w):l=e,g.precision=l+=f,t=Se(y),n=t.charAt(0),Math.abs(o=b.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)b=b.times(i),t=Se(b.d),n=t.charAt(0),d++;o=b.e,n>1?(b=new g("0."+t),o++):b=new g(n+"."+t.slice(1))}else return u=gn(g,l+2,w).times(o+""),b=pt(new g(n+"."+t.slice(1)),l-f).plus(u),g.precision=w,e==null?F(b,w,A,G=!0):b;for(p=b,c=s=b=ce(b.minus(1),b.plus(1),l,1),m=F(b.times(b),l,1),r=3;;){if(s=F(s.times(m),l,1),u=c.plus(ce(s,new g(r),l,1)),Se(u.d).slice(0,l)===Se(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(gn(g,l+2,w).times(o+""))),c=ce(c,new g(d),l,1),e==null)if(Gt(c.d,l-f,A,a))g.precision=l+=f,u=s=b=ce(p.minus(1),p.plus(1),l,1),m=F(b.times(b),l,1),r=a=1;else return F(c,g.precision=w,A,G=!0);else return g.precision=w,c;c=u,r+=2}}function or(i){return String(i.s*i.s/0)}function Jn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%D,t<0&&(n+=D),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=D;n<r;)i.d.push(+e.slice(n,n+=D));e=e.slice(n),n=D-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),G&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Go(i,e){var t,n,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),tr.test(e))return Jn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(Wo.test(e))t=16,e=e.toLowerCase();else if(Fo.test(e))t=2;else if(Vo.test(e))t=8;else throw Error(dt+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=ir(n,new n(t),o,o*2)),u=fn(e,t,Ge),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new n(i.s*0):(i.e=kn(u,l),i.d=u,G=!1,s&&(i=ce(i,r,a*4)),c&&(i=i.times(Math.abs(c)<54?Te(2,c):Xt.pow(2,c))),G=!0,i)}function Xo(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:Rt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/An(5,t)),e=Rt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function Rt(i,e,t,n,r){var o,s,a,c,u=1,l=i.precision,p=Math.ceil(l/D);for(G=!1,c=t.times(t),a=new i(n);;){if(s=ce(a.times(c),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=ce(s.times(c),new i(e++*e++),l,1),s=a.plus(n),s.d[p]!==void 0){for(o=p;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return G=!0,s.d.length=p+1,s}function An(i,e){for(var t=i;--e;)t*=i;return t}function sr(i,e){var t,n=e.s<0,r=Ue(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return rt=n?4:1,e;if(t=e.divToInt(r),t.isZero())rt=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return rt=Qi(t)?n?2:3:n?4:1,e;rt=Qi(t)?n?1:4:n?3:2}return e.minus(r).abs()}function $n(i,e,t,n){var r,o,s,a,c,u,l,p,m,d=i.constructor,f=t!==void 0;if(f?(Re(t,1,ft),n===void 0?n=d.rounding:Re(n,0,8)):(t=d.precision,n=d.rounding),!i.isFinite())l=or(i);else{for(l=Ze(i),s=l.indexOf("."),f?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),m=new d(1),m.e=l.length-s,m.d=fn(Ze(m),10,r),m.e=m.d.length),p=fn(l,10,r),o=c=p.length;p[--c]==0;)p.pop();if(!p[0])l=f?"0p+0":"0";else{if(s<0?o--:(i=new d(i),i.d=p,i.e=o,i=ce(i,m,t,n,0,r),p=i.d,o=i.e,u=Yi),s=p[t],a=r/2,u=u||p[t+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&p[t-1]&1||n===(i.s<0?8:7)),p.length=t,u)for(;++p[--t]>r-1;)p[t]=0,t||(++o,p.unshift(1));for(c=p.length;!p[c-1];--c);for(s=0,l="";s<c;s++)l+=Qn.charAt(p[s]);if(f){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(p=fn(l,r,e),c=p.length;!p[c-1];--c);for(s=1,l="1.";s<c;s++)l+=Qn.charAt(p[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function ji(i,e){if(i.length>e)return i.length=e,!0}function zo(i){return new this(i).abs()}function Ho(i){return new this(i).acos()}function Qo(i){return new this(i).acosh()}function jo(i,e){return new this(i).plus(e)}function Zo(i){return new this(i).asin()}function Yo(i){return new this(i).asinh()}function Jo(i){return new this(i).atan()}function $o(i){return new this(i).atanh()}function es(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Ue(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Ue(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Ue(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ce(i,e,o,1)),e=Ue(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(ce(i,e,o,1)),t}function ts(i){return new this(i).cbrt()}function ns(i){return F(i=new this(i),i.e+1,2)}function is(i,e,t){return new this(i).clamp(e,t)}function rs(i){if(!i||typeof i!="object")throw Error(Pn+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,ft,"rounding",0,8,"toExpNeg",-Lt,0,"toExpPos",0,Lt,"maxE",0,Lt,"minE",-Lt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=jn[t]),(n=i[t])!==void 0)if(Ke(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(dt+t+": "+n);if(t="crypto",r&&(this[t]=jn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error($i);else this[t]=!1;else throw Error(dt+t+": "+n);return this}function os(i){return new this(i).cos()}function ss(i){return new this(i).cosh()}function ar(i){var e,t,n;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,Zi(o)){u.s=o.s,G?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;G?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return Jn(u,o.toString())}else if(c!=="string")throw Error(dt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),tr.test(o)?Jn(u,o):Go(u,o)}if(r.prototype=S,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=rs,r.clone=ar,r.isDecimal=Zi,r.abs=zo,r.acos=Ho,r.acosh=Qo,r.add=jo,r.asin=Zo,r.asinh=Yo,r.atan=Jo,r.atanh=$o,r.atan2=es,r.cbrt=ts,r.ceil=ns,r.clamp=is,r.cos=os,r.cosh=ss,r.div=as,r.exp=us,r.floor=cs,r.hypot=ls,r.ln=ms,r.log=ps,r.log10=fs,r.log2=ds,r.max=bs,r.min=ys,r.mod=gs,r.mul=Ps,r.pow=ks,r.random=As,r.round=ws,r.sign=hs,r.sin=Ts,r.sinh=Bs,r.sqrt=Is,r.sub=xs,r.sum=Ss,r.tan=Ks,r.tanh=Cs,r.trunc=Ns,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function as(i,e){return new this(i).div(e)}function us(i){return new this(i).exp()}function cs(i){return F(i=new this(i),i.e+1,3)}function ls(){var i,e,t=new this(0);for(G=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return G=!0,new this(1/0);t=e}return G=!0,t.sqrt()}function Zi(i){return i instanceof Xt||i&&i.toStringTag===er||!1}function ms(i){return new this(i).ln()}function ps(i,e){return new this(i).log(e)}function ds(i){return new this(i).log(2)}function fs(i){return new this(i).log(10)}function bs(){return rr(this,arguments,"lt")}function ys(){return rr(this,arguments,"gt")}function gs(i,e){return new this(i).mod(e)}function Ps(i,e){return new this(i).mul(e)}function ks(i,e){return new this(i).pow(e)}function As(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Re(i,1,ft),n=Math.ceil(i/D),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error($i);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=D,n&&i&&(r=Te(10,D-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=D)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<D&&(t-=D-n)}return s.e=t,s.d=a,s}function ws(i){return F(i=new this(i),i.e+1,this.rounding)}function hs(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function Ts(i){return new this(i).sin()}function Bs(i){return new this(i).sinh()}function Is(i){return new this(i).sqrt()}function xs(i,e){return new this(i).sub(e)}function Ss(){var i=0,e=arguments,t=new this(e[i]);for(G=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return G=!0,F(t,this.precision,this.rounding)}function Ks(i){return new this(i).tan()}function Cs(i){return new this(i).tanh()}function Ns(i){return F(i=new this(i),i.e+1,1)}S[Symbol.for("nodejs.util.inspect.custom")]=S.toString;S[Symbol.toStringTag]="Decimal";var Xt=S.constructor=ar(jn);bn=new Xt(bn);yn=new Xt(yn);var M=Xt;var ii=require("@solana/web3.js");var zt=require("lodash");var ei=class{logLevel;name;constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ur={},Ls={};function le(i){let e=(0,zt.get)(ur,i);if(!e){let t=(0,zt.get)(Ls,i);e=new ei({name:i,logLevel:t}),(0,zt.set)(ur,i,e)}return e}var bt=require("@solana/spl-token"),ti=le("Raydium_accountInfo_util");async function ot(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}={batchRequest:!1,...t},s=ni(e,o),a=new Array(s.length).fill([]);if(n){let c=s.map(p=>{let m=i._buildArgs([p.map(d=>d.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=ni(c,10);a=(await(await Promise.all(u.map(async p=>await i._rpcBatchRequest(p)))).flat()).map(p=>(p.error&&ti.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${p.error.message}`),p.result.value.map(m=>{if(m){let{data:d,executable:f,lamports:b,owner:y,rentEpoch:g}=m;return d.length!==2&&d[1]!=="base64"&&ti.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:f,lamports:b,owner:new ii.PublicKey(y),rentEpoch:g}}return null})))}else try{a=await Promise.all(s.map(c=>i.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&ti.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function ht(i,e,t){let n=await ot(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>({...r,accountInfo:n[o]}))}async function ri({connection:i,mints:e,config:t}){if(e.length===0)return{};let n=await ht(i,e.map(o=>({pubkey:Ye(o)})),t),r={};for(let o of n){if(!o.accountInfo||o.accountInfo.data.length<bt.MINT_SIZE){console.log("invalid mint account",o.pubkey.toBase58());continue}let s=(0,bt.unpackMint)(o.pubkey,o.accountInfo,o.accountInfo?.owner);r[o.pubkey.toString()]={...s,programId:o.accountInfo?.owner||bt.TOKEN_PROGRAM_ID,feeConfig:(0,bt.getTransferFeeConfig)(s)??void 0}}return r[ii.PublicKey.default.toBase58()]=r[Xe.toBase58()],r}var et=ae(require("bn.js"));var fr=ae(require("big.js")),Zt=ae(require("bn.js"));var cr=ae(require("toformat")),Rs=cr.default,Ht=Rs;var Qt=ae(require("big.js")),mr=ae(require("bn.js")),pr=ae(require("decimal.js-light"));var Mt=ae(require("bn.js"));var lr=9007199254740991;function me(i){let e=le("Raydium_parseBigNumberish");if(i instanceof Mt.default)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Mt.default(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=lr||i<=-lr)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Mt.default(String(i))):typeof i=="bigint"?new Mt.default(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Mt.default(0))}var wn=le("module/fraction"),oi=Ht(Qt.default),jt=Ht(pr.default),Os={[0]:jt.ROUND_DOWN,[1]:jt.ROUND_HALF_UP,[2]:jt.ROUND_UP},Es={[0]:Qt.default.roundDown,[1]:Qt.default.roundHalfUp,[2]:Qt.default.roundUp},ne=class{numerator;denominator;constructor(e,t=new mr.default(1)){this.numerator=me(e),this.denominator=me(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new ne(this.denominator,this.numerator)}add(e){let t=e instanceof ne?e:new ne(me(e));return this.denominator.eq(t.denominator)?new ne(this.numerator.add(t.numerator),this.denominator):new ne(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof ne?e:new ne(me(e));return this.denominator.eq(t.denominator)?new ne(this.numerator.sub(t.numerator),this.denominator):new ne(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof ne?e:new ne(me(e));return new ne(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof ne?e:new ne(me(e));return new ne(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||wn.logWithError(`${e} is not an integer.`),e<=0&&wn.logWithError(`${e} is not positive.`),jt.set({precision:e+1,rounding:Os[n]});let r=new jt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||wn.logWithError(`${e} is not an integer.`),e<0&&wn.logWithError(`${e} is negative.`),oi.DP=e,oi.RM=Es[n]||1,new oi(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var vs=le("Raydium_amount"),dr=Ht(fr.default);function _s(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):vs.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var fe=class extends ne{token;logger;constructor(e,t,n=!0,r){let o=new Zt.default(0),s=si.pow(new Zt.default(e.decimals));if(n)o=me(t);else{let a=new Zt.default(0),c=new Zt.default(0);if(typeof t=="string"||typeof t=="number"||typeof t=="bigint"){let[u,l]=_s(t.toString(),e.decimals);a=me(u),c=me(l)}a=a.mul(s),o=a.add(c)}super(o,s),this.logger=le(r||"TokenAmount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new fe(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new fe(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,t,n=0){return super.toSignificant(e,t,n)}toFixed(e=this.token.decimals,t,n=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,t,n)}toExact(e={groupSeparator:""}){return dr.DP=this.token.decimals,new dr(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};var br=require("@solana/web3.js"),ai=require("@solana/spl-token"),ui={chainId:101,address:br.PublicKey.default.toBase58(),programId:ai.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Je={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ai.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Tn=require("@solana/web3.js");var ue=require("@solana/web3.js"),yr=require("@solana/spl-token");function K({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var wu=[K({pubkey:yr.TOKEN_PROGRAM_ID,isWritable:!1}),K({pubkey:ue.SystemProgram.programId,isWritable:!1}),K({pubkey:ue.SYSVAR_RENT_PUBKEY,isWritable:!1})];function ci({publicKey:i,transformSol:e}){let t=li(i.toString());if(t instanceof ue.PublicKey)return e&&t.equals(Yt)?Xe:t;if(e&&t.toString()===Yt.toBase58())return Xe;if(typeof t=="string"){if(t===ue.PublicKey.default.toBase58())return ue.PublicKey.default;try{return new ue.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function li(i){try{return new ue.PublicKey(i)}catch{return i}}var hn=new ue.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ot=new ue.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),$e=new ue.PublicKey("SysvarRent111111111111111111111111111111111"),hu=new ue.PublicKey("SysvarC1ock11111111111111111111111111111111"),yt=new ue.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Tu=new ue.PublicKey("Sysvar1nstructions1111111111111111111111111"),Fs=ue.SystemProgram.programId,Bu=new ue.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Iu=new ue.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),xu=new ue.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Su=new ue.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ku=new ue.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Cu=new ue.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Nu=new ue.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Lu=new ue.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ru=new ue.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Mu=new ue.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ou=new ue.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Xe=new ue.PublicKey("So11111111111111111111111111111111111111112"),Yt=ue.PublicKey.default;function Ye(i){return ci({publicKey:i,transformSol:!0})}var mi=class{symbol;name;decimals;isToken2022;mint;constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Yt.toBase58()||e instanceof Tn.PublicKey&&Yt.equals(e)){this.decimals=Je.decimals,this.symbol=Je.symbol,this.name=Je.name,this.mint=new Tn.PublicKey(Je.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?Tn.PublicKey.default:ci({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},ve=mi;dn(ve,"WSOL",new mi({...Je,mint:Je.address}));var pi=class{symbol;name;decimals;constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Bn=pi;dn(Bn,"SOL",new pi(ui));var Pr=ae(require("bn.js"));var gr=new ne(new Pr.default(100)),st=class extends ne{toSignificant(e=5,t,n){return this.mul(gr).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(gr).toFixed(e,t,n)}};var Ws=le("Raydium_price"),Me=class extends ne{baseToken;quoteToken;scalar;constructor(e){let{baseToken:t,quoteToken:n,numerator:r,denominator:o}=e;super(r,o),this.baseToken=t,this.quoteToken=n,this.scalar=new ne(di(t.decimals),di(n.decimals))}get raw(){return new ne(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Me({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&Ws.logWithError("mul token not equals");let t=super.mul(e);return new Me({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:t.denominator,numerator:t.numerator})}toSignificant(e=this.quoteToken.decimals,t,n){return this.adjusted.toSignificant(e,t,n)}toFixed(e=this.quoteToken.decimals,t,n){return this.adjusted.toFixed(e,t,n)}};var Ar=require("@solana/web3.js"),wr=ae(require("bn.js"));function hr(i){return typeof i=="object"&&i!==null&&![ve,fe,Ar.PublicKey,ne,wr.default,Me,st].some(e=>typeof e=="object"&&i instanceof e)}function Tt(i){return typeof i=="string"?li(i):Array.isArray(i)?i.map(e=>Tt(e)):hr(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,Tt(t)])):i}var kr=new et.default(0),Vs=new et.default(1),Bc=new et.default(2),Ic=new et.default(3),xc=new et.default(5),si=new et.default(10),Sc=new et.default(100),Kc=new et.default(1e3),Cc=new et.default(1e4);function di(i){return si.pow(me(i))}function ni(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var xr=require("@solana/web3.js"),Sr=require("@solana/spl-token");var Ce=require("@solana/web3.js");var Z={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip",NonceAccount:"NonceAccount"};var Br=require("@solana/spl-token"),Tr=le("Raydium_txUtil"),Ir=1644;function In(i){let e=[],t=[];return i.microLamports&&(e.push(Ce.ComputeBudgetProgram.setComputeUnitPrice({microLamports:i.microLamports})),t.push(Z.SetComputeUnitPrice)),i.units&&(e.push(Ce.ComputeBudgetProgram.setComputeUnitLimit({units:i.units})),t.push(Z.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Et(i,e){let t=e??"confirmed";return(await i.getLatestBlockhash?.({commitment:t}))?.blockhash}async function xn(i,e){return i.getSignatureStatuses([e]),new Promise((t,n)=>{let r=setTimeout(n,6e4);i.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}n(Object.assign(o.err,{txId:e}))},"confirmed")})}function Ds(i,e){i.length<1&&Tr.logWithError(`no instructions provided: ${i.toString()}`),e.length<1&&Tr.logWithError(`no signers provided:, ${e.toString()}`);let t=new Ce.Transaction;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...i);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Ir}catch{return!1}}function Ae(i,e){let[t,n]=Ce.PublicKey.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function Jt({instructions:i,payer:e,signers:t}){return Ds(i,[e,...t])}function $t({instructions:i,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Ce.Keypair.generate().publicKey.toString()}){let o=new Ce.TransactionMessage({payerKey:e,recentBlockhash:n,instructions:i}).compileToV0Message(Object.values(t??{}));try{return Buffer.from(new Ce.VersionedTransaction(o).serialize()).toString("base64").length<Ir}catch{return!1}}var qs=i=>Buffer.isBuffer(i)?i:i instanceof Uint8Array?Buffer.from(i.buffer,i.byteOffset,i.byteLength):Buffer.from(i),Us=i=>{let e=i.serialize({requireAllSignatures:!1,verifySignatures:!1});i instanceof Ce.VersionedTransaction&&(e=qs(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Bt(i){let e=[];return i.forEach(t=>{t instanceof Ce.Transaction&&(t.recentBlockhash||(t.recentBlockhash=Br.TOKEN_PROGRAM_ID.toBase58()),t.feePayer||(t.feePayer=Ce.Keypair.generate().publicKey)),e.push(Us(t))}),console.log("simulate tx string:",e),e}function be(i,e,t){return Ae([i.toBuffer(),(t??Sr.TOKEN_PROGRAM_ID).toBuffer(),e.toBuffer()],new xr.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var q=require("@solana/web3.js"),Xc=new q.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),zc=new q.PublicKey("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Hc=new q.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Qc=new q.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),jc=new q.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Zc=new q.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),fi=new q.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Kr=new q.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Yc=new q.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Cr=new q.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),bi=new q.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Gs=new q.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Xs=new q.PublicKey("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Jc=new q.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),$c=new q.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),el=new q.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),tl=new q.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),nl=new q.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),il=new q.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),yi=new q.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),zs=new q.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),rl=new q.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Hs=new q.PublicKey("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Qs=new q.PublicKey("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),js=new q.PublicKey("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),ol=new q.PublicKey("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Zs=new q.PublicKey("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),sl=new q.PublicKey("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Ys=new q.PublicKey("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),al=new q.PublicKey("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),ul=new q.PublicKey("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Js=new q.PublicKey("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),$s=new q.PublicKey("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var cl={SERUM_MARKET:q.PublicKey.default,OPENBOOK_MARKET:new q.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:q.PublicKey.default,FarmV3:new q.PublicKey("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new q.PublicKey("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new q.PublicKey("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new q.PublicKey("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new q.PublicKey("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new q.PublicKey("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new q.PublicKey("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new q.PublicKey("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new q.PublicKey("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Hs,CREATE_CPMM_POOL_AUTH:Qs,CREATE_CPMM_POOL_FEE_ACC:js,FEE_DESTINATION_ID:new q.PublicKey("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:Zs,LCOK_CPMM_AUTH:Ys,LAUNCHPAD_PROGRAM:Js,LAUNCHPAD_AUTH:$s};var qe=ae(require("bn.js")),en=1e4;function ke(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r={...e,olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}},o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new qe.default(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===en){let c=new qe.default(o.maximumFee.toString());return{amount:i.add(c),fee:c,expirationTime:a}}else{let c=Sn(i.mul(new qe.default(en)),new qe.default(en-o.transferFeeBasisPoints)),u=new qe.default(o.maximumFee.toString()),l=c.sub(i).gt(u)?i.add(u):c,p=Sn(l.mul(new qe.default(o.transferFeeBasisPoints)),new qe.default(en)),m=p.gt(s)?s:p;return{amount:l,fee:m,expirationTime:a}}else{let c=Sn(i.mul(new qe.default(o.transferFeeBasisPoints)),new qe.default(en)),u=c.gt(s)?s:c;return{amount:i,fee:u,expirationTime:a}}}function ze(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Sn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new qe.default(0))?t.add(new qe.default(1)):t}var gt=require("@solana/web3.js");async function gi({connection:i,address:e}){let t=await ot(i,[...new Set(e.map(r=>r.toString()))].map(r=>new gt.PublicKey(r))),n={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new gt.AddressLookupTableAccount({key:s,state:gt.AddressLookupTableAccount.deserialize(o.data)});n[s.toString()]=a,Kn[s.toString()]=a}return n}var Kn={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new gt.AddressLookupTableAccount({key:new gt.PublicKey("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:gt.AddressLookupTableAccount.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};var ie=require("@solana/web3.js"),Lr=ae(require("axios"));var Cn=2e3,Nn=class{connection;owner;instructions=[];endInstructions=[];lookupTableAddress=[];signers=[];instructionTypes=[];endInstructionTypes=[];feePayer;cluster;signAllTransactions;blockhashCommitment;loopMultiTxStatus;constructor(e){this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){let e=(await Lr.default.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=e?.[15]??{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=In(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){return e?(this.endInstructions.push(ie.SystemProgram.transfer({fromPubkey:e.feePayer??this.feePayer,toPubkey:new ie.PublicKey(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(Z.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==ie.PublicKey.default.toString())),this}async versionBuild({txVersion:e,extInfo:t},n){return e===0?await this.buildV0({...t||{}},n):this.build(t,n)}build(e,t){let n=new ie.Transaction;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,this.owner?.signer&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:n,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=r||{},u=o??t??await Et(this.connection,this.blockhashCommitment);if(n.recentBlockhash=u,this.signers.length&&n.sign(...this.signers),Bt([n]),this.owner?.isKeyPair)return{txId:a?await(0,ie.sendAndConfirmTransaction)(this.connection,n,this.signers.find(p=>p.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(n.serialize(),{skipPreflight:s}),signedTx:n};if(this.signAllTransactions){let l=await this.signAllTransactions([n]);if(this.signers.length)for(let p of l)try{p.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),o=t.filter(u=>u.transaction.instructions.length>0),s=[r,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return this.owner?.signer&&a.forEach(u=>{u.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async u=>{let{sequentially:l,onTxUpdate:p,skipTxCount:m=0,recentBlockHash:d,skipPreflight:f=!0}=u||{},b=d??await Et(this.connection,this.blockhashCommitment);if(this.owner?.isKeyPair){if(l){let y=[],g=0;for(let A of s){if(++g,g<=m)continue;let w=await(0,ie.sendAndConfirmTransaction)(this.connection,A,this.signers.find(h=>h.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});y.push(w)}return{txIds:y,signedTxs:s}}return{txIds:await await Promise.all(s.map(async y=>(y.recentBlockhash=b,await this.connection.sendRawTransaction(y.serialize(),{skipPreflight:f})))),signedTxs:s}}if(this.signAllTransactions){let y=s.map((A,w)=>(A.recentBlockhash=b,a[w].length&&A.sign(...a[w]),A));Bt(y);let g=await this.signAllTransactions(y);if(l){let A=0,w=[],h=async()=>{if(!g[A])return;let x=await this.connection.sendRawTransaction(g[A].serialize(),{skipPreflight:f});w.push({txId:x,status:"sent",signedTx:g[A]}),p?.([...w]),A++;let k=!1,B=null,L=null,T=R=>{B!==null&&clearInterval(B),L!==null&&this.connection.removeSignatureListener(L);let O=w.findIndex(Y=>Y.txId===x);if(O>-1){if(w[O].status==="error"||w[O].status==="success")return;w[O].status=R.err?"error":"success"}p?.([...w]),R.err||h()};this.loopMultiTxStatus&&(B=setInterval(async()=>{if(k){clearInterval(B);return}try{let R=await this.connection.getTransaction(x,{commitment:"confirmed",maxSupportedTransactionVersion:0});R&&(k=!0,clearInterval(B),T({err:R.meta?.err||null}),console.log("tx status from getTransaction:",x))}catch(R){k=!0,clearInterval(B),console.error("getTransaction timeout:",R,x)}},Cn)),L=this.connection.onSignature(x,R=>{if(k){this.connection.removeSignatureListener(L);return}k=!0,T(R)},"confirmed"),this.connection.getSignatureStatus(x)};return await h(),{txIds:w.map(x=>x.txId),signedTxs:g}}else{let A=[];for(let w=0;w<g.length;w+=1){let h=await this.connection.sendRawTransaction(g[w].serialize(),{skipPreflight:f});A.push(h)}return{txIds:A,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e,t){let{lookupTableCache:n={},lookupTableAddress:r=[],forerunCreate:o,recentBlockhash:s,...a}=e||{},c={...this.cluster==="devnet"?{}:Kn,...n},u=Array.from(new Set([...r,...this.lookupTableAddress])),l=[];for(let f of u)c[f]===void 0&&l.push(new ie.PublicKey(f));if(l.length>0){let f=await gi({connection:this.connection,address:l});for(let[b,y]of Object.entries(f))c[b]=y}let p=t??(o?ie.PublicKey.default.toBase58():s??await Et(this.connection,this.blockhashCommitment)),m=new ie.TransactionMessage({payerKey:this.feePayer,recentBlockhash:p,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(c));this.owner?.signer&&!this.signers.some(f=>f.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let d=new ie.VersionedTransaction(m);return d.sign(this.signers),{builder:this,transaction:d,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async f=>{let{skipPreflight:b=!0,sendAndConfirm:y,notSendToRpc:g}=f||{};if(Bt([d]),this.owner?.isKeyPair){let A=await this.connection.sendTransaction(d,{skipPreflight:b});return y&&await xn(this.connection,A),{txId:A,signedTx:d}}if(this.signAllTransactions){let A=await this.signAllTransactions([d]);if(this.signers.length)for(let w of A)try{w.sign(this.signers)}catch{}return{txId:g?"":await this.connection.sendTransaction(A[0],{skipPreflight:b}),signedTx:A[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(e){let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),o=t.filter(u=>u.builder.instructions.length>0),s=[r,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return this.owner?.signer&&a.forEach(u=>{u.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(u,l)=>{u.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async u=>{let{sequentially:l,onTxUpdate:p,recentBlockHash:m,skipPreflight:d=!0}=u||{};if(m&&s.forEach(f=>f.message.recentBlockhash=m),Bt(s),this.owner?.isKeyPair){if(l){let f=[];for(let b of s){let y=await this.connection.sendTransaction(b,{skipPreflight:d});await xn(this.connection,y),f.push(y)}return{txIds:f,signedTxs:s}}return{txIds:await Promise.all(s.map(async f=>await this.connection.sendTransaction(f,{skipPreflight:d}))),signedTxs:s}}if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(l){let b=0,y=[],g=async()=>{if(!f[b])return;let A=await this.connection.sendTransaction(f[b],{skipPreflight:d});y.push({txId:A,status:"sent",signedTx:f[b]}),p?.([...y]),b++;let w=!1,h=null,x=null,k=B=>{h!==null&&clearInterval(h),x!==null&&this.connection.removeSignatureListener(x);let L=y.findIndex(T=>T.txId===A);if(L>-1){if(y[L].status==="error"||y[L].status==="success")return;y[L].status=B.err?"error":"success"}p?.([...y]),B.err||g()};this.loopMultiTxStatus&&(h=setInterval(async()=>{if(w){clearInterval(h);return}try{let B=await this.connection.getTransaction(A,{commitment:"confirmed",maxSupportedTransactionVersion:0});B&&(w=!0,clearInterval(h),k({err:B.meta?.err||null}),console.log("tx status from getTransaction:",A))}catch(B){w=!0,clearInterval(h),console.error("getTransaction timeout:",B,A)}},Cn)),x=this.connection.onSignature(A,B=>{if(w){this.connection.removeSignatureListener(x);return}w=!0,k(B)},"confirmed"),this.connection.getSignatureStatus(A)};return g(),{txIds:[],signedTxs:f}}else{let b=[];for(let y=0;y<f.length;y+=1){let g=await this.connection.sendTransaction(f[y],{skipPreflight:d});b.push(g)}return{txIds:b,signedTxs:f}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){let{splitIns:t=[],computeBudgetConfig:n,...r}=e||{},o=n?In(n):{instructions:[],instructionTypes:[]},s=this.signers.reduce((p,m)=>({...p,[m.publicKey.toBase58()]:m}),{}),a=[],c=[],u=[],l=0;if(this.allInstructions.forEach(p=>{let m=[...u,p],d=n?[...o.instructions,...m]:m,b=[...new Set(m.map(y=>y.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(y=>new ie.PublicKey(y));if(p!==t[l]&&u.length<12&&(Jt({instructions:d,payer:this.feePayer,signers:b})||Jt({instructions:m,payer:this.feePayer,signers:b})))u.push(p);else{if(u.length===0)throw Error("item ins too big");l+=p===t[l]?1:0,Jt({instructions:n?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:b})?a.push(new ie.Transaction().add(...o.instructions,...u)):a.push(new ie.Transaction().add(...u)),c.push(Array.from(new Set(u.map(y=>y.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat())).map(y=>s[y]).filter(y=>y!==void 0)),u=[p]}}),u.length>0){let m=[...new Set(u.map(d=>d.keys.filter(f=>f.isSigner).map(f=>f.pubkey.toString())).flat()).values()].map(d=>s[d]).filter(d=>d!==void 0);Jt({instructions:n?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:m.map(d=>d.publicKey)})?a.push(new ie.Transaction().add(...o.instructions,...u)):a.push(new ie.Transaction().add(...u)),c.push(m)}return a.forEach(p=>p.feePayer=this.feePayer),this.owner?.signer&&c.forEach(p=>{p.some(m=>m.publicKey.equals(this.owner.publicKey))||p.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async p=>{let{sequentially:m,onTxUpdate:d,skipTxCount:f=0,recentBlockHash:b,skipPreflight:y=!0}=p||{},g=b??await Et(this.connection,this.blockhashCommitment);if(a.forEach(async(A,w)=>{A.recentBlockhash=g,c[w].length&&A.sign(...c[w])}),Bt(a),this.owner?.isKeyPair){if(m){let A=0,w=[];for(let h of a){if(++A,A<=f){w.push("tx skipped");continue}let x=await(0,ie.sendAndConfirmTransaction)(this.connection,h,this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});w.push(x)}return{txIds:w,signedTxs:a}}return{txIds:await Promise.all(a.map(async A=>await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:y}))),signedTxs:a}}if(this.signAllTransactions){let A=await this.signAllTransactions(a.slice(f,a.length)),w=[...a.slice(0,f),...A];if(m){let h=0,x=[],k=async()=>{if(!w[h])return;h<f&&(x.push({txId:"",status:"success",signedTx:w[h]}),d?.([...x]),h++,k());let B=await this.connection.sendRawTransaction(w[h].serialize(),{skipPreflight:y});x.push({txId:B,status:"sent",signedTx:w[h]}),d?.([...x]),h++;let L=!1,T=null,R=null,O=Y=>{T!==null&&clearInterval(T),R!==null&&this.connection.removeSignatureListener(R);let j=x.findIndex(pe=>pe.txId===B);if(j>-1){if(x[j].status==="error"||x[j].status==="success")return;x[j].status=Y.err?"error":"success"}d?.([...x]),Y.err||k()};this.loopMultiTxStatus&&(T=setInterval(async()=>{if(L){clearInterval(T);return}try{let Y=await this.connection.getTransaction(B,{commitment:"confirmed",maxSupportedTransactionVersion:0});Y&&(L=!0,clearInterval(T),O({err:Y.meta?.err||null}),console.log("tx status from getTransaction:",B))}catch(Y){L=!0,clearInterval(T),console.error("getTransaction timeout:",Y,B)}},Cn)),R=this.connection.onSignature(B,Y=>{if(L){this.connection.removeSignatureListener(R);return}L=!0,O(Y)},"confirmed"),this.connection.getSignatureStatus(B)};return await k(),{txIds:x.map(B=>B.txId),signedTxs:w}}else{let h=[];for(let x=0;x<w.length;x+=1){let k=await this.connection.sendRawTransaction(w[x].serialize(),{skipPreflight:y});h.push(k)}return{txIds:h,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(e){let{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:r={},lookupTableAddress:o=[],...s}=e||{},a={...this.cluster==="devnet"?{}:Kn,...r},c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let A of c)a[A]===void 0&&u.push(new ie.PublicKey(A));let l=await gi({connection:this.connection,address:u});for(let[A,w]of Object.entries(l))a[A]=w;let p=t?In(t):{instructions:[],instructionTypes:[]},m=await Et(this.connection,this.blockhashCommitment),d=this.signers.reduce((A,w)=>({...A,[w.publicKey.toBase58()]:w}),{}),f=[],b=[],y=[],g=0;if(this.allInstructions.forEach(A=>{let w=[...y,A],h=t?[...p.instructions,...w]:w;if(A!==n[g]&&y.length<12&&($t({instructions:h,payer:this.feePayer,lookupTableAddressAccount:a})||$t({instructions:w,payer:this.feePayer,lookupTableAddressAccount:a})))y.push(A);else{if(y.length===0)throw Error("item ins too big");g+=A===n[g]?1:0;let x={};for(let k of[...new Set(c)])a[k]!==void 0&&(x[k]=a[k]);if(t&&$t({instructions:[...p.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:m})){let k=new ie.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...p.instructions,...y]}).compileToV0Message(Object.values(a));f.push(new ie.VersionedTransaction(k))}else{let k=new ie.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...y]}).compileToV0Message(Object.values(a));f.push(new ie.VersionedTransaction(k))}b.push(Array.from(new Set(y.map(k=>k.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(k=>d[k]).filter(k=>k!==void 0)),y=[A]}}),y.length>0){let w=[...new Set(y.map(h=>h.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(h=>d[h]).filter(h=>h!==void 0);if(t&&$t({instructions:[...p.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:m})){let h=new ie.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...p.instructions,...y]}).compileToV0Message(Object.values(a));f.push(new ie.VersionedTransaction(h))}else{let h=new ie.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...y]}).compileToV0Message(Object.values(a));f.push(new ie.VersionedTransaction(h))}b.push(w)}return this.owner?.signer&&b.forEach(A=>{A.some(w=>w.publicKey.equals(this.owner.publicKey))||A.push(this.owner.signer)}),f.forEach((A,w)=>{A.sign(b[w])}),{builder:this,transactions:f,buildProps:e,signers:b,instructionTypes:this.instructionTypes,execute:async A=>{let{sequentially:w,onTxUpdate:h,skipTxCount:x=0,recentBlockHash:k,skipPreflight:B=!0}=A||{};if(f.map(async(L,T)=>{b[T].length&&L.sign(b[T]),k&&(L.message.recentBlockhash=k)}),Bt(f),this.owner?.isKeyPair){if(w){let L=0,T=[];for(let R of f){if(++L,L<=x){console.log("skip tx: ",L),T.push("tx skipped");continue}let O=await this.connection.sendTransaction(R,{skipPreflight:B});await xn(this.connection,O),T.push(O)}return{txIds:T,signedTxs:f}}return{txIds:await Promise.all(f.map(async L=>await this.connection.sendTransaction(L,{skipPreflight:B}))),signedTxs:f}}if(this.signAllTransactions){let L=await this.signAllTransactions(f.slice(x,f.length)),T=[...f.slice(0,x),...L];if(w){let R=0,O=[],Y=async()=>{if(!T[R])return;if(R<x){O.push({txId:"",status:"success",signedTx:T[R]}),h?.([...O]),R++,Y();return}let j=await this.connection.sendTransaction(T[R],{skipPreflight:B});O.push({txId:j,status:"sent",signedTx:T[R]}),h?.([...O]),R++;let pe=!1,se=null,te=null,zi=it=>{se!==null&&clearInterval(se),te!==null&&this.connection.removeSignatureListener(te);let pn=O.findIndex(Co=>Co.txId===j);if(pn>-1){if(O[pn].status==="error"||O[pn].status==="success")return;O[pn].status=it.err?"error":"success"}h?.([...O]),it.err||Y()};this.loopMultiTxStatus&&(se=setInterval(async()=>{if(pe){clearInterval(se);return}try{let it=await this.connection.getTransaction(j,{commitment:"confirmed",maxSupportedTransactionVersion:0});it&&(pe=!0,clearInterval(se),zi({err:it.meta?.err||null}),console.log("tx status from getTransaction:",j))}catch(it){pe=!0,clearInterval(se),console.error("getTransaction timeout:",it,j)}},Cn)),te=this.connection.onSignature(j,it=>{if(pe){this.connection.removeSignatureListener(te);return}pe=!0,zi(it)},"confirmed"),this.connection.getSignatureStatus(j)};return Y(),{txIds:[],signedTxs:T}}else{let R=[];for(let O=0;O<T.length;O+=1){let Y=await this.connection.sendTransaction(T[O],{skipPreflight:B});R.push(Y)}return{txIds:R,signedTxs:T}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};var Rr=ae(require("bn.js")),ea=new Rr.default(1e6);var vr=require("@solana/web3.js"),vt=ae(require("bn.js"));var V=require("@solana/buffer-layout"),Pi=V.Layout,Mr=V.Structure;var ki=V.UInt;var Or=V.u8,It=V.u16;var ye=V.s32;var Er=V.seq;var we=V.blob;var _t=class extends Pi{blob;signed;constructor(e,t,n){super(e,n),this.blob=we(e),this.signed=t}decode(e,t=0){let n=new vt.default(this.blob.decode(e,t),10,"le");return this.signed?n.fromTwos(this.span*8).clone():n}encode(e,t,n=0){return typeof e=="number"&&(e=new vt.default(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),t,n)}};function U(i){return new ki(1,i)}function _e(i){return new ki(4,i)}function P(i){return new _t(8,!1,i)}function X(i){return new _t(16,!1,i)}function _r(i){return new _t(8,!0,i)}function Fr(i){return new _t(16,!0,i)}var Ln=class extends Pi{layout;decoder;encoder;constructor(e,t,n,r){super(e.span,r),this.layout=e,this.decoder=t,this.encoder=n}decode(e,t){return this.decoder(this.layout.decode(e,t))}encode(e,t,n){return this.layout.encode(this.encoder(e),t,n)}getSpan(e,t){return this.layout.getSpan(e,t)}};function C(i){return new Ln(we(32),e=>new vr.PublicKey(e),e=>e.toBuffer(),i)}function Ie(i){return new Ln(Or(),ta,na,i)}function ta(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function na(i){return i?1:0}var Ai=class extends Mr{decode(e,t){return super.decode(e,t)}};function E(i,e,t){return new Ai(i,e,t)}function J(i,e,t){let n,r=typeof e=="number"?e:(0,vt.isBN)(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=(0,vt.isBN)(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Er(i,r,t)}var ka=require("@solana/web3.js"),Aa=ae(require("bn.js"));var Ri=require("@solana/spl-token");var ia=require("@solana/web3.js"),Wr=require("@solana/spl-token");var Vr=i=>new ve({mint:i.address,decimals:i.decimals,symbol:i.symbol,name:i.name}),tn=({amount:i,isRaw:e,name:t,...n})=>new fe(new ve({mint:Ye(n.address).toBase58(),decimals:n.decimals,symbol:n.symbol,name:t}),i,e,t);var xt=({address:i,programId:e,decimals:t,...n})=>({chainId:101,address:Ye(i).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{},...n});var wi=(...i)=>i.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ft=class{scope;disabled=!1;logger;constructor({scope:e,moduleName:t}){this.scope=e,this.logger=le(t)}createTxBuilder(e){return this.scope.checkOwner(),new Nn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(wi(e))}logInfo(...e){this.logger.info(wi(e))}logAndCreateError(...e){let t=wi(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var I=require("@solana/web3.js"),Fn=ae(require("bn.js"));var _=require("@solana/spl-token");var eo=ae(require("bn.js"));var Fe=ae(require("bn.js")),ge=new Fe.default(0),We=new Fe.default(1),at=new Fe.default(-1),Ve=new Fe.default(1).shln(64),Rn=new Fe.default(1).shln(128),hi=Ve.sub(We),nn=64,Dr=Rn.subn(1),Ne=-443636,Le=-Ne,tt=new Fe.default("4295048016"),nt=new Fe.default("79226673521066979257578248091"),Mn=new Fe.default("4295048017"),On=new Fe.default("79226673521066979257578248090"),qr=16,Ur="59543866431248",Gr="184467440737095516",Xr="15793534762490258745",En=new Fe.default(10).pow(new Fe.default(6));var pm=new Fe.default("18446744073700000000");var Q=ae(require("bn.js"));function vn(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Ti(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Bi(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function rn(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function zr(i,e){return rn(i,e)?null:Ti(i,e)}function Hr(i,e){return rn(i,e)?null:Bi(i,e)}var Pm=Buffer.from("amm_config","utf8"),ra=Buffer.from("pool","utf8"),oa=Buffer.from("pool_vault","utf8"),sa=Buffer.from("pool_reward_vault","utf8"),Qr=Buffer.from("position","utf8"),aa=Buffer.from("tick_array","utf8"),ua=Buffer.from("operation","utf8"),ca=Buffer.from("pool_tick_array_bitmap_extension","utf8"),la=Buffer.from("observation","utf8");function jr(i,e,t,n){return Ae([ra,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Ii(i,e,t){return Ae([oa,e.toBuffer(),t.toBuffer()],i)}function Zr(i,e,t){return Ae([sa,e.toBuffer(),t.toBuffer()],i)}function re(i,e,t){return Ae([aa,e.toBuffer(),vn(t)],i)}function ut(i,e,t,n){return Ae([Qr,e.toBuffer(),vn(t),vn(n)],i)}function Oe(i,e){return Ae([Qr,e.toBuffer()],i)}function Wt(i){return Ae([Buffer.from("metadata","utf8"),yt.toBuffer(),i.toBuffer()],yt)}function _n(i){return Ae([ua],i)}function he(i,e){return Ae([ca,e.toBuffer()],i)}function Yr(i,e){return Ae([la,e.toBuffer()],i)}var Jr=Buffer.from("locked_position","utf8");function xi(i,e){return Ae([Jr,e.toBuffer()],i)}function Si(i,e){return Ae([Jr,e.toBuffer()],i)}var km=Buffer.from("support_mint","utf8");var Ee=require("@solana/web3.js"),Ci=require("@solana/spl-token"),de=ae(require("bn.js"));var He=ae(require("bn.js"));var on=class{static getfeeGrowthInside(e,t,n){let r=new He.default(0),o=new He.default(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new He.default(0),a=new He.default(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=H.wrappingSubU128(H.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),u=H.wrappingSubU128(H.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=H.mulDivFloor(H.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ve),c=t.tokenFeesOwedA.add(a),u=H.mulDivFloor(H.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ve),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=H.mulDivFloor(H.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ve),c=t.tokenFeesOwedA.add(a),u=H.mulDivFloor(H.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ve),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=H.wrappingSubU128(c,u.growthInsideLastX64),p=H.mulDivFloor(l,t.liquidity,Ve),m=u.rewardAmountOwed.add(p);o.push(m)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=H.wrappingSubU128(c,u.growthInsideLastX64),p=H.mulDivFloor(l,t.liquidity,Ve),m=u.rewardAmountOwed.add(p);o.push(m)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new He.default(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new He.default(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(H.wrappingSubU128(H.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new He.default(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new He.default(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(H.wrappingSubU128(H.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){let a=z.priceToSqrtPriceX64(new M(e.price),e.mintA.decimals,e.mintB.decimals),c=z.getSqrtPriceX64FromTick(t.tickLower),u=z.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,p=ee.getAmountsFromLiquidity(a,c,u,n,o),[m,d]=[ke(p.amountA,e.mintA.extensions?.feeConfig,s,!0),ke(p.amountB,e.mintB.extensions?.feeConfig,s,!0)],[f,b]=[ke(new He.default(new M(p.amountA.toString()).mul(l).toFixed(0)),e.mintA.extensions?.feeConfig,s,!0),ke(new He.default(new M(p.amountB.toString()).mul(l).toFixed(0)),e.mintB.extensions?.feeConfig,s,!0)];return{liquidity:n,amountA:m,amountB:d,amountSlippageA:f,amountSlippageB:b,expirationTime:ze(m.expirationTime,d.expirationTime)}}};var ma=15,$=class{static async getTickArrays(e,t,n,r,o,s,a){let c=[],u=v.getTickArrayStartIndexByTick(r,o),l=v.getInitializedTickArrayInRange(s,a,o,u,Math.floor(ma/2));for(let d=0;d<l.length;d++){let{publicKey:f}=re(t,n,l[d]);c.push(f)}let p=(await ot(e,c)).map(d=>d!==null?sn.decode(d.data):null),m={};for(let d=0;d<c.length;d++){let f=p[d];f!==null&&(m[f.startTickIndex]={...f,address:c[d]})}return m}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(u=v.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let l=n[u];if(l===void 0)continue;let{nextTick:p,tickArrayAddress:m,tickArrayStartTickIndex:d}=this.firstInitializedTickInOneArray(e,t,l,s);[a,c,u]=[p,m,d]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/$.tickCount(t)),a=n?v.searchLowBitFromStart(r,o,s-1,1,t):v.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=Be-1;for(;a>=0;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a-1}}else{let a=0;for(;a<Be;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a+1}}let{publicKey:s}=re(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=v.getTickArrayStartIndexByTick(r,o),c=Math.floor((r-a)/o),u=n[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;c>=0;){let m=u.ticks[c];if(m.liquidityGross.gtn(0)){l=m;break}c=c-1}else for(c=c+1;c<Be;){let m=u.ticks[c];if(m.liquidityGross.gtn(0)){l=m;break}c=c+1}let{publicKey:p}=re(e,t,a);return{initializedTick:l,tickArrayAddress:p,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(v.checkIsOutOfBoundary(e)){if(e>Le)return!1;let n=v.getTickArrayStartIndexByTick(Ne,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return Be*e}};var Ki=14,ct=class{static maxTickInTickarrayBitmap(e){return e*Be*St}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!$.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-$.tickCount(n):t+$.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*Be,c=s/a+512;s<0&&s%a!=0&&c--;let u=Math.abs(c);if(r){let l=e.shln(1024-u-1),p=zr(1024,l);if(p!==null){let m=(u-p-512)*a;return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(u),p=Hr(1024,l);if(p!==null){let m=(u+p-512)*a;return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:o-$.tickCount(n)}}}},an=class{static getBitmapOffset(e,t){if(!$.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=ct.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=ct.maxTickInTickarrayBitmap(e),n=-t;if(Le<=t)throw Error(`extensionTickBoundary check error: ${Le}, ${t}`);if(n<=Ne)throw Error(`extensionTickBoundary check error: ${n}, ${Ne}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:v.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=$.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=ct.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let c=v.mergeTickArrayBitmap(e).shln(St-1-a),u=rn(512,c)?null:Ti(512,c);if(u!==null){let l=t-u*$.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let c=v.mergeTickArrayBitmap(e).shrn(a),u=rn(512,c)?null:Bi(512,c);if(u!==null){let l=t+u*$.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-$.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%ct.maxTickInTickarrayBitmap(t),r=Math.floor(n/$.tickCount(t));return e<0&&n!=0&&(r=St-r),r}};var Pe=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,c=[],{isExist:u,startIndex:l,nextAccountMeta:p}=this.getFirstInitializedTickArray(e,a);if(!u||l===void 0||!p)throw new Error("Invalid tick array");c.push(p);let{allTrade:m,amountCalculated:d,accounts:f,sqrtPriceX64:b,feeAmount:y}=Kt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return c.push(...f),{allTrade:m,expectedAmountOut:d.mul(at),remainingAccounts:c,executionPrice:b,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");try{let b=this.preInitializedTickArrayStartIndex(e,s);if(b.isExist){let{publicKey:y}=re(e.programId,e.id,b.nextStartIndex);a.push(y)}}catch{}a.push(l);let{amountCalculated:p,accounts:m,sqrtPriceX64:d,feeAmount:f}=Kt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(at),u,o);return a.push(...m),{expectedAmountIn:p,remainingAccounts:a,executionPrice:d,feeAmount:f}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=Pe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?an.checkTickArrayIsInit($.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):v.checkTickArrayIsInitialized(v.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=re(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,$.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=re(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/$.tickCount(e.tickSpacing)),r=t?v.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):v.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=$.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=ct.nextInitializedTickArrayStartIndex(v.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=an.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Ne||t>Le)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){let s=[];for(let a=0;a<o.length;a++){let c=o[a],u=t.rewardDefaultInfos[a]?.mint.programId??(await e.getAccountInfo(c.tokenMint))?.owner;if(u===void 0)throw Error("get new reward mint info error");let l={...c,perSecond:H.x64ToDecimal(c.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ee.PublicKey(u)};if(l.tokenMint.equals(Ee.PublicKey.default))continue;if(n<=l.openTime.toNumber()||r.eq(ge)){s.push(l);continue}let p=new de.default(Math.min(l.endTime.toNumber(),n)),m=p.sub(l.lastUpdateTime),d=H.mulDivFloor(m,l.emissionsPerSecondX64,r),f=l.rewardGrowthGlobalX64.add(d),b=H.mulDivFloor(m,l.emissionsPerSecondX64,Ve),y=l.rewardTotalEmissioned.add(b);s.push({...l,rewardGrowthGlobalX64:f,rewardTotalEmissioned:y,lastUpdateTime:p})}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=v.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=ct.maxTickInTickarrayBitmap(e),n=-t;return t>Le&&(t=$.getArrayStartIndex(Le,e)+$.tickCount(e)),n<Ne&&(n=$.getArrayStartIndex(Ne,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!$.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/$.tickCount(t)*St}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await ht(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=$r.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let c of t){let u=v.getTickArrayStartIndexByTick(c.tickCurrent,c.tickSpacing),l=v.getInitializedTickArrayInRange(c.tickArrayBitmap,c.exBitmapInfo,c.tickSpacing,u,7);for(let p of l){let{publicKey:m}=re(c.programId,c.id,p);o.push({pubkey:m}),r[m.toString()]=c.id}}let s=await ht(e,o,{batchRequest:n}),a={};for(let c of s){if(!c.accountInfo)continue;let u=r[c.pubkey.toString()];if(!u)continue;a[u.toString()]===void 0&&(a[u.toString()]={});let l=sn.decode(c.accountInfo.data);a[u.toString()][l.startTickIndex]={...l,address:c.pubkey}}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){let s=[];for(let a=0;a<e.length;a++){let c=e[a];c!==null&&(s.find(u=>u.equals(c.state.programId))||s.push(c.state.programId))}if(n){let a=n.tokenAccounts.map(p=>p.accountInfo.mint),c=[];for(let p of a)for(let m of s)c.push(Oe(m,p).publicKey);let u=await ot(t,c,{batchRequest:r}),l={};for(let p of u){if(p===null)continue;let m=Ni.decode(p.data),d=m.poolId.toString(),f=e.find(B=>B.state.id.toBase58()===d);if(f===void 0)continue;let b=f.state,y=v._getTickPriceLegacy({poolInfo:b,tick:m.tickLower,baseIn:!0}),g=v._getTickPriceLegacy({poolInfo:b,tick:m.tickUpper,baseIn:!0}),{amountA:A,amountB:w}=ee.getAmountsFromLiquidity(b.sqrtPriceX64,y.tickSqrtPriceX64,g.tickSqrtPriceX64,m.liquidity,!1),h=1/(1-Math.sqrt(Math.sqrt(y.price.div(g.price).toNumber())));f.positionAccount=[...f.positionAccount??[],{poolId:m.poolId,nftMint:m.nftMint,priceLower:y.price,priceUpper:g.price,amountA:A,amountB:w,tickLower:m.tickLower,tickUpper:m.tickUpper,liquidity:m.liquidity,feeGrowthInsideLastX64A:m.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:m.feeGrowthInsideLastX64B,tokenFeesOwedA:m.tokenFeesOwedA,tokenFeesOwedB:m.tokenFeesOwedB,rewardInfos:m.rewardInfos.map(B=>({...B,pendingReward:new de.default(0)})),leverage:h,tokenFeeAmountA:new de.default(0),tokenFeeAmountB:new de.default(0)}];let x=await v.getTickArrayAddressByTick(f.state.programId,m.poolId,m.tickLower,f.state.tickSpacing),k=await v.getTickArrayAddressByTick(f.state.programId,m.poolId,m.tickUpper,f.state.tickSpacing);l[`${f.state.programId.toString()}-${m.poolId.toString()}-${m.tickLower}`]=x,l[`${f.state.programId.toString()}-${m.poolId.toString()}-${m.tickUpper}`]=k}if(o){let p=Object.values(l),m=await ot(t,p,{batchRequest:r}),d={};for(let f=0;f<p.length;f++){let b=m[f];if(b===null)continue;let y=p[f].toString();d[y]=sn.decode(b.data)}for(let{state:f,positionAccount:b}of e)if(!!b)for(let y of b){let g=`${f.programId.toString()}-${f.id.toString()}-${y.tickLower}`,A=`${f.programId.toString()}-${f.id.toString()}-${y.tickUpper}`,w=d[l[g].toString()],h=d[l[A].toString()],x=w.ticks[v.getTickOffsetInArray(y.tickLower,f.tickSpacing)],k=h.ticks[v.getTickOffsetInArray(y.tickUpper,f.tickSpacing)],{tokenFeeAmountA:B,tokenFeeAmountB:L}=await on.GetPositionFees(f,y,x,k),T=await on.GetPositionRewards(f,y,x,k);y.tokenFeeAmountA=B.gte(new de.default(0))?B:new de.default(0),y.tokenFeeAmountB=L.gte(new de.default(0))?L:new de.default(0);for(let R=0;R<T.length;R++)y.rewardInfos[R].pendingReward=T[R].gte(new de.default(0))?T[R]:new de.default(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new M(0),catchLiquidityInsufficient:c=!1}){let u,l=n.toBase58()===e.mintA.address,[p,m]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new M(0))?u=l?tt.add(new de.default(1)):nt.sub(new de.default(1)):u=z.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let d=ke(o,p,r,!1),{allTrade:f,expectedAmountOut:b,remainingAccounts:y,executionPrice:g,feeAmount:A}=Pe.getOutputAmountAndRemainAccounts(e,t,n,d.amount.sub(d.fee??ge),u,c),w=ke(b,m,r,!1),h=z.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),x=l?h:new M(1).div(h),k=b.mul(new de.default(Math.floor((1-s)*1e10))).div(new de.default(1e10)),B=ke(k,m,r,!1),L=l?e.currentPrice:new M(1).div(e.currentPrice),T=new M(x).sub(L).abs(),R=L,O=new st(new M(T).mul(10**15).toFixed(0),new M(R).mul(10**15).toFixed(0));return{allTrade:f,realAmountIn:d,amountOut:w,minAmountOut:B,expirationTime:ze(d.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:x,priceImpact:O,fee:A,remainingAccounts:y,executionPriceX64:g}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let c=r.address===e.mintB.address,[u,l]=c?[e.mintA,e.mintB]:[e.mintB,e.mintA],[p,m]=[new ve({...u,mint:u.address,isToken2022:u.programId===Ci.TOKEN_2022_PROGRAM_ID.toBase58()}),new ve({...l,mint:l.address,isToken2022:l.programId===Ci.TOKEN_2022_PROGRAM_ID.toBase58()})],{allTrade:d,realAmountIn:f,amountOut:b,minAmountOut:y,expirationTime:g,currentPrice:A,executionPrice:w,priceImpact:h,fee:x,remainingAccounts:k,executionPriceX64:B}=Pe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Ee.PublicKey(u.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),L={...f,amount:new fe(p,f.amount),fee:f.fee===void 0?void 0:new fe(p,f.fee)},T={...b,amount:new fe(m,b.amount),fee:b.fee===void 0?void 0:new fe(m,b.fee)},R={...y,amount:new fe(m,y.amount),fee:y.fee===void 0?void 0:new fe(m,y.fee)},O=new Me({baseToken:p,denominator:new de.default(10).pow(new de.default(20+p.decimals)),quoteToken:m,numerator:A.mul(new M(10**(20+m.decimals))).toFixed(0)}),Y=new Me({baseToken:p,denominator:new de.default(10).pow(new de.default(20+p.decimals)),quoteToken:m,numerator:w.mul(new M(10**(20+m.decimals))).toFixed(0)}),j=new fe(p,x);return{allTrade:d,realAmountIn:L,amountOut:T,minAmountOut:R,expirationTime:g,currentPrice:O,executionPrice:Y,priceImpact:h,fee:j,remainingAccounts:k,executionPriceX64:B}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new M(0)}){let c=n.toBase58()===e.mintA.address,u={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new M(0))?l=c?nt.sub(new de.default(1)):tt.add(new de.default(1)):l=z.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=ke(o,u[n.toString()],r,!0),{expectedAmountIn:m,remainingAccounts:d,executionPrice:f,feeAmount:b}=Pe.getInputAmountAndRemainAccounts(e,t,n,p.amount.sub(p.fee??ge),l),y=c?e.mintB.address:e.mintA.address,g=ke(m,u[y],r,!1),A=z.sqrtPriceX64ToPrice(f,e.mintA.decimals,e.mintB.decimals),w=c?A:new M(1).div(A),h=m.mul(new de.default(Math.floor((1+s)*1e10))).div(new de.default(1e10)),x=ke(h,u[y],r,!0),k=c?e.currentPrice:new M(1).div(e.currentPrice),B=new M(w).sub(k).abs(),L=k,T=new st(new M(B).mul(10**15).toFixed(0),new M(L).mul(10**15).toFixed(0));return{amountIn:g,maxAmountIn:x,realAmountOut:p,expirationTime:ze(g.expirationTime,p.expirationTime),currentPrice:e.currentPrice,executionPrice:w,priceImpact:T,fee:b,remainingAccounts:d}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){let o=e[t],s=v.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=v.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),c=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-c,p=a-s,m=o.priceMax-o.priceMin,d;return l<=0?d=0:p===l?d=m/l:m===l?d=l/p:d=l/m*(l/p),{feeApr:o.feeApr*d,rewardsApr:[(o.rewardApr[0]??0)*d,(o.rewardApr[1]??0)*d,(o.rewardApr[2]??0)*d],apr:o.apr*d}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:c}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],p=r[Ye(e.mintA.address).toString()],m=r[Ye(e.mintB.address).toString()],d=e.mintA.decimals,f=e.mintB.decimals;if(!l||!p||!m)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let b=z.priceToSqrtPriceX64(new M(e.price),e.mintA.decimals,e.mintB.decimals),y=z.getSqrtPriceX64FromTick(s),g=z.getSqrtPriceX64FromTick(a),{amountSlippageA:A,amountSlippageB:w}=ee.getAmountsFromLiquidityWithSlippage(b,y,g,t,!1,!1,0),{amountSlippageA:h,amountSlippageB:x}=ee.getAmountsFromLiquidityWithSlippage(b,y,g,o,!1,!1,0),k=new M(A.toString()).div(new M(10).pow(d)).mul(p.value).add(new M(w.toString()).div(new M(10).pow(f)).mul(m.value)),B=new M(h.toString()).div(new M(10).pow(d)).mul(p.value).add(new M(x.toString()).div(new M(10).pow(f)).mul(m.value)),L=new M(1).div(k.add(B)),R=new M(l.volumeFee).mul(365).div(u).mul(L).mul(100).toNumber(),O=3600*24*365,Y=e.rewardDefaultInfos.map(j=>{let pe=j.mint.decimals,se=r[j.mint.address];return c<(j.startTime??0)||c>(j.endTime??0)||!j.perSecond||!se||pe===void 0?0:new M(se.value).mul(new M(j.perSecond).mul(O)).div(new M(10).pow(pe)).mul(L).mul(100).toNumber()});return{feeApr:R,rewardsApr:Y,apr:R+Y.reduce((j,pe)=>j+pe,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:c,amountHasFee:u}){let l=z.priceToSqrtPriceX64(new M(e.price),e.mintA.decimals,e.mintB.decimals),p=z.getSqrtPriceX64FromTick(n),m=z.getSqrtPriceX64FromTick(r),d=ke(o,e[t?"mintA":"mintB"].extensions?.feeConfig,c,!u),f=new de.default(new M(d.amount.sub(d.fee??ge).toString()).toFixed(0)),b;if(l.lte(p))b=t?ee.getLiquidityFromTokenAmountA(p,m,f,!a):new de.default(0);else if(l.lte(m)){let g=ee.getLiquidityFromTokenAmountA(l,m,f,!a),A=ee.getLiquidityFromTokenAmountB(p,l,f);b=t?g:A}else b=t?new de.default(0):ee.getLiquidityFromTokenAmountB(p,m,f);let y=await Pe.getAmountsFromLiquidity({epochInfo:c,poolInfo:e,tickLower:n,tickUpper:r,liquidity:b,slippage:s,add:a});return{liquidity:b,amountA:t?d:y.amountA,amountB:t?y.amountB:d,amountSlippageA:t?d:y.amountSlippageA,amountSlippageB:t?y.amountSlippageB:d,expirationTime:y.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){let c=z.getSqrtPriceX64FromTick(n),u=z.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,p=ee.getAmountsFromLiquidity(z.priceToSqrtPriceX64(new M(t.price),t.mintA.decimals,t.mintB.decimals),c,u,o,a),[m,d]=[ke(p.amountA,t.mintA.extensions?.feeConfig,e,!0),ke(p.amountB,t.mintB.extensions?.feeConfig,e,!0)],[f,b]=[ke(p.amountA.muln(l),t.mintA.extensions?.feeConfig,e,!0),ke(p.amountB.muln(l),t.mintB.extensions?.feeConfig,e,!0)];return{liquidity:o,amountA:m,amountB:d,amountSlippageA:f,amountSlippageB:b,expirationTime:ze(m.expirationTime,d.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(c=>!n[c.id]).map(c=>new Ee.PublicKey(c.id));(await ot(e,r)).forEach((c,u)=>{!c||(n[r[u].toBase58()]=Vt.decode(c.data))});let s=t.map(c=>he(new Ee.PublicKey(c.programId),new Ee.PublicKey(c.id)).publicKey),a=await Pe.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((c,u)=>({...c,[u.id]:{...n[u.id],id:new Ee.PublicKey(u.id),version:6,programId:new Ee.PublicKey(u.programId),mintA:u.mintA,mintB:u.mintB,ammConfig:{...u.config,id:new Ee.PublicKey(u.config.id),fundOwner:""},currentPrice:new M(u.price),exBitmapAccount:he(new Ee.PublicKey(u.programId),new Ee.PublicKey(u.id)).publicKey,exBitmapInfo:a[he(new Ee.PublicKey(u.programId),new Ee.PublicKey(u.id)).publicKey.toBase58()],startTime:n[u.id].startTime.toNumber(),rewardInfos:n[u.id].rewardInfos}}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var H=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(ge)||(o=o.add(We)),o}static mulDivFloor(e,t,n){if(n.eq(ge))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ge))throw new Error("division by 0");return e.mul(t).add(n.sub(We)).div(n)}static x64ToDecimal(e,t){return new M(e.toString()).div(M.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new Q.default(e.mul(M.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Rn).sub(t).mod(Rn)}};function xe(i,e){return Li(i.mul(e),64,256)}function pa(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Li(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var z=class{static sqrtPriceX64ToPrice(e,t,n){return H.x64ToDecimal(e).pow(2).mul(M.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return H.decimalToX64(e.mul(M.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ge))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ge))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ge))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ge))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ge))return e;let o=t.shln(nn);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?H.mulDivCeil(s,e,a):H.mulDivRoundingUp(s,We,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return H.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(nn);if(r)return e.add(o.div(t));{let s=H.mulDivRoundingUp(o,We,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ne||e>Le)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new Q.default("18445821805675395072"):new Q.default("18446744073709551616");return(t&2)!=0&&(n=xe(n,new Q.default("18444899583751176192"))),(t&4)!=0&&(n=xe(n,new Q.default("18443055278223355904"))),(t&8)!=0&&(n=xe(n,new Q.default("18439367220385607680"))),(t&16)!=0&&(n=xe(n,new Q.default("18431993317065453568"))),(t&32)!=0&&(n=xe(n,new Q.default("18417254355718170624"))),(t&64)!=0&&(n=xe(n,new Q.default("18387811781193609216"))),(t&128)!=0&&(n=xe(n,new Q.default("18329067761203558400"))),(t&256)!=0&&(n=xe(n,new Q.default("18212142134806163456"))),(t&512)!=0&&(n=xe(n,new Q.default("17980523815641700352"))),(t&1024)!=0&&(n=xe(n,new Q.default("17526086738831433728"))),(t&2048)!=0&&(n=xe(n,new Q.default("16651378430235570176"))),(t&4096)!=0&&(n=xe(n,new Q.default("15030750278694412288"))),(t&8192)!=0&&(n=xe(n,new Q.default("12247334978884435968"))),(t&16384)!=0&&(n=xe(n,new Q.default("8131365268886854656"))),(t&32768)!=0&&(n=xe(n,new Q.default("3584323654725218816"))),(t&65536)!=0&&(n=xe(n,new Q.default("696457651848324352"))),(t&131072)!=0&&(n=xe(n,new Q.default("26294789957507116"))),(t&262144)!=0&&(n=xe(n,new Q.default("37481735321082"))),e>0&&(n=Dr.div(n)),n}static getTickFromPrice(e,t,n){return z.getTickFromSqrtPriceX64(z.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(nt)||e.lt(tt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new Q.default(t-64),r=pa(n,32,128),o=new Q.default("8000000000000000","hex"),s=0,a=new Q.default(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new Q.default(0))&&s<qr;){c=c.mul(c);let f=c.shrn(127);c=c.shrn(63+f.toNumber()),a=a.add(o.mul(f)),o=o.shrn(1),s+=1}let u=a.shrn(32),p=r.add(u).mul(new Q.default(Ur)),m=Li(p.sub(new Q.default(Gr)),64,128).toNumber(),d=Li(p.add(new Q.default(Xr)),64,128).toNumber();return m==d?m:z.getSqrtPriceX64FromTick(d).lte(e)?d:m}},Ct=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=z.getTickFromSqrtPriceX64(z.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=Ct.getTickWithPriceAndTickspacing(e,t,n,r),s=z.getSqrtPriceX64FromTick(o);return z.sqrtPriceX64ToPrice(s,n,r)}},ee=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ge))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(nn),s=t.sub(e);return r?H.mulDivRoundingUp(H.mulDivCeil(o,s,t),We,e):H.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ge))throw new Error("sqrtPriceX64A must greater than 0");return r?H.mulDivCeil(n,t.sub(e),Ve):H.mulDivFloor(n,t.sub(e),Ve)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?H.mulDivRoundingUp(a,We,hi):a.shrn(nn)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),H.mulDivFloor(n,hi,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return ee.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=ee.getLiquidityFromTokenAmountA(e,n,r,!1),a=ee.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return ee.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:ee.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new Q.default(0)};if(e.lt(n)){let s=ee.getTokenAmountAFromLiquidity(e,n,r,o),a=ee.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new Q.default(0),amountB:ee.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:c,amountB:u}=ee.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,p=new Q.default(new M(c.toString()).mul(l).toFixed(0)),m=new Q.default(new M(u.toString()).mul(l).toFixed(0));return{amountSlippageA:p,amountSlippageB:m}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:c}){let u=z.priceToSqrtPriceX64(new M(e.price),e.mintA.decimals,e.mintB.decimals),l=z.getSqrtPriceX64FromTick(t),p=z.getSqrtPriceX64FromTick(n),m=s?1+o:1-o,d=ee.getAmountsFromLiquidity(u,l,p,r,s),[f,b]=[ke(d.amountA,e.mintA.extensions?.feeConfig,a,c),ke(d.amountB,e.mintB.extensions?.feeConfig,a,c)],[y,g]=[ke(new Q.default(new M(d.amountA.toString()).mul(m).toFixed(0)),e.mintA.extensions?.feeConfig,a,c),ke(new Q.default(new M(d.amountB.toString()).mul(m).toFixed(0)),e.mintB.extensions?.feeConfig,a,c)];return{liquidity:r,amountA:f,amountB:b,amountSlippageA:y,amountSlippageB:g,expirationTime:ze(f.expirationTime,b.expirationTime)}}},Kt=class{static swapCompute(e,t,n,r,o,s,a,c,u,l,p,m,d,f,b=!1){if(m.eq(ge))throw new Error("amountSpecified must not be 0");if(f||(f=s?tt.add(We):nt.sub(We)),s){if(f.lt(tt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(f.gte(p))throw new Error("sqrtPriceX64 must smaller than current")}else{if(f.gt(nt))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(f.lte(p))throw new Error("sqrtPriceX64 must greater than current")}let y=m.gt(ge),g={amountSpecifiedRemaining:m,amountCalculated:ge,sqrtPriceX64:p,tick:u>d?Math.min(d+$.tickCount(l)-1,u):d,accounts:[],liquidity:c,feeAmount:new Q.default(0)},A=d,w=n[d],h=0,x=!s&&w.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(ge)&&!g.sqrtPriceX64.eq(f);){h>10;let k={};k.sqrtPriceStartX64=g.sqrtPriceX64;let B=v.nextInitTick(w,g.tick,l,s,x),L=B||null,T=null;if(!L?.liquidityGross.gtn(0)){let O=Pe.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},A,s);if(!O.isExist){if(b)return{allTrade:!1,amountSpecifiedRemaining:g.amountSpecifiedRemaining,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts};throw Error("swapCompute LiquidityInsufficient")}A=O.nextStartIndex;let{publicKey:Y}=re(e,t,A);T=Y,w=n[A];try{L=v.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}k.tickNext=L.tick,k.initialized=L.liquidityGross.gtn(0),d!==A&&T&&(g.accounts.push(T),d=A),k.tickNext<Ne?k.tickNext=Ne:k.tickNext>Le&&(k.tickNext=Le),k.sqrtPriceNextX64=z.getSqrtPriceX64FromTick(k.tickNext);let R;if(s&&k.sqrtPriceNextX64.lt(f)||!s&&k.sqrtPriceNextX64.gt(f)?R=f:R=k.sqrtPriceNextX64,[g.sqrtPriceX64,k.amountIn,k.amountOut,k.feeAmount]=Kt.swapStepCompute(g.sqrtPriceX64,R,g.liquidity,g.amountSpecifiedRemaining,a,s),g.feeAmount=g.feeAmount.add(k.feeAmount),y?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(k.amountIn.add(k.feeAmount)),g.amountCalculated=g.amountCalculated.sub(k.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(k.amountOut),g.amountCalculated=g.amountCalculated.add(k.amountIn.add(k.feeAmount))),g.sqrtPriceX64.eq(k.sqrtPriceNextX64)){if(k.initialized){let O=L.liquidityNet;s&&(O=O.mul(at)),g.liquidity=ee.addDelta(g.liquidity,O)}x=k.tickNext!=g.tick&&!s&&w.startTickIndex===k.tickNext,g.tick=s?k.tickNext-1:k.tickNext}else if(g.sqrtPriceX64!=k.sqrtPriceStartX64){let O=z.getTickFromSqrtPriceX64(g.sqrtPriceX64);x=O!=g.tick&&!s&&w.startTickIndex===O,g.tick=O}++h}try{let{nextStartIndex:k,isExist:B}=$.nextInitializedTickArray(g.tick,l,s,r,o);B&&d!==k&&(g.accounts.push(re(e,t,k).publicKey),d=k)}catch{}return{allTrade:!0,amountSpecifiedRemaining:ge,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,r,o,s){let a={sqrtPriceX64Next:new Q.default(0),amountIn:new Q.default(0),amountOut:new Q.default(0),feeAmount:new Q.default(0)},c=r.gte(ge);if(c){let l=H.mulDivFloor(r,En.sub(new Q.default(o.toString())),En);a.amountIn=s?ee.getTokenAmountAFromLiquidity(t,e,n,!0):ee.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(a.amountIn)?a.sqrtPriceX64Next=t:a.sqrtPriceX64Next=z.getNextSqrtPriceX64FromInput(e,n,l,s)}else a.amountOut=s?ee.getTokenAmountBFromLiquidity(t,e,n,!1):ee.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(at).gte(a.amountOut)?a.sqrtPriceX64Next=t:a.sqrtPriceX64Next=z.getNextSqrtPriceX64FromOutput(e,n,r.mul(at),s);let u=t.eq(a.sqrtPriceX64Next);return s?(u&&c||(a.amountIn=ee.getTokenAmountAFromLiquidity(a.sqrtPriceX64Next,e,n,!0)),u&&!c||(a.amountOut=ee.getTokenAmountBFromLiquidity(a.sqrtPriceX64Next,e,n,!1))):(a.amountIn=u&&c?a.amountIn:ee.getTokenAmountBFromLiquidity(e,a.sqrtPriceX64Next,n,!0),a.amountOut=u&&!c?a.amountOut:ee.getTokenAmountAFromLiquidity(e,a.sqrtPriceX64Next,n,!1)),!c&&a.amountOut.gt(r.mul(at))&&(a.amountOut=r.mul(at)),c&&!a.sqrtPriceX64Next.eq(t)?a.feeAmount=r.sub(a.amountIn):a.feeAmount=H.mulDivCeil(a.amountIn,new Q.default(o),En.sub(new Q.default(o))),[a.sqrtPriceX64Next,a.amountIn,a.amountOut,a.feeAmount]}};var Be=60,St=512,v=class{static getTickArrayAddressByTick(e,t,n,r){let o=v.getTickArrayStartIndexByTick(n,r),{publicKey:s}=re(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=v.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=Be)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=$.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*$.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*Be,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*Be,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*Be:e+t*Be}static mergeTickArrayBitmap(e){let t=new eo.default(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*Be));return[...v.searchLowBitFromStart(e,t,s-1,o,n),...v.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return v.searchHightBitFromStart(e,t,-7680,St,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=v.getAllInitializedTickArrayStartIndex(n,r,o);for(let c of a){let{publicKey:u}=re(e,t,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>v.mergeTickArrayBitmap(u)),a=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n--,a.length===r)break}let c=$.tickCount(o);return a.map(u=>u*c)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>v.mergeTickArrayBitmap(u)),a=[];for(;n<7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n++,a.length===r)break}let c=$.tickCount(o);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<Ne||e>Le}static nextInitTick(e,t,n,r,o){if($.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<Be;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=Be-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<Be;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=z.getSqrtPriceX64FromTick(t),o=z.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new M(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new M(1).div(t),o=Ct.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=z.getSqrtPriceX64FromTick(o),a=z.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new M(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=z.getSqrtPriceX64FromTick(t),o=z.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new M(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new M(1).div(t),o=Ct.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=z.getSqrtPriceX64FromTick(o),a=z.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new M(1).div(a)}}};var da=E([we(8),U("bump"),It("index"),C(""),_e("protocolFeeRate"),_e("tradeFeeRate"),It("tickSpacing"),J(P(),8,"")]),fa=E([_e("blockTimestamp"),_r("tickCumulative"),J(P(),4)]),to=E([we(8),Ie("initialized"),P("recentEpoch"),It("observationIndex"),C("poolId"),J(fa,100,"observations"),J(P(),4)]),ba=E([U("rewardState"),P("openTime"),P("endTime"),P("lastUpdateTime"),X("emissionsPerSecondX64"),P("rewardTotalEmissioned"),P("rewardClaimed"),C("tokenMint"),C("tokenVault"),C("creator"),X("rewardGrowthGlobalX64")]),Vt=E([we(8),U("bump"),C("ammConfig"),C("creator"),C("mintA"),C("mintB"),C("vaultA"),C("vaultB"),C("observationId"),U("mintDecimalsA"),U("mintDecimalsB"),It("tickSpacing"),X("liquidity"),X("sqrtPriceX64"),ye("tickCurrent"),_e(),X("feeGrowthGlobalX64A"),X("feeGrowthGlobalX64B"),P("protocolFeesTokenA"),P("protocolFeesTokenB"),X("swapInAmountTokenA"),X("swapOutAmountTokenB"),X("swapInAmountTokenB"),X("swapOutAmountTokenA"),U("status"),J(U(),7,""),J(ba,3,"rewardInfos"),J(P(),16,"tickArrayBitmap"),P("totalFeesTokenA"),P("totalFeesClaimedTokenA"),P("totalFeesTokenB"),P("totalFeesClaimedTokenB"),P("fundFeesTokenA"),P("fundFeesTokenB"),P("startTime"),J(P(),15*4-3,"padding")]),ya=E([X("growthInsideLastX64"),P("rewardAmountOwed")]),Ni=E([we(8),U("bump"),C("nftMint"),C("poolId"),ye("tickLower"),ye("tickUpper"),X("liquidity"),X("feeGrowthInsideLastX64A"),X("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),J(ya,3,"rewardInfos"),J(P(),8,"")]),wp=E([we(8),U("bump"),C("poolId"),ye("tickLowerIndex"),ye("tickUpperIndex"),X("liquidity"),X("feeGrowthInsideLastX64A"),X("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),J(X(),3,"rewardGrowthInside"),J(P(),8,"")]),ga=E([ye("tick"),Fr("liquidityNet"),X("liquidityGross"),X("feeGrowthOutsideX64A"),X("feeGrowthOutsideX64B"),J(X(),3,"rewardGrowthsOutsideX64"),J(_e(),13,"")]),sn=E([we(8),C("poolId"),ye("startTickIndex"),J(ga,Be,"ticks"),U("initializedTickCount"),J(U(),115,"")]),Pa=E([we(329),J(C(),100,"whitelistMints")]),$r=E([we(8),C("poolId"),J(J(P(),8),Ki,"positiveTickArrayBitmap"),J(J(P(),8),Ki,"negativeTickArrayBitmap")]),hp=E([P(),U("bump"),C("owner"),C("poolId"),C("positionId"),C("nftAccount"),J(P(),8)]),Tp=E([we(8),U("bump"),C("lockOwner"),C("poolId"),C("positionId"),C("nftAccount"),C("lockNftMint"),P("recentEpoch"),J(P(),8)]);to.span;var no=le("Raydium_Clmm"),De={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},io=[188,37,179,131,82,150,84,73],ro=[16,72,250,198,14,162,212,19],Nt=class{static createPoolInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,f){let b=E([X("sqrtPriceX64"),P("zero")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:I.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:$e,isSigner:!1,isWritable:!1},...f?.map(w=>({pubkey:w,isSigner:!1,isWritable:!1}))||[]],g=Buffer.alloc(b.span);b.encode({sqrtPriceX64:d,zero:ge},g);let A=Buffer.from([...De.createPool,...g]);return new I.TransactionInstruction({keys:y,programId:e,data:A})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,extendMintAccount:c}=e,[u,l]=[new I.PublicKey(r.address),new I.PublicKey(o.address)],{publicKey:p}=jr(t,s,u,l),{publicKey:m}=Yr(t,p),{publicKey:d}=Ii(t,p,u),{publicKey:f}=Ii(t,p,l),b=he(t,p).publicKey,y=[this.createPoolInstruction(t,p,n,s,m,u,d,new I.PublicKey(r.programId||_.TOKEN_PROGRAM_ID),l,f,new I.PublicKey(o.programId||_.TOKEN_PROGRAM_ID),b,a,c)];return{signers:[],instructions:y,instructionTypes:[Z.CreateAccount,Z.ClmmCreatePool],address:{poolId:p,observationId:m,exBitmapAccount:b,mintAVault:d,mintBVault:f},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,f,b,y,g,A,w,h,x,k,B,L,T,R){let O=E([ye("tickLowerIndex"),ye("tickUpperIndex"),ye("tickArrayLowerStartIndex"),ye("tickArrayUpperStartIndex"),X("liquidity"),P("amountMaxA"),P("amountMaxB"),Ie("withMetadata"),U("optionBaseFlag"),Ie("baseFlag")]),Y=[...R?[{pubkey:R,isSigner:!1,isWritable:!0}]:[]],j=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:$e,isSigner:!1,isWritable:!1},{pubkey:I.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:_.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...Y],pe=Buffer.alloc(O.span);O.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:h,tickArrayUpperStartIndex:x,liquidity:k,amountMaxA:B,amountMaxB:L,withMetadata:T==="create",baseFlag:!1,optionBaseFlag:0},pe);let se=Buffer.from([...De.openPosition,...pe]);return new I.TransactionInstruction({keys:j,programId:e,data:se})}static openPositionFromLiquidityInstruction22(e,t,n,r,o,s,a,c,u,l,p,m,d,f,b,y,g,A,w,h,x,k,B,L,T){let R=E([ye("tickLowerIndex"),ye("tickUpperIndex"),ye("tickArrayLowerStartIndex"),ye("tickArrayUpperStartIndex"),X("liquidity"),P("amountMaxA"),P("amountMaxB"),Ie("withMetadata"),U("optionBaseFlag"),Ie("baseFlag")]),O=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],Y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:$e,isSigner:!1,isWritable:!1},{pubkey:I.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:_.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...O],j=Buffer.alloc(R.span);R.encode({tickLowerIndex:g,tickUpperIndex:A,tickArrayLowerStartIndex:w,tickArrayUpperStartIndex:h,liquidity:x,amountMaxA:k,amountMaxB:B,withMetadata:L==="create",baseFlag:!1,optionBaseFlag:0},j);let pe=Buffer.from([...De.openPositionWithTokenEx,...j]);return new I.TransactionInstruction({keys:Y,programId:e,data:pe})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l,nft2022:p}){let m=[],[d,f]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],b;if(l)b=new I.PublicKey((await l(1))[0]);else{let T=I.Keypair.generate();m.push(T),b=T.publicKey}let y=v.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=v.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=re(d,f,y),{publicKey:w}=re(d,f,g),{publicKey:h}=p?be(n.wallet,b,_.TOKEN_2022_PROGRAM_ID):be(n.wallet,b,_.TOKEN_PROGRAM_ID),{publicKey:x}=Wt(b),{publicKey:k}=Oe(d,b),{publicKey:B}=ut(d,f,r,o),L=p?this.openPositionFromLiquidityInstruction22(d,n.feePayer,f,n.wallet,b,h,B,A,w,k,n.tokenAccountA,n.tokenAccountB,new I.PublicKey(t.vault.A),new I.PublicKey(t.vault.B),new I.PublicKey(e.mintA.address),new I.PublicKey(e.mintB.address),r,o,y,g,s,a,c,u,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?he(d,f).publicKey:void 0):this.openPositionFromLiquidityInstruction(d,n.feePayer,f,n.wallet,b,h,x,B,A,w,k,n.tokenAccountA,n.tokenAccountB,new I.PublicKey(t.vault.A),new I.PublicKey(t.vault.B),new I.PublicKey(e.mintA.address),new I.PublicKey(e.mintB.address),r,o,y,g,s,a,c,u,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?he(d,f).publicKey:void 0);return{signers:m,instructions:[L],instructionTypes:[Z.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:b,tickArrayLower:A,tickArrayUpper:w,positionNftAccount:h,metadataAccount:x,personalPosition:k,protocolPosition:B}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:u,getEphemeralSigners:l,nft2022:p}){let m=[],[d,f]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],b;if(l)b=new I.PublicKey((await l(1))[0]);else{let T=I.Keypair.generate();m.push(T),b=T.publicKey}let y=v.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=v.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=re(d,f,y),{publicKey:w}=re(d,f,g),{publicKey:h}=p?be(n.wallet,b,_.TOKEN_2022_PROGRAM_ID):be(n.wallet,b,_.TOKEN_PROGRAM_ID),{publicKey:x}=Wt(b),{publicKey:k}=Oe(d,b),{publicKey:B}=ut(d,f,r,o),L=p?this.openPositionFromBaseInstruction22(d,n.feePayer,f,n.wallet,b,h,B,A,w,k,n.tokenAccountA,n.tokenAccountB,new I.PublicKey(t.vault.A),new I.PublicKey(t.vault.B),new I.PublicKey(e.mintA.address),new I.PublicKey(e.mintB.address),r,o,y,g,u,s,a,c,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?he(d,f).publicKey:void 0):this.openPositionFromBaseInstruction(d,n.feePayer,f,n.wallet,b,h,x,B,A,w,k,n.tokenAccountA,n.tokenAccountB,new I.PublicKey(t.vault.A),new I.PublicKey(t.vault.B),new I.PublicKey(e.mintA.address),new I.PublicKey(e.mintB.address),r,o,y,g,u,s,a,c,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?he(d,f).publicKey:void 0);return{address:{nftMint:b,tickArrayLower:A,tickArrayUpper:w,positionNftAccount:h,metadataAccount:x,personalPosition:k,protocolPosition:B},instructions:[L],signers:m,instructionTypes:[Z.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,f,b,y,g,A,w,h,x,k,B,L,T,R){let O=E([ye("tickLowerIndex"),ye("tickUpperIndex"),ye("tickArrayLowerStartIndex"),ye("tickArrayUpperStartIndex"),X("liquidity"),P("amountMaxA"),P("amountMaxB"),Ie("withMetadata"),U("optionBaseFlag"),Ie("baseFlag")]),Y=[...R?[{pubkey:R,isSigner:!1,isWritable:!0}]:[]],j=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:$e,isSigner:!1,isWritable:!1},{pubkey:I.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:_.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...Y],pe=Buffer.alloc(O.span);O.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:h,tickArrayUpperStartIndex:x,liquidity:new Fn.default(0),amountMaxA:B==="MintA"?L:T,amountMaxB:B==="MintA"?T:L,withMetadata:k==="create",baseFlag:B==="MintA",optionBaseFlag:1},pe);let se=Buffer.from([...De.openPosition,...pe]);return new I.TransactionInstruction({keys:j,programId:e,data:se})}static openPositionFromBaseInstruction22(e,t,n,r,o,s,a,c,u,l,p,m,d,f,b,y,g,A,w,h,x,k,B,L,T){let R=E([ye("tickLowerIndex"),ye("tickUpperIndex"),ye("tickArrayLowerStartIndex"),ye("tickArrayUpperStartIndex"),X("liquidity"),P("amountMaxA"),P("amountMaxB"),Ie("withMetadata"),U("optionBaseFlag"),Ie("baseFlag")]),O=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],Y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:$e,isSigner:!1,isWritable:!1},{pubkey:I.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:_.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...O],j=Buffer.alloc(R.span);R.encode({tickLowerIndex:g,tickUpperIndex:A,tickArrayLowerStartIndex:w,tickArrayUpperStartIndex:h,liquidity:new Fn.default(0),amountMaxA:k==="MintA"?B:L,amountMaxB:k==="MintA"?L:B,withMetadata:x==="create",baseFlag:k==="MintA",optionBaseFlag:1},j);let pe=Buffer.from([...De.openPositionWithTokenEx,...j]);return new I.TransactionInstruction({keys:Y,programId:e,data:pe})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l,nft2022:p}){let m,d=[];if(l)m=new I.PublicKey((await l(1))[0]);else{let T=I.Keypair.generate();d.push(T),m=T.publicKey}let[f,b]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],y=v.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=v.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=re(f,b,y),{publicKey:w}=re(f,b,g),{publicKey:h}=p?be(n.wallet,m,_.TOKEN_2022_PROGRAM_ID):be(n.wallet,m,_.TOKEN_PROGRAM_ID),{publicKey:x}=Wt(m),{publicKey:k}=Oe(f,m),{publicKey:B}=ut(f,b,r,o),L=p?this.openPositionFromLiquidityInstruction22(f,n.wallet,b,n.wallet,m,h,B,A,w,k,n.tokenAccountA,n.tokenAccountB,new I.PublicKey(t.vault.A),new I.PublicKey(t.vault.B),new I.PublicKey(t.mintA.address),new I.PublicKey(t.mintB.address),r,o,y,g,s,a,c,u,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?he(f,b).publicKey:void 0):this.openPositionFromLiquidityInstruction(f,n.wallet,b,n.wallet,m,h,x,B,A,w,k,n.tokenAccountA,n.tokenAccountB,new I.PublicKey(t.vault.A),new I.PublicKey(t.vault.B),new I.PublicKey(t.mintA.address),new I.PublicKey(t.mintB.address),r,o,y,g,s,a,c,u,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?he(f,b).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:A,tickArrayUpper:w,positionNftAccount:h,metadataAccount:x,personalPosition:k,protocolPosition:B},instructions:[L],signers:d,instructionTypes:[Z.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o,s){let a=E([]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:I.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:s?_.TOKEN_2022_PROGRAM_ID:_.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],u=Buffer.alloc(a.span);a.encode({},u);let l=Buffer.from([...De.closePosition,...u]);return new I.TransactionInstruction({keys:c,programId:e,data:l})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r,nft2022:o}){let s=new I.PublicKey(e.programId),a=o?be(n.wallet,r.nftMint,_.TOKEN_2022_PROGRAM_ID).publicKey:be(n.wallet,r.nftMint,_.TOKEN_PROGRAM_ID).publicKey,{publicKey:c}=Oe(s,r.nftMint),u=[];return u.push(this.closePositionInstruction(s,n.wallet,r.nftMint,a,c,o)),{address:{positionNftAccount:a,personalPosition:c},signers:[],instructions:u,instructionTypes:[Z.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,f,b,y,g,A){let w=E([X("liquidity"),P("amountMaxA"),P("amountMaxB"),U("optionBaseFlag"),Ie("baseFlag")]),h=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],x=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:_.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},...h],k=Buffer.alloc(w.span);w.encode({liquidity:b,amountMaxA:y,amountMaxB:g,optionBaseFlag:0,baseFlag:!1},k);let B=Buffer.from([...De.increaseLiquidity,...k]);return new I.TransactionInstruction({keys:x,programId:e,data:B})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a,nft2022:c}){let[u,l]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],p=v.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=v.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=re(u,l,p),{publicKey:f}=re(u,l,m),{publicKey:b}=c?be(r.wallet,n.nftMint,_.TOKEN_2022_PROGRAM_ID):be(r.wallet,n.nftMint,_.TOKEN_PROGRAM_ID),{publicKey:y}=Oe(u,n.nftMint),{publicKey:g}=ut(u,l,n.tickLower,n.tickUpper),A=this.increasePositionFromLiquidityInstruction(u,r.wallet,b,y,l,g,d,f,r.tokenAccountA,r.tokenAccountB,new I.PublicKey(t.vault.A),new I.PublicKey(t.vault.B),new I.PublicKey(e.mintA.address),new I.PublicKey(e.mintB.address),o,s,a,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,m])?he(u,l).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:b,personalPosition:y,protocolPosition:g},signers:[],instructions:[A],instructionTypes:[Z.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a,nft2022:c}){let[u,l]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],p=v.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=v.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=re(u,l,p),{publicKey:f}=re(u,l,m),{publicKey:b}=c?be(r.wallet,n.nftMint,_.TOKEN_2022_PROGRAM_ID):be(r.wallet,n.nftMint,_.TOKEN_PROGRAM_ID),{publicKey:y}=Oe(u,n.nftMint),{publicKey:g}=ut(u,l,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:b,personalPosition:y,protocolPosition:g},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,b,y,l,g,d,f,r.tokenAccountA,r.tokenAccountB,new I.PublicKey(t.vault.A),new I.PublicKey(t.vault.B),new I.PublicKey(e.mintA.address),new I.PublicKey(e.mintB.address),o,s,a,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,m])?he(u,l).publicKey:void 0)],signers:[],instructionTypes:[Z.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,f,b,y,g,A){let w=E([X("liquidity"),P("amountMaxA"),P("amountMaxB"),U("optionBaseFlag"),Ie("baseFlag")]),h=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],x=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:_.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},...h],k=Buffer.alloc(w.span);w.encode({liquidity:new Fn.default(0),amountMaxA:b==="MintA"?y:g,amountMaxB:b==="MintA"?g:y,baseFlag:b==="MintA",optionBaseFlag:1},k);let B=Buffer.from([...De.increaseLiquidity,...k]);return new I.TransactionInstruction({keys:x,programId:e,data:B})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,f,b,y,g,A,w){let h=E([X("liquidity"),P("amountMinA"),P("amountMinB")]),x=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...b.map(T=>[{pubkey:T.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:T.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:T.rewardMint,isSigner:!1,isWritable:!1}]).flat()],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:_.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:hn,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},...x],B=Buffer.alloc(h.span);h.encode({liquidity:y,amountMinA:g,amountMinB:A},B);let L=Buffer.from([...De.decreaseLiquidity,...B]);return new I.TransactionInstruction({keys:k,programId:e,data:L})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:c,nft2022:u}){let[l,p]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],m=v.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=v.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=re(l,p,m),{publicKey:b}=re(l,p,d),{publicKey:y}=u?be(r.wallet,n.nftMint,_.TOKEN_2022_PROGRAM_ID):be(r.wallet,n.nftMint,c),{publicKey:g}=Oe(l,n.nftMint),{publicKey:A}=ut(l,p,n.tickLower,n.tickUpper),w=[];for(let k=0;k<e.rewardDefaultInfos.length;k++)w.push({poolRewardVault:new I.PublicKey(t.rewardInfos[k].vault),ownerRewardVault:r.rewardAccounts[k],rewardMint:new I.PublicKey(e.rewardDefaultInfos[k].mint.address)});let h=[],x=this.decreaseLiquidityInstruction(l,r.wallet,y,g,p,A,f,b,r.tokenAccountA,r.tokenAccountB,new I.PublicKey(t.vault.A),new I.PublicKey(t.vault.B),new I.PublicKey(e.mintA.address),new I.PublicKey(e.mintB.address),w,o,s,a,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?he(l,p).publicKey:void 0);return h.push(x),{address:{tickArrayLower:f,tickArrayUpper:b,positionNftAccount:y,personalPosition:g,protocolPosition:A},signers:[],instructions:h,instructionTypes:[Z.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,f,b,y,g){let A=E([P("amount"),P("otherAmountThreshold"),X("sqrtPriceLimitX64"),Ie("isBaseInput")]),w=[...g?[{pubkey:g,isSigner:!1,isWritable:!0}]:[],...p.map(B=>({pubkey:B,isSigner:!1,isWritable:!0}))],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:_.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:hn,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],x=Buffer.alloc(A.span);A.encode({amount:d,otherAmountThreshold:f,sqrtPriceLimitX64:b,isBaseInput:y},x);let k=Buffer.from([...De.swap,...x]);return new I.TransactionInstruction({keys:h,programId:e,data:k})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,p]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],[m,d]=[new I.PublicKey(t.vault.A),new I.PublicKey(t.vault.B)],[f,b]=[new I.PublicKey(e.mintA.address),new I.PublicKey(e.mintB.address)],y=e.mintA.address===o.toString(),g=[this.swapInstruction(l,r.wallet,p,new I.PublicKey(e.config.id),y?r.tokenAccountA:r.tokenAccountB,y?r.tokenAccountB:r.tokenAccountA,y?m:d,y?d:m,y?f:b,y?b:f,u,n,s,a,c,!0,he(l,p).publicKey)];return{signers:[],instructions:g,instructionTypes:[Z.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,p]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],[m,d]=[new I.PublicKey(t.vault.A),new I.PublicKey(t.vault.B)],[f,b]=[new I.PublicKey(e.mintA.address),new I.PublicKey(e.mintB.address)],y=e.mintA.address===o.toBase58(),g=[this.swapInstruction(l,r.wallet,p,new I.PublicKey(e.config.id),y?r.tokenAccountB:r.tokenAccountA,y?r.tokenAccountA:r.tokenAccountB,y?d:m,y?m:d,y?b:f,y?f:b,u,n,s,a,c,!1,he(l,p).publicKey)];return{signers:[],instructions:g,instructionTypes:[Z.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,c,u,l,p,m){let d=E([P("openTime"),P("endTime"),X("emissionsPerSecondX64")]),f=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:I.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:$e,isSigner:!1,isWritable:!1}],b=Buffer.alloc(d.span);d.encode({openTime:me(l),endTime:me(p),emissionsPerSecondX64:m},b);let y=Buffer.from([...De.initReward,...b]);return new I.TransactionInstruction({keys:f,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],a=Zr(o,s,r.mint).publicKey,c=_n(o).publicKey,u=[this.initRewardInstruction(o,n.wallet,s,c,new I.PublicKey(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:c},signers:[],instructions:u,instructionTypes:[Z.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,c,u,l,p,m){let d=E([U("rewardIndex"),X("emissionsPerSecondX64"),P("openTime"),P("endTime")]),f=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:_.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0}],b=Buffer.alloc(d.span);d.encode({rewardIndex:u,emissionsPerSecondX64:m,openTime:me(l),endTime:me(p)},b);let y=Buffer.from([...De.setRewardEmissions,...b]);return new I.TransactionInstruction({keys:f,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],a,c,u;for(let m=0;m<e.rewardDefaultInfos.length;m++)e.rewardDefaultInfos[m].mint.address===r.mint.toString()&&(a=m,c=new I.PublicKey(t.rewardInfos[m].vault),u=new I.PublicKey(t.rewardInfos[m].mint.address));(a===void 0||c===void 0)&&no.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=_n(o).publicKey,p=[this.setRewardInstruction(o,n.wallet,s,l,new I.PublicKey(e.config.id),n.tokenAccount,c,u,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:c,operationId:l},signers:[],instructions:p,instructionTypes:[Z.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let c=E([U("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:hn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(c.span);c.encode({rewardIndex:a},l);let p=Buffer.from([...De.collectReward,...l]);return new I.TransactionInstruction({keys:u,programId:e,data:p})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new I.PublicKey(e.programId),new I.PublicKey(e.id)],a,c;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,c=new I.PublicKey(t.rewardInfos[l].vault));(a===void 0||c===void 0)&&no.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,c,r,a)];return{address:{rewardVault:c},signers:[],instructions:u,instructionTypes:[Z.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:r,wallet:o,nftMint:s,nft2022:a,getEphemeralSigners:c}){let u=[],l;if(c)l=new I.PublicKey((await c(1))[0]);else{let g=I.Keypair.generate();u.push(g),l=g.publicKey}let p=a?be(o,s,_.TOKEN_2022_PROGRAM_ID).publicKey:be(o,s,_.TOKEN_PROGRAM_ID).publicKey,{publicKey:m}=Oe(n,s),d=Si(e,l).publicKey,f=be(o,l,_.TOKEN_PROGRAM_ID).publicKey,b=Wt(l).publicKey,y=Nt.lockPositionInstructionV2({programId:e,auth:t,payer:r,positionOwner:o,lockOwner:o,positionNftAccount:p,positionId:m,lockPositionId:d,lockNftMint:l,lockNftAccount:f,metadataAccount:b,withMetadata:!0,nft2022:a,positionNftMint:s,authPositionNftAccount:be(t,s,a?_.TOKEN_2022_PROGRAM_ID:_.TOKEN_PROGRAM_ID).publicKey,positionNftProgram:a?_.TOKEN_2022_PROGRAM_ID:_.TOKEN_PROGRAM_ID});return{address:{positionId:m,lockPositionId:d,lockNftAccount:f,lockNftMint:l,positionNftAccount:p,metadataAccount:b},instructions:[y],signers:u,instructionTypes:[Z.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:r,lockOwner:o,positionNftAccount:s,positionId:a,positionNftMint:c,authPositionNftAccount:u,positionNftProgram:l,lockPositionId:p,lockNftMint:m,lockNftAccount:d,metadataAccount:f,withMetadata:b}){let y=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!0,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:_.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:$e,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:I.SystemProgram.programId,isSigner:!1,isWritable:!1}],g=E([Ie("withMetadata")]),A=Buffer.alloc(g.span);g.encode({withMetadata:b},A);let w=Buffer.from([...io,...A]);return new I.TransactionInstruction({keys:y,programId:e,data:w})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:s}=be(r,o,_.TOKEN_PROGRAM_ID),{publicKey:a}=Oe(n,o),c=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:xi(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:_.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:I.SystemProgram.programId,isSigner:!1,isWritable:!1}];return new I.TransactionInstruction({keys:c,programId:e,data:Buffer.from(io)})}static harvestLockPositionInstruction(e){let[t,n]=[new I.PublicKey(e.poolKeys.programId),new I.PublicKey(e.poolKeys.id)],r=v.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=v.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=re(t,n,r),{publicKey:a}=re(t,n,o),{publicKey:c}=be(e.owner,e.ownerPosition.nftMint,_.TOKEN_PROGRAM_ID),{publicKey:u}=Oe(t,e.ownerPosition.nftMint),{publicKey:l}=ut(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),p=[];for(let f=0;f<e.poolKeys.rewardInfos.length;f++)p.push({poolRewardVault:new I.PublicKey(e.poolKeys.rewardInfos[f].vault),ownerRewardVault:e.ownerRewardAccounts[f],rewardMint:new I.PublicKey(e.poolKeys.rewardInfos[f].mint.address)});let m=[...p.map(f=>[{pubkey:f.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:f.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:f.rewardMint,isSigner:!1,isWritable:!1}]).flat()],d=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:xi(e.programId,u).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new I.PublicKey(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new I.PublicKey(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:_.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Ot,isSigner:!1,isWritable:!1},{pubkey:new I.PublicKey(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new I.PublicKey(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...m];return new I.TransactionInstruction({keys:d,programId:e.programId,data:Buffer.from(ro)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:r,lockOwner:o,lockNftMint:s,lockNftAccount:a,positionNftAccount:c,positionId:u,poolId:l,protocolPosition:p,vaultA:m,vaultB:d,tickArrayLower:f,tickArrayUpper:b,userVaultA:y,userVaultB:g,mintA:A,mintB:w,rewardAccounts:h,exTickArrayBitmap:x}){let k=[...x?[{pubkey:x,isSigner:!1,isWritable:!0}]:[],...h.map(L=>[{pubkey:L.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:L.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:L.rewardMint,isSigner:!1,isWritable:!1}]).flat()],B=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:_.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:_.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Ot,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...k];return new I.TransactionInstruction({keys:B,programId:e,data:Buffer.from(ro)})}};var xd=E([we(8),U("bump"),Ie("disableCreatePool"),It("index"),P("tradeFeeRate"),P("protocolFeeRate"),P("fundFeeRate"),P("createPoolFee"),C("protocolOwner"),C("fundOwner"),J(P(),16)]),oo=E([we(8),C("configId"),C("poolCreator"),C("vaultA"),C("vaultB"),C("mintLp"),C("mintA"),C("mintB"),C("mintProgramA"),C("mintProgramB"),C("observationId"),U("bump"),U("status"),U("lpDecimals"),U("mintDecimalA"),U("mintDecimalB"),P("lpAmount"),P("protocolFeesMintA"),P("protocolFeesMintB"),P("fundFeesMintA"),P("fundFeesMintB"),P("openTime"),J(P(),32)]);var un=require("@solana/web3.js"),Mi=require("@solana/spl-token");var wa=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Cd=Buffer.from("amm_config","utf8"),Nd=Buffer.from("pool","utf8"),Ld=Buffer.from("pool_lp_mint","utf8"),Rd=Buffer.from("pool_vault","utf8"),Md=Buffer.from("observation","utf8");function so(i){return Ae([wa],i)}var Od=Buffer.from("locked_liquidity","utf8");var Xd=le("Raydium_cpmm"),ha={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function ao(i,e,t,n,r,o,s,a,c,u,l,p,m,d,f,b){let y=E([P("amountIn"),P("amounOutMin")]),g=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0}],A=Buffer.alloc(y.span);return y.encode({amountIn:f,amounOutMin:b},A),new un.TransactionInstruction({keys:g,programId:i,data:Buffer.from([...ha.swapBaseInput,...A])})}var Ta=ae(require("bn.js")),Ba=ae(require("decimal.js-light"));var uo=ae(require("bn.js"));var Zd=new uo.default(0);var Oi=ae(require("bn.js")),Af=new Oi.default(25),wf=new Oi.default(1e4);var Ei=E([U("instruction"),P("amountIn"),P("minAmountOut")]),vi=E([U("instruction"),P("maxAmountIn"),P("amountOut")]),If=E([U("instruction"),U("nonce")]),Ia=E([U("instruction"),U("nonce"),P("startTime")]),_i=E([P("status"),P("nonce"),P("maxOrder"),P("depth"),P("baseDecimal"),P("quoteDecimal"),P("state"),P("resetFlag"),P("minSize"),P("volMaxCutRatio"),P("amountWaveRatio"),P("baseLotSize"),P("quoteLotSize"),P("minPriceMultiplier"),P("maxPriceMultiplier"),P("systemDecimalValue"),P("minSeparateNumerator"),P("minSeparateDenominator"),P("tradeFeeNumerator"),P("tradeFeeDenominator"),P("pnlNumerator"),P("pnlDenominator"),P("swapFeeNumerator"),P("swapFeeDenominator"),P("baseNeedTakePnl"),P("quoteNeedTakePnl"),P("quoteTotalPnl"),P("baseTotalPnl"),P("poolOpenTime"),P("punishPcAmount"),P("punishCoinAmount"),P("orderbookToInitTime"),X("swapBaseInAmount"),X("swapQuoteOutAmount"),P("swapBase2QuoteFee"),X("swapQuoteInAmount"),X("swapBaseOutAmount"),P("swapQuote2BaseFee"),C("baseVault"),C("quoteVault"),C("baseMint"),C("quoteMint"),C("lpMint"),C("openOrders"),C("marketId"),C("marketProgramId"),C("targetOrders"),C("withdrawQueue"),C("lpVault"),C("owner"),P("lpReserve"),J(P(),3,"padding")]),xf=E([P("accountType"),P("status"),P("nonce"),P("maxOrder"),P("depth"),P("baseDecimal"),P("quoteDecimal"),P("state"),P("resetFlag"),P("minSize"),P("volMaxCutRatio"),P("amountWaveRatio"),P("baseLotSize"),P("quoteLotSize"),P("minPriceMultiplier"),P("maxPriceMultiplier"),P("systemDecimalsValue"),P("abortTradeFactor"),P("priceTickMultiplier"),P("priceTick"),P("minSeparateNumerator"),P("minSeparateDenominator"),P("tradeFeeNumerator"),P("tradeFeeDenominator"),P("pnlNumerator"),P("pnlDenominator"),P("swapFeeNumerator"),P("swapFeeDenominator"),P("baseNeedTakePnl"),P("quoteNeedTakePnl"),P("quoteTotalPnl"),P("baseTotalPnl"),P("poolOpenTime"),P("punishPcAmount"),P("punishCoinAmount"),P("orderbookToInitTime"),X("swapBaseInAmount"),X("swapQuoteOutAmount"),X("swapQuoteInAmount"),X("swapBaseOutAmount"),P("swapQuote2BaseFee"),P("swapBase2QuoteFee"),C("baseVault"),C("quoteVault"),C("baseMint"),C("quoteMint"),C("lpMint"),C("modelDataAccount"),C("openOrders"),C("marketId"),C("marketProgramId"),C("targetOrders"),C("owner"),J(P(),64,"padding")]),xa=E([U("instruction"),P("baseAmountIn"),P("quoteAmountIn"),P("fixedSide"),P("otherAmountMin")]),Sa=E([U("instruction"),P("lpAmount"),P("baseAmountMin"),P("quoteAmountMin")]);var Sf=E([P("fee")]);var Da=require("@solana/web3.js"),qa=ae(require("bn.js"));var ho=require("@solana/spl-token");var Dt=require("@solana/web3.js"),Wn=require("@solana/spl-token");var co=require("@solana/web3.js");var Fi=new co.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ka=5e4,Ca=E([P("x"),P("y"),P("price")]),Lf=E([P("accountType"),P("status"),P("multiplier"),P("validDataCount"),J(Ca,Ka,"DataElement")]);var lo=le("Raydium_liquidity_instruction");function Na({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=Tt(i),s=Buffer.alloc(Ei.span);Ei.encode({instruction:9,amountIn:me(t),minAmountOut:me(n)},s);let a=[K({pubkey:Wn.TOKEN_PROGRAM_ID,isWritable:!1}),K({pubkey:o.id}),K({pubkey:o.authority,isWritable:!1}),K({pubkey:o.openOrders})];return r===4&&a.push(K({pubkey:o.targetOrders})),a.push(K({pubkey:o.vault.A}),K({pubkey:o.vault.B})),r===5&&a.push(K({pubkey:Fi})),a.push(K({pubkey:o.marketProgramId,isWritable:!1}),K({pubkey:o.marketId}),K({pubkey:o.marketBids}),K({pubkey:o.marketAsks}),K({pubkey:o.marketEventQueue}),K({pubkey:o.marketBaseVault}),K({pubkey:o.marketQuoteVault}),K({pubkey:o.marketAuthority,isWritable:!1}),K({pubkey:e.tokenAccountIn}),K({pubkey:e.tokenAccountOut}),K({pubkey:e.owner,isWritable:!1,isSigner:!0})),new Dt.TransactionInstruction({programId:o.programId,keys:a,data:s})}function La({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=Tt(i),s=Buffer.alloc(vi.span);vi.encode({instruction:11,maxAmountIn:me(t),amountOut:me(n)},s);let a=[K({pubkey:Wn.TOKEN_PROGRAM_ID,isWritable:!1}),K({pubkey:o.id}),K({pubkey:o.authority,isWritable:!1}),K({pubkey:o.openOrders}),K({pubkey:o.targetOrders}),K({pubkey:o.vault.A}),K({pubkey:o.vault.B})];return r===5&&a.push(K({pubkey:Fi})),a.push(K({pubkey:o.marketProgramId,isWritable:!1}),K({pubkey:o.marketId}),K({pubkey:o.marketBids}),K({pubkey:o.marketAsks}),K({pubkey:o.marketEventQueue}),K({pubkey:o.marketBaseVault}),K({pubkey:o.marketQuoteVault}),K({pubkey:o.marketAuthority,isWritable:!1}),K({pubkey:e.tokenAccountIn}),K({pubkey:e.tokenAccountOut}),K({pubkey:e.owner,isWritable:!1,isSigner:!0})),new Dt.TransactionInstruction({programId:o.programId,keys:a,data:s})}function mo(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return Na({...a,amountIn:r,minAmountOut:o},t);if(s==="out")return La({...a,maxAmountIn:r,amountOut:o},t);lo.logWithError("invalid params","params",i)}throw lo.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}var Ra=require("@solana/web3.js");var Xf=le("Raydium_liquidity_serum");var cn=E([C("mint"),C("owner"),P("amount"),_e("delegateOption"),C("delegate"),U("state"),_e("isNativeOption"),P("isNative"),P("delegatedAmount"),_e("closeAuthorityOption"),C("closeAuthority")]);var Un=require("@solana/web3.js"),_a=ae(require("bn.js"));var Po=require("@solana/spl-token");function Ma(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function Wi(i,...e){if(!Ma(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function Vi(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function po(i,e){Wi(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Dn=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),Qe=(i,e)=>i<<32-e|i>>>e;var Yf=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Oa(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function Di(i){return typeof i=="string"&&(i=Oa(i)),Wi(i),i}var Vn=class{clone(){return this._cloneInto()}},Jf={}.toString;function fo(i){let e=n=>i().update(Di(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function Ea(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),c=n?4:0,u=n?0:4;i.setUint32(e+c,s,n),i.setUint32(e+u,a,n)}var bo=(i,e,t)=>i&e^~i&t,yo=(i,e,t)=>i&e^i&t^e&t,qn=class extends Vn{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Dn(this.buffer)}update(e){Vi(this);let{view:t,buffer:n,blockLen:r}=this;e=Di(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let c=Dn(e);for(;r<=o-s;s+=r)this.process(c,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Vi(this),po(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let p=s;p<r;p++)t[p]=0;Ea(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=Dn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<u;p++)a.setUint32(4*p,l[p],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var va=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Pt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),kt=new Uint32Array(64),qi=class extends qn{constructor(){super(64,32,8,!1),this.A=Pt[0]|0,this.B=Pt[1]|0,this.C=Pt[2]|0,this.D=Pt[3]|0,this.E=Pt[4]|0,this.F=Pt[5]|0,this.G=Pt[6]|0,this.H=Pt[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:c}=this;return[e,t,n,r,o,s,a,c]}set(e,t,n,r,o,s,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=c|0}process(e,t){for(let p=0;p<16;p++,t+=4)kt[p]=e.getUint32(t,!1);for(let p=16;p<64;p++){let m=kt[p-15],d=kt[p-2],f=Qe(m,7)^Qe(m,18)^m>>>3,b=Qe(d,17)^Qe(d,19)^d>>>10;kt[p]=b+kt[p-7]+f+kt[p-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:c,G:u,H:l}=this;for(let p=0;p<64;p++){let m=Qe(a,6)^Qe(a,11)^Qe(a,25),d=l+m+bo(a,c,u)+va[p]+kt[p]|0,b=(Qe(n,2)^Qe(n,13)^Qe(n,22))+yo(n,r,o)|0;l=u,u=c,c=a,a=s+d|0,s=o,o=r,r=n,n=d+b|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,r,o,s,a,c,u,l)}roundClean(){kt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var go=fo(()=>new qi);var pb=le("Raydium_Util");function ko({fromPublicKey:i,programId:e=Po.TOKEN_PROGRAM_ID,assignSeed:t}){let n=t?btoa(t).slice(0,32):Un.Keypair.generate().publicKey.toBase58().slice(0,32);return{publicKey:Fa(i,n,e),seed:n}}function Fa(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=go(n);return new Un.PublicKey(r)}var Gn=require("@solana/web3.js"),Ao=ae(require("bn.js"));var je=require("@solana/spl-token");function Wa(i){let{mint:e,tokenAccount:t,owner:n,programId:r=je.TOKEN_PROGRAM_ID}=i;return(0,je.createInitializeAccountInstruction)(t,e,n,r)}function ln(i){let{tokenAccount:e,payer:t,multiSigners:n=[],owner:r,programId:o=je.TOKEN_PROGRAM_ID}=i;return(0,je.createCloseAccountInstruction)(e,t,r,n,o)}async function wo(i){let{connection:e,amount:t,commitment:n,payer:r,owner:o,skipCloseAccount:s}=i,a=await e.getMinimumBalanceForRentExemption(cn.span,n),c=me(t).add(new Ao.default(a)),u=ko({fromPublicKey:r,programId:je.TOKEN_PROGRAM_ID});return{addresses:{newAccount:u.publicKey},signers:[],instructions:[Gn.SystemProgram.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:u.seed,newAccountPubkey:u.publicKey,lamports:c.toNumber(),space:cn.span,programId:je.TOKEN_PROGRAM_ID}),Wa({mint:new Gn.PublicKey(Je.address),tokenAccount:u.publicKey,owner:o,programId:je.TOKEN_PROGRAM_ID})],instructionTypes:[Z.CreateAccount,Z.InitAccount],endInstructionTypes:s?[]:[Z.CloseAccount],endInstructions:s?[]:[ln({tokenAccount:u.publicKey,payer:r,owner:o})]}}var Va=E([_e("mintAuthorityOption"),C("mintAuthority"),P("supply"),U("decimals"),U("isInitialized"),_e("freezeAuthorityOption"),C("freezeAuthority")]);function Ua({programId:i}){let{publicKey:e}=Ae([Buffer.from("amm_config_account_seed","utf-8")],i);return e}function To({programId:i}){return Ae([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],i)}var Ui={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]},Bo=i=>{let e={},t=ho.TOKEN_PROGRAM_ID.toBase58();return Object.keys(i).map(n=>{let r=i[n],[o,s]=[r.baseMint.toBase58(),r.quoteMint.toBase58()];e[n]={id:n,version:4,status:r.status.toNumber(),programId:r.programId.toBase58(),mintA:xt({address:o,programId:t,decimals:r.baseDecimal.toNumber()}),mintB:xt({address:s,programId:t,decimals:r.quoteDecimal.toNumber()}),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:r.poolPrice.toNumber(),mintAmountA:new M(r.mintAAmount.toString()).div(10**r.baseDecimal.toNumber()).toNumber(),mintAmountB:new M(r.mintBAmount.toString()).div(10**r.quoteDecimal.toNumber()).toNumber(),baseReserve:r.baseReserve,quoteReserve:r.quoteReserve,feeRate:new M(r.tradeFeeNumerator.toString()).div(r.tradeFeeDenominator.toString()).toNumber(),openTime:r.poolOpenTime.toString(),tvl:0,day:Ui,week:Ui,month:Ui,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,type:"Standard",marketId:r.marketId.toBase58(),configId:Ua({programId:r.programId}).toBase58(),lpPrice:0,lpAmount:new M(r.lpReserve.toString()).div(10**Math.min(r.baseDecimal.toNumber(),r.quoteDecimal.toNumber())).toNumber(),lpMint:xt({address:r.lpMint.toBase58(),programId:t,decimals:Math.min(r.baseDecimal.toNumber(),r.quoteDecimal.toNumber())}),burnPercent:0}}),e};var Io={[fi.toBase58()]:3},xo={3:fi};var Gi=E([we(5),we(8),C("ownAddress"),P("vaultSignerNonce"),C("baseMint"),C("quoteMint"),C("baseVault"),P("baseDepositsTotal"),P("baseFeesAccrued"),C("quoteVault"),P("quoteDepositsTotal"),P("quoteFeesAccrued"),P("quoteDustThreshold"),C("requestQueue"),C("eventQueue"),C("bids"),C("asks"),P("baseLotSize"),P("quoteLotSize"),P("feeRateBps"),P("referrerRebatesAccrued"),we(7)]),So={3:Gi};var Xi=require("@solana/web3.js");var Xn=le("Serum"),zn=class{static getProgramId(e){let t=xo[e];return t||Xn.logWithError("invalid version","version",e),t}static getVersion(e){let t=e.toBase58(),n=Io[t];return n||Xn.logWithError("invalid program id","programId",t),n}static getStateLayout(e){let t=So[e];return t||Xn.logWithError(!!t,"invalid version","version",e),t}static getLayouts(e){return{state:this.getStateLayout(e)}}static getAssociatedAuthority({programId:e,marketId:t}){let n=[t.toBuffer()],r=0,o;for(;r<100;){try{let s=n.concat(Buffer.from([r]),Buffer.alloc(7));o=Xi.PublicKey.createProgramAddressSync(s,e)}catch(s){if(s instanceof TypeError)throw s;r++;continue}return{publicKey:o,nonce:r}}return Xn.logWithError("unable to find a viable program address nonce","params",{programId:e,marketId:t}),{publicKey:Xi.PublicKey.default,nonce:r}}};var W=require("@solana/web3.js"),At=ae(require("bn.js")),qt=require("@solana/spl-token");function Ga(i,e,t,n,r,o,s,a,c,u,l,p,m,d,f){let b=[],y=[K({pubkey:qt.TOKEN_PROGRAM_ID,isWritable:!1}),K({pubkey:qt.TOKEN_2022_PROGRAM_ID,isWritable:!1}),K({pubkey:qt.ASSOCIATED_TOKEN_PROGRAM_ID,isWritable:!1}),K({pubkey:W.SystemProgram.programId,isWritable:!1}),K({pubkey:e,isSigner:!0})];y.push(K({pubkey:t})),y.push(K({pubkey:r}));let g=[c,u],A=[l,p],w=[o,s,a];for(let k=0;k<g.length;k++){let B=g[k],L=w[k]===B.mintA.address;if(y.push(K({pubkey:new W.PublicKey(B.programId),isWritable:!1})),k===g.length-1?y.push(K({pubkey:r})):y.push(K({pubkey:n})),y.push(K({pubkey:new W.PublicKey(w[k])})),y.push(K({pubkey:new W.PublicKey(w[k+1])})),B.version===6){let T=A[k];y.push(K({pubkey:new W.PublicKey(T.config.id)})),y.push(K({pubkey:new W.PublicKey(T.id)})),y.push(K({pubkey:new W.PublicKey(L?T.vault.A:T.vault.B)})),y.push(K({pubkey:new W.PublicKey(L?T.vault.B:T.vault.A)})),y.push(K({pubkey:new W.PublicKey(B.observationId)})),y.push(K({pubkey:Ot})),y.push(K({pubkey:he(new W.PublicKey(B.programId),new W.PublicKey(B.id)).publicKey})),b.push(Xa(B.sqrtPriceX64.toString(),L));for(let R of f[k]??[])y.push(K({pubkey:new W.PublicKey(R)}))}else if(B.version===5){let T=A[k];y.push(K({pubkey:new W.PublicKey(T.id)})),y.push(K({pubkey:new W.PublicKey(T.authority),isWritable:!1})),y.push(K({pubkey:new W.PublicKey(T.marketProgramId)})),y.push(K({pubkey:new W.PublicKey(T.marketAuthority)})),y.push(K({pubkey:Cr,isWritable:!1})),y.push(K({pubkey:new W.PublicKey(T.openOrders)})),y.push(K({pubkey:new W.PublicKey(T.vault.A)})),y.push(K({pubkey:new W.PublicKey(T.vault.B)})),y.push(K({pubkey:new W.PublicKey(T.id)})),y.push(K({pubkey:new W.PublicKey(T.id)})),y.push(K({pubkey:new W.PublicKey(T.id)})),y.push(K({pubkey:new W.PublicKey(T.id)})),y.push(K({pubkey:new W.PublicKey(T.id)})),y.push(K({pubkey:new W.PublicKey(T.id)})),y.push(K({pubkey:new W.PublicKey(T.marketId)})),y.push(K({pubkey:new W.PublicKey(T.marketBids)})),y.push(K({pubkey:new W.PublicKey(T.marketAsks)})),y.push(K({pubkey:new W.PublicKey(T.marketEventQueue)})),y.push(K({pubkey:new W.PublicKey(T.marketBaseVault)})),y.push(K({pubkey:new W.PublicKey(T.marketQuoteVault)}))}else if(B.version===4){let T=A[k],R=B.status!==1;y.push(K({pubkey:new W.PublicKey(T.id)})),y.push(K({pubkey:new W.PublicKey(T.authority),isWritable:!1})),y.push(K({pubkey:new W.PublicKey(R?T.id:T.marketProgramId)})),y.push(K({pubkey:new W.PublicKey(R?T.id:T.marketAuthority)})),y.push(K({pubkey:new W.PublicKey(R?T.id:T.openOrders)})),y.push(K({pubkey:new W.PublicKey(T.vault.A)})),y.push(K({pubkey:new W.PublicKey(T.vault.B)})),y.push(K({pubkey:new W.PublicKey(R?T.id:T.marketId)})),y.push(K({pubkey:new W.PublicKey(R?T.id:T.marketBids)})),y.push(K({pubkey:new W.PublicKey(R?T.id:T.marketAsks)})),y.push(K({pubkey:new W.PublicKey(R?T.id:T.marketEventQueue)})),y.push(K({pubkey:new W.PublicKey(R?T.id:T.marketBaseVault)})),y.push(K({pubkey:new W.PublicKey(R?T.id:T.marketQuoteVault)}))}else if(B.version===7){let T=A[k];y.push(K({pubkey:new W.PublicKey(T.authority)})),y.push(K({pubkey:new W.PublicKey(T.config.id)})),y.push(K({pubkey:new W.PublicKey(T.id)})),y.push(K({pubkey:new W.PublicKey(L?T.vault.A:T.vault.B)})),y.push(K({pubkey:new W.PublicKey(L?T.vault.B:T.vault.A)})),y.push(K({pubkey:new W.PublicKey(B.observationId)}))}else throw Error("pool type error")}let h=E([U("insId"),P("amountIn"),P("amountOut"),J(X(),b.length,"clmmPriceLimit")]),x=Buffer.alloc(h.span);return h.encode({insId:0,amountIn:m,amountOut:d,clmmPriceLimit:b},x),new W.TransactionInstruction({keys:y,programId:i,data:x})}function Xa(i,e){if(i)if(e){let t=new At.default(i).div(new At.default(25));return t.gt(Mn)?t:Mn}else{let t=new At.default(i).mul(new At.default(25));return t.lt(On)?t:On}else return e?Mn:On}function Ko({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){if(n.routeType==="amm")if(n.poolInfo[0].version===6){let r=n.poolKey[0],o=Tt(r),s=t.equals(o.mintA.address)?tt.add(We):nt.sub(We);return Nt.makeSwapBaseInInstructions({poolInfo:r,poolKeys:r,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:o.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:o.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub(n.minAmountOut.fee?.raw??new At.default(0)),sqrtPriceLimitX64:s,remainingAccounts:n.remainingAccounts[0]??[]})}else if(n.poolInfo[0].version===7){let r=n.poolInfo[0],o=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[ao(r.programId,e.wallet,r.authority,r.configId,r.id,e.sourceToken,e.destinationToken,o?r.vaultA:r.vaultB,o?r.vaultB:r.vaultA,o?r.mintProgramA:r.mintProgramB,o?r.mintProgramB:r.mintProgramA,new W.PublicKey(r[o?"mintA":"mintB"].address),new W.PublicKey(r[o?"mintB":"mintA"].address),r.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[o?Z.CpmmSwapBaseIn:Z.CpmmSwapBaseOut],address:{}}}else{let r=n.poolKey[0];return{signers:[],instructions:[mo({poolKeys:r,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub(n.minAmountOut.fee?.raw??new At.default(0)),fixedSide:"in"})],lookupTableAddress:r.lookupTableAccount?[r.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?Z.AmmV5SwapBaseIn:Z.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let r=n.poolInfo[0],o=n.poolInfo[1],s=n.poolKey[0],a=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[Ga(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),r,o,s,a,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub(n.minAmountOut.fee?.raw??new At.default(0)),n.remainingAccounts)],instructionTypes:[Z.RouteSwap],lookupTableAddress:[s.lookupTableAccount,a.lookupTableAccount].filter(c=>c!==void 0),address:{}}}else throw Error("route type error")}var lt=new mn.default(0),Hn=class extends Ft{constructor(e){super(e)}async getWSolAccounts(){this.scope.checkOwner(),await this.scope.account.fetchWalletTokenAccounts();let e=this.scope.account.tokenAccounts.filter(t=>t.mint.equals(Xe));return e.sort((t,n)=>t.isAssociated?1:n.isAssociated||t.amount.lt(n.amount)?-1:1),e}async unWrapWSol(e){let{amount:t,tokenProgram:n,txVersion:r=1,feePayer:o}=e,s=await this.getWSolAccounts(),a=this.createTxBuilder(o);a.addCustomComputeBudget(e.computeBudgetConfig);let c=me(t);for(let u=0;u<s.length;u++)c.gte(s[u].amount)?(a.addInstruction({instructions:[ln({tokenAccount:s[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]}),c.sub(s[u].amount)):a.addInstruction({instructions:[ln({tokenAccount:s[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]});return a.versionBuild({txVersion:r})}async wrapWSol(e,t,n,r){let o=this.createTxBuilder(r),s=await wo({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:e,skipCloseAccount:!0});return o.addInstruction(s),o.versionBuild({txVersion:n??1})}async swap({swapInfo:e,swapPoolKeys:t,ownerInfo:n,computeBudgetConfig:r,routeProgram:o,txVersion:s,feePayer:a}){let c=this.createTxBuilder(a),u=e.amountIn,l=e.amountOut,p=u.amount.token.mint.equals(Xe),m=l.amount.token.mint.equals(Xe),d=u.amount.token.mint,f=l.amount.token.mint,{account:b,instructionParams:y}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.amount.token.isToken2022?oe.TOKEN_2022_PROGRAM_ID:oe.TOKEN_PROGRAM_ID,mint:d,notUseTokenAccount:p,owner:this.scope.ownerPubKey,skipCloseAccount:!p,createInfo:p?{payer:this.scope.ownerPubKey,amount:u.amount.raw}:void 0,associatedOnly:p?!1:n.associatedOnly,checkCreateATAOwner:n.checkCreateATAOwner});if(y&&c.addInstruction(y),b===void 0)throw Error("input account check error");let g;if(e.routeType==="route"&&!m)g=this.scope.account.getAssociatedTokenAccount(f,l.amount.token.isToken2022?oe.TOKEN_2022_PROGRAM_ID:oe.TOKEN_PROGRAM_ID);else{let{account:x,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:l.amount.token.isToken2022?oe.TOKEN_2022_PROGRAM_ID:oe.TOKEN_PROGRAM_ID,mint:f,notUseTokenAccount:m,owner:this.scope.ownerPubKey,skipCloseAccount:!0,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:m?!1:n.associatedOnly,checkCreateATAOwner:n.checkCreateATAOwner});g=x,k&&c.addInstruction(k)}m&&c.addInstruction({endInstructions:[ln({owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,tokenAccount:g,programId:oe.TOKEN_PROGRAM_ID})],endInstructionTypes:[Z.CloseAccount]});let A;if(e.routeType==="route"){let x=e.middleToken;A=this.scope.account.getAssociatedTokenAccount(x.mint,x.isToken2022?oe.TOKEN_2022_PROGRAM_ID:oe.TOKEN_PROGRAM_ID)}let w=t||await this.computePoolToPoolKeys({pools:e.poolInfoList}),h=Ko({routeProgram:o,inputMint:d,swapInfo:{...e,poolInfo:[...e.poolInfoList],poolKey:w,outputMint:f},ownerInfo:{wallet:this.scope.ownerPubKey,sourceToken:b,routeToken:A,destinationToken:g}});if(e.feeConfig!==void 0){let x=this.createTxBuilder();x.addInstruction({instructions:[(0,oe.createTransferInstruction)(b,e.feeConfig.feeAccount,this.scope.ownerPubKey,e.feeConfig.feeAmount.toNumber())],instructionTypes:[Z.TransferAmount]}),x.addInstruction(h);let{transactions:k}=s===0?await x.sizeCheckBuildV0():await x.sizeCheckBuild();k.length<2&&c.addInstruction({instructions:[(0,oe.createTransferInstruction)(b,e.feeConfig.feeAccount,this.scope.ownerPubKey,e.feeConfig.feeAmount.toNumber())],instructionTypes:[Z.TransferAmount]})}return c.addInstruction(h),s===0?c.sizeCheckBuildV0({computeBudgetConfig:r,address:h.address}):c.sizeCheckBuild({computeBudgetConfig:r,address:h.address})}async fetchRoutePoolBasicInfo(e){let{amm:t=Kr,clmm:n=bi,cpmm:r=yi}=e||{},o=await this.scope.connection.getProgramAccounts(t,{dataSlice:{offset:_i.offsetOf("baseMint"),length:64}}),s=E([C("baseMint"),C("quoteMint")]),a=o.map(d=>({id:d.pubkey,version:4,mintA:s.decode(d.account.data).baseMint,mintB:s.decode(d.account.data).quoteMint})),c=E([C("mintA"),C("mintB")]),l=(await this.scope.connection.getProgramAccounts(n,{filters:[{dataSize:Vt.span}],dataSlice:{offset:Vt.offsetOf("mintA"),length:64}})).map(d=>{let f=c.decode(d.account.data);return{id:d.pubkey,version:6,mintA:f.mintA,mintB:f.mintB}}),m=(await this.scope.connection.getProgramAccounts(r,{dataSlice:{offset:oo.offsetOf("mintA"),length:64}})).map(d=>{let f=c.decode(d.account.data);return{id:d.pubkey,version:7,mintA:f.mintA,mintB:f.mintB}});return{clmmPools:l,ammPools:a,cpmmPools:m}}getAllRoute({inputMint:e,outputMint:t,clmmPools:n,ammPools:r,cpmmPools:o}){e=e.toString()===wt.PublicKey.default.toString()?Xe:e,t=t.toString()===wt.PublicKey.default.toString()?Xe:t;let s={},a={},c={},u=[],l={};for(let m of n??[]){if((m.mintA.equals(e)&&m.mintB.equals(t)||m.mintA.equals(t)&&m.mintB.equals(e))&&(u.push(m),a[m.id.toString()]=m),m.mintA.equals(e)){let d=m.mintB.toString();l[d]===void 0&&(l[d]={mintProgram:oe.TOKEN_PROGRAM_ID,in:[],out:[],mDecimals:0}),l[d].in.push(m)}if(m.mintB.equals(e)){let d=m.mintA.toString();l[d]===void 0&&(l[d]={mintProgram:oe.TOKEN_PROGRAM_ID,in:[],out:[],mDecimals:0}),l[d].in.push(m)}if(m.mintA.equals(t)){let d=m.mintB.toString();l[d]===void 0&&(l[d]={mintProgram:oe.TOKEN_PROGRAM_ID,in:[],out:[],mDecimals:0}),l[d].out.push(m)}if(m.mintB.equals(t)){let d=m.mintA.toString();l[d]===void 0&&(l[d]={mintProgram:oe.TOKEN_PROGRAM_ID,in:[],out:[],mDecimals:0}),l[d].out.push(m)}}let p=[];for(let m of r)(m.mintA.equals(e)&&m.mintB.equals(t)||m.mintA.equals(t)&&m.mintB.equals(e))&&(u.push(m),s[m.id.toBase58()]=m,p.push(m)),m.mintA.equals(e)&&(l[m.mintB.toBase58()]===void 0&&(l[m.mintB.toBase58()]={mintProgram:oe.TOKEN_PROGRAM_ID,in:[],out:[],mDecimals:0}),l[m.mintB.toBase58()].in.push(m)),m.mintB.equals(e)&&(l[m.mintA.toBase58()]===void 0&&(l[m.mintA.toBase58()]={mintProgram:oe.TOKEN_PROGRAM_ID,in:[],out:[],mDecimals:0}),l[m.mintA.toBase58()].in.push(m)),m.mintA.equals(t)&&(l[m.mintB.toBase58()]===void 0&&(l[m.mintB.toBase58()]={mintProgram:oe.TOKEN_PROGRAM_ID,in:[],out:[],mDecimals:0}),l[m.mintB.toBase58()].out.push(m)),m.mintB.equals(t)&&(l[m.mintA.toBase58()]===void 0&&(l[m.mintA.toBase58()]={mintProgram:oe.TOKEN_PROGRAM_ID,in:[],out:[],mDecimals:0}),l[m.mintA.toBase58()].out.push(m));for(let m of o)(m.mintA.equals(e)&&m.mintB.equals(t)||m.mintA.equals(t)&&m.mintB.equals(e))&&(u.push(m),c[m.id.toBase58()]=m),m.mintA.equals(e)&&(l[m.mintB.toBase58()]===void 0&&(l[m.mintB.toBase58()]={mintProgram:oe.TOKEN_PROGRAM_ID,in:[],out:[],mDecimals:0}),l[m.mintB.toBase58()].in.push(m)),m.mintB.equals(e)&&(l[m.mintA.toBase58()]===void 0&&(l[m.mintA.toBase58()]={mintProgram:oe.TOKEN_PROGRAM_ID,in:[],out:[],mDecimals:0}),l[m.mintA.toBase58()].in.push(m)),m.mintA.equals(t)&&(l[m.mintB.toBase58()]===void 0&&(l[m.mintB.toBase58()]={mintProgram:oe.TOKEN_PROGRAM_ID,in:[],out:[],mDecimals:0}),l[m.mintB.toBase58()].out.push(m)),m.mintB.equals(t)&&(l[m.mintA.toBase58()]===void 0&&(l[m.mintA.toBase58()]={mintProgram:oe.TOKEN_PROGRAM_ID,in:[],out:[],mDecimals:0}),l[m.mintA.toBase58()].out.push(m));for(let m of Object.keys(l)){if(l[m].in.length===1&&l[m].out.length===1&&l[m].in[0].id.equals(l[m].out[0].id)){delete l[m];continue}if(l[m].in.length===0||l[m].out.length===0){delete l[m];continue}let d=l[m];for(let f of d.in)for(let b of d.out)f.version===6&&a[f.id.toString()]===void 0?a[f.id.toString()]=f:f.version===7&&c[f.id.toString()]===void 0?c[f.id.toString()]=f:(f.version===4||f.version===5)&&s[f.id.toString()]===void 0&&(s[f.id.toString()]=f),b.version===6&&a[b.id.toString()]===void 0?a[b.id.toString()]=b:b.version===7&&c[b.id.toString()]===void 0?c[b.id.toString()]=b:(b.version===4||b.version===5)&&s[b.id.toString()]===void 0&&(s[b.id.toString()]=b)}return{directPath:u,addLiquidityPools:p,routePathDict:l,needSimulate:Object.values(s),needTickArray:Object.values(a),cpmmPoolList:Object.values(c)}}async fetchSwapRoutesData({routes:e,inputMint:t,outputMint:n}){let r=new Set([...e.needTickArray.map(b=>[b.mintA.toBase58(),b.mintB.toBase58()]).flat(),t.toString(),n.toString()]);console.log("fetching amm pools info, total: ",e.needSimulate.length);let o=await this.scope.liquidity.getRpcPoolInfos(e.needSimulate.map(b=>b.id)),s=Bo(o),a={};Object.values(s).forEach(b=>{r.delete(b.mintA.address),a[b.mintA.address]={address:new wt.PublicKey(b.mintA.address),programId:oe.TOKEN_PROGRAM_ID,mintAuthority:null,supply:BigInt(0),decimals:b.mintA.decimals,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0},r.delete(b.mintB.address),a[b.mintB.address]={address:new wt.PublicKey(b.mintB.address),programId:oe.TOKEN_PROGRAM_ID,mintAuthority:null,supply:BigInt(0),decimals:b.mintB.decimals,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0}}),console.log("fetching cpmm pools info, total: ",e.cpmmPoolList.length);let c=await this.scope.cpmm.getRpcPoolInfos(e.cpmmPoolList.map(b=>b.id.toBase58()),!0);Object.values(c).forEach(b=>{let[y,g]=[b.mintA.toBase58(),b.mintB.toBase58()];b.mintProgramA.equals(oe.TOKEN_PROGRAM_ID)?(r.delete(y),a[y]={address:b.mintA,programId:b.mintProgramA,mintAuthority:null,supply:BigInt(0),decimals:b.mintDecimalA,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0}):r.add(y),b.mintProgramB.equals(oe.TOKEN_PROGRAM_ID)?(r.delete(g),a[g]={address:b.mintB,programId:b.mintProgramB,mintAuthority:null,supply:BigInt(0),decimals:b.mintDecimalB,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0}):r.add(g)}),console.log("fetching mints info, total: ",r.size);let u=await ri({connection:this.scope.connection,mints:Array.from(r).map(b=>new wt.PublicKey(b))});a={...a,...u};let l=this.scope.cpmm.toComputePoolInfos({pools:c,mintInfos:a});console.log("fetching clmm pools info, total:",e.needTickArray.length);let p=await this.scope.clmm.getRpcClmmPoolInfos({poolIds:e.needTickArray.map(b=>b.id)}),{computeClmmPoolInfo:m,computePoolTickData:d}=await this.scope.clmm.getComputeClmmPoolInfos({clmmPoolsRpcInfo:p,mintInfos:a}),f=Object.keys(e.routePathDict).reduce((b,y)=>({...b,[y]:{...e.routePathDict[y],mintProgram:a[y].programId,mDecimals:a[y].decimals,in:e.routePathDict[y].in.map(g=>s[g.id.toBase58()]||m[g.id.toBase58()]||l[g.id.toBase58()]),out:e.routePathDict[y].out.map(g=>s[g.id.toBase58()]||m[g.id.toBase58()]||l[g.id.toBase58()])}}),{});return{mintInfos:a,ammPoolsRpcInfo:o,ammSimulateCache:s,clmmPoolsRpcInfo:p,computeClmmPoolInfo:m,computePoolTickData:d,computeCpmmData:l,routePathDict:f}}getAllRouteComputeAmountOut({inputTokenAmount:e,outputToken:t,directPath:n,routePathDict:r,simulateCache:o,tickCache:s,slippage:a,chainTime:c,epochInfo:u,feeConfig:l}){let p=l===void 0?new mn.default(0):e.raw.mul(new mn.default(l.feeBps.toNumber())).div(new mn.default(1e4)),m=e.raw.sub(p),d=new fe(e.token,m),f=l===void 0?void 0:{feeAmount:p,feeAccount:l.feeAccount},b={...t,address:Ye(t.address).toString()},y=[];for(let g of n)try{y.push({...this.computeAmountOut({itemPool:g,tickCache:s,simulateCache:o,chainTime:c,epochInfo:u,slippage:a,outputToken:b,amountIn:d}),feeConfig:f})}catch(A){this.logDebug("direct error",g.version,g.id.toString(),A.message)}this.logDebug("direct done");for(let[g,A]of Object.entries(r)){let w={chainId:101,address:g,programId:A.mintProgram.toBase58(),logoURI:"",symbol:"",name:"",decimals:A.mDecimals,tags:[],extensions:{}},h=A.in.map(k=>{try{return{pool:k,data:this.computeAmountOut({itemPool:k,tickCache:s,simulateCache:o,chainTime:c,epochInfo:u,slippage:a,outputToken:w,amountIn:d})}}catch(B){this.logDebug("route in error",k.version,k.id.toString(),B.message);return}}).sort((k,B)=>{let L=k===void 0?lt:k.data.amountOut.amount.raw.sub(k.data.amountOut.fee?.raw??lt),T=B===void 0?lt:B.data.amountOut.amount.raw.sub(B.data.amountOut.fee?.raw??lt);return L.lt(T)?1:-1})[0];if(h===void 0)continue;let x=new fe(Vr(w),h.data.amountOut.amount.raw.sub(h.data.amountOut.fee?.raw??lt));for(let k of A.out)try{let B=this.computeAmountOut({itemPool:k,tickCache:s,simulateCache:o,chainTime:c,epochInfo:u,slippage:a,outputToken:b,amountIn:x});y.push({...B,allTrade:!!(h.data.allTrade&&B.allTrade),amountIn:h.data.amountIn,amountOut:B.amountOut,minAmountOut:B.minAmountOut,currentPrice:void 0,executionPrice:new M(new Me({baseToken:h.data.amountIn.amount.token,denominator:h.data.amountIn.amount.raw,quoteToken:B.amountOut.amount.token,numerator:B.amountOut.amount.raw.sub(B.amountOut.fee?.raw??lt)}).toFixed()),priceImpact:new M(h.data.priceImpact.add(B.priceImpact).toFixed()),fee:[h.data.fee[0],B.fee[0]],routeType:"route",poolInfoList:[h.pool,k],remainingAccounts:[h.data.remainingAccounts[0],B.remainingAccounts[0]],minMiddleAmountFee:B.amountOut.fee?.raw?new fe(h.data.amountOut.amount.token,(h.data.amountOut.fee?.raw??lt).add(B.amountOut.fee?.raw??lt)):void 0,middleToken:h.data.amountOut.amount.token,poolReady:h.data.poolReady&&B.poolReady,poolType:[h.data.poolType,B.poolType],feeConfig:f,expirationTime:ze(h.data.expirationTime,B.expirationTime)})}catch(B){this.logDebug("route out error",k.version,k.id.toString(),B.message)}}return y.filter(g=>(g.allTrade||this.logDebug(`pool ${g.poolInfoList.map(A=>A.id.toString()).join(",")} filter out since not all trade`),g.allTrade)).sort((g,A)=>g.amountOut.amount.raw.sub(A.amountOut.amount.raw).gt(lt)?-1:1)}computeAmountOut({itemPool:e,tickCache:t,simulateCache:n,chainTime:r,epochInfo:o,slippage:s,outputToken:a,amountIn:c}){if(e.version===6){let{allTrade:u,realAmountIn:l,amountOut:p,minAmountOut:m,expirationTime:d,currentPrice:f,executionPrice:b,priceImpact:y,fee:g,remainingAccounts:A,executionPriceX64:w}=Pe.computeAmountOutFormat({poolInfo:e,tickArrayCache:t[e.id.toString()],amountIn:c.raw,tokenOut:a,slippage:s,epochInfo:o,catchLiquidityInsufficient:!0});return{allTrade:u,amountIn:l,amountOut:p,minAmountOut:m,currentPrice:new M(f.toFixed()),executionPrice:new M(b.toFixed()),priceImpact:new M(y.toFixed()),fee:[g],remainingAccounts:[A],routeType:"amm",poolInfoList:[e],poolReady:e.startTime<r,poolType:"CLMM",slippage:s,clmmExPriceX64:[w],expirationTime:ze(l.expirationTime,d)}}else if(e.version===7){let{allTrade:u,executionPrice:l,amountOut:p,minAmountOut:m,priceImpact:d,fee:f}=this.scope.cpmm.computeSwapAmount({pool:e,outputMint:a.address,amountIn:c.raw,slippage:s});return{allTrade:u,amountIn:{amount:c,fee:void 0,expirationTime:void 0},amountOut:{amount:tn({...a,amount:p}),fee:void 0,expirationTime:void 0},minAmountOut:{amount:tn({...a,amount:m}),fee:void 0,expirationTime:void 0},currentPrice:e.poolPrice,executionPrice:l,priceImpact:d,fee:[new fe(c.token,f)],remainingAccounts:[],routeType:"amm",poolInfoList:[e],poolReady:e.openTime.toNumber()<r,poolType:"CPMM",slippage:s,clmmExPriceX64:[void 0],expirationTime:void 0}}else{if(![1,6,7].includes(n[e.id.toString()].status))throw Error("swap error");let{amountOut:u,minAmountOut:l,currentPrice:p,executionPrice:m,priceImpact:d,fee:f}=this.scope.liquidity.computeAmountOut({poolInfo:n[e.id.toString()],amountIn:c.raw,mintIn:c.token.mint,mintOut:a.address,slippage:s});return{amountIn:{amount:c,fee:void 0,expirationTime:void 0},amountOut:{amount:tn({...a,amount:u}),fee:void 0,expirationTime:void 0},minAmountOut:{amount:tn({...a,amount:l}),fee:void 0,expirationTime:void 0},currentPrice:p,executionPrice:m,priceImpact:d,fee:[new fe(c.token,f)],routeType:"amm",poolInfoList:[e],remainingAccounts:[],poolReady:Number(n[e.id].openTime)<r,poolType:e.version===5?"STABLE":void 0,expirationTime:void 0,allTrade:!0,slippage:s,clmmExPriceX64:[void 0]}}}async computePoolToPoolKeys({pools:e,clmmRpcData:t={},ammRpcData:n={}}){let r=new Set(e.filter(u=>u.version===6&&!t[u.id.toString()]).map(u=>u.id.toString()));if(r.size>0){let u=await this.scope.clmm.getRpcClmmPoolInfos({poolIds:Array.from(r)});Object.keys(u).forEach(l=>{t[l]=u[l]})}let o=new Set(e.filter(u=>u.version===4&&!n[u.id.toString()]).map(u=>u.id.toString()));if(o.size>0){let u=await this.scope.liquidity.getRpcPoolInfos(Array.from(o));Object.keys(u).forEach(l=>{n[l]=u[l]})}let s=new Set(e.filter(u=>u.version===4).map(u=>u.marketId)),a={};s.size>0&&(await ht(this.scope.connection,Array.from(s).map(l=>({pubkey:new wt.PublicKey(l)})))).forEach(l=>{if(!l.accountInfo)return;let p=Gi.decode(l.accountInfo.data);a[l.pubkey.toBase58()]={marketId:l.pubkey.toString(),marketProgramId:l.accountInfo.owner.toString(),marketAuthority:zn.getAssociatedAuthority({programId:l.accountInfo.owner,marketId:l.pubkey}).publicKey.toString(),marketBaseVault:p.baseVault.toString(),marketQuoteVault:p.quoteVault.toString(),marketBids:p.bids.toString(),marketAsks:p.asks.toString(),marketEventQueue:p.eventQueue.toString()}});let c=[];return e.forEach(u=>{if(u.version===6){let l=t[u.id.toString()],p={programId:u.programId.toBase58(),id:u.id.toBase58(),mintA:u.mintA,mintB:u.mintB,openTime:String(u.startTime),vault:{A:l.vaultA.toBase58(),B:l.vaultB.toBase58()},config:{...u.ammConfig,id:u.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]},rewardInfos:[],observationId:u.observationId.toBase58(),exBitmapAccount:u.exBitmapAccount.toBase58()};c.push(p)}else if(u.version===4){let l=n[u.id.toString()],p={programId:u.programId,id:u.id,mintA:u.mintA,mintB:u.mintB,openTime:String(u.openTime),vault:{A:l.baseVault.toBase58(),B:l.quoteVault.toBase58()},authority:To({programId:new wt.PublicKey(u.programId)}).publicKey.toString(),openOrders:l.openOrders.toBase58(),targetOrders:l.targetOrders.toBase58(),mintLp:u.lpMint,...a[u.marketId]};c.push(p)}else u.version===7&&c.push({observationId:u.observationId.toBase58(),programId:u.programId.toBase58(),id:u.id.toBase58(),mintA:u.mintA,mintB:u.mintB,openTime:String(u.openTime),authority:so(u.programId).publicKey.toBase58(),vault:{A:u.vaultA.toBase58(),B:u.vaultB.toBase58()},mintLp:xt({address:u.mintLp.toBase58(),programId:oe.TOKEN_PROGRAM_ID.toBase58(),decimals:u.lpDecimals}),config:{id:u.configId.toBase58(),...u.configInfo,protocolFeeRate:u.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:u.configInfo.tradeFeeRate.toNumber(),fundFeeRate:u.configInfo.fundFeeRate.toNumber(),createPoolFee:u.configInfo.createPoolFee.toString()}})}),c}};0&&(module.exports={});
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=trade.js.map