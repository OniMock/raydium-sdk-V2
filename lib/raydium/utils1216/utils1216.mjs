var ln=Object.defineProperty;var fn=(t,e,n)=>e in t?ln(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Q=(t,e,n)=>(fn(t,typeof e!="symbol"?e+"":e,n),n);import{PublicKey as qr,Transaction as Pt,TransactionInstruction as Hr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Gr}from"@solana/spl-token";import un from"bn.js";import{PublicKey as dn}from"@solana/web3.js";import{get as St,set as mn}from"lodash";var $e=class{logLevel;name;constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let n=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Lt={},pn={};function j(t){let e=St(Lt,t);if(!e){let n=St(pn,t);e=new $e({name:t,logLevel:n}),mn(Lt,t,e)}return e}import{MINT_SIZE as ni,TOKEN_PROGRAM_ID as ri,getTransferFeeConfig as ii,unpackMint as oi}from"@solana/spl-token";var et=j("Raydium_accountInfo_util");async function Re(t,e,n){let{batchRequest:r,commitment:i="confirmed",chunkCount:o=100}={batchRequest:!1,...n},s=tt(e,o),a=new Array(s.length).fill([]);if(r){let c=s.map(f=>{let m=t._buildArgs([f.map(d=>d.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=tt(c,10);a=(await(await Promise.all(u.map(async f=>await t._rpcBatchRequest(f)))).flat()).map(f=>(f.error&&et.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.error.message}`),f.result.value.map(m=>{if(m){let{data:d,executable:g,lamports:b,owner:y,rentEpoch:T}=m;return d.length!==2&&d[1]!=="base64"&&et.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:g,lamports:b,owner:new dn(y),rentEpoch:T}}return null})))}else try{a=await Promise.all(s.map(c=>t.getMultipleAccountsInfo(c,i)))}catch(c){c instanceof Error&&et.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}import ie from"bn.js";var pe=9e15,ce=1e9,rt="0123456789abcdef",ve="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",_e="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",it={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-pe,maxE:pe,crypto:!1},It,ne,k=!0,Ve="[DecimalError] ",ue=Ve+"Invalid argument: ",Nt=Ve+"Precision limit exceeded",Et=Ve+"crypto unavailable",Mt="[object Decimal]",H=Math.floor,U=Math.pow,gn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,hn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,bn=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Dt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Y=1e7,A=7,yn=9007199254740991,wn=ve.length-1,ot=_e.length-1,p={toStringTag:Mt};p.absoluteValue=p.abs=function(){var t=new this.constructor(this);return t.s<0&&(t.s=1),P(t)};p.ceil=function(){return P(new this.constructor(this),this.e+1,2)};p.clampedTo=p.clamp=function(t,e){var n,r=this,i=r.constructor;if(t=new i(t),e=new i(e),!t.s||!e.s)return new i(NaN);if(t.gt(e))throw Error(ue+e);return n=r.cmp(t),n<0?t:r.cmp(e)>0?e:new i(r)};p.comparedTo=p.cmp=function(t){var e,n,r,i,o=this,s=o.d,a=(t=new o.constructor(t)).d,c=o.s,u=t.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==t.e)return o.e>t.e^c<0?1:-1;for(r=s.length,i=a.length,e=0,n=r<i?r:i;e<n;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return r===i?0:r>i^c<0?1:-1};p.cosine=p.cos=function(){var t,e,n=this,r=n.constructor;return n.d?n.d[0]?(t=r.precision,e=r.rounding,r.precision=t+Math.max(n.e,n.sd())+A,r.rounding=1,n=Tn(r,Ft(r,n)),r.precision=t,r.rounding=e,P(ne==2||ne==3?n.neg():n,t,e,!0)):new r(1):new r(NaN)};p.cubeRoot=p.cbrt=function(){var t,e,n,r,i,o,s,a,c,u,l=this,f=l.constructor;if(!l.isFinite()||l.isZero())return new f(l);for(k=!1,o=l.s*U(l.s*l,1/3),!o||Math.abs(o)==1/0?(n=q(l.d),t=l.e,(o=(t-n.length+1)%3)&&(n+=o==1||o==-2?"0":"00"),o=U(n,1/3),t=H((t+1)/3)-(t%3==(t<0?-1:2)),o==1/0?n="5e"+t:(n=o.toExponential(),n=n.slice(0,n.indexOf("e")+1)+t),r=new f(n),r.s=l.s):r=new f(o.toString()),s=(t=f.precision)+3;;)if(a=r,c=a.times(a).times(a),u=c.plus(l),r=v(u.plus(l).times(a),u.plus(c),s+2,1),q(a.d).slice(0,s)===(n=q(r.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!i&&n=="4999"){if(!i&&(P(a,t+1,0),a.times(a).times(a).eq(l))){r=a;break}s+=4,i=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(P(r,t+1,1),e=!r.times(r).times(r).eq(l));break}return k=!0,P(r,t,f.rounding,e)};p.decimalPlaces=p.dp=function(){var t,e=this.d,n=NaN;if(e){if(t=e.length-1,n=(t-H(this.e/A))*A,t=e[t],t)for(;t%10==0;t/=10)n--;n<0&&(n=0)}return n};p.dividedBy=p.div=function(t){return v(this,new this.constructor(t))};p.dividedToIntegerBy=p.divToInt=function(t){var e=this,n=e.constructor;return P(v(e,new n(t),0,1,1),n.precision,n.rounding)};p.equals=p.eq=function(t){return this.cmp(t)===0};p.floor=function(){return P(new this.constructor(this),this.e+1,3)};p.greaterThan=p.gt=function(t){return this.cmp(t)>0};p.greaterThanOrEqualTo=p.gte=function(t){var e=this.cmp(t);return e==1||e===0};p.hyperbolicCosine=p.cosh=function(){var t,e,n,r,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;n=s.precision,r=s.rounding,s.precision=n+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(t=Math.ceil(i/3),e=(1/Ue(4,t)).toString()):(t=16,e="2.3283064365386962890625e-10"),o=de(s,1,o.times(e),new s(1),!0);for(var c,u=t,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return P(o,s.precision=n,s.rounding=r,!0)};p.hyperbolicSine=p.sinh=function(){var t,e,n,r,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,n=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,r=i.d.length,r<3)i=de(o,2,i,i,!0);else{t=1.4*Math.sqrt(r),t=t>16?16:t|0,i=i.times(1/Ue(5,t)),i=de(o,2,i,i,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);t--;)s=i.times(i),i=i.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=n,P(i,e,n,!0)};p.hyperbolicTangent=p.tanh=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+7,r.rounding=1,v(n.sinh(),n.cosh(),r.precision=t,r.rounding=e)):new r(n.s)};p.inverseCosine=p.acos=function(){var t,e=this,n=e.constructor,r=e.abs().cmp(1),i=n.precision,o=n.rounding;return r!==-1?r===0?e.isNeg()?X(n,i,o):new n(0):new n(NaN):e.isZero()?X(n,i+4,o).times(.5):(n.precision=i+6,n.rounding=1,e=e.asin(),t=X(n,i+4,o).times(.5),n.precision=i,n.rounding=o,t.minus(e))};p.inverseHyperbolicCosine=p.acosh=function(){var t,e,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(t=r.precision,e=r.rounding,r.precision=t+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,k=!1,n=n.times(n).minus(1).sqrt().plus(n),k=!0,r.precision=t,r.rounding=e,n.ln()):new r(n)};p.inverseHyperbolicSine=p.asinh=function(){var t,e,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,k=!1,n=n.times(n).plus(1).sqrt().plus(n),k=!0,r.precision=t,r.rounding=e,n.ln())};p.inverseHyperbolicTangent=p.atanh=function(){var t,e,n,r,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(t=o.precision,e=o.rounding,r=i.sd(),Math.max(r,t)<2*-i.e-1?P(new o(i),t,e,!0):(o.precision=n=r-i.e,i=v(i.plus(1),new o(1).minus(i),n+t,1),o.precision=t+4,o.rounding=1,i=i.ln(),o.precision=t,o.rounding=e,i.times(.5))):new o(NaN)};p.inverseSine=p.asin=function(){var t,e,n,r,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),n=o.precision,r=o.rounding,e!==-1?e===0?(t=X(o,n+4,r).times(.5),t.s=i.s,t):new o(NaN):(o.precision=n+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=n,o.rounding=r,i.times(2)))};p.inverseTangent=p.atan=function(){var t,e,n,r,i,o,s,a,c,u=this,l=u.constructor,f=l.precision,m=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&f+4<=ot)return s=X(l,f+4,m).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(f+4<=ot)return s=X(l,f+4,m).times(.5),s.s=u.s,s}for(l.precision=a=f+10,l.rounding=1,n=Math.min(28,a/A+2|0),t=n;t;--t)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(k=!1,e=Math.ceil(a/A),r=1,c=u.times(u),s=new l(u),i=u;t!==-1;)if(i=i.times(c),o=s.minus(i.div(r+=2)),i=i.times(c),s=o.plus(i.div(r+=2)),s.d[e]!==void 0)for(t=e;s.d[t]===o.d[t]&&t--;);return n&&(s=s.times(2<<n-1)),k=!0,P(s,l.precision=f,l.rounding=m,!0)};p.isFinite=function(){return!!this.d};p.isInteger=p.isInt=function(){return!!this.d&&H(this.e/A)>this.d.length-2};p.isNaN=function(){return!this.s};p.isNegative=p.isNeg=function(){return this.s<0};p.isPositive=p.isPos=function(){return this.s>0};p.isZero=function(){return!!this.d&&this.d[0]===0};p.lessThan=p.lt=function(t){return this.cmp(t)<0};p.lessThanOrEqualTo=p.lte=function(t){return this.cmp(t)<1};p.logarithm=p.log=function(t){var e,n,r,i,o,s,a,c,u=this,l=u.constructor,f=l.precision,m=l.rounding,d=5;if(t==null)t=new l(10),e=!0;else{if(t=new l(t),n=t.d,t.s<0||!n||!n[0]||t.eq(1))return new l(NaN);e=t.eq(10)}if(n=u.d,u.s<0||!n||!n[0]||u.eq(1))return new l(n&&!n[0]?-1/0:u.s!=1?NaN:n?0:1/0);if(e)if(n.length>1)o=!0;else{for(i=n[0];i%10===0;)i/=10;o=i!==1}if(k=!1,a=f+d,s=ae(u,a),r=e?Fe(l,a+10):ae(t,a),c=v(s,r,a,1),Te(c.d,i=f,m))do if(a+=10,s=ae(u,a),r=e?Fe(l,a+10):ae(t,a),c=v(s,r,a,1),!o){+q(c.d).slice(i+1,i+15)+1==1e14&&(c=P(c,f+1,0));break}while(Te(c.d,i+=10,m));return k=!0,P(c,f,m)};p.minus=p.sub=function(t){var e,n,r,i,o,s,a,c,u,l,f,m,d=this,g=d.constructor;if(t=new g(t),!d.d||!t.d)return!d.s||!t.s?t=new g(NaN):d.d?t.s=-t.s:t=new g(t.d||d.s!==t.s?d:NaN),t;if(d.s!=t.s)return t.s=-t.s,d.plus(t);if(u=d.d,m=t.d,a=g.precision,c=g.rounding,!u[0]||!m[0]){if(m[0])t.s=-t.s;else if(u[0])t=new g(d);else return new g(c===3?-0:0);return k?P(t,a,c):t}if(n=H(t.e/A),l=H(d.e/A),u=u.slice(),o=l-n,o){for(f=o<0,f?(e=u,o=-o,s=m.length):(e=m,n=l,s=u.length),r=Math.max(Math.ceil(a/A),s)+2,o>r&&(o=r,e.length=1),e.reverse(),r=o;r--;)e.push(0);e.reverse()}else{for(r=u.length,s=m.length,f=r<s,f&&(s=r),r=0;r<s;r++)if(u[r]!=m[r]){f=u[r]<m[r];break}o=0}for(f&&(e=u,u=m,m=e,t.s=-t.s),s=u.length,r=m.length-s;r>0;--r)u[s++]=0;for(r=m.length;r>o;){if(u[--r]<m[r]){for(i=r;i&&u[--i]===0;)u[i]=Y-1;--u[i],u[r]+=Y}u[r]-=m[r]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--n;return u[0]?(t.d=u,t.e=Ke(u,n),k?P(t,a,c):t):new g(c===3?-0:0)};p.modulo=p.mod=function(t){var e,n=this,r=n.constructor;return t=new r(t),!n.d||!t.s||t.d&&!t.d[0]?new r(NaN):!t.d||n.d&&!n.d[0]?P(new r(n),r.precision,r.rounding):(k=!1,r.modulo==9?(e=v(n,t.abs(),0,3,1),e.s*=t.s):e=v(n,t,0,r.modulo,1),e=e.times(t),k=!0,n.minus(e))};p.naturalExponential=p.exp=function(){return st(this)};p.naturalLogarithm=p.ln=function(){return ae(this)};p.negated=p.neg=function(){var t=new this.constructor(this);return t.s=-t.s,P(t)};p.plus=p.add=function(t){var e,n,r,i,o,s,a,c,u,l,f=this,m=f.constructor;if(t=new m(t),!f.d||!t.d)return!f.s||!t.s?t=new m(NaN):f.d||(t=new m(t.d||f.s===t.s?f:NaN)),t;if(f.s!=t.s)return t.s=-t.s,f.minus(t);if(u=f.d,l=t.d,a=m.precision,c=m.rounding,!u[0]||!l[0])return l[0]||(t=new m(f)),k?P(t,a,c):t;if(o=H(f.e/A),r=H(t.e/A),u=u.slice(),i=o-r,i){for(i<0?(n=u,i=-i,s=l.length):(n=l,r=o,s=u.length),o=Math.ceil(a/A),s=o>s?o+1:s+1,i>s&&(i=s,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for(s=u.length,i=l.length,s-i<0&&(i=s,n=l,l=u,u=n),e=0;i;)e=(u[--i]=u[i]+l[i]+e)/Y|0,u[i]%=Y;for(e&&(u.unshift(e),++r),s=u.length;u[--s]==0;)u.pop();return t.d=u,t.e=Ke(u,r),k?P(t,a,c):t};p.precision=p.sd=function(t){var e,n=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(ue+t);return n.d?(e=Rt(n.d),t&&n.e+1>e&&(e=n.e+1)):e=NaN,e};p.round=function(){var t=this,e=t.constructor;return P(new e(t),t.e+1,e.rounding)};p.sine=p.sin=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+Math.max(n.e,n.sd())+A,r.rounding=1,n=Pn(r,Ft(r,n)),r.precision=t,r.rounding=e,P(ne>2?n.neg():n,t,e,!0)):new r(NaN)};p.squareRoot=p.sqrt=function(){var t,e,n,r,i,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(k=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=q(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=H((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),r=new l(e)):r=new l(u.toString()),n=(c=l.precision)+3;;)if(o=r,r=o.plus(v(s,o,n+2,1)).times(.5),q(o.d).slice(0,n)===(e=q(r.d)).slice(0,n))if(e=e.slice(n-3,n+1),e=="9999"||!i&&e=="4999"){if(!i&&(P(o,c+1,0),o.times(o).eq(s))){r=o;break}n+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(P(r,c+1,1),t=!r.times(r).eq(s));break}return k=!0,P(r,c,l.rounding,t)};p.tangent=p.tan=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+10,r.rounding=1,n=n.sin(),n.s=1,n=v(n,new r(1).minus(n.times(n)).sqrt(),t+10,0),r.precision=t,r.rounding=e,P(ne==2||ne==4?n.neg():n,t,e,!0)):new r(NaN)};p.times=p.mul=function(t){var e,n,r,i,o,s,a,c,u,l=this,f=l.constructor,m=l.d,d=(t=new f(t)).d;if(t.s*=l.s,!m||!m[0]||!d||!d[0])return new f(!t.s||m&&!m[0]&&!d||d&&!d[0]&&!m?NaN:!m||!d?t.s/0:t.s*0);for(n=H(l.e/A)+H(t.e/A),c=m.length,u=d.length,c<u&&(o=m,m=d,d=o,s=c,c=u,u=s),o=[],s=c+u,r=s;r--;)o.push(0);for(r=u;--r>=0;){for(e=0,i=c+r;i>r;)a=o[i]+d[r]*m[i-r-1]+e,o[i--]=a%Y|0,e=a/Y|0;o[i]=(o[i]+e)%Y|0}for(;!o[--s];)o.pop();return e?++n:o.shift(),t.d=o,t.e=Ke(o,n),k?P(t,f.precision,f.rounding):t};p.toBinary=function(t,e){return ut(this,2,t,e)};p.toDecimalPlaces=p.toDP=function(t,e){var n=this,r=n.constructor;return n=new r(n),t===void 0?n:(Z(t,0,ce),e===void 0?e=r.rounding:Z(e,0,8),P(n,t+n.e+1,e))};p.toExponential=function(t,e){var n,r=this,i=r.constructor;return t===void 0?n=$(r,!0):(Z(t,0,ce),e===void 0?e=i.rounding:Z(e,0,8),r=P(new i(r),t+1,e),n=$(r,!0,t+1)),r.isNeg()&&!r.isZero()?"-"+n:n};p.toFixed=function(t,e){var n,r,i=this,o=i.constructor;return t===void 0?n=$(i):(Z(t,0,ce),e===void 0?e=o.rounding:Z(e,0,8),r=P(new o(i),t+i.e+1,e),n=$(r,!1,t+r.e+1)),i.isNeg()&&!i.isZero()?"-"+n:n};p.toFraction=function(t){var e,n,r,i,o,s,a,c,u,l,f,m,d=this,g=d.d,b=d.constructor;if(!g)return new b(d);if(u=n=new b(1),r=c=new b(0),e=new b(r),o=e.e=Rt(g)-d.e-1,s=o%A,e.d[0]=U(10,s<0?A+s:s),t==null)t=o>0?e:u;else{if(a=new b(t),!a.isInt()||a.lt(u))throw Error(ue+a);t=a.gt(e)?o>0?e:u:a}for(k=!1,a=new b(q(g)),l=b.precision,b.precision=o=g.length*A*2;f=v(a,e,0,1,1),i=n.plus(f.times(r)),i.cmp(t)!=1;)n=r,r=i,i=u,u=c.plus(f.times(i)),c=i,i=e,e=a.minus(f.times(i)),a=i;return i=v(t.minus(n),r,0,1,1),c=c.plus(i.times(u)),n=n.plus(i.times(r)),c.s=u.s=d.s,m=v(u,r,o,1).minus(d).abs().cmp(v(c,n,o,1).minus(d).abs())<1?[u,r]:[c,n],b.precision=l,k=!0,m};p.toHexadecimal=p.toHex=function(t,e){return ut(this,16,t,e)};p.toNearest=function(t,e){var n=this,r=n.constructor;if(n=new r(n),t==null){if(!n.d)return n;t=new r(1),e=r.rounding}else{if(t=new r(t),e===void 0?e=r.rounding:Z(e,0,8),!n.d)return t.s?n:t;if(!t.d)return t.s&&(t.s=n.s),t}return t.d[0]?(k=!1,n=v(n,t,0,e,1).times(t),k=!0,P(n)):(t.s=n.s,n=t),n};p.toNumber=function(){return+this};p.toOctal=function(t,e){return ut(this,8,t,e)};p.toPower=p.pow=function(t){var e,n,r,i,o,s,a=this,c=a.constructor,u=+(t=new c(t));if(!a.d||!t.d||!a.d[0]||!t.d[0])return new c(U(+a,u));if(a=new c(a),a.eq(1))return a;if(r=c.precision,o=c.rounding,t.eq(1))return P(a,r,o);if(e=H(t.e/A),e>=t.d.length-1&&(n=u<0?-u:u)<=yn)return i=Ot(c,a,n,r),t.s<0?new c(1).div(i):P(i,r,o);if(s=a.s,s<0){if(e<t.d.length-1)return new c(NaN);if((t.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return n=U(+a,u),e=n==0||!isFinite(n)?H(u*(Math.log("0."+q(a.d))/Math.LN10+a.e+1)):new c(n+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(k=!1,c.rounding=a.s=1,n=Math.min(12,(e+"").length),i=st(t.times(ae(a,r+n)),r),i.d&&(i=P(i,r+5,1),Te(i.d,r,o)&&(e=r+10,i=P(st(t.times(ae(a,e+n)),e),e+5,1),+q(i.d).slice(r+1,r+15)+1==1e14&&(i=P(i,r+1,0)))),i.s=s,k=!0,c.rounding=o,P(i,r,o))};p.toPrecision=function(t,e){var n,r=this,i=r.constructor;return t===void 0?n=$(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):(Z(t,1,ce),e===void 0?e=i.rounding:Z(e,0,8),r=P(new i(r),t,e),n=$(r,t<=r.e||r.e<=i.toExpNeg,t)),r.isNeg()&&!r.isZero()?"-"+n:n};p.toSignificantDigits=p.toSD=function(t,e){var n=this,r=n.constructor;return t===void 0?(t=r.precision,e=r.rounding):(Z(t,1,ce),e===void 0?e=r.rounding:Z(e,0,8)),P(new r(n),t,e)};p.toString=function(){var t=this,e=t.constructor,n=$(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()&&!t.isZero()?"-"+n:n};p.truncated=p.trunc=function(){return P(new this.constructor(this),this.e+1,1)};p.valueOf=p.toJSON=function(){var t=this,e=t.constructor,n=$(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()?"-"+n:n};function q(t){var e,n,r,i=t.length-1,o="",s=t[0];if(i>0){for(o+=s,e=1;e<i;e++)r=t[e]+"",n=A-r.length,n&&(o+=se(n)),o+=r;s=t[e],r=s+"",n=A-r.length,n&&(o+=se(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Z(t,e,n){if(t!==~~t||t<e||t>n)throw Error(ue+t)}function Te(t,e,n,r){var i,o,s,a;for(o=t[0];o>=10;o/=10)--e;return--e<0?(e+=A,i=0):(i=Math.ceil((e+1)/A),e%=A),o=U(10,A-e),a=t[i]%o|0,r==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=n<4&&a==99999||n>3&&a==49999||a==5e4||a==0):s=(n<4&&a+1==o||n>3&&a+1==o/2)&&(t[i+1]/o/100|0)==U(10,e-2)-1||(a==o/2||a==0)&&(t[i+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(r||n<4)&&a==9999||!r&&n>3&&a==4999):s=((r||n<4)&&a+1==o||!r&&n>3&&a+1==o/2)&&(t[i+1]/o/1e3|0)==U(10,e-3)-1,s}function Oe(t,e,n){for(var r,i=[0],o,s=0,a=t.length;s<a;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=rt.indexOf(t.charAt(s++)),r=0;r<i.length;r++)i[r]>n-1&&(i[r+1]===void 0&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}function Tn(t,e){var n,r,i;if(e.isZero())return e;r=e.d.length,r<32?(n=Math.ceil(r/3),i=(1/Ue(4,n)).toString()):(n=16,i="2.3283064365386962890625e-10"),t.precision+=n,e=de(t,1,e.times(i),new t(1));for(var o=n;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return t.precision-=n,e}var v=function(){function t(r,i,o){var s,a=0,c=r.length;for(r=r.slice();c--;)s=r[c]*i+a,r[c]=s%o|0,a=s/o|0;return a&&r.unshift(a),r}function e(r,i,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(r[a]!=i[a]){c=r[a]>i[a]?1:-1;break}return c}function n(r,i,o,s){for(var a=0;o--;)r[o]-=a,a=r[o]<i[o]?1:0,r[o]=a*s+r[o]-i[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,o,s,a,c){var u,l,f,m,d,g,b,y,T,w,h,x,S,L,B,I,N,R,E,K,W=r.constructor,J=r.s==i.s?1:-1,V=r.d,O=i.d;if(!V||!V[0]||!O||!O[0])return new W(!r.s||!i.s||(V?O&&V[0]==O[0]:!O)?NaN:V&&V[0]==0||!O?J*0:J/0);for(c?(d=1,l=r.e-i.e):(c=Y,d=A,l=H(r.e/d)-H(i.e/d)),E=O.length,N=V.length,T=new W(J),w=T.d=[],f=0;O[f]==(V[f]||0);f++);if(O[f]>(V[f]||0)&&l--,o==null?(L=o=W.precision,s=W.rounding):a?L=o+(r.e-i.e)+1:L=o,L<0)w.push(1),g=!0;else{if(L=L/d+2|0,f=0,E==1){for(m=0,O=O[0],L++;(f<N||m)&&L--;f++)B=m*c+(V[f]||0),w[f]=B/O|0,m=B%O|0;g=m||f<N}else{for(m=c/(O[0]+1)|0,m>1&&(O=t(O,m,c),V=t(V,m,c),E=O.length,N=V.length),I=E,h=V.slice(0,E),x=h.length;x<E;)h[x++]=0;K=O.slice(),K.unshift(0),R=O[0],O[1]>=c/2&&++R;do m=0,u=e(O,h,E,x),u<0?(S=h[0],E!=x&&(S=S*c+(h[1]||0)),m=S/R|0,m>1?(m>=c&&(m=c-1),b=t(O,m,c),y=b.length,x=h.length,u=e(b,h,y,x),u==1&&(m--,n(b,E<y?K:O,y,c))):(m==0&&(u=m=1),b=O.slice()),y=b.length,y<x&&b.unshift(0),n(h,b,x,c),u==-1&&(x=h.length,u=e(O,h,E,x),u<1&&(m++,n(h,E<x?K:O,x,c))),x=h.length):u===0&&(m++,h=[0]),w[f++]=m,u&&h[0]?h[x++]=V[I]||0:(h=[V[I]],x=1);while((I++<N||h[0]!==void 0)&&L--);g=h[0]!==void 0}w[0]||w.shift()}if(d==1)T.e=l,It=g;else{for(f=1,m=w[0];m>=10;m/=10)f++;T.e=f+l*d-1,P(T,a?o+T.e+1:o,s,g)}return T}}();function P(t,e,n,r){var i,o,s,a,c,u,l,f,m,d=t.constructor;e:if(e!=null){if(f=t.d,!f)return t;for(i=1,a=f[0];a>=10;a/=10)i++;if(o=e-i,o<0)o+=A,s=e,l=f[m=0],c=l/U(10,i-s-1)%10|0;else if(m=Math.ceil((o+1)/A),a=f.length,m>=a)if(r){for(;a++<=m;)f.push(0);l=c=0,i=1,o%=A,s=o-A+1}else break e;else{for(l=a=f[m],i=1;a>=10;a/=10)i++;o%=A,s=o-A+i,c=s<0?0:l/U(10,i-s-1)%10|0}if(r=r||e<0||f[m+1]!==void 0||(s<0?l:l%U(10,i-s-1)),u=n<4?(c||r)&&(n==0||n==(t.s<0?3:2)):c>5||c==5&&(n==4||r||n==6&&(o>0?s>0?l/U(10,i-s):0:f[m-1])%10&1||n==(t.s<0?8:7)),e<1||!f[0])return f.length=0,u?(e-=t.e+1,f[0]=U(10,(A-e%A)%A),t.e=-e||0):f[0]=t.e=0,t;if(o==0?(f.length=m,a=1,m--):(f.length=m+1,a=U(10,A-o),f[m]=s>0?(l/U(10,i-s)%U(10,s)|0)*a:0),u)for(;;)if(m==0){for(o=1,s=f[0];s>=10;s/=10)o++;for(s=f[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(t.e++,f[0]==Y&&(f[0]=1));break}else{if(f[m]+=a,f[m]!=Y)break;f[m--]=0,a=1}for(o=f.length;f[--o]===0;)f.pop()}return k&&(t.e>d.maxE?(t.d=null,t.e=NaN):t.e<d.minE&&(t.e=0,t.d=[0])),t}function $(t,e,n){if(!t.isFinite())return _t(t);var r,i=t.e,o=q(t.d),s=o.length;return e?(n&&(r=n-s)>0?o=o.charAt(0)+"."+o.slice(1)+se(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(t.e<0?"e":"e+")+t.e):i<0?(o="0."+se(-i-1)+o,n&&(r=n-s)>0&&(o+=se(r))):i>=s?(o+=se(i+1-s),n&&(r=n-i-1)>0&&(o=o+"."+se(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),n&&(r=n-s)>0&&(i+1===s&&(o+="."),o+=se(r))),o}function Ke(t,e){var n=t[0];for(e*=A;n>=10;n/=10)e++;return e}function Fe(t,e,n){if(e>wn)throw k=!0,n&&(t.precision=n),Error(Nt);return P(new t(ve),e,1,!0)}function X(t,e,n){if(e>ot)throw Error(Nt);return P(new t(_e),e,n,!0)}function Rt(t){var e=t.length-1,n=e*A+1;if(e=t[e],e){for(;e%10==0;e/=10)n--;for(e=t[0];e>=10;e/=10)n++}return n}function se(t){for(var e="";t--;)e+="0";return e}function Ot(t,e,n,r){var i,o=new t(1),s=Math.ceil(r/A+4);for(k=!1;;){if(n%2&&(o=o.times(e),Ct(o.d,s)&&(i=!0)),n=H(n/2),n===0){n=o.d.length-1,i&&o.d[n]===0&&++o.d[n];break}e=e.times(e),Ct(e.d,s)}return k=!0,o}function kt(t){return t.d[t.d.length-1]&1}function vt(t,e,n){for(var r,i=new t(e[0]),o=0;++o<e.length;)if(r=new t(e[o]),r.s)i[n](r)&&(i=r);else{i=r;break}return i}function st(t,e){var n,r,i,o,s,a,c,u=0,l=0,f=0,m=t.constructor,d=m.rounding,g=m.precision;if(!t.d||!t.d[0]||t.e>17)return new m(t.d?t.d[0]?t.s<0?0:1/0:1:t.s?t.s<0?0:t:0/0);for(e==null?(k=!1,c=g):c=e,a=new m(.03125);t.e>-2;)t=t.times(a),f+=5;for(r=Math.log(U(2,f))/Math.LN10*2+5|0,c+=r,n=o=s=new m(1),m.precision=c;;){if(o=P(o.times(t),c,1),n=n.times(++l),a=s.plus(v(o,n,c,1)),q(a.d).slice(0,c)===q(s.d).slice(0,c)){for(i=f;i--;)s=P(s.times(s),c,1);if(e==null)if(u<3&&Te(s.d,c-r,d,u))m.precision=c+=10,n=o=a=new m(1),l=0,u++;else return P(s,m.precision=g,d,k=!0);else return m.precision=g,s}s=a}}function ae(t,e){var n,r,i,o,s,a,c,u,l,f,m,d=1,g=10,b=t,y=b.d,T=b.constructor,w=T.rounding,h=T.precision;if(b.s<0||!y||!y[0]||!b.e&&y[0]==1&&y.length==1)return new T(y&&!y[0]?-1/0:b.s!=1?NaN:y?0:b);if(e==null?(k=!1,l=h):l=e,T.precision=l+=g,n=q(y),r=n.charAt(0),Math.abs(o=b.e)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)b=b.times(t),n=q(b.d),r=n.charAt(0),d++;o=b.e,r>1?(b=new T("0."+n),o++):b=new T(r+"."+n.slice(1))}else return u=Fe(T,l+2,h).times(o+""),b=ae(new T(r+"."+n.slice(1)),l-g).plus(u),T.precision=h,e==null?P(b,h,w,k=!0):b;for(f=b,c=s=b=v(b.minus(1),b.plus(1),l,1),m=P(b.times(b),l,1),i=3;;){if(s=P(s.times(m),l,1),u=c.plus(v(s,new T(i),l,1)),q(u.d).slice(0,l)===q(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Fe(T,l+2,h).times(o+""))),c=v(c,new T(d),l,1),e==null)if(Te(c.d,l-g,w,a))T.precision=l+=g,u=s=b=v(f.minus(1),f.plus(1),l,1),m=P(b.times(b),l,1),i=a=1;else return P(c,T.precision=h,w,k=!0);else return T.precision=h,c;c=u,i+=2}}function _t(t){return String(t.s*t.s/0)}function at(t,e){var n,r,i;for((n=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(n<0&&(n=r),n+=+e.slice(r+1),e=e.substring(0,r)):n<0&&(n=e.length),r=0;e.charCodeAt(r)===48;r++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(r,i),e){if(i-=r,t.e=n=n-r-1,t.d=[],r=(n+1)%A,n<0&&(r+=A),r<i){for(r&&t.d.push(+e.slice(0,r)),i-=A;r<i;)t.d.push(+e.slice(r,r+=A));e=e.slice(r),r=A-e.length}else r-=i;for(;r--;)e+="0";t.d.push(+e),k&&(t.e>t.constructor.maxE?(t.d=null,t.e=NaN):t.e<t.constructor.minE&&(t.e=0,t.d=[0]))}else t.e=0,t.d=[0];return t}function xn(t,e){var n,r,i,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Dt.test(e))return at(t,e)}else if(e==="Infinity"||e==="NaN")return+e||(t.s=NaN),t.e=NaN,t.d=null,t;if(hn.test(e))n=16,e=e.toLowerCase();else if(gn.test(e))n=2;else if(bn.test(e))n=8;else throw Error(ue+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,r=t.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,i=Ot(r,new r(n),o,o*2)),u=Oe(e,n,Y),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new r(t.s*0):(t.e=Ke(u,l),t.d=u,k=!1,s&&(t=v(t,i,a*4)),c&&(t=t.times(Math.abs(c)<54?U(2,c):We.pow(2,c))),k=!0,t)}function Pn(t,e){var n,r=e.d.length;if(r<3)return e.isZero()?e:de(t,2,e,e);n=1.4*Math.sqrt(r),n=n>16?16:n|0,e=e.times(1/Ue(5,n)),e=de(t,2,e,e);for(var i,o=new t(5),s=new t(16),a=new t(20);n--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(a))));return e}function de(t,e,n,r,i){var o,s,a,c,u=1,l=t.precision,f=Math.ceil(l/A);for(k=!1,c=n.times(n),a=new t(r);;){if(s=v(a.times(c),new t(e++*e++),l,1),a=i?r.plus(s):r.minus(s),r=v(s.times(c),new t(e++*e++),l,1),s=a.plus(r),s.d[f]!==void 0){for(o=f;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=r,r=s,s=o,u++}return k=!0,s.d.length=f+1,s}function Ue(t,e){for(var n=t;--e;)n*=t;return n}function Ft(t,e){var n,r=e.s<0,i=X(t,t.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return ne=r?4:1,e;if(n=e.divToInt(i),n.isZero())ne=r?3:2;else{if(e=e.minus(n.times(i)),e.lte(o))return ne=kt(n)?r?2:3:r?4:1,e;ne=kt(n)?r?1:4:r?3:2}return e.minus(i).abs()}function ut(t,e,n,r){var i,o,s,a,c,u,l,f,m,d=t.constructor,g=n!==void 0;if(g?(Z(n,1,ce),r===void 0?r=d.rounding:Z(r,0,8)):(n=d.precision,r=d.rounding),!t.isFinite())l=_t(t);else{for(l=$(t),s=l.indexOf("."),g?(i=2,e==16?n=n*4-3:e==8&&(n=n*3-2)):i=e,s>=0&&(l=l.replace(".",""),m=new d(1),m.e=l.length-s,m.d=Oe($(m),10,i),m.e=m.d.length),f=Oe(l,10,i),o=c=f.length;f[--c]==0;)f.pop();if(!f[0])l=g?"0p+0":"0";else{if(s<0?o--:(t=new d(t),t.d=f,t.e=o,t=v(t,m,n,r,0,i),f=t.d,o=t.e,u=It),s=f[n],a=i/2,u=u||f[n+1]!==void 0,u=r<4?(s!==void 0||u)&&(r===0||r===(t.s<0?3:2)):s>a||s===a&&(r===4||u||r===6&&f[n-1]&1||r===(t.s<0?8:7)),f.length=n,u)for(;++f[--n]>i-1;)f[n]=0,n||(++o,f.unshift(1));for(c=f.length;!f[c-1];--c);for(s=0,l="";s<c;s++)l+=rt.charAt(f[s]);if(g){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(f=Oe(l,i,e),c=f.length;!f[c-1];--c);for(s=1,l="1.";s<c;s++)l+=rt.charAt(f[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return t.s<0?"-"+l:l}function Ct(t,e){if(t.length>e)return t.length=e,!0}function An(t){return new this(t).abs()}function Sn(t){return new this(t).acos()}function Ln(t){return new this(t).acosh()}function kn(t,e){return new this(t).plus(e)}function Cn(t){return new this(t).asin()}function Bn(t){return new this(t).asinh()}function In(t){return new this(t).atan()}function Nn(t){return new this(t).atanh()}function En(t,e){t=new this(t),e=new this(e);var n,r=this.precision,i=this.rounding,o=r+4;return!t.s||!e.s?n=new this(NaN):!t.d&&!e.d?(n=X(this,o,1).times(e.s>0?.25:.75),n.s=t.s):!e.d||t.isZero()?(n=e.s<0?X(this,r,i):new this(0),n.s=t.s):!t.d||e.isZero()?(n=X(this,o,1).times(.5),n.s=t.s):e.s<0?(this.precision=o,this.rounding=1,n=this.atan(v(t,e,o,1)),e=X(this,o,1),this.precision=r,this.rounding=i,n=t.s<0?n.minus(e):n.plus(e)):n=this.atan(v(t,e,o,1)),n}function Mn(t){return new this(t).cbrt()}function Dn(t){return P(t=new this(t),t.e+1,2)}function Rn(t,e,n){return new this(t).clamp(e,n)}function On(t){if(!t||typeof t!="object")throw Error(Ve+"Object expected");var e,n,r,i=t.defaults===!0,o=["precision",1,ce,"rounding",0,8,"toExpNeg",-pe,0,"toExpPos",0,pe,"maxE",0,pe,"minE",-pe,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(n=o[e],i&&(this[n]=it[n]),(r=t[n])!==void 0)if(H(r)===r&&r>=o[e+1]&&r<=o[e+2])this[n]=r;else throw Error(ue+n+": "+r);if(n="crypto",i&&(this[n]=it[n]),(r=t[n])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(Et);else this[n]=!1;else throw Error(ue+n+": "+r);return this}function vn(t){return new this(t).cos()}function _n(t){return new this(t).cosh()}function Vt(t){var e,n,r;function i(o){var s,a,c,u=this;if(!(u instanceof i))return new i(o);if(u.constructor=i,Bt(o)){u.s=o.s,k?!o.d||o.e>i.maxE?(u.e=NaN,u.d=null):o.e<i.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;k?s>i.maxE?(u.e=NaN,u.d=null):s<i.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return at(u,o.toString())}else if(c!=="string")throw Error(ue+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),Dt.test(o)?at(u,o):xn(u,o)}if(i.prototype=p,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=On,i.clone=Vt,i.isDecimal=Bt,i.abs=An,i.acos=Sn,i.acosh=Ln,i.add=kn,i.asin=Cn,i.asinh=Bn,i.atan=In,i.atanh=Nn,i.atan2=En,i.cbrt=Mn,i.ceil=Dn,i.clamp=Rn,i.cos=vn,i.cosh=_n,i.div=Fn,i.exp=Vn,i.floor=Kn,i.hypot=Un,i.ln=Wn,i.log=qn,i.log10=Gn,i.log2=Hn,i.max=jn,i.min=Zn,i.mod=zn,i.mul=Jn,i.pow=Qn,i.random=Xn,i.round=Yn,i.sign=$n,i.sin=er,i.sinh=tr,i.sqrt=nr,i.sub=rr,i.sum=ir,i.tan=or,i.tanh=sr,i.trunc=ar,t===void 0&&(t={}),t&&t.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<r.length;)t.hasOwnProperty(n=r[e++])||(t[n]=this[n]);return i.config(t),i}function Fn(t,e){return new this(t).div(e)}function Vn(t){return new this(t).exp()}function Kn(t){return P(t=new this(t),t.e+1,3)}function Un(){var t,e,n=new this(0);for(k=!1,t=0;t<arguments.length;)if(e=new this(arguments[t++]),e.d)n.d&&(n=n.plus(e.times(e)));else{if(e.s)return k=!0,new this(1/0);n=e}return k=!0,n.sqrt()}function Bt(t){return t instanceof We||t&&t.toStringTag===Mt||!1}function Wn(t){return new this(t).ln()}function qn(t,e){return new this(t).log(e)}function Hn(t){return new this(t).log(2)}function Gn(t){return new this(t).log(10)}function jn(){return vt(this,arguments,"lt")}function Zn(){return vt(this,arguments,"gt")}function zn(t,e){return new this(t).mod(e)}function Jn(t,e){return new this(t).mul(e)}function Qn(t,e){return new this(t).pow(e)}function Xn(t){var e,n,r,i,o=0,s=new this(1),a=[];if(t===void 0?t=this.precision:Z(t,1,ce),r=Math.ceil(t/A),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(r));o<r;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(r*=4);o<r;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(i%1e7),o+=4);o=r/4}else throw Error(Et);else for(;o<r;)a[o++]=Math.random()*1e7|0;for(r=a[--o],t%=A,r&&t&&(i=U(10,A-t),a[o]=(r/i|0)*i);a[o]===0;o--)a.pop();if(o<0)n=0,a=[0];else{for(n=-1;a[0]===0;n-=A)a.shift();for(r=1,i=a[0];i>=10;i/=10)r++;r<A&&(n-=A-r)}return s.e=n,s.d=a,s}function Yn(t){return P(t=new this(t),t.e+1,this.rounding)}function $n(t){return t=new this(t),t.d?t.d[0]?t.s:0*t.s:t.s||NaN}function er(t){return new this(t).sin()}function tr(t){return new this(t).sinh()}function nr(t){return new this(t).sqrt()}function rr(t,e){return new this(t).sub(e)}function ir(){var t=0,e=arguments,n=new this(e[t]);for(k=!1;n.s&&++t<e.length;)n=n.plus(e[t]);return k=!0,P(n,this.precision,this.rounding)}function or(t){return new this(t).tan()}function sr(t){return new this(t).tanh()}function ar(t){return P(t=new this(t),t.e+1,1)}p[Symbol.for("nodejs.util.inspect.custom")]=p.toString;p[Symbol.toStringTag]="Decimal";var We=p.constructor=Vt(it);ve=new We(ve);_e=new We(_e);import gr from"big.js";import Si from"bn.js";import ur from"toformat";var cr=ur,xe=cr;import He from"big.js";import fr from"bn.js";import mr from"decimal.js-light";import Pe from"bn.js";var Kt=9007199254740991;function re(t){let e=j("Raydium_parseBigNumberish");if(t instanceof Pe)return t;if(typeof t=="string"){if(t.match(/^-?[0-9]+$/))return new Pe(t);e.logWithError(`invalid BigNumberish string: ${t}`)}return typeof t=="number"?(t%1&&e.logWithError(`BigNumberish number underflow: ${t}`),(t>=Kt||t<=-Kt)&&e.logWithError(`BigNumberish number overflow: ${t}`),new Pe(String(t))):typeof t=="bigint"?new Pe(t.toString()):(e.error(`invalid BigNumberish value: ${t}`),new Pe(0))}var qe=j("module/fraction"),ct=xe(He),Ae=xe(mr),pr={[0]:Ae.ROUND_DOWN,[1]:Ae.ROUND_HALF_UP,[2]:Ae.ROUND_UP},dr={[0]:He.roundDown,[1]:He.roundHalfUp,[2]:He.roundUp},_=class{numerator;denominator;constructor(e,n=new fr(1)){this.numerator=re(e),this.denominator=re(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new _(this.denominator,this.numerator)}add(e){let n=e instanceof _?e:new _(re(e));return this.denominator.eq(n.denominator)?new _(this.numerator.add(n.numerator),this.denominator):new _(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(e){let n=e instanceof _?e:new _(re(e));return this.denominator.eq(n.denominator)?new _(this.numerator.sub(n.numerator),this.denominator):new _(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(e){let n=e instanceof _?e:new _(re(e));return new _(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(e){let n=e instanceof _?e:new _(re(e));return new _(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(e,n={groupSeparator:""},r=1){Number.isInteger(e)||qe.logWithError(`${e} is not an integer.`),e<=0&&qe.logWithError(`${e} is not positive.`),Ae.set({precision:e+1,rounding:pr[r]});let i=new Ae(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),n)}toFixed(e,n={groupSeparator:""},r=1){return Number.isInteger(e)||qe.logWithError(`${e} is not an integer.`),e<0&&qe.logWithError(`${e} is negative.`),ct.DP=e,ct.RM=dr[r]||1,new ct(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,n)}isZero(){return this.numerator.isZero()}};var Di=j("Raydium_amount"),Ri=xe(gr);import{PublicKey as br}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ut}from"@solana/spl-token";var Wt={chainId:101,address:br.default.toBase58(),programId:Ut.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},le={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Ut.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as ft}from"@solana/web3.js";import{PublicKey as F,SystemProgram as qt,SYSVAR_RENT_PUBKEY as yr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as wr}from"@solana/spl-token";function lt({pubkey:t,isSigner:e=!1,isWritable:n=!0}){return{pubkey:t,isWritable:n,isSigner:e}}var Wi=[lt({pubkey:wr,isWritable:!1}),lt({pubkey:qt.programId,isWritable:!1}),lt({pubkey:yr,isWritable:!1})];function Ht({publicKey:t,transformSol:e}){let n=Gt(t.toString());if(n instanceof F)return e&&n.equals(Se)?nt:n;if(e&&n.toString()===Se.toBase58())return nt;if(typeof n=="string"){if(n===F.default.toBase58())return F.default;try{return new F(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Gt(t){try{return new F(t)}catch{return t}}var qi=new F("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Hi=new F("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Gi=new F("SysvarRent111111111111111111111111111111111"),ji=new F("SysvarC1ock11111111111111111111111111111111"),Zi=new F("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),zi=new F("Sysvar1nstructions1111111111111111111111111"),Ji=qt.programId,Qi=new F("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Xi=new F("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Yi=new F("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),$i=new F("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),eo=new F("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),to=new F("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),no=new F("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ro=new F("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),io=new F("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),oo=new F("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),so=new F("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),nt=new F("So11111111111111111111111111111111111111112"),Se=F.default;var mt=class{symbol;name;decimals;isToken2022;mint;constructor({mint:e,decimals:n,symbol:r,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===Se.toBase58()||e instanceof ft&&Se.equals(e)){this.decimals=le.decimals,this.symbol=le.symbol,this.name=le.name,this.mint=new ft(le.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?ft.default:Ht({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},z=mt;Q(z,"WSOL",new mt({...le,mint:le.address}));var pt=class{symbol;name;decimals;constructor({decimals:e,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=n,this.name=r}equals(e){return this===e}},Ge=pt;Q(Ge,"SOL",new pt(Wt));import Tr from"bn.js";var wo=new _(new Tr(100));var Lo=j("Raydium_price");import{PublicKey as Wo}from"@solana/web3.js";import Ho from"bn.js";var xr=new ie(0),cs=new ie(1),ls=new ie(2),fs=new ie(3),ms=new ie(5),hr=new ie(10),ps=new ie(100),ds=new ie(1e3),gs=new ie(1e4);function tt(t,e=1,n=[]){let r=[...t];if(e<=0)return n;for(;r.length;)n.push(r.splice(0,e));return n}import{PublicKey as Ms}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Rs}from"@solana/spl-token";import{ComputeBudgetProgram as Jt,Keypair as Xt,PublicKey as Pr,Transaction as Yt,TransactionMessage as Ar,VersionedTransaction as $t}from"@solana/web3.js";var Le={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip",NonceAccount:"NonceAccount"};import{TOKEN_PROGRAM_ID as Sr}from"@solana/spl-token";var Qt=j("Raydium_txUtil"),en=1644;function je(t){let e=[],n=[];return t.microLamports&&(e.push(Jt.setComputeUnitPrice({microLamports:t.microLamports})),n.push(Le.SetComputeUnitPrice)),t.units&&(e.push(Jt.setComputeUnitLimit({units:t.units})),n.push(Le.SetComputeUnitLimit)),{instructions:e,instructionTypes:n}}async function ge(t,e){let n=e??"confirmed";return(await t.getLatestBlockhash?.({commitment:n}))?.blockhash}async function Ze(t,e){return t.getSignatureStatuses([e]),new Promise((n,r)=>{let i=setTimeout(r,6e4);t.onSignature(e,o=>{if(clearTimeout(i),!o.err){n("");return}r(Object.assign(o.err,{txId:e}))},"confirmed")})}function dt(t,e){t.length<1&&Qt.logWithError(`no instructions provided: ${t.toString()}`),e.length<1&&Qt.logWithError(`no signers provided:, ${e.toString()}`);let n=new Yt;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=e[0],n.add(...t);try{return Buffer.from(n.serialize({verifySignatures:!1})).toString("base64").length<en}catch{return!1}}function ze(t,e){let[n,r]=Pr.findProgramAddressSync(t,e);return{publicKey:n,nonce:r}}function ke({instructions:t,payer:e,signers:n}){return dt(t,[e,...n])}function Ce({instructions:t,payer:e,lookupTableAddressAccount:n,recentBlockhash:r=Xt.generate().publicKey.toString()}){let o=new Ar({payerKey:e,recentBlockhash:r,instructions:t}).compileToV0Message(Object.values(n??{}));try{return Buffer.from(new $t(o).serialize()).toString("base64").length<en}catch{return!1}}var Lr=t=>Buffer.isBuffer(t)?t:t instanceof Uint8Array?Buffer.from(t.buffer,t.byteOffset,t.byteLength):Buffer.from(t),kr=t=>{let e=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof $t&&(e=Lr(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function fe(t){let e=[];return t.forEach(n=>{n instanceof Yt&&(n.recentBlockhash||(n.recentBlockhash=Sr.toBase58()),n.feePayer||(n.feePayer=Xt.generate().publicKey)),e.push(kr(n))}),console.log("simulate tx string:",e),e}import{PublicKey as C}from"@solana/web3.js";var Fs=new C("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Vs=new C("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Ks=new C("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Us=new C("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Ws=new C("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),qs=new C("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Hs=new C("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Gs=new C("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),js=new C("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Zs=new C("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),zs=new C("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Js=new C("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Qs=new C("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Xs=new C("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Ys=new C("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),$s=new C("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),ea=new C("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ta=new C("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),na=new C("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ra=new C("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),ia=new C("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),oa=new C("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Cr=new C("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Br=new C("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Ir=new C("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),sa=new C("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Nr=new C("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),aa=new C("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Er=new C("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),ua=new C("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),ca=new C("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Mr=new C("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),Dr=new C("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var la={SERUM_MARKET:C.default,OPENBOOK_MARKET:new C("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:C.default,FarmV3:new C("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new C("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new C("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new C("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new C("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new C("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new C("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new C("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new C("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Cr,CREATE_CPMM_POOL_AUTH:Br,CREATE_CPMM_POOL_FEE_ACC:Ir,FEE_DESTINATION_ID:new C("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:Nr,LCOK_CPMM_AUTH:Er,LAUNCHPAD_PROGRAM:Mr,LAUNCHPAD_AUTH:Dr};import pa from"bn.js";import{PublicKey as tn,AddressLookupTableAccount as Je}from"@solana/web3.js";async function gt({connection:t,address:e}){let n=await Re(t,[...new Set(e.map(i=>i.toString()))].map(i=>new tn(i))),r={};for(let i=0;i<e.length;i++){let o=n[i],s=e[i];if(!o)continue;let a=new Je({key:s,state:Je.deserialize(o.data)});r[s.toString()]=a,Qe[s.toString()]=a}return r}var Qe={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Je({key:new tn("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Je.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as he,sendAndConfirmTransaction as ht,SystemProgram as Rr,Transaction as Be,TransactionMessage as Ie,VersionedTransaction as Ne}from"@solana/web3.js";import Or from"axios";var Xe=2e3,Ye=class{connection;owner;instructions=[];endInstructions=[];lookupTableAddress=[];signers=[];instructionTypes=[];endInstructionTypes=[];feePayer;cluster;signAllTransactions;blockhashCommitment;loopMultiTxStatus;constructor(e){this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){let e=(await Or.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:n}=e?.[15]??{};if(!!n)return{units:6e5,microLamports:Math.min(Math.ceil(n*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:n,instructionTypes:r}=je(e);return this.instructions.unshift(...n),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(e){return e?(this.endInstructions.push(Rr.transfer({fromPubkey:e.feePayer??this.feePayer,toPubkey:new he(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(Le.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:n}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;n&&this.instructions.unshift(...n)}catch{n&&this.instructions.unshift(...n)}}addInstruction({instructions:e=[],endInstructions:n=[],signers:r=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...n),this.signers.push(...r),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==he.default.toString())),this}async versionBuild({txVersion:e,extInfo:n},r){return e===0?await this.buildV0({...n||{}},r):this.build(n,r)}build(e,n){let r=new Be;return this.allInstructions.length&&r.add(...this.allInstructions),r.feePayer=this.feePayer,this.owner?.signer&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:r,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=i||{},u=o??n??await ge(this.connection,this.blockhashCommitment);if(r.recentBlockhash=u,this.signers.length&&r.sign(...this.signers),fe([r]),this.owner?.isKeyPair)return{txId:a?await ht(this.connection,r,this.signers.find(f=>f.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(r.serialize(),{skipPreflight:s}),signedTx:r};if(this.signAllTransactions){let l=await this.signAllTransactions([r]);if(this.signers.length)for(let f of l)try{f.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:n=[],extInfo:r}=e,{transaction:i}=this.build(r),o=n.filter(u=>u.transaction.instructions.length>0),s=[i,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return this.owner?.signer&&a.forEach(u=>{u.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async u=>{let{sequentially:l,onTxUpdate:f,skipTxCount:m=0,recentBlockHash:d,skipPreflight:g=!0}=u||{},b=d??await ge(this.connection,this.blockhashCommitment);if(this.owner?.isKeyPair){if(l){let y=[],T=0;for(let w of s){if(++T,T<=m)continue;let h=await ht(this.connection,w,this.signers.find(x=>x.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});y.push(h)}return{txIds:y,signedTxs:s}}return{txIds:await await Promise.all(s.map(async y=>(y.recentBlockhash=b,await this.connection.sendRawTransaction(y.serialize(),{skipPreflight:g})))),signedTxs:s}}if(this.signAllTransactions){let y=s.map((w,h)=>(w.recentBlockhash=b,a[h].length&&w.sign(...a[h]),w));fe(y);let T=await this.signAllTransactions(y);if(l){let w=0,h=[],x=async()=>{if(!T[w])return;let S=await this.connection.sendRawTransaction(T[w].serialize(),{skipPreflight:g});h.push({txId:S,status:"sent",signedTx:T[w]}),f?.([...h]),w++;let L=!1,B=null,I=null,N=R=>{B!==null&&clearInterval(B),I!==null&&this.connection.removeSignatureListener(I);let E=h.findIndex(K=>K.txId===S);if(E>-1){if(h[E].status==="error"||h[E].status==="success")return;h[E].status=R.err?"error":"success"}f?.([...h]),R.err||x()};this.loopMultiTxStatus&&(B=setInterval(async()=>{if(L){clearInterval(B);return}try{let R=await this.connection.getTransaction(S,{commitment:"confirmed",maxSupportedTransactionVersion:0});R&&(L=!0,clearInterval(B),N({err:R.meta?.err||null}),console.log("tx status from getTransaction:",S))}catch(R){L=!0,clearInterval(B),console.error("getTransaction timeout:",R,S)}},Xe)),I=this.connection.onSignature(S,R=>{if(L){this.connection.removeSignatureListener(I);return}L=!0,N(R)},"confirmed"),this.connection.getSignatureStatus(S)};return await x(),{txIds:h.map(S=>S.txId),signedTxs:T}}else{let w=[];for(let h=0;h<T.length;h+=1){let x=await this.connection.sendRawTransaction(T[h].serialize(),{skipPreflight:g});w.push(x)}return{txIds:w,signedTxs:T}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:n,extInfo:r}){return n===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e,n){let{lookupTableCache:r={},lookupTableAddress:i=[],forerunCreate:o,recentBlockhash:s,...a}=e||{},c={...this.cluster==="devnet"?{}:Qe,...r},u=Array.from(new Set([...i,...this.lookupTableAddress])),l=[];for(let g of u)c[g]===void 0&&l.push(new he(g));if(l.length>0){let g=await gt({connection:this.connection,address:l});for(let[b,y]of Object.entries(g))c[b]=y}let f=n??(o?he.default.toBase58():s??await ge(this.connection,this.blockhashCommitment)),m=new Ie({payerKey:this.feePayer,recentBlockhash:f,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(c));this.owner?.signer&&!this.signers.some(g=>g.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let d=new Ne(m);return d.sign(this.signers),{builder:this,transaction:d,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async g=>{let{skipPreflight:b=!0,sendAndConfirm:y,notSendToRpc:T}=g||{};if(fe([d]),this.owner?.isKeyPair){let w=await this.connection.sendTransaction(d,{skipPreflight:b});return y&&await Ze(this.connection,w),{txId:w,signedTx:d}}if(this.signAllTransactions){let w=await this.signAllTransactions([d]);if(this.signers.length)for(let h of w)try{h.sign(this.signers)}catch{}return{txId:T?"":await this.connection.sendTransaction(w[0],{skipPreflight:b}),signedTx:w[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:a||{}}}async buildV0MultiTx(e){let{extraPreBuildData:n=[],buildProps:r}=e,{transaction:i}=await this.buildV0(r),o=n.filter(u=>u.builder.instructions.length>0),s=[i,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return this.owner?.signer&&a.forEach(u=>{u.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(u,l)=>{u.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:r,execute:async u=>{let{sequentially:l,onTxUpdate:f,recentBlockHash:m,skipPreflight:d=!0}=u||{};if(m&&s.forEach(g=>g.message.recentBlockhash=m),fe(s),this.owner?.isKeyPair){if(l){let g=[];for(let b of s){let y=await this.connection.sendTransaction(b,{skipPreflight:d});await Ze(this.connection,y),g.push(y)}return{txIds:g,signedTxs:s}}return{txIds:await Promise.all(s.map(async g=>await this.connection.sendTransaction(g,{skipPreflight:d}))),signedTxs:s}}if(this.signAllTransactions){let g=await this.signAllTransactions(s);if(l){let b=0,y=[],T=async()=>{if(!g[b])return;let w=await this.connection.sendTransaction(g[b],{skipPreflight:d});y.push({txId:w,status:"sent",signedTx:g[b]}),f?.([...y]),b++;let h=!1,x=null,S=null,L=B=>{x!==null&&clearInterval(x),S!==null&&this.connection.removeSignatureListener(S);let I=y.findIndex(N=>N.txId===w);if(I>-1){if(y[I].status==="error"||y[I].status==="success")return;y[I].status=B.err?"error":"success"}f?.([...y]),B.err||T()};this.loopMultiTxStatus&&(x=setInterval(async()=>{if(h){clearInterval(x);return}try{let B=await this.connection.getTransaction(w,{commitment:"confirmed",maxSupportedTransactionVersion:0});B&&(h=!0,clearInterval(x),L({err:B.meta?.err||null}),console.log("tx status from getTransaction:",w))}catch(B){h=!0,clearInterval(x),console.error("getTransaction timeout:",B,w)}},Xe)),S=this.connection.onSignature(w,B=>{if(h){this.connection.removeSignatureListener(S);return}h=!0,L(B)},"confirmed"),this.connection.getSignatureStatus(w)};return T(),{txIds:[],signedTxs:g}}else{let b=[];for(let y=0;y<g.length;y+=1){let T=await this.connection.sendTransaction(g[y],{skipPreflight:d});b.push(T)}return{txIds:b,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){let{splitIns:n=[],computeBudgetConfig:r,...i}=e||{},o=r?je(r):{instructions:[],instructionTypes:[]},s=this.signers.reduce((f,m)=>({...f,[m.publicKey.toBase58()]:m}),{}),a=[],c=[],u=[],l=0;if(this.allInstructions.forEach(f=>{let m=[...u,f],d=r?[...o.instructions,...m]:m,b=[...new Set(m.map(y=>y.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(y=>new he(y));if(f!==n[l]&&u.length<12&&(ke({instructions:d,payer:this.feePayer,signers:b})||ke({instructions:m,payer:this.feePayer,signers:b})))u.push(f);else{if(u.length===0)throw Error("item ins too big");l+=f===n[l]?1:0,ke({instructions:r?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:b})?a.push(new Be().add(...o.instructions,...u)):a.push(new Be().add(...u)),c.push(Array.from(new Set(u.map(y=>y.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat())).map(y=>s[y]).filter(y=>y!==void 0)),u=[f]}}),u.length>0){let m=[...new Set(u.map(d=>d.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(d=>s[d]).filter(d=>d!==void 0);ke({instructions:r?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:m.map(d=>d.publicKey)})?a.push(new Be().add(...o.instructions,...u)):a.push(new Be().add(...u)),c.push(m)}return a.forEach(f=>f.feePayer=this.feePayer),this.owner?.signer&&c.forEach(f=>{f.some(m=>m.publicKey.equals(this.owner.publicKey))||f.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async f=>{let{sequentially:m,onTxUpdate:d,skipTxCount:g=0,recentBlockHash:b,skipPreflight:y=!0}=f||{},T=b??await ge(this.connection,this.blockhashCommitment);if(a.forEach(async(w,h)=>{w.recentBlockhash=T,c[h].length&&w.sign(...c[h])}),fe(a),this.owner?.isKeyPair){if(m){let w=0,h=[];for(let x of a){if(++w,w<=g){h.push("tx skipped");continue}let S=await ht(this.connection,x,this.signers.find(L=>L.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});h.push(S)}return{txIds:h,signedTxs:a}}return{txIds:await Promise.all(a.map(async w=>await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:y}))),signedTxs:a}}if(this.signAllTransactions){let w=await this.signAllTransactions(a.slice(g,a.length)),h=[...a.slice(0,g),...w];if(m){let x=0,S=[],L=async()=>{if(!h[x])return;x<g&&(S.push({txId:"",status:"success",signedTx:h[x]}),d?.([...S]),x++,L());let B=await this.connection.sendRawTransaction(h[x].serialize(),{skipPreflight:y});S.push({txId:B,status:"sent",signedTx:h[x]}),d?.([...S]),x++;let I=!1,N=null,R=null,E=K=>{N!==null&&clearInterval(N),R!==null&&this.connection.removeSignatureListener(R);let W=S.findIndex(J=>J.txId===B);if(W>-1){if(S[W].status==="error"||S[W].status==="success")return;S[W].status=K.err?"error":"success"}d?.([...S]),K.err||L()};this.loopMultiTxStatus&&(N=setInterval(async()=>{if(I){clearInterval(N);return}try{let K=await this.connection.getTransaction(B,{commitment:"confirmed",maxSupportedTransactionVersion:0});K&&(I=!0,clearInterval(N),E({err:K.meta?.err||null}),console.log("tx status from getTransaction:",B))}catch(K){I=!0,clearInterval(N),console.error("getTransaction timeout:",K,B)}},Xe)),R=this.connection.onSignature(B,K=>{if(I){this.connection.removeSignatureListener(R);return}I=!0,E(K)},"confirmed"),this.connection.getSignatureStatus(B)};return await L(),{txIds:S.map(B=>B.txId),signedTxs:h}}else{let x=[];for(let S=0;S<h.length;S+=1){let L=await this.connection.sendRawTransaction(h[S].serialize(),{skipPreflight:y});x.push(L)}return{txIds:x,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(e){let{computeBudgetConfig:n,splitIns:r=[],lookupTableCache:i={},lookupTableAddress:o=[],...s}=e||{},a={...this.cluster==="devnet"?{}:Qe,...i},c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let w of c)a[w]===void 0&&u.push(new he(w));let l=await gt({connection:this.connection,address:u});for(let[w,h]of Object.entries(l))a[w]=h;let f=n?je(n):{instructions:[],instructionTypes:[]},m=await ge(this.connection,this.blockhashCommitment),d=this.signers.reduce((w,h)=>({...w,[h.publicKey.toBase58()]:h}),{}),g=[],b=[],y=[],T=0;if(this.allInstructions.forEach(w=>{let h=[...y,w],x=n?[...f.instructions,...h]:h;if(w!==r[T]&&y.length<12&&(Ce({instructions:x,payer:this.feePayer,lookupTableAddressAccount:a})||Ce({instructions:h,payer:this.feePayer,lookupTableAddressAccount:a})))y.push(w);else{if(y.length===0)throw Error("item ins too big");T+=w===r[T]?1:0;let S={};for(let L of[...new Set(c)])a[L]!==void 0&&(S[L]=a[L]);if(n&&Ce({instructions:[...f.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:m})){let L=new Ie({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f.instructions,...y]}).compileToV0Message(Object.values(a));g.push(new Ne(L))}else{let L=new Ie({payerKey:this.feePayer,recentBlockhash:m,instructions:[...y]}).compileToV0Message(Object.values(a));g.push(new Ne(L))}b.push(Array.from(new Set(y.map(L=>L.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(L=>d[L]).filter(L=>L!==void 0)),y=[w]}}),y.length>0){let h=[...new Set(y.map(x=>x.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat()).values()].map(x=>d[x]).filter(x=>x!==void 0);if(n&&Ce({instructions:[...f.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:m})){let x=new Ie({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f.instructions,...y]}).compileToV0Message(Object.values(a));g.push(new Ne(x))}else{let x=new Ie({payerKey:this.feePayer,recentBlockhash:m,instructions:[...y]}).compileToV0Message(Object.values(a));g.push(new Ne(x))}b.push(h)}return this.owner?.signer&&b.forEach(w=>{w.some(h=>h.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),g.forEach((w,h)=>{w.sign(b[h])}),{builder:this,transactions:g,buildProps:e,signers:b,instructionTypes:this.instructionTypes,execute:async w=>{let{sequentially:h,onTxUpdate:x,skipTxCount:S=0,recentBlockHash:L,skipPreflight:B=!0}=w||{};if(g.map(async(I,N)=>{b[N].length&&I.sign(b[N]),L&&(I.message.recentBlockhash=L)}),fe(g),this.owner?.isKeyPair){if(h){let I=0,N=[];for(let R of g){if(++I,I<=S){console.log("skip tx: ",I),N.push("tx skipped");continue}let E=await this.connection.sendTransaction(R,{skipPreflight:B});await Ze(this.connection,E),N.push(E)}return{txIds:N,signedTxs:g}}return{txIds:await Promise.all(g.map(async I=>await this.connection.sendTransaction(I,{skipPreflight:B}))),signedTxs:g}}if(this.signAllTransactions){let I=await this.signAllTransactions(g.slice(S,g.length)),N=[...g.slice(0,S),...I];if(h){let R=0,E=[],K=async()=>{if(!N[R])return;if(R<S){E.push({txId:"",status:"success",signedTx:N[R]}),x?.([...E]),R++,K();return}let W=await this.connection.sendTransaction(N[R],{skipPreflight:B});E.push({txId:W,status:"sent",signedTx:N[R]}),x?.([...E]),R++;let J=!1,V=null,O=null,At=te=>{V!==null&&clearInterval(V),O!==null&&this.connection.removeSignatureListener(O);let De=E.findIndex(cn=>cn.txId===W);if(De>-1){if(E[De].status==="error"||E[De].status==="success")return;E[De].status=te.err?"error":"success"}x?.([...E]),te.err||K()};this.loopMultiTxStatus&&(V=setInterval(async()=>{if(J){clearInterval(V);return}try{let te=await this.connection.getTransaction(W,{commitment:"confirmed",maxSupportedTransactionVersion:0});te&&(J=!0,clearInterval(V),At({err:te.meta?.err||null}),console.log("tx status from getTransaction:",W))}catch(te){J=!0,clearInterval(V),console.error("getTransaction timeout:",te,W)}},Xe)),O=this.connection.onSignature(W,te=>{if(J){this.connection.removeSignatureListener(O);return}J=!0,At(te)},"confirmed"),this.connection.getSignatureStatus(W)};return K(),{txIds:[],signedTxs:N}}else{let R=[];for(let E=0;E<N.length;E+=1){let K=await this.connection.sendTransaction(N[E],{skipPreflight:B});R.push(K)}return{txIds:R,signedTxs:N}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};import vr from"bn.js";var Da=new vr(1e6);import{PublicKey as Wr}from"@solana/web3.js";import sn,{isBN as an}from"bn.js";import{bits as tu,BitStructure as nu,blob as _r,Blob as ru,cstr as iu,f32 as ou,f32be as su,f64 as au,f64be as uu,greedy as cu,Layout as Fr,ns64 as lu,ns64be as fu,nu64 as mu,nu64be as pu,offset as du,s16 as gu,s16be as hu,s24 as bu,s24be as yu,s32 as wu,s32be as Tu,s40 as xu,s40be as Pu,s48 as Au,s48be as Su,s8 as Lu,seq as Vr,struct as ku,Structure as Kr,u16 as Cu,u16be as Bu,u24 as Iu,u24be as Nu,u32 as Eu,u32be as Mu,u40 as Du,u40be as Ru,u48 as Ou,u48be as vu,u8 as _u,UInt as Ur,union as Fu,Union as Vu,unionLayoutDiscriminator as Ku,utf8 as Uu}from"@solana/buffer-layout";var bt=Fr,nn=Kr;var rn=Ur;var on=Vr;var be=_r;var yt=class extends bt{blob;signed;constructor(e,n,r){super(e,r),this.blob=be(e),this.signed=n}decode(e,n=0){let r=new sn(this.blob.decode(e,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(e,n,r=0){return typeof e=="number"&&(e=new sn(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),n,r)}};function ye(t){return new rn(1,t)}function ee(t){return new yt(8,!1,t)}var wt=class extends bt{layout;decoder;encoder;constructor(e,n,r,i){super(e.span,i),this.layout=e,this.decoder=n,this.encoder=r}decode(e,n){return this.decoder(this.layout.decode(e,n))}encode(e,n,r){return this.layout.encode(this.encoder(e),n,r)}getSpan(e,n){return this.layout.getSpan(e,n)}};function me(t){return new wt(be(32),e=>new Wr(e),e=>e.toBuffer(),t)}var Tt=class extends nn{decode(e,n){return super.decode(e,n)}};function we(t,e,n){return new Tt(t,e,n)}function Ee(t,e,n){let r,i=typeof e=="number"?e:an(e)?e.toNumber():new Proxy(e,{get(o,s){if(!r){let a=Reflect.get(o,"count");r=an(a)?a.toNumber():a,Reflect.set(o,"count",r)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(r=a),Reflect.set(o,s,a)}});return on(t,i,n)}var xt=(...t)=>t.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Me=class{scope;disabled=!1;logger;constructor({scope:e,moduleName:n}){this.scope=e,this.logger=j(n)}createTxBuilder(e){return this.scope.checkOwner(),new Ye({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(xt(e))}logInfo(...e){this.logger.info(xt(e))}logAndCreateError(...e){let n=xt(e);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var G=class extends Me{static getPdaPoolId(e,n){return ze([G.SEED_CONFIG.pool.id,n.toBuffer()],e)}static getPdaOwnerId(e,n,r,i){return ze([G.SEED_CONFIG.owner.id,n.toBuffer(),r.toBuffer(),Buffer.from(new un(i).toArray())],e)}static async getAllInfo({connection:e,programId:n,poolIds:r,wallet:i,chainTime:o}){if(r.length===0)return[];let s=r.map(l=>G.getPdaPoolId(n,l).publicKey),a=[];for(let l=0;l<G.VERSION_PROJECT.length;l++)a.push(...s.map(f=>G.getPdaOwnerId(n,f,i,l).publicKey));let c=await Re(e,[...s,...a]),u=[];for(let l=0;l<c.length;l++){let f=Math.floor(l/r.length),m=l%r.length,d=s[m],g=a[l],b=c[m],y=c[r.length+l];if(!(b&&y)||b.data.length!==G.POOL_LAYOUT.span||y.data.length!==G.OWNER_LAYOUT.span)continue;let T=G.POOL_LAYOUT.decode(b.data),w=G.OWNER_LAYOUT.decode(y.data),h=T.openTime.toNumber(),x=T.endTime.toNumber(),S=w.tokenInfo.map(I=>I.debtAmount.gt(new un(0))).filter(I=>!I).length!==3,L=o>h&&o<x&&T.status===1,B=S&&L;u.push({programId:n,poolId:d,ammId:T.ammId,ownerAccountId:g,snapshotLpAmount:w.lpAmount,project:G.VERSION_PROJECT[f],openTime:h,endTime:x,canClaim:B,canClaimErrorType:S?L?void 0:"outOfOperationalTime":"alreadyClaimIt",tokenInfo:T.tokenInfo.map((I,N)=>({mintAddress:I.mintAddress,mintVault:I.mintVault,mintDecimals:I.mintDecimals,perLpLoss:I.perLpLoss,debtAmount:w.tokenInfo[N].debtAmount.add(w.tokenInfo[N].claimedAmount)}))})}return u}async makeClaimTransaction({poolInfo:e,ownerInfo:n,feePayer:r}){n.wallet||this.scope.checkOwner();let i=this.createTxBuilder(r),o=n.wallet||this.scope.ownerPubKey,s=[];for(let u of e.tokenInfo){let{account:l,instructionParams:f}=await this.scope.account.getOrCreateTokenAccount({mint:u.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:u.mintAddress.equals(z.WSOL.mint),createInfo:{payer:o,amount:0},skipCloseAccount:!u.mintAddress.equals(z.WSOL.mint),associatedOnly:u.mintAddress.equals(z.WSOL.mint)?!1:n.associatedOnly});f&&i.addInstruction(f),s.push(l)}i.addInstruction({instructions:[G.makeClaimInstruction({programId:e.programId,poolInfo:e,ownerInfo:{wallet:o,ownerPda:e.ownerAccountId,claimAddress:s}})]});let{transaction:a,signers:c}=i.build();return[{transaction:a,signer:c}]}async makeClaimAllTransaction({poolInfos:e,ownerInfo:n,feePayer:r}){let i=this.createTxBuilder(r),o=n.wallet||this.scope.ownerPubKey,s={};for(let l of e){let f=[];for(let m of l.tokenInfo){let{account:d,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({mint:m.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:m.mintAddress.equals(z.WSOL.mint),createInfo:{payer:o,amount:0},skipCloseAccount:!m.mintAddress.equals(z.WSOL.mint),associatedOnly:m.mintAddress.equals(z.WSOL.mint)?!1:n.associatedOnly});g&&i.addInstruction(g),d&&(s[m.mintAddress.toString()]=d,f.push(d))}i.addInstruction({instructions:[G.makeClaimInstruction({programId:l.programId,poolInfo:l,ownerInfo:{wallet:o,ownerPda:l.ownerAccountId,claimAddress:f}})]})}let{transaction:a,signers:c}=i.build(),u=i.allInstructions;return dt(u,[o,...c.map(l=>l.publicKey)])?[{transaction:a,signer:c}]:[{transaction:new Pt().add(...u.slice(0,i.AllTxData.instructions.length-1)),signer:c},{transaction:new Pt().add(...u.slice(i.AllTxData.instructions.length-1)),signer:[]},{transaction:new Pt().add(...i.AllTxData.endInstructions),signer:[]}]}static makeClaimInstruction({programId:e,poolInfo:n,ownerInfo:r}){let i=we([]),o=[{pubkey:r.wallet,isSigner:!0,isWritable:!0},{pubkey:n.poolId,isSigner:!1,isWritable:!0},{pubkey:r.ownerPda,isSigner:!1,isWritable:!0},...r.claimAddress.map(c=>({pubkey:c,isSigner:!1,isWritable:!0})),...n.tokenInfo.map(({mintVault:c})=>({pubkey:c,isSigner:!1,isWritable:!0})),{pubkey:Gr,isSigner:!1,isWritable:!1}],s=Buffer.alloc(i.span);i.encode({},s);let a=Buffer.from([10,66,208,184,161,6,191,98,...s]);return new Hr({keys:o,programId:e,data:a})}},oe=G;Q(oe,"CLAIMED_NUM",3),Q(oe,"POOL_LAYOUT",we([be(8),ye("bump"),ye("status"),ee("openTime"),ee("endTime"),me("ammId"),Ee(we([ye("mintDecimals"),me("mintAddress"),me("mintVault"),ee("perLpLoss"),ee("totalClaimedAmount")]),G.CLAIMED_NUM,"tokenInfo"),Ee(ee(),10,"padding")])),Q(oe,"OWNER_LAYOUT",we([be(8),ye("bump"),ye("version"),me("poolId"),me("owner"),ee("lpAmount"),Ee(we([me("mintAddress"),ee("debtAmount"),ee("claimedAmount")]),G.CLAIMED_NUM,"tokenInfo"),Ee(ee(),4,"padding")])),Q(oe,"DEFAULT_POOL_ID",["58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2","6UmmUiYoBjSrhakAobJw8BvkmJtDVxaeBtbt7rxWo1mg","AVs9TA4nWDzfPJE9gGVNJMVhcQy3V9PGazuz33BfG2RA","DVa7Qmb5ct9RCpaU7UTpSaf3GVMYz17vNVU67XpdCRut","7XawhbbxtsRcQA8KTkHT9f9nc6d69UwqCDh6U5EEbEmX","6a1CsrpeZubDjEJE9s1CMVheB6HWM5d7m1cj2jkhyXhj","EoNrn8iUhwgJySD1pHu8Qxm5gSQqLK3za4m8xzD2RuEb","AceAyRTWt4PyB2pHqf2qhDgNZDtKVNaxgL8Ru3V4aN1P","6tmFJbMk5yVHFcFy7X2K8RwHjKLr6KVFLYXpgpBNeAxB"].map(e=>new qr(e))),Q(oe,"SEED_CONFIG",{pool:{id:Buffer.from("pool_seed","utf8")},owner:{id:Buffer.from("user_claim_seed","utf8")}}),Q(oe,"VERSION_PROJECT",[void 0,"Francium","Tulip","Larix"]);export{oe as default};
//# sourceMappingURL=utils1216.mjs.map